<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>collapse and plm • collapse</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="collapse and plm">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">collapse</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">2.1.3.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Documentation</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://sebkrantz.github.io/Rblog/">Blog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://bsky.app/profile/rcollapse.bsky.social" aria-label="BlueSky"><span class="fa fa-bluesky"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://twitter.com/collapse_R" aria-label="Twitter"><span class="fa fa-twitter"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/SebKrantz/collapse" aria-label="GitHub"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>collapse and plm</h1>
            <h3 data-toc-skip class="subtitle">Fast Transformation and
Exploration of Panel Data</h3>
                        <h4 data-toc-skip class="author">Sebastian
Krantz</h4>
            
            <h4 data-toc-skip class="date">2021-06-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/SebKrantz/collapse/blob/master/vignettes/collapse_and_plm.Rmd" class="external-link"><code>vignettes/collapse_and_plm.Rmd</code></a></small>
      <div class="d-none name"><code>collapse_and_plm.Rmd</code></div>
    </div>

    
    
<style type="text/css">
pre {
  max-height: 600px;
  overflow-y: auto;
}

pre[class] {
  max-height: 600px;
}
</style>
<!--
*collapse* is a C/C++ based package for data transformation and statistical computing in R. It's aims are:

1. To facilitate complex data transformation, exploration and computing tasks in R.
2. To help make R code fast, flexible, parsimonious and programmer friendly.
--><p>This vignette focuses on the integration of <em>collapse</em> and the
popular <em>plm</em> (‘Linear Models for Panel Data’) package by Yves
Croissant, Giovanni Millo and Kevin Tappe. It will demonstrate the
utility of the <em>pseries</em> and <em>pdata.frame</em> classes
introduced in <em>plm</em> together with the corresponding methods for
fast <em>collapse</em> functions (implemented in C or C++), to extend
and facilitate extremely fast computations on panel-vectors and panel
data frames (20-100 times faster than native <em>plm</em>). The
<em>collapse</em> package should enable R programmers to - with very
little effort - write high-performance code in the domain of panel data
exploration and panel data econometrics.</p>
<!-- The computations considered are between and within transformations (grouped averaging and centering), higher-dimensional between and within transformations (i.e. averaging and centering over multiple groups), standardizing (i.e. scaling and centering), weighted versions of all of the above, sequences of panel- lags / leads and lagged / leaded and iterated differences and growth rates / log-differences, panel- auto-, partial-auto and cross-correlation functions, panel data to (ts-) matrix / array conversions, and summary statistics for panel data. Not really covered in this vignette is the whole suite of *Fast Statistical Functions* in the *collapse* package, which may of course also be used for grouped and weighted operations on panel data, but currently do not have methods for *plm* classes.  -->
<hr>
<p><strong>Notes:</strong></p>
<ul>
<li><p>To learn more about <em>collapse</em>, see the ‘Introduction to
<em>collapse</em>’ vignette or the built-in structured documentation
available under <code><a href="../reference/collapse-documentation.html">help("collapse-documentation")</a></code> after
installing the package. In addition
<code><a href="../reference/collapse-package.html">help("collapse-package")</a></code> provides a compact set of examples
for quick-start.</p></li>
<li><p>Documentation and vignettes can also be viewed <a href="https://sebkrantz.github.io/collapse/">online</a>.</p></li>
</ul>
<hr>
<p>The vignette is structured as follows:</p>
<ul>
<li><p><strong>Part 1</strong> introduces <em>collapse</em>’s fast
functions and associated <em>transformation operators</em> to compute
various transformations on panel data, and delivers some
benchmarks.</p></li>
<li><p><strong>Part 2</strong> uses these functions to explore panel
data a bit and introduce additional functions for summary statistics,
panel-autocorrelations and testing fixed effects.</p></li>
<li><p><strong>Part 3</strong> finally provides an example programming
application by coding a slightly extended and very efficient Hausman and
Taylor (1981) estimator.</p></li>
</ul>
<p>For this vignette we will use a dataset (<code>wlddev</code>)
supplied with <em>collapse</em> containing a panel of 5 key development
indicators taken from the World Bank Development Indicators
Database:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sebkrantz.github.io/collapse/">collapse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">wlddev</span><span class="op">)</span></span>
<span><span class="co">#       country iso3c       date year decade     region     income  OECD PCGDP LIFEEX GINI       ODA</span></span>
<span><span class="co"># 1 Afghanistan   AFG 1961-01-01 1960   1960 South Asia Low income FALSE    NA 32.446   NA 116769997</span></span>
<span><span class="co"># 2 Afghanistan   AFG 1962-01-01 1961   1960 South Asia Low income FALSE    NA 32.962   NA 232080002</span></span>
<span><span class="co"># 3 Afghanistan   AFG 1963-01-01 1962   1960 South Asia Low income FALSE    NA 33.471   NA 112839996</span></span>
<span><span class="co"># 4 Afghanistan   AFG 1964-01-01 1963   1960 South Asia Low income FALSE    NA 33.971   NA 237720001</span></span>
<span><span class="co"># 5 Afghanistan   AFG 1965-01-01 1964   1960 South Asia Low income FALSE    NA 34.463   NA 295920013</span></span>
<span><span class="co"># 6 Afghanistan   AFG 1966-01-01 1965   1960 South Asia Low income FALSE    NA 34.948   NA 341839996</span></span>
<span><span class="co">#       POP</span></span>
<span><span class="co"># 1 8996973</span></span>
<span><span class="co"># 2 9169410</span></span>
<span><span class="co"># 3 9351441</span></span>
<span><span class="co"># 4 9543205</span></span>
<span><span class="co"># 5 9744781</span></span>
<span><span class="co"># 6 9956320</span></span>
<span></span>
<span><span class="fu"><a href="../reference/fnobs.html">fnobs</a></span><span class="op">(</span><span class="va">wlddev</span><span class="op">)</span>      <span class="co"># This column-wise counts the number of observations</span></span>
<span><span class="co"># country   iso3c    date    year  decade  region  income    OECD   PCGDP  LIFEEX    GINI     ODA </span></span>
<span><span class="co">#   13176   13176   13176   13176   13176   13176   13176   13176    9470   11670    1744    8608 </span></span>
<span><span class="co">#     POP </span></span>
<span><span class="co">#   12919</span></span>
<span></span>
<span><span class="fu"><a href="../reference/fndistinct.html">fndistinct</a></span><span class="op">(</span><span class="va">wlddev</span><span class="op">)</span> <span class="co"># This counts the number of distinct values</span></span>
<span><span class="co"># country   iso3c    date    year  decade  region  income    OECD   PCGDP  LIFEEX    GINI     ODA </span></span>
<span><span class="co">#     216     216      61      61       7       7       4       2    9470   10548     368    7832 </span></span>
<span><span class="co">#     POP </span></span>
<span><span class="co">#   12877</span></span></code></pre></div>
<div class="section level2">
<h2 id="part-1-fast-transformation-of-panel-data">Part 1: Fast Transformation of Panel Data<a class="anchor" aria-label="anchor" href="#part-1-fast-transformation-of-panel-data"></a>
</h2>
<p>First let us convert this data to a <em>plm</em> panel data.frame
(class <em>pdata.frame</em>):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cran.r-project.org/package=plm" class="external-link">plm</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This creates a panel data frame</span></span>
<span><span class="va">pwlddev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/plm/man/pdata.frame.html" class="external-link">pdata.frame</a></span><span class="op">(</span><span class="va">wlddev</span>, index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iso3c"</span>, <span class="st">"year"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">pwlddev</span>, give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># Classes 'pdata.frame' and 'data.frame':   13176 obs. of  13 variables:</span></span>
<span><span class="co">#  $ country: 'pseries' Named chr  "Aruba" "Aruba" "Aruba" "Aruba" ...</span></span>
<span><span class="co">#  $ iso3c  : Factor w/ 216 levels "ABW","AFG","AGO",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#  $ date   : pseries, format: "1961-01-01" "1962-01-01" "1963-01-01" ...</span></span>
<span><span class="co">#  $ year   : Factor w/ 61 levels "1960","1961",..: 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#  $ decade : 'pseries' Named int  1960 1960 1960 1960 1960 1960 1960 1960 1960 1960 ...</span></span>
<span><span class="co">#  $ region : Factor w/ 7 levels "East Asia &amp; Pacific",..: 3 3 3 3 3 3 3 3 3 3 ...</span></span>
<span><span class="co">#  $ income : Factor w/ 4 levels "High income",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#  $ OECD   : 'pseries' Named logi  FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#  $ PCGDP  : 'pseries' Named num  NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#  $ LIFEEX : 'pseries' Named num  65.7 66.1 66.4 66.8 67.1 ...</span></span>
<span><span class="co">#  $ GINI   : 'pseries' Named num  NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#  $ ODA    : 'pseries' Named num  NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#  $ POP    : 'pseries' Named num  54211 55438 56225 56695 57032 ...</span></span>
<span></span>
<span><span class="co"># A pdata.frame has an index attribute attached [retrieved using index(pwlddev) or attr(pwlddev, "index")]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html" class="external-link">index</a></span><span class="op">(</span><span class="va">pwlddev</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Classes 'pindex' and 'data.frame':    13176 obs. of  2 variables:</span></span>
<span><span class="co">#  $ iso3c: Factor w/ 216 levels "ABW","AFG","AGO",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#  $ year : Factor w/ 61 levels "1960","1961",..: 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span></span>
<span><span class="co"># This shows the individual and time dimensions</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/plm/man/pdim.html" class="external-link">pdim</a></span><span class="op">(</span><span class="va">pwlddev</span><span class="op">)</span></span>
<span><span class="co"># Balanced Panel: n = 216, T = 61, N = 13176</span></span></code></pre></div>
<!-- # This shows which variables vary across which dimensions -->
<!-- pvar(pwlddev) -->
<p>A <code><a href="https://rdrr.io/pkg/plm/man/pdata.frame.html" class="external-link">plm::pdata.frame</a></code> is a data.frame with panel
identifiers attached as a list of factors in an <em>index</em> attribute
(non-factor index variables are converted to factor). Each column in
that data.frame is a Panel Series (<code><a href="https://rdrr.io/pkg/plm/man/pseries.html" class="external-link">plm::pseries</a></code>), which
also has the panel identifiers attached:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Panel Series of GDP per Capita and Life-Expectancy at Birth</span></span>
<span><span class="va">PCGDP</span> <span class="op">&lt;-</span> <span class="va">pwlddev</span><span class="op">$</span><span class="va">PCGDP</span></span>
<span><span class="va">LIFEEX</span> <span class="op">&lt;-</span> <span class="va">pwlddev</span><span class="op">$</span><span class="va">LIFEEX</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span></span>
<span><span class="co">#  'pseries' Named num [1:13176] 65.7 66.1 66.4 66.8 67.1 ...</span></span>
<span><span class="co">#  - attr(*, "names")= chr [1:13176] "ABW-1960" "ABW-1961" "ABW-1962" "ABW-1963" ...</span></span>
<span><span class="co">#  - attr(*, "index")=Classes 'pindex' and 'data.frame':    13176 obs. of  2 variables:</span></span>
<span><span class="co">#   ..$ iso3c: Factor w/ 216 levels "ABW","AFG","AGO",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#   ..$ year : Factor w/ 61 levels "1960","1961",..: 1 2 3 4 5 6 7 8 9 10 ...</span></span></code></pre></div>
<p>Now that we have explored the basic data structures provided in the
<em>plm</em> package, let’s compute some transformations on them:</p>
<div class="section level3">
<h3 id="between-and-within-transformations">1.1 Between and Within Transformations<a class="anchor" aria-label="anchor" href="#between-and-within-transformations"></a>
</h3>
<p>The functions <code>fbetween</code> and <code>fbetween</code> can be
used to compute efficient between and within transformations on panel
vectors and panel data.frames:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Between-Transformations</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">fbetween</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span><span class="op">)</span>                        <span class="co"># Between individual (default)</span></span>
<span><span class="co"># ABW-1960 ABW-1961 ABW-1962 ABW-1963 ABW-1964 ABW-1965 </span></span>
<span><span class="co"># 72.40653 72.40653 72.40653 72.40653 72.40653 72.40653</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">fbetween</a></span><span class="op">(</span><span class="va">LIFEEX</span>, effect <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span><span class="op">)</span>       <span class="co"># Between time</span></span>
<span><span class="co"># ABW-1960 ABW-1961 ABW-1962 ABW-1963 ABW-1964 ABW-1965 </span></span>
<span><span class="co"># 53.91206 54.47441 54.85718 55.20272 55.66802 56.12963</span></span>
<span></span>
<span><span class="co"># Within-Transformations</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">fwithin</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span><span class="op">)</span>                         <span class="co"># Within individuals (default)</span></span>
<span><span class="co">#  ABW-1960  ABW-1961  ABW-1962  ABW-1963  ABW-1964  ABW-1965 </span></span>
<span><span class="co"># -6.744533 -6.332533 -5.962533 -5.619533 -5.293533 -4.971533</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">fwithin</a></span><span class="op">(</span><span class="va">LIFEEX</span>, effect <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span><span class="op">)</span>        <span class="co"># Within time</span></span>
<span><span class="co"># ABW-1960 ABW-1961 ABW-1962 ABW-1963 ABW-1964 ABW-1965 </span></span>
<span><span class="co"># 11.74994 11.59959 11.58682 11.58428 11.44498 11.30537</span></span></code></pre></div>
<p>by default <code>na.rm = TRUE</code> thus both functions skip
(preserve) missing values in the data (which is the default for all
<em>collapse</em> functions). For <code>fbetween</code> the output
behavior can be altered with the option <code>fill</code>: Setting
<code>fill = TRUE</code> will compute the group-means on the complete
cases in each group (as long as <code>na.rm = TRUE</code>), but replace
all values in each group with the group mean (hence overwriting or
‘filling up’ missing values):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This preserves missing values in the output</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">fbetween</a></span><span class="op">(</span><span class="va">PCGDP</span><span class="op">)</span>, <span class="fl">30</span><span class="op">)</span></span>
<span><span class="co"># ABW-1960 ABW-1961 ABW-1962 ABW-1963 ABW-1964 ABW-1965 ABW-1966 ABW-1967 ABW-1968 ABW-1969 ABW-1970 </span></span>
<span><span class="co">#       NA       NA       NA       NA       NA       NA       NA       NA       NA       NA       NA </span></span>
<span><span class="co"># ABW-1971 ABW-1972 ABW-1973 ABW-1974 ABW-1975 ABW-1976 ABW-1977 ABW-1978 ABW-1979 ABW-1980 ABW-1981 </span></span>
<span><span class="co">#       NA       NA       NA       NA       NA       NA       NA       NA       NA       NA       NA </span></span>
<span><span class="co"># ABW-1982 ABW-1983 ABW-1984 ABW-1985 ABW-1986 ABW-1987 ABW-1988 ABW-1989 </span></span>
<span><span class="co">#       NA       NA       NA       NA 25413.84 25413.84 25413.84 25413.84</span></span>
<span></span>
<span><span class="co"># This replaces all individuals with the group mean</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">fbetween</a></span><span class="op">(</span><span class="va">PCGDP</span>, fill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fl">30</span><span class="op">)</span></span>
<span><span class="co"># ABW-1960 ABW-1961 ABW-1962 ABW-1963 ABW-1964 ABW-1965 ABW-1966 ABW-1967 ABW-1968 ABW-1969 ABW-1970 </span></span>
<span><span class="co"># 25413.84 25413.84 25413.84 25413.84 25413.84 25413.84 25413.84 25413.84 25413.84 25413.84 25413.84 </span></span>
<span><span class="co"># ABW-1971 ABW-1972 ABW-1973 ABW-1974 ABW-1975 ABW-1976 ABW-1977 ABW-1978 ABW-1979 ABW-1980 ABW-1981 </span></span>
<span><span class="co"># 25413.84 25413.84 25413.84 25413.84 25413.84 25413.84 25413.84 25413.84 25413.84 25413.84 25413.84 </span></span>
<span><span class="co"># ABW-1982 ABW-1983 ABW-1984 ABW-1985 ABW-1986 ABW-1987 ABW-1988 ABW-1989 </span></span>
<span><span class="co"># 25413.84 25413.84 25413.84 25413.84 25413.84 25413.84 25413.84 25413.84</span></span></code></pre></div>
<p>In <code>fwithin</code> the <code>mean</code> argument allows to set
an arbitrary data mean (different from 0) after the data is centered. In
grouped centering task, as sensible choice for such an added mean would
be the overall mean of the data series, enabled by the option
<code>mean = "overall.mean"</code>. This will add the overall mean of
the series back to the data after subtracting out group means, and thus
preserve the level of the data (and will only change the intercept when
employed in a regression):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This performed standard grouped centering</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">fwithin</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#  ABW-1960  ABW-1961  ABW-1962  ABW-1963  ABW-1964  ABW-1965 </span></span>
<span><span class="co"># -6.744533 -6.332533 -5.962533 -5.619533 -5.293533 -4.971533</span></span>
<span></span>
<span><span class="co"># This adds the overall average Life-Expectancy (across countries) to the country-demeaned series</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">fwithin</a></span><span class="op">(</span><span class="va">LIFEEX</span>, mean <span class="op">=</span> <span class="st">"overall.mean"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># ABW-1960 ABW-1961 ABW-1962 ABW-1963 ABW-1964 ABW-1965 </span></span>
<span><span class="co"># 57.55177 57.96377 58.33377 58.67677 59.00277 59.32477</span></span></code></pre></div>
<p><code>fbetween</code> and <code>fwithin</code> can also be applied to
<em>pdata.frame</em>’s where they will perform these computations
variable by variable:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">fbetween</a></span><span class="op">(</span><span class="fu"><a href="../reference/select_replace_vars.html">num_vars</a></span><span class="op">(</span><span class="va">pwlddev</span><span class="op">)</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#            decade PCGDP   LIFEEX GINI ODA      POP</span></span>
<span><span class="co"># ABW-1960 1985.574    NA 72.40653   NA  NA 76268.63</span></span>
<span><span class="co"># ABW-1961 1985.574    NA 72.40653   NA  NA 76268.63</span></span>
<span><span class="co"># ABW-1962 1985.574    NA 72.40653   NA  NA 76268.63</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">fbetween</a></span><span class="op">(</span><span class="fu"><a href="../reference/select_replace_vars.html">num_vars</a></span><span class="op">(</span><span class="va">pwlddev</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#            decade    PCGDP   LIFEEX GINI      ODA      POP</span></span>
<span><span class="co"># ABW-1960 1985.574 25413.84 72.40653   NA 33245000 76268.63</span></span>
<span><span class="co"># ABW-1961 1985.574 25413.84 72.40653   NA 33245000 76268.63</span></span>
<span><span class="co"># ABW-1962 1985.574 25413.84 72.40653   NA 33245000 76268.63</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">fwithin</a></span><span class="op">(</span><span class="fu"><a href="../reference/select_replace_vars.html">num_vars</a></span><span class="op">(</span><span class="va">pwlddev</span><span class="op">)</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#             decade PCGDP    LIFEEX GINI ODA       POP</span></span>
<span><span class="co"># ABW-1960 -25.57377    NA -6.744533   NA  NA -22057.63</span></span>
<span><span class="co"># ABW-1961 -25.57377    NA -6.332533   NA  NA -20830.63</span></span>
<span><span class="co"># ABW-1962 -25.57377    NA -5.962533   NA  NA -20043.63</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">fwithin</a></span><span class="op">(</span><span class="fu"><a href="../reference/select_replace_vars.html">num_vars</a></span><span class="op">(</span><span class="va">pwlddev</span><span class="op">)</span>, mean <span class="op">=</span> <span class="st">"overall.mean"</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#          decade PCGDP   LIFEEX GINI ODA      POP</span></span>
<span><span class="co"># ABW-1960   1960    NA 57.55177   NA  NA 24223914</span></span>
<span><span class="co"># ABW-1961   1960    NA 57.96377   NA  NA 24225141</span></span>
<span><span class="co"># ABW-1962   1960    NA 58.33377   NA  NA 24225928</span></span></code></pre></div>
<p>Now next to <code>fbetween</code> and <code>fwithin</code> there also
exist short versions <code>B</code> and <code>W</code>, which are
referred to as <em>transformation operators</em>. These are essentially
wrappers around <code>fbetween</code> and <code>fwithin</code> and
provide the same functionality, but are more parsimonious to employ in
regression formulas and also offer additional features when applied to
panel data.frames. For panel series, <code>B</code> and <code>W</code>
are exact analogues to <code>fbetween</code> and <code>fwithin</code>,
just under a shorter name:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">fbetween</a></span><span class="op">(</span><span class="va">PCGDP</span><span class="op">)</span>, <span class="fu"><a href="../reference/fbetween_fwithin.html">B</a></span><span class="op">(</span><span class="va">PCGDP</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># [1] TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">fbetween</a></span><span class="op">(</span><span class="va">PCGDP</span>, fill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fu"><a href="../reference/fbetween_fwithin.html">B</a></span><span class="op">(</span><span class="va">PCGDP</span>, fill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># [1] TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">fwithin</a></span><span class="op">(</span><span class="va">PCGDP</span><span class="op">)</span>, <span class="fu"><a href="../reference/fbetween_fwithin.html">W</a></span><span class="op">(</span><span class="va">PCGDP</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># [1] TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">fwithin</a></span><span class="op">(</span><span class="va">PCGDP</span>, mean <span class="op">=</span> <span class="st">"overall.mean"</span><span class="op">)</span>, <span class="fu"><a href="../reference/fbetween_fwithin.html">W</a></span><span class="op">(</span><span class="va">PCGDP</span>, mean <span class="op">=</span> <span class="st">"overall.mean"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># [1] TRUE</span></span></code></pre></div>
<p>When applied to panel data.frames, <code>B</code> and <code>W</code>
offer some additional utility by (a) allowing you to select columns to
transform using the <code>cols</code> argument (default is
<code>cols = is.numeric</code>, so by default all numeric columns will
be selected for transformation), (b) allowing you to add a prefix to the
transformed columns with the <code>stub</code> argument (default is
<code>stub = "B."</code> for <code>B</code> and <code>stub = "W."</code>
for <code>W</code>) and (c) preserving the panel-id’s with the
<code>keep.ids</code> argument (default
<code>keep.ids = TRUE</code>):</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">B</a></span><span class="op">(</span><span class="va">pwlddev</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#          iso3c year B.decade B.PCGDP B.LIFEEX B.GINI B.ODA    B.POP</span></span>
<span><span class="co"># ABW-1960   ABW 1960 1985.574      NA 72.40653     NA    NA 76268.63</span></span>
<span><span class="co"># ABW-1961   ABW 1961 1985.574      NA 72.40653     NA    NA 76268.63</span></span>
<span><span class="co"># ABW-1962   ABW 1962 1985.574      NA 72.40653     NA    NA 76268.63</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">W</a></span><span class="op">(</span><span class="va">pwlddev</span>, cols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span> <span class="co"># Here using the cols argument</span></span>
<span><span class="co">#          iso3c year W.PCGDP  W.LIFEEX W.GINI W.ODA</span></span>
<span><span class="co"># ABW-1960   ABW 1960      NA -6.744533     NA    NA</span></span>
<span><span class="co"># ABW-1961   ABW 1961      NA -6.332533     NA    NA</span></span>
<span><span class="co"># ABW-1962   ABW 1962      NA -5.962533     NA    NA</span></span></code></pre></div>
<!-- The main philosophy behind having transformation operators like `B` and `W` is that they are more parsimonious to use ad-hoc (i.e. to demean a variable in a regression formula), and also offer more convenient output for ad-hoc computations on data.frames, whereas the corresponding functions `fbetween` and `fwithin` are a bit simpler in terms of R-code (and thus a tiny bit faster) and also more convenient for programming since they require all inputs to be provided in terms of data.  -->
<p><code>fbetween</code> / <code>B</code> and <code>fwithin</code> /
<code>W</code> also support weighted computations. This of course
applies more to panel-survey settings, but for the sake of illustration
suppose we wanted to weight our between and within transformations by
the population of these countries:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This replaces values by the POP-weighted group mean and also preserves the weight variable (POP, argument keep.w = TRUE)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">B</a></span><span class="op">(</span><span class="va">pwlddev</span>, w <span class="op">=</span> <span class="op">~</span> <span class="va">POP</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#          iso3c year   POP B.decade B.PCGDP B.LIFEEX B.GINI B.ODA</span></span>
<span><span class="co"># ABW-1960   ABW 1960 54211 1988.976      NA 72.96257     NA    NA</span></span>
<span><span class="co"># ABW-1961   ABW 1961 55438 1988.976      NA 72.96257     NA    NA</span></span>
<span><span class="co"># ABW-1962   ABW 1962 56225 1988.976      NA 72.96257     NA    NA</span></span>
<span></span>
<span><span class="co"># This centers values on the POP-weighted group mean</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">W</a></span><span class="op">(</span><span class="va">pwlddev</span>, w <span class="op">=</span> <span class="op">~</span> <span class="va">POP</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PCGDP"</span>,<span class="st">"LIFEEX"</span>,<span class="st">"GINI"</span><span class="op">)</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#          iso3c year   POP W.PCGDP  W.LIFEEX W.GINI</span></span>
<span><span class="co"># ABW-1960   ABW 1960 54211      NA -7.300566     NA</span></span>
<span><span class="co"># ABW-1961   ABW 1961 55438      NA -6.888566     NA</span></span>
<span><span class="co"># ABW-1962   ABW 1962 56225      NA -6.518566     NA</span></span>
<span></span>
<span><span class="co"># This centers values on the POP-weighted group mean and also adds the overall POP-weighted mean of the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">W</a></span><span class="op">(</span><span class="va">pwlddev</span>, w <span class="op">=</span> <span class="op">~</span> <span class="va">POP</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PCGDP"</span>,<span class="st">"LIFEEX"</span>,<span class="st">"GINI"</span><span class="op">)</span>, mean <span class="op">=</span> <span class="st">"overall.mean"</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#          iso3c year   POP W.PCGDP W.LIFEEX W.GINI</span></span>
<span><span class="co"># ABW-1960   ABW 1960 54211      NA 58.58012     NA</span></span>
<span><span class="co"># ABW-1961   ABW 1961 55438      NA 58.99212     NA</span></span>
<span><span class="co"># ABW-1962   ABW 1962 56225      NA 59.36212     NA</span></span></code></pre></div>
<p>As shown above, with <code>B</code> and <code>W</code> the weight
column can also be passed as a formula or character string, whereas
<code>fbetween</code> and <code>fwithin</code> require the all inputs to
be passed directly in terms of data
(i.e. <code>fbetween(get_vars(pwlddev, 9:11), w = pwlddev$POP)</code>),
and the weight vector or id columns are never preserved in the output.
Therefore in most applications <code>B</code> and <code>W</code> are
probably more convenient for quick use, whereas <code>fbetween</code>
and <code>fwithin</code> are the preferred programmers choice, also
because they have a little less R-overhead which makes them a tiny bit
faster.</p>
</div>
<div class="section level3">
<h3 id="higher-dimensional-between-and-within-transformations">1.2 Higher-Dimensional Between and Within Transformations<a class="anchor" aria-label="anchor" href="#higher-dimensional-between-and-within-transformations"></a>
</h3>
<p>Analogous to <code>fbetween</code> / <code>B</code> and
<code>fwithin</code> / <code>W</code>, <em>collapse</em> provides a duo
of functions and operators <code>fhdbetween</code> / <code>HDB</code>
and <code>fhdwithin</code> / <code>HDW</code> to efficiently average and
center data on multiple groups. The credit herefore goes to Laurent
Berge, the author of the <em>fixest</em> package who wrote an efficient
C-implementation of the alternating-projections algorithm to perform
this task. <code>fhdbetween</code> / <code>HDB</code> and
<code>fhdwithin</code> / <code>HDW</code> enrich this implementation
(available in the function <code><a href="https://lrberge.github.io/fixest/reference/demean.html" class="external-link">fixest::demean</a></code>) by providing
more options regarding missing values, and also allowing continuous
covariates and (full) interactions to be projected out alongside
factors. The methods for <em>pseries</em> and <em>pdata.frame</em>’s are
however rather simple, as they simply simultaneously center
panel-vectors on various panel-identifiers in the index (which can be
more than 2, the default is to center on all identifiers):</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This simultaneously averages Life-Expectancy across countries and years</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fhdbetween_fhdwithin.html">HDB</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span><span class="op">)</span> <span class="co"># (same as running a regression on country and year dummies and taking the fitted values)</span></span>
<span><span class="co"># ABW-1960 ABW-1961 ABW-1962 ABW-1963 ABW-1964 ABW-1965 </span></span>
<span><span class="co"># 62.36179 62.85981 63.24258 63.65245 64.11774 64.52503</span></span>
<span></span>
<span><span class="co"># This simultaneously centers Life-Expectenacy on countries and years</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fhdbetween_fhdwithin.html">HDW</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span><span class="op">)</span> <span class="co"># (same as running a regression on country and year dummies and taking the residuals)</span></span>
<span><span class="co"># ABW-1960 ABW-1961 ABW-1962 ABW-1963 ABW-1964 ABW-1965 </span></span>
<span><span class="co"># 3.300210 3.214193 3.201424 3.134554 2.995255 2.909975</span></span></code></pre></div>
<p>The architecture of <code>fhdbetween</code> / <code>HDB</code> and
<code>fhdwithin</code> / <code>HDW</code> differs a bit from
<code>fbetween</code> / <code>B</code> and <code>fwithin</code> /
<code>W</code>. This is essentially a consequence of the underlying
C++-implementation (accessed through <code><a href="https://lrberge.github.io/fixest/reference/demean.html" class="external-link">fixest::demean</a></code>), which
was not built to accommodate missing values. <code>fhdbetween</code> /
<code>HDB</code> and <code>fhdwithin</code> / <code>HDW</code> therefore
both have an argument <code>fill = TRUE</code> (the default), which
stipulates that missing values in the data are preserved in the output.
The <em>collapse</em> default <code>na.rm = TRUE</code> again ensures
that only complete cases are used for the computation:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Missing values are preserved in the output when fill = TRUE (the default)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fhdbetween_fhdwithin.html">HDB</a></span><span class="op">(</span><span class="va">PCGDP</span><span class="op">)</span>, <span class="fl">30</span><span class="op">)</span></span>
<span><span class="co"># ABW-1960 ABW-1961 ABW-1962 ABW-1963 ABW-1964 ABW-1965 ABW-1966 ABW-1967 ABW-1968 ABW-1969 ABW-1970 </span></span>
<span><span class="co">#       NA       NA       NA       NA       NA       NA       NA       NA       NA       NA       NA </span></span>
<span><span class="co"># ABW-1971 ABW-1972 ABW-1973 ABW-1974 ABW-1975 ABW-1976 ABW-1977 ABW-1978 ABW-1979 ABW-1980 ABW-1981 </span></span>
<span><span class="co">#       NA       NA       NA       NA       NA       NA       NA       NA       NA       NA       NA </span></span>
<span><span class="co"># ABW-1982 ABW-1983 ABW-1984 ABW-1985 ABW-1986 ABW-1987 ABW-1988 ABW-1989 </span></span>
<span><span class="co">#       NA       NA       NA       NA 21833.32 22132.25 22479.20 22772.31</span></span>
<span></span>
<span><span class="co"># When fill = FALSE, only the complete cases are returned</span></span>
<span><span class="va">nofill</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fhdbetween_fhdwithin.html">HDB</a></span><span class="op">(</span><span class="va">PCGDP</span>, fill <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">nofill</span>, <span class="fl">30</span><span class="op">)</span></span>
<span><span class="co"># ABW-1986 ABW-1987 ABW-1988 ABW-1989 ABW-1990 ABW-1991 ABW-1992 ABW-1993 ABW-1994 ABW-1995 ABW-1996 </span></span>
<span><span class="co"># 21833.32 22132.25 22479.20 22772.31 23064.29 23060.00 23089.75 23115.36 23343.25 23595.16 23823.11 </span></span>
<span><span class="co"># ABW-1997 ABW-1998 ABW-1999 ABW-2000 ABW-2001 ABW-2002 ABW-2003 ABW-2004 ABW-2005 ABW-2006 ABW-2007 </span></span>
<span><span class="co"># 24149.44 24424.69 24727.46 25205.98 25399.16 25603.11 25851.29 26349.64 26665.54 27224.58 27772.82 </span></span>
<span><span class="co"># ABW-2008 ABW-2009 ABW-2010 ABW-2011 ABW-2012 ABW-2013 ABW-2014 ABW-2015 </span></span>
<span><span class="co"># 27769.52 27002.95 27218.84 27424.18 27471.49 27660.92 27889.34 28107.78</span></span>
<span></span>
<span><span class="co"># This results in a shorter panel-vector</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">nofill</span><span class="op">)</span></span>
<span><span class="co"># [1] 9470</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">PCGDP</span><span class="op">)</span></span>
<span><span class="co"># [1] 13176</span></span>
<span></span>
<span><span class="co"># The cases that were missing and removed from the output are available as an attribute</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">nofill</span>, <span class="st">"na.rm"</span><span class="op">)</span>, <span class="fl">30</span><span class="op">)</span></span>
<span><span class="co">#  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 59 60 61 62</span></span></code></pre></div>
<p>In the <em>pdata.frame</em> methods there are 3 different choices how
to deal with missing values. The default for the <em>plm</em> classes in
<code>variable.wise = TRUE</code>, which will essentially sequentially
apply <code>fhdbetween.pseries</code> and <code>fhdwithin.pseries</code>
(with the default <code>fill = TRUE</code>) to all columns. This is the
same behavior as in <code>fbetween</code> / <code>B</code> and
<code>fwithin</code> / <code>W</code>, which also consider the
column-wise complete obs:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This column-wise centers the data on countries and years</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="fu"><a href="../reference/fhdbetween_fhdwithin.html">HDW</a></span><span class="op">(</span><span class="va">pwlddev</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#          HDW.decade HDW.PCGDP HDW.LIFEEX  HDW.GINI   HDW.ODA  HDW.POP</span></span>
<span><span class="co"># ZWE-2011          0 -4632.971  -8.080748 -3.663217 118306300 -4547122</span></span>
<span><span class="co"># ZWE-2012          0 -4523.505  -6.271385        NA 385526419 -4749368</span></span>
<span><span class="co"># ZWE-2013          0 -4710.576  -4.753056        NA 149910333 -4903132</span></span>
<span><span class="co"># ZWE-2014          0 -4931.693  -3.568136        NA  93295114 -5059317</span></span>
<span><span class="co"># ZWE-2015          0 -5148.895  -2.685053        NA 150833589 -5224484</span></span>
<span><span class="co"># ZWE-2016          0 -5433.809  -2.203219        NA -27844184 -5404667</span></span>
<span><span class="co"># ZWE-2017          0 -5645.022  -1.920365 -1.964138  10266318 -5591762</span></span>
<span><span class="co"># ZWE-2018          0 -5938.794  -1.759333        NA  59646823 -5774326</span></span>
<span><span class="co"># ZWE-2019          0 -5710.646  -1.669415  5.627356 223473855 -5946725</span></span>
<span><span class="co"># ZWE-2020          0        NA         NA        NA        NA       NA</span></span></code></pre></div>
<p>If <code>variable.wise = FALSE</code>, <code>fhdbetween</code> /
<code>HDB</code> and <code>fhdwithin</code> / <code>HDW</code> will only
consider the complete cases in the dataset, but still return a dataset
of the same dimensions (as long as <code>fill = TRUE</code>), resulting
in some rows all-missing:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This centers the complete cases of the data data on countries and years and keeps missing cases</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="fu"><a href="../reference/fhdbetween_fhdwithin.html">HDW</a></span><span class="op">(</span><span class="va">pwlddev</span>, variable.wise <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#          HDW.decade HDW.PCGDP HDW.LIFEEX  HDW.GINI    HDW.ODA  HDW.POP</span></span>
<span><span class="co"># ZWE-2011          0  517.6924  -4.379840 -3.839653 -176176494 -3042247</span></span>
<span><span class="co"># ZWE-2012         NA        NA         NA        NA         NA       NA</span></span>
<span><span class="co"># ZWE-2013         NA        NA         NA        NA         NA       NA</span></span>
<span><span class="co"># ZWE-2014         NA        NA         NA        NA         NA       NA</span></span>
<span><span class="co"># ZWE-2015         NA        NA         NA        NA         NA       NA</span></span>
<span><span class="co"># ZWE-2016         NA        NA         NA        NA         NA       NA</span></span>
<span><span class="co"># ZWE-2017          0 -128.5240   1.971143 -1.314869  -67497466  1936716</span></span>
<span><span class="co"># ZWE-2018         NA        NA         NA        NA         NA       NA</span></span>
<span><span class="co"># ZWE-2019          0 -389.1684   2.408697  5.154522  243673961  1105530</span></span>
<span><span class="co"># ZWE-2020         NA        NA         NA        NA         NA       NA</span></span></code></pre></div>
<p>Finally, if also <code>fill = FALSE</code>, the behavior is the same
as in the <em>pseries</em> method: Missing cases are removed from the
data:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This centers the complete cases of the data data on countries and years, and removes missing cases</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fhdbetween_fhdwithin.html">HDW</a></span><span class="op">(</span><span class="va">pwlddev</span>, fill <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">res</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#          HDW.decade   HDW.PCGDP HDW.LIFEEX   HDW.GINI    HDW.ODA    HDW.POP</span></span>
<span><span class="co"># ZMB-1996          0   534.39373 -3.6445256  -4.744748 -174237036  4911230.7</span></span>
<span><span class="co"># ZMB-1998          0   201.58094 -4.1708951  -5.085621 -492258601   644947.7</span></span>
<span><span class="co"># ZMB-2002          0   250.78234 -2.9085522 -10.912265   81848768 -1027712.3</span></span>
<span><span class="co"># ZMB-2004          0   -72.94954 -1.9629513   1.494340  396830282 -3774596.6</span></span>
<span><span class="co"># ZMB-2006          0  -308.55937 -0.4975872   2.407226  485998870 -2255101.6</span></span>
<span><span class="co"># ZMB-2010          0  -428.16949  3.9600416   4.497547 -148714637 -4174306.2</span></span>
<span><span class="co"># ZMB-2015          0 -1106.52213  8.4099983   7.553052 -335529320 -4962997.8</span></span>
<span><span class="co"># ZWE-2011          0   517.69244 -4.3798401  -3.839653 -176176494 -3042246.9</span></span>
<span><span class="co"># ZWE-2017          0  -128.52402  1.9711431  -1.314869  -67497466  1936716.5</span></span>
<span><span class="co"># ZWE-2019          0  -389.16842  2.4086971   5.154522  243673961  1105530.5</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">res</span>, <span class="st">"na.rm"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># [1] 13169 13170 13171 13172 13174 13176</span></span></code></pre></div>
<!-- Again it is possible to perform weighted higher-order transformations, but the weight vector is not preserved and this -->
<!-- ```{r, eval = NCRAN} -->
<!-- # This centers the complete cases of the data data on countries and years, and removes missing cases -->
<!-- HDW(pwlddev, w = pwlddev$POP, cols = 9:11, fill = FALSE, variable.wise = FALSE) -->
<!-- ``` -->
<p><em>Notes: </em> (1) Because of the different missing case options
and associated challenges, panel-identifiers are not preserved in
<code>HDB</code> and <code>HDW</code>. (2) The default
<code>variable.wise = TRUE</code> and <code>fill = TRUE</code> was only
set for the <em>pseries</em> and <em>pdata.frame</em> methods, to
harmonize the default implementations with <code>fbetween</code> /
<code>B</code> and <code>fwithin</code> / <code>W</code> for these
classes. In the standard <em>default</em>, <em>matrix</em> and
<em>data.frame</em> methods, the defaults are
<code>variable.wise = FALSE</code> and <code>fill = FALSE</code>
(i.e. missing cases are removed beforehand), which is generally more
efficient.</p>
</div>
<div class="section level3">
<h3 id="scaling-and-centering">1.3 Scaling and Centering<a class="anchor" aria-label="anchor" href="#scaling-and-centering"></a>
</h3>
<p>Next to the above functions for grouped centering and averaging, the
function / operator pair <code>fscale</code> / <code>STD</code> can be
used to efficiently standardize (i.e. scale and center) panel data along
an arbitrary dimension. The architecture is identical to that of
<code>fwithin</code> / <code>W</code> or <code>fbetween</code> /
<code>B</code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This standardizes GDP per capita in each country</span></span>
<span><span class="va">STD_PCGDP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fscale.html">STD</a></span><span class="op">(</span><span class="va">PCGDP</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Checks:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fmean.html">fmean</a></span><span class="op">(</span><span class="va">STD_PCGDP</span>, <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html" class="external-link">index</a></span><span class="op">(</span><span class="va">STD_PCGDP</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#           ABW           AFG           AGO           ALB           AND           ARE </span></span>
<span><span class="co"># -1.422473e-15  2.528841e-16 -6.189493e-16 -2.275957e-16 -9.281464e-16 -6.661338e-17</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fvar_fsd.html">fsd</a></span><span class="op">(</span><span class="va">STD_PCGDP</span>, <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html" class="external-link">index</a></span><span class="op">(</span><span class="va">STD_PCGDP</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># ABW AFG AGO ALB AND ARE </span></span>
<span><span class="co">#   1   1   1   1   1   1</span></span>
<span></span>
<span><span class="co"># This standardizes GDP per capita in each year</span></span>
<span><span class="va">STD_PCGDP_T</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fscale.html">STD</a></span><span class="op">(</span><span class="va">PCGDP</span>, effect <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Checks:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fmean.html">fmean</a></span><span class="op">(</span><span class="va">STD_PCGDP_T</span>, <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html" class="external-link">index</a></span><span class="op">(</span><span class="va">STD_PCGDP_T</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#          1960          1961          1962          1963          1964          1965 </span></span>
<span><span class="co">#  9.882205e-17  3.496021e-16  1.889741e-17 -2.185013e-16 -1.724389e-16  2.616954e-16</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fvar_fsd.html">fsd</a></span><span class="op">(</span><span class="va">STD_PCGDP_T</span>, <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html" class="external-link">index</a></span><span class="op">(</span><span class="va">STD_PCGDP_T</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># 1960 1961 1962 1963 1964 1965 </span></span>
<span><span class="co">#    1    1    1    1    1    1</span></span></code></pre></div>
<p>And similarly for <em>pdata.frame</em>’s:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fscale.html">STD</a></span><span class="op">(</span><span class="va">pwlddev</span>, cols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#          iso3c year STD.PCGDP STD.LIFEEX STD.GINI STD.ODA</span></span>
<span><span class="co"># ABW-1960   ABW 1960        NA  -2.372636       NA      NA</span></span>
<span><span class="co"># ABW-1961   ABW 1961        NA  -2.227700       NA      NA</span></span>
<span><span class="co"># ABW-1962   ABW 1962        NA  -2.097539       NA      NA</span></span>
<span><span class="co"># ABW-1963   ABW 1963        NA  -1.976876       NA      NA</span></span>
<span><span class="co"># ABW-1964   ABW 1964        NA  -1.862193       NA      NA</span></span>
<span><span class="co"># ABW-1965   ABW 1965        NA  -1.748918       NA      NA</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fscale.html">STD</a></span><span class="op">(</span><span class="va">pwlddev</span>, cols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">12</span>, effect <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#          iso3c year STD.PCGDP STD.LIFEEX STD.GINI STD.ODA</span></span>
<span><span class="co"># ABW-1960   ABW 1960        NA  0.9609854       NA      NA</span></span>
<span><span class="co"># ABW-1961   ABW 1961        NA  0.9485730       NA      NA</span></span>
<span><span class="co"># ABW-1962   ABW 1962        NA  0.9585105       NA      NA</span></span>
<span><span class="co"># ABW-1963   ABW 1963        NA  0.9669638       NA      NA</span></span>
<span><span class="co"># ABW-1964   ABW 1964        NA  0.9579477       NA      NA</span></span>
<span><span class="co"># ABW-1965   ABW 1965        NA  0.9556529       NA      NA</span></span></code></pre></div>
<p>More customized scaling can be done with the help of the
<code>mean</code> and <code>sd</code> arguments to <code>fscale</code> /
<code>STD</code>. By default <code>mean = 0</code> and
<code>sd = 1</code>, but these could be assigned any numeric values:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This will scale the data such that mean mean within each country is 5 and the standard deviation is 3</span></span>
<span><span class="fu"><a href="../reference/qsu.html">qsu</a></span><span class="op">(</span><span class="fu"><a href="../reference/fscale.html">fscale</a></span><span class="op">(</span><span class="va">pwlddev</span><span class="op">$</span><span class="va">PCGDP</span>, mean <span class="op">=</span> <span class="fl">5</span>, sd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#              N/T  Mean     SD      Min     Max</span></span>
<span><span class="co"># Overall     9466     5  2.968  -6.1908  16.257</span></span>
<span><span class="co"># Between      202     5      0        5       5</span></span>
<span><span class="co"># Within   46.8614     5  2.968  -6.1908  16.257</span></span></code></pre></div>
<p>Even further customization (i.e. setting means and standard
deviations for each group and / or each column) can of course be
achieved by calling <code><a href="../reference/TRA.html">collapse::TRA</a></code> on the result of
<code>fscale</code> to sweep out an appropriate set of means and
standard deviations.</p>
<p>Scaling without centering can be done with the option
<code>mean = FALSE</code>. This will also preserve the mean of the data
overall and within each group:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Scaling without centering: Mean preserving with fscale / STD</span></span>
<span><span class="fu"><a href="../reference/qsu.html">qsu</a></span><span class="op">(</span><span class="fu"><a href="../reference/fscale.html">fscale</a></span><span class="op">(</span><span class="va">pwlddev</span><span class="op">$</span><span class="va">PCGDP</span>, mean <span class="op">=</span> <span class="cn">FALSE</span>, sd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#              N/T        Mean          SD         Min         Max</span></span>
<span><span class="co"># Overall     9466  12031.4627  17803.3537    247.7598   131349.27</span></span>
<span><span class="co"># Between      202  12169.2793  18055.6626    253.1886  131342.669</span></span>
<span><span class="co"># Within   46.8614  12031.4627       2.968  12020.2718  12042.7196</span></span>
<span></span>
<span><span class="co"># Scaling without centering can also be done using fsd, but this does not preserve the mean</span></span>
<span><span class="fu"><a href="../reference/qsu.html">qsu</a></span><span class="op">(</span><span class="fu"><a href="../reference/fvar_fsd.html">fsd</a></span><span class="op">(</span><span class="va">pwlddev</span><span class="op">$</span><span class="va">PCGDP</span>, <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html" class="external-link">index</a></span><span class="op">(</span><span class="va">pwlddev</span>, <span class="fl">1</span><span class="op">)</span>, TRA <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#              N/T    Mean      SD     Min      Max</span></span>
<span><span class="co"># Overall     9466   4.247   3.192  0.0579   26.647</span></span>
<span><span class="co"># Between      202  4.6036  3.5846  0.8207  24.8111</span></span>
<span><span class="co"># Within   46.8614   4.247  0.9893  0.5167   7.9993</span></span></code></pre></div>
<!-- # Again, the *Fast Statistical Functions* in *collapse* do not have methods for *pseries* or *pdata.frame*'s (yet). -->
<p>Finally a special kind of data harmonization in the first two moments
can be done by setting <code>mean = "overall.mean"</code> and
<code>sd = "within.sd"</code> in a grouped scaling task. This will
harmonize the data across groups such that the mean of each group is
equal to the overall data mean and the standard deviation equal to the
within standard deviation (= the standard deviation calculated on the
group-centered series):</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fmean.html">fmean</a></span><span class="op">(</span><span class="va">pwlddev</span><span class="op">$</span><span class="va">PCGDP</span><span class="op">)</span>  <span class="co"># Overall mean</span></span>
<span><span class="co"># [1] 12048.78</span></span>
<span><span class="fu"><a href="../reference/fvar_fsd.html">fsd</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">W</a></span><span class="op">(</span><span class="va">pwlddev</span><span class="op">$</span><span class="va">PCGDP</span><span class="op">)</span><span class="op">)</span> <span class="co"># Within sd</span></span>
<span><span class="co"># [1] 6723.681</span></span>
<span></span>
<span><span class="co"># Scaling and centerin such that the mean of each country is the overall mean, and the sd of each country is the within sd</span></span>
<span><span class="fu"><a href="../reference/qsu.html">qsu</a></span><span class="op">(</span><span class="fu"><a href="../reference/fscale.html">fscale</a></span><span class="op">(</span><span class="va">pwlddev</span><span class="op">$</span><span class="va">PCGDP</span>, mean <span class="op">=</span> <span class="st">"overall.mean"</span>, sd <span class="op">=</span> <span class="st">"within.sd"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#              N/T       Mean         SD          Min         Max</span></span>
<span><span class="co"># Overall     9466  12048.778  6651.9052  -13032.4333  37278.2175</span></span>
<span><span class="co"># Between      202  12048.778          0    12048.778   12048.778</span></span>
<span><span class="co"># Within   46.8614  12048.778  6651.9052  -13032.4333  37278.2175</span></span></code></pre></div>
<p>All of this seamlessly generalizes to weighted scaling an centering,
using the <code>w</code> argument to add a weight vector.</p>
</div>
<div class="section level3">
<h3 id="panel-lags-leads-differences-and-growth-rates">1.4 Panel Lags / Leads, Differences and Growth Rates<a class="anchor" aria-label="anchor" href="#panel-lags-leads-differences-and-growth-rates"></a>
</h3>
<!-- A proper *and* fast implementation of panel- lags, differences and growth rates has been missing in R so far. -->
<p>With <code>flag</code> / <code>L</code> / <code>F</code>,
<code>fdiff</code> / <code>D</code> and <code>fgrowth</code> /
<code>G</code>, <em>collapse</em> provides a fast and comprehensive C++
based solution to the computation of (sequences of) lags / leads and
(sequences of) lagged / leaded and suitably iterated (quasi-, log-)
differences and growth rates on panel data. The <em>pseries</em> and
<em>pdata.frame</em> methods to these functions and associated
<em>transformation operators</em> use the panel-identifiers in the
‘index’ attached to these objects (where the last variable in the
‘index’ is taken as the time-variable and the variables before that are
taken as individual identifiers) to perform fast fully-identified
time-dependent operations on panel data, without the need of sorting the
data.</p>
<!-- With 'proper' I mean an implementation that does not require panel-vectors to be sorted (amounting i.e. to a grouped-lag on sorted data), but that takes into account both individual an time-identifiers in the computation. `plm::lag` and `dplyr::lag` (with the `order_by` argument) provide proper implementations but rely on base-R (split-apply-combine logic) which makes them slow. `data.table::shift` allows for pretty fast grouped lags on sorted data, but without taking into account the time-identifiers (you can do something like `DT[oder(time), shift(col1), by = pid]` in *data.table* but that sorts the data and is definitely more computationally expensive than the implementation introduced here).  -->
<p>With <code>flag</code> / <code>L</code> / <code>F</code>, it is easy
to lag or lead <em>pseries</em>:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># A panel-lag</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/flag.html">flag</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># ABW-1960 ABW-1961 ABW-1962 ABW-1963 ABW-1964 ABW-1965 </span></span>
<span><span class="co">#       NA   65.662   66.074   66.444   66.787   67.113</span></span>
<span></span>
<span><span class="co"># A panel-lead</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/flag.html">flag</a></span><span class="op">(</span><span class="va">LIFEEX</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># ABW-1960 ABW-1961 ABW-1962 ABW-1963 ABW-1964 ABW-1965 </span></span>
<span><span class="co">#   66.074   66.444   66.787   67.113   67.435   67.762</span></span>
<span></span>
<span><span class="co"># The lag and lead operators are even more parsimonious to employ:</span></span>
<span><span class="fu"><a href="../reference/small-helpers.html">all_identical</a></span><span class="op">(</span><span class="fu"><a href="../reference/flag.html">L</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span>, <span class="fu"><a href="../reference/flag.html">flag</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># [1] TRUE</span></span>
<span><span class="fu"><a href="../reference/small-helpers.html">all_identical</a></span><span class="op">(</span><span class="fu"><a href="../reference/flag.html">F</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span>, <span class="fu"><a href="../reference/flag.html">flag</a></span><span class="op">(</span><span class="va">LIFEEX</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/plm/man/lag.plm.html" class="external-link">lead</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># [1] TRUE</span></span></code></pre></div>
<p>It is also possible to compute a sequence of lags / leads using
<code>flag</code> or one of the operators:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sequence of panel- lags and leads</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/flag.html">flag</a></span><span class="op">(</span><span class="va">LIFEEX</span>, <span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#              F1     --     L1     L2     L3</span></span>
<span><span class="co"># ABW-1960 66.074 65.662     NA     NA     NA</span></span>
<span><span class="co"># ABW-1961 66.444 66.074 65.662     NA     NA</span></span>
<span><span class="co"># ABW-1962 66.787 66.444 66.074 65.662     NA</span></span>
<span><span class="co"># ABW-1963 67.113 66.787 66.444 66.074 65.662</span></span>
<span><span class="co"># ABW-1964 67.435 67.113 66.787 66.444 66.074</span></span>
<span><span class="co"># ABW-1965 67.762 67.435 67.113 66.787 66.444</span></span>
<span></span>
<span><span class="fu"><a href="../reference/small-helpers.html">all_identical</a></span><span class="op">(</span><span class="fu"><a href="../reference/flag.html">L</a></span><span class="op">(</span><span class="va">LIFEEX</span>, <span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="../reference/flag.html">F</a></span><span class="op">(</span><span class="va">LIFEEX</span>, <span class="fl">1</span><span class="op">:</span><span class="op">-</span><span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="../reference/flag.html">flag</a></span><span class="op">(</span><span class="va">LIFEEX</span>, <span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># [1] TRUE</span></span>
<span></span>
<span><span class="co"># The native plm implementation also returns a matrix of lags but with different column names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">LIFEEX</span>, <span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#              -1      0      1      2      3</span></span>
<span><span class="co"># ABW-1960 66.074 65.662     NA     NA     NA</span></span>
<span><span class="co"># ABW-1961 66.444 66.074 65.662     NA     NA</span></span>
<span><span class="co"># ABW-1962 66.787 66.444 66.074 65.662     NA</span></span>
<span><span class="co"># ABW-1963 67.113 66.787 66.444 66.074 65.662</span></span></code></pre></div>
<!-- # Just the meaning is a bit ambiguous... -->
<!-- head(lead(LIFEEX, 1:-3), 4) -->
<p>Of course the lag orders may be unevenly spaced,
i.e. <code>L(x, -1:3*12)</code> would compute seasonal lags on monthly
data. On <em>pdata.frame</em>’s, the effects of <code>flag</code> and
<code>L</code> / <code>F</code> differ insofar that <code>flag</code>
will just lag the entire dataset without preserving identifiers
(although the index attribute is always preserved), whereas
<code>L</code> / <code>F</code> by default
(<code>cols = is.numeric</code>) select the numeric variables and add
the panel-id’s on the left (default <code>keep.ids = TRUE</code>):</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This lags the entire data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/flag.html">flag</a></span><span class="op">(</span><span class="va">pwlddev</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#          country iso3c       date year decade                    region      income  OECD PCGDP</span></span>
<span><span class="co"># ABW-1960    &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt; &lt;NA&gt;     NA                      &lt;NA&gt;        &lt;NA&gt;    NA    NA</span></span>
<span><span class="co"># ABW-1961   Aruba   ABW 1961-01-01 1960   1960 Latin America &amp; Caribbean High income FALSE    NA</span></span>
<span><span class="co"># ABW-1962   Aruba   ABW 1962-01-01 1961   1960 Latin America &amp; Caribbean High income FALSE    NA</span></span>
<span><span class="co"># ABW-1963   Aruba   ABW 1963-01-01 1962   1960 Latin America &amp; Caribbean High income FALSE    NA</span></span>
<span><span class="co"># ABW-1964   Aruba   ABW 1964-01-01 1963   1960 Latin America &amp; Caribbean High income FALSE    NA</span></span>
<span><span class="co"># ABW-1965   Aruba   ABW 1965-01-01 1964   1960 Latin America &amp; Caribbean High income FALSE    NA</span></span>
<span><span class="co">#          LIFEEX GINI ODA   POP</span></span>
<span><span class="co"># ABW-1960     NA   NA  NA    NA</span></span>
<span><span class="co"># ABW-1961 65.662   NA  NA 54211</span></span>
<span><span class="co"># ABW-1962 66.074   NA  NA 55438</span></span>
<span><span class="co"># ABW-1963 66.444   NA  NA 56225</span></span>
<span><span class="co"># ABW-1964 66.787   NA  NA 56695</span></span>
<span><span class="co"># ABW-1965 67.113   NA  NA 57032</span></span>
<span></span>
<span><span class="co"># This lags only numeric columns and preserves panel-id's</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/flag.html">L</a></span><span class="op">(</span><span class="va">pwlddev</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#          iso3c year L1.decade L1.PCGDP L1.LIFEEX L1.GINI L1.ODA L1.POP</span></span>
<span><span class="co"># ABW-1960   ABW 1960        NA       NA        NA      NA     NA     NA</span></span>
<span><span class="co"># ABW-1961   ABW 1961      1960       NA    65.662      NA     NA  54211</span></span>
<span><span class="co"># ABW-1962   ABW 1962      1960       NA    66.074      NA     NA  55438</span></span>
<span><span class="co"># ABW-1963   ABW 1963      1960       NA    66.444      NA     NA  56225</span></span>
<span><span class="co"># ABW-1964   ABW 1964      1960       NA    66.787      NA     NA  56695</span></span>
<span><span class="co"># ABW-1965   ABW 1965      1960       NA    67.113      NA     NA  57032</span></span>
<span></span>
<span><span class="co"># This lags only columns 9 through 12 and preserves panel-id's</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/flag.html">L</a></span><span class="op">(</span><span class="va">pwlddev</span>, cols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#          iso3c year L1.PCGDP L1.LIFEEX L1.GINI L1.ODA</span></span>
<span><span class="co"># ABW-1960   ABW 1960       NA        NA      NA     NA</span></span>
<span><span class="co"># ABW-1961   ABW 1961       NA    65.662      NA     NA</span></span>
<span><span class="co"># ABW-1962   ABW 1962       NA    66.074      NA     NA</span></span>
<span><span class="co"># ABW-1963   ABW 1963       NA    66.444      NA     NA</span></span>
<span><span class="co"># ABW-1964   ABW 1964       NA    66.787      NA     NA</span></span>
<span><span class="co"># ABW-1965   ABW 1965       NA    67.113      NA     NA</span></span></code></pre></div>
<p>We can also easily compute a sequence of lags / leads on a panel
data.frame:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This lags only columns 9 through 12 and preserves panel-id's</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/flag.html">L</a></span><span class="op">(</span><span class="va">pwlddev</span>, <span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, cols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#          iso3c year F1.PCGDP PCGDP L1.PCGDP L2.PCGDP L3.PCGDP F1.LIFEEX LIFEEX L1.LIFEEX L2.LIFEEX</span></span>
<span><span class="co"># ABW-1960   ABW 1960       NA    NA       NA       NA       NA    66.074 65.662        NA        NA</span></span>
<span><span class="co"># ABW-1961   ABW 1961       NA    NA       NA       NA       NA    66.444 66.074    65.662        NA</span></span>
<span><span class="co"># ABW-1962   ABW 1962       NA    NA       NA       NA       NA    66.787 66.444    66.074    65.662</span></span>
<span><span class="co"># ABW-1963   ABW 1963       NA    NA       NA       NA       NA    67.113 66.787    66.444    66.074</span></span>
<span><span class="co"># ABW-1964   ABW 1964       NA    NA       NA       NA       NA    67.435 67.113    66.787    66.444</span></span>
<span><span class="co"># ABW-1965   ABW 1965       NA    NA       NA       NA       NA    67.762 67.435    67.113    66.787</span></span>
<span><span class="co">#          L3.LIFEEX F1.GINI GINI L1.GINI L2.GINI L3.GINI F1.ODA ODA L1.ODA L2.ODA L3.ODA</span></span>
<span><span class="co"># ABW-1960        NA      NA   NA      NA      NA      NA     NA  NA     NA     NA     NA</span></span>
<span><span class="co"># ABW-1961        NA      NA   NA      NA      NA      NA     NA  NA     NA     NA     NA</span></span>
<span><span class="co"># ABW-1962        NA      NA   NA      NA      NA      NA     NA  NA     NA     NA     NA</span></span>
<span><span class="co"># ABW-1963    65.662      NA   NA      NA      NA      NA     NA  NA     NA     NA     NA</span></span>
<span><span class="co"># ABW-1964    66.074      NA   NA      NA      NA      NA     NA  NA     NA     NA     NA</span></span>
<span><span class="co"># ABW-1965    66.444      NA   NA      NA      NA      NA     NA  NA     NA     NA     NA</span></span></code></pre></div>
<p>Essentially the same functionality applies to <code>fdiff</code> /
<code>D</code> and <code>fgrowth</code> / <code>G</code>, with the main
differences that these functions also have a <code>diff</code> argument
to determine the number of iterations:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Panel-difference of Life Expectancy</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fdiff.html">fdiff</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># ABW-1960 ABW-1961 ABW-1962 ABW-1963 ABW-1964 ABW-1965 </span></span>
<span><span class="co">#       NA    0.412    0.370    0.343    0.326    0.322</span></span>
<span></span>
<span><span class="co"># Second panel-difference</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fdiff.html">fdiff</a></span><span class="op">(</span><span class="va">LIFEEX</span>, diff <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># ABW-1960 ABW-1961 ABW-1962 ABW-1963 ABW-1964 ABW-1965 </span></span>
<span><span class="co">#       NA       NA   -0.042   -0.027   -0.017   -0.004</span></span>
<span></span>
<span><span class="co"># Panel-growth rate of Life Expectancy</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fgrowth.html">fgrowth</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#  ABW-1960  ABW-1961  ABW-1962  ABW-1963  ABW-1964  ABW-1965 </span></span>
<span><span class="co">#        NA 0.6274558 0.5599782 0.5162242 0.4881189 0.4797878</span></span>
<span></span>
<span><span class="co"># Growth rate of growth rate of Life Expectancy</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fgrowth.html">fgrowth</a></span><span class="op">(</span><span class="va">LIFEEX</span>, diff <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#   ABW-1960   ABW-1961   ABW-1962   ABW-1963   ABW-1964   ABW-1965 </span></span>
<span><span class="co">#         NA         NA -10.754153  -7.813521  -5.444387  -1.706782</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="fu"><a href="../reference/fdiff.html">D</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span>, <span class="fu"><a href="../reference/fdiff.html">fdiff</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># [1] TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="fu"><a href="../reference/fgrowth.html">G</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span>, <span class="fu"><a href="../reference/fgrowth.html">fgrowth</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># [1] TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="fu"><a href="../reference/fdiff.html">fdiff</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span><span class="op">)</span> <span class="co"># Same as plm::diff.pseries (which does not compute iterated panel-differences)</span></span>
<span><span class="co"># [1] TRUE</span></span></code></pre></div>
<p>By default, growth rates are calculated in percentage terms which is
set by the default argument <code>scale = 100</code>. It is also
possible to compute log-differences with
<code>fdiff(.., log = TRUE)</code> or the <code>Dlog</code> operator,
and growth rates in percentage terms based on log-differences using
<code>fgrowth(.., logdiff = TRUE)</code>.</p>
<!-- It is also possible to compute growth rates based on log-differences which are often used in economics for various reasons (i.e. symmetry, exponential trends on macro-series, heteroskedasticity, properties of the log etc..). In that case the formula is `(log(x) - lag(log(x))) * 100` or `log(x/lag(x)) * 100`: -->
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Panel log-difference of Life Expectancy</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fdiff.html">Dlog</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#    ABW-1960    ABW-1961    ABW-1962    ABW-1963    ABW-1964    ABW-1965 </span></span>
<span><span class="co">#          NA 0.006254955 0.005584162 0.005148963 0.004869315 0.004786405</span></span>
<span></span>
<span><span class="co"># Panel log-difference growth rate (in percentage terms) of Life Expectancy</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fgrowth.html">G</a></span><span class="op">(</span><span class="va">LIFEEX</span>, logdiff <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#  ABW-1960  ABW-1961  ABW-1962  ABW-1963  ABW-1964  ABW-1965 </span></span>
<span><span class="co">#        NA 0.6254955 0.5584162 0.5148963 0.4869315 0.4786405</span></span></code></pre></div>
<p>It is also possible to compute sequences of lagged / leaded and
iterated differences, log-differences and growth rates:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># first and second forward-difference and first and second difference of lags 1-3 of Life-Expectancy</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fdiff.html">D</a></span><span class="op">(</span><span class="va">LIFEEX</span>, <span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#             FD1    FD2     --    D1     D2  L2D1   L2D2  L3D1 L3D2</span></span>
<span><span class="co"># ABW-1960 -0.412 -0.042 65.662    NA     NA    NA     NA    NA   NA</span></span>
<span><span class="co"># ABW-1961 -0.370 -0.027 66.074 0.412     NA    NA     NA    NA   NA</span></span>
<span><span class="co"># ABW-1962 -0.343 -0.017 66.444 0.370 -0.042 0.782     NA    NA   NA</span></span>
<span><span class="co"># ABW-1963 -0.326 -0.004 66.787 0.343 -0.027 0.713     NA 1.125   NA</span></span>
<span><span class="co"># ABW-1964 -0.322  0.005 67.113 0.326 -0.017 0.669 -0.113 1.039   NA</span></span>
<span><span class="co"># ABW-1965 -0.327  0.006 67.435 0.322 -0.004 0.648 -0.065 0.991   NA</span></span>
<span></span>
<span><span class="co"># Same with Log-differences</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fdiff.html">Dlog</a></span><span class="op">(</span><span class="va">LIFEEX</span>, <span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#                FDlog1        FDlog2       --       Dlog1         Dlog2    L2Dlog1      L2Dlog2</span></span>
<span><span class="co"># ABW-1960 -0.006254955 -6.707929e-04 4.184520          NA            NA         NA           NA</span></span>
<span><span class="co"># ABW-1961 -0.005584162 -4.351984e-04 4.190775 0.006254955            NA         NA           NA</span></span>
<span><span class="co"># ABW-1962 -0.005148963 -2.796481e-04 4.196359 0.005584162 -0.0006707929 0.01183912           NA</span></span>
<span><span class="co"># ABW-1963 -0.004869315 -8.291000e-05 4.201508 0.005148963 -0.0004351984 0.01073312           NA</span></span>
<span><span class="co"># ABW-1964 -0.004786405  5.098981e-05 4.206378 0.004869315 -0.0002796481 0.01001828 -0.001820838</span></span>
<span><span class="co"># ABW-1965 -0.004837395  6.482830e-05 4.211164 0.004786405 -0.0000829100 0.00965572 -0.001077405</span></span>
<span><span class="co">#             L3Dlog1 L3Dlog2</span></span>
<span><span class="co"># ABW-1960         NA      NA</span></span>
<span><span class="co"># ABW-1961         NA      NA</span></span>
<span><span class="co"># ABW-1962         NA      NA</span></span>
<span><span class="co"># ABW-1963 0.01698808      NA</span></span>
<span><span class="co"># ABW-1964 0.01560244      NA</span></span>
<span><span class="co"># ABW-1965 0.01480468      NA</span></span>
<span></span>
<span><span class="co"># Same with (exact) growth rates</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fgrowth.html">G</a></span><span class="op">(</span><span class="va">LIFEEX</span>, <span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#                 FG1       FG2     --        G1         G2      L2G1      L2G2     L3G1 L3G2</span></span>
<span><span class="co"># ABW-1960 -0.6235433 11.974895 65.662        NA         NA        NA        NA       NA   NA</span></span>
<span><span class="co"># ABW-1961 -0.5568599  8.428580 66.074 0.6274558         NA        NA        NA       NA   NA</span></span>
<span><span class="co"># ABW-1962 -0.5135730  5.728297 66.444 0.5599782 -10.754153 1.1909476        NA       NA   NA</span></span>
<span><span class="co"># ABW-1963 -0.4857479  1.727984 66.787 0.5162242  -7.813521 1.0790931        NA 1.713320   NA</span></span>
<span><span class="co"># ABW-1964 -0.4774968 -1.051555 67.113 0.4881189  -5.444387 1.0068629 -15.45699 1.572479   NA</span></span>
<span><span class="co"># ABW-1965 -0.4825714 -1.319230 67.435 0.4797878  -1.706782 0.9702487 -10.08666 1.491482   NA</span></span></code></pre></div>
<p>A further possibility is to compute quasi-differences and
quasi-log-differences of the form <span class="math inline">x_t - \rho
x_{t-s}</span> or <span class="math inline">log(x_t) - \rho
log(x_{t-s})</span>. These are useful for panel-regressions suffering
from serial-correlation, following Cochrane &amp; Orcutt (1949), and can
be specified with the <code>rho</code> argument to <code>fdiff</code>,
<code>D</code> and <code>Dlog</code>.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Regression of GDP on Life Expectance with country and time FE</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">PCGDP</span> <span class="op">~</span> <span class="va">LIFEEX</span>, data <span class="op">=</span> <span class="fu"><a href="../reference/fhdbetween_fhdwithin.html">fhdwithin</a></span><span class="op">(</span><span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="va">pwlddev</span>, <span class="va">PCGDP</span>, <span class="va">LIFEEX</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mod</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Call:</span></span>
<span><span class="co"># lm(formula = PCGDP ~ LIFEEX, data = fhdwithin(fselect(pwlddev, </span></span>
<span><span class="co">#     PCGDP, LIFEEX), fill = FALSE))</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Coefficients:</span></span>
<span><span class="co"># (Intercept)       LIFEEX  </span></span>
<span><span class="co">#  -2.442e-12   -3.330e+02</span></span>
<span></span>
<span><span class="co"># Computing autocorrelation of residuals</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pwcor_pwcov_pwnobs.html">pwcor</a></span><span class="op">(</span><span class="va">r</span>, <span class="fu"><a href="../reference/flag.html">L</a></span><span class="op">(</span><span class="va">r</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Need this to compute a panel-lag</span></span>
<span><span class="va">r</span></span>
<span><span class="co"># [1] .98</span></span>
<span></span>
<span><span class="co"># Running the regression again quasi-differencing the transformed data</span></span>
<span><span class="va">modCO</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">PCGDP</span> <span class="op">~</span> <span class="va">LIFEEX</span>, data <span class="op">=</span> <span class="fu"><a href="../reference/fdiff.html">fdiff</a></span><span class="op">(</span><span class="fu"><a href="../reference/fhdbetween_fhdwithin.html">fhdwithin</a></span><span class="op">(</span><span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="va">pwlddev</span>, <span class="va">PCGDP</span>, <span class="va">LIFEEX</span><span class="op">)</span>, variable.wise <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, rho <span class="op">=</span> <span class="va">r</span>, stubs <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">modCO</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Call:</span></span>
<span><span class="co"># lm(formula = PCGDP ~ LIFEEX, data = fdiff(fhdwithin(fselect(pwlddev, </span></span>
<span><span class="co">#     PCGDP, LIFEEX), variable.wise = FALSE), rho = r, stubs = FALSE))</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Coefficients:</span></span>
<span><span class="co"># (Intercept)       LIFEEX  </span></span>
<span><span class="co">#      -12.93       -91.97</span></span>
<span></span>
<span><span class="co"># In this case rho is almost 1, so we might as well just difference the untransformed data and go with that</span></span>
<span><span class="co"># We also need to bootstrap this for proper standard errors.</span></span></code></pre></div>
<!-- compared to `plm::lag` or `plm::diff`  -->
<p>A final important advantage of the <em>collapse</em> functions is
that the panel-identifiers are preserved, even if a matrix of lags /
leads / differences or growth rates is returned. This allows for nested
panel-computations, for example we can compute shifted sequences of
lagged / leaded and iterated panel differences:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sequence of differneces (same as above), adding one extra lag of the whole sequence</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/flag.html">L</a></span><span class="op">(</span><span class="fu"><a href="../reference/fdiff.html">D</a></span><span class="op">(</span><span class="va">LIFEEX</span>, <span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#             FD1 L1.FD1    FD2 L1.FD2     --  L1.--    D1 L1.D1     D2  L1.D2  L2D1 L1.L2D1   L2D2</span></span>
<span><span class="co"># ABW-1960 -0.412     NA -0.042     NA 65.662     NA    NA    NA     NA     NA    NA      NA     NA</span></span>
<span><span class="co"># ABW-1961 -0.370 -0.412 -0.027 -0.042 66.074 65.662 0.412    NA     NA     NA    NA      NA     NA</span></span>
<span><span class="co"># ABW-1962 -0.343 -0.370 -0.017 -0.027 66.444 66.074 0.370 0.412 -0.042     NA 0.782      NA     NA</span></span>
<span><span class="co"># ABW-1963 -0.326 -0.343 -0.004 -0.017 66.787 66.444 0.343 0.370 -0.027 -0.042 0.713   0.782     NA</span></span>
<span><span class="co"># ABW-1964 -0.322 -0.326  0.005 -0.004 67.113 66.787 0.326 0.343 -0.017 -0.027 0.669   0.713 -0.113</span></span>
<span><span class="co"># ABW-1965 -0.327 -0.322  0.006  0.005 67.435 67.113 0.322 0.326 -0.004 -0.017 0.648   0.669 -0.065</span></span>
<span><span class="co">#          L1.L2D2  L3D1 L1.L3D1 L3D2 L1.L3D2</span></span>
<span><span class="co"># ABW-1960      NA    NA      NA   NA      NA</span></span>
<span><span class="co"># ABW-1961      NA    NA      NA   NA      NA</span></span>
<span><span class="co"># ABW-1962      NA    NA      NA   NA      NA</span></span>
<span><span class="co"># ABW-1963      NA 1.125      NA   NA      NA</span></span>
<span><span class="co"># ABW-1964      NA 1.039   1.125   NA      NA</span></span>
<span><span class="co"># ABW-1965  -0.113 0.991   1.039   NA      NA</span></span></code></pre></div>
<p>All of this naturally generalized to computations on
<em>pdata.frames</em>:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fdiff.html">D</a></span><span class="op">(</span><span class="va">pwlddev</span>, <span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, cols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#          iso3c year FD1.PCGDP FD2.PCGDP PCGDP D1.PCGDP D2.PCGDP L2D1.PCGDP L2D2.PCGDP L3D1.PCGDP</span></span>
<span><span class="co"># ABW-1960   ABW 1960        NA        NA    NA       NA       NA         NA         NA         NA</span></span>
<span><span class="co"># ABW-1961   ABW 1961        NA        NA    NA       NA       NA         NA         NA         NA</span></span>
<span><span class="co"># ABW-1962   ABW 1962        NA        NA    NA       NA       NA         NA         NA         NA</span></span>
<span><span class="co">#          L3D2.PCGDP FD1.LIFEEX FD2.LIFEEX LIFEEX D1.LIFEEX D2.LIFEEX L2D1.LIFEEX L2D2.LIFEEX</span></span>
<span><span class="co"># ABW-1960         NA     -0.412     -0.042 65.662        NA        NA          NA          NA</span></span>
<span><span class="co"># ABW-1961         NA     -0.370     -0.027 66.074     0.412        NA          NA          NA</span></span>
<span><span class="co"># ABW-1962         NA     -0.343     -0.017 66.444     0.370    -0.042       0.782          NA</span></span>
<span><span class="co">#          L3D1.LIFEEX L3D2.LIFEEX</span></span>
<span><span class="co"># ABW-1960          NA          NA</span></span>
<span><span class="co"># ABW-1961          NA          NA</span></span>
<span><span class="co"># ABW-1962          NA          NA</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/flag.html">L</a></span><span class="op">(</span><span class="fu"><a href="../reference/fdiff.html">D</a></span><span class="op">(</span><span class="va">pwlddev</span>, <span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, cols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#          iso3c year FD1.PCGDP L1.FD1.PCGDP FD2.PCGDP L1.FD2.PCGDP PCGDP L1.PCGDP D1.PCGDP</span></span>
<span><span class="co"># ABW-1960   ABW 1960        NA           NA        NA           NA    NA       NA       NA</span></span>
<span><span class="co"># ABW-1961   ABW 1961        NA           NA        NA           NA    NA       NA       NA</span></span>
<span><span class="co"># ABW-1962   ABW 1962        NA           NA        NA           NA    NA       NA       NA</span></span>
<span><span class="co">#          L1.D1.PCGDP D2.PCGDP L1.D2.PCGDP L2D1.PCGDP L1.L2D1.PCGDP L2D2.PCGDP L1.L2D2.PCGDP</span></span>
<span><span class="co"># ABW-1960          NA       NA          NA         NA            NA         NA            NA</span></span>
<span><span class="co"># ABW-1961          NA       NA          NA         NA            NA         NA            NA</span></span>
<span><span class="co"># ABW-1962          NA       NA          NA         NA            NA         NA            NA</span></span>
<span><span class="co">#          L3D1.PCGDP L1.L3D1.PCGDP L3D2.PCGDP L1.L3D2.PCGDP FD1.LIFEEX L1.FD1.LIFEEX FD2.LIFEEX</span></span>
<span><span class="co"># ABW-1960         NA            NA         NA            NA     -0.412            NA     -0.042</span></span>
<span><span class="co"># ABW-1961         NA            NA         NA            NA     -0.370        -0.412     -0.027</span></span>
<span><span class="co"># ABW-1962         NA            NA         NA            NA     -0.343        -0.370     -0.017</span></span>
<span><span class="co">#          L1.FD2.LIFEEX LIFEEX L1.LIFEEX D1.LIFEEX L1.D1.LIFEEX D2.LIFEEX L1.D2.LIFEEX L2D1.LIFEEX</span></span>
<span><span class="co"># ABW-1960            NA 65.662        NA        NA           NA        NA           NA          NA</span></span>
<span><span class="co"># ABW-1961        -0.042 66.074    65.662     0.412           NA        NA           NA          NA</span></span>
<span><span class="co"># ABW-1962        -0.027 66.444    66.074     0.370        0.412    -0.042           NA       0.782</span></span>
<span><span class="co">#          L1.L2D1.LIFEEX L2D2.LIFEEX L1.L2D2.LIFEEX L3D1.LIFEEX L1.L3D1.LIFEEX L3D2.LIFEEX</span></span>
<span><span class="co"># ABW-1960             NA          NA             NA          NA             NA          NA</span></span>
<span><span class="co"># ABW-1961             NA          NA             NA          NA             NA          NA</span></span>
<span><span class="co"># ABW-1962             NA          NA             NA          NA             NA          NA</span></span>
<span><span class="co">#          L1.L3D2.LIFEEX</span></span>
<span><span class="co"># ABW-1960             NA</span></span>
<span><span class="co"># ABW-1961             NA</span></span>
<span><span class="co"># ABW-1962             NA</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="panel-data-to-array-conversions">1.5 Panel Data to Array Conversions<a class="anchor" aria-label="anchor" href="#panel-data-to-array-conversions"></a>
</h3>
<p>Viewing and transforming panel data stored in an array can be a
powerful strategy, especially as it provides much more direct access to
the different dimensions of the data. The function <code>psmat</code>
can be used to efficiently transform <em>pseries</em> to a 2D matrix,
and <em>pdata.frame</em>’s to a 3D array:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Converting the panel series to array, individual rows (default)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="../reference/psmat.html">psmat</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#  'psmat' num [1:216, 1:61] 65.7 32.4 37.5 62.3 NA ...</span></span>
<span><span class="co">#  - attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#   ..$ : chr [1:216] "ABW" "AFG" "AGO" "ALB" ...</span></span>
<span><span class="co">#   ..$ : chr [1:61] "1960" "1961" "1962" "1963" ...</span></span>
<span><span class="co">#  - attr(*, "transpose")= logi FALSE</span></span>
<span></span>
<span><span class="co"># Converting the panel series to array, individual columns</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="../reference/psmat.html">psmat</a></span><span class="op">(</span><span class="va">LIFEEX</span>, transpose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#  'psmat' num [1:61, 1:216] 65.7 66.1 66.4 66.8 67.1 ...</span></span>
<span><span class="co">#  - attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#   ..$ : chr [1:61] "1960" "1961" "1962" "1963" ...</span></span>
<span><span class="co">#   ..$ : chr [1:216] "ABW" "AFG" "AGO" "ALB" ...</span></span>
<span><span class="co">#  - attr(*, "transpose")= logi TRUE</span></span>
<span></span>
<span><span class="co"># Same as plm::as.matrix.pseries, apart from attributes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="fu"><a href="../reference/small-helpers.html">unattrib</a></span><span class="op">(</span><span class="fu"><a href="../reference/psmat.html">psmat</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="../reference/small-helpers.html">unattrib</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># [1] TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="fu"><a href="../reference/small-helpers.html">unattrib</a></span><span class="op">(</span><span class="fu"><a href="../reference/psmat.html">psmat</a></span><span class="op">(</span><span class="va">LIFEEX</span>, transpose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="../reference/small-helpers.html">unattrib</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">LIFEEX</span>, idbyrow <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># [1] TRUE</span></span></code></pre></div>
<p>Applying <code>psmat</code> to a <em>pdata.frame</em> yields a 3D
array:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">psar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/psmat.html">psmat</a></span><span class="op">(</span><span class="va">pwlddev</span>, cols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">psar</span><span class="op">)</span></span>
<span><span class="co">#  'psmat' num [1:216, 1:61, 1:4] NA NA NA NA NA ...</span></span>
<span><span class="co">#  - attr(*, "dimnames")=List of 3</span></span>
<span><span class="co">#   ..$ : chr [1:216] "ABW" "AFG" "AGO" "ALB" ...</span></span>
<span><span class="co">#   ..$ : chr [1:61] "1960" "1961" "1962" "1963" ...</span></span>
<span><span class="co">#   ..$ : chr [1:4] "PCGDP" "LIFEEX" "GINI" "ODA"</span></span>
<span><span class="co">#  - attr(*, "transpose")= logi FALSE</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="../reference/psmat.html">psmat</a></span><span class="op">(</span><span class="va">pwlddev</span>, cols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">12</span>, transpose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#  'psmat' num [1:61, 1:216, 1:4] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#  - attr(*, "dimnames")=List of 3</span></span>
<span><span class="co">#   ..$ : chr [1:61] "1960" "1961" "1962" "1963" ...</span></span>
<span><span class="co">#   ..$ : chr [1:216] "ABW" "AFG" "AGO" "ALB" ...</span></span>
<span><span class="co">#   ..$ : chr [1:4] "PCGDP" "LIFEEX" "GINI" "ODA"</span></span>
<span><span class="co">#  - attr(*, "transpose")= logi TRUE</span></span></code></pre></div>
<p>This format can be very convenient to quickly and freely access data
for different countries, variables and time-periods:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Looking at wealth, health and inequality in Brazil and Argentinia, 1990-1999</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/aperm.html" class="external-link">aperm</a></span><span class="op">(</span><span class="va">psar</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BRA"</span>,<span class="st">"ARG"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fl">1990</span><span class="op">:</span><span class="fl">1999</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PCGDP"</span>, <span class="st">"LIFEEX"</span>, <span class="st">"GINI"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># , , BRA</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#          1990   1991   1992   1993   1994   1995   1996   1997   1998   1999</span></span>
<span><span class="co"># PCGDP  7983.7 7963.1 7791.8 8020.6 8311.6 8540.1 8591.0 8744.8 8641.3 8554.1</span></span>
<span><span class="co"># LIFEEX   66.3   66.7   67.1   67.5   67.9   68.3   68.7   69.1   69.4   69.8</span></span>
<span><span class="co"># GINI     60.5     NA   53.2   60.1     NA   59.6   59.9   59.8   59.6   59.0</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># , , ARG</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#          1990   1991   1992   1993   1994   1995   1996   1997   1998   1999</span></span>
<span><span class="co"># PCGDP  6245.7 6721.3 7157.3 7644.2 7988.6 7666.5 7994.2 8543.0 8772.1 8381.3</span></span>
<span><span class="co"># LIFEEX   71.6   71.8   72.0   72.2   72.5   72.7   72.8   73.0   73.2   73.4</span></span>
<span><span class="co"># GINI       NA   46.8   45.5   44.9   45.9   48.9   49.5   49.1   50.7   49.8</span></span></code></pre></div>
<p><code>psmat</code> can also return the output as a list of panel
series matrices:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pslist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/psmat.html">psmat</a></span><span class="op">(</span><span class="va">pwlddev</span>, cols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">12</span>, array <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">pslist</span><span class="op">)</span></span>
<span><span class="co"># List of 4</span></span>
<span><span class="co">#  $ PCGDP : 'psmat' num [1:216, 1:61] NA NA NA NA NA ...</span></span>
<span><span class="co">#   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#   .. ..$ : chr [1:216] "ABW" "AFG" "AGO" "ALB" ...</span></span>
<span><span class="co">#   .. ..$ : chr [1:61] "1960" "1961" "1962" "1963" ...</span></span>
<span><span class="co">#   ..- attr(*, "transpose")= logi FALSE</span></span>
<span><span class="co">#  $ LIFEEX: 'psmat' num [1:216, 1:61] 65.7 32.4 37.5 62.3 NA ...</span></span>
<span><span class="co">#   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#   .. ..$ : chr [1:216] "ABW" "AFG" "AGO" "ALB" ...</span></span>
<span><span class="co">#   .. ..$ : chr [1:61] "1960" "1961" "1962" "1963" ...</span></span>
<span><span class="co">#   ..- attr(*, "transpose")= logi FALSE</span></span>
<span><span class="co">#  $ GINI  : 'psmat' num [1:216, 1:61] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#   .. ..$ : chr [1:216] "ABW" "AFG" "AGO" "ALB" ...</span></span>
<span><span class="co">#   .. ..$ : chr [1:61] "1960" "1961" "1962" "1963" ...</span></span>
<span><span class="co">#   ..- attr(*, "transpose")= logi FALSE</span></span>
<span><span class="co">#  $ ODA   : 'psmat' num [1:216, 1:61] NA 116769997 -390000 NA NA ...</span></span>
<span><span class="co">#   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#   .. ..$ : chr [1:216] "ABW" "AFG" "AGO" "ALB" ...</span></span>
<span><span class="co">#   .. ..$ : chr [1:61] "1960" "1961" "1962" "1963" ...</span></span>
<span><span class="co">#   ..- attr(*, "transpose")= logi FALSE</span></span></code></pre></div>
<p>This list can then be unlisted using the function
<code>unlist2d</code> (for unlisting in 2-dimensions), to yield a
reshaped data.frame:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/unlist2d.html">unlist2d</a></span><span class="op">(</span><span class="va">pslist</span>, idcols <span class="op">=</span> <span class="st">"Variable"</span>, row.names <span class="op">=</span> <span class="st">"Country Code"</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#   Variable Country Code 1960 1961 1962 1963 1964 1965 1966 1967 1968 1969 1970 1971 1972 1973 1974</span></span>
<span><span class="co"># 1    PCGDP          ABW   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA</span></span>
<span><span class="co"># 2    PCGDP          AFG   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA</span></span>
<span><span class="co"># 3    PCGDP          AGO   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA</span></span>
<span><span class="co">#   1975 1976 1977 1978 1979     1980     1981     1982     1983     1984     1985      1986</span></span>
<span><span class="co"># 1   NA   NA   NA   NA   NA       NA       NA       NA       NA       NA       NA 15669.616</span></span>
<span><span class="co"># 2   NA   NA   NA   NA   NA       NA       NA       NA       NA       NA       NA        NA</span></span>
<span><span class="co"># 3   NA   NA   NA   NA   NA 3193.404 2947.194 2844.322 2859.919 2925.367 2922.217  2902.618</span></span>
<span><span class="co">#        1987      1988      1989      1990      1991      1992      1993      1994     1995</span></span>
<span><span class="co"># 1 18427.612 22134.017 24837.951 25357.787 26329.313 26401.969 26663.208 27272.310 26705.18</span></span>
<span><span class="co"># 2        NA        NA        NA        NA        NA        NA        NA        NA       NA</span></span>
<span><span class="co"># 3  2916.794  2989.617  2889.886  2697.491  2635.156  2401.234  1767.025  1733.844  1930.80</span></span>
<span><span class="co">#        1996      1997     1998     1999      2000      2001       2002       2003       2004</span></span>
<span><span class="co"># 1 26087.776 27190.501 27151.92 26954.40 28417.384 26966.055 25508.3027 25469.2876 27005.5294</span></span>
<span><span class="co"># 2        NA        NA       NA       NA        NA        NA   330.3036   343.0809   333.2167</span></span>
<span><span class="co"># 3  2122.968  2205.294  2235.39  2211.13  2205.205  2223.335  2444.4178  2433.8616  2608.7840</span></span>
<span><span class="co">#         2005       2006      2007       2008       2009      2010       2011       2012       2013</span></span>
<span><span class="co"># 1 26979.8854 27046.2242 27427.579 27365.9312 24463.6922 23512.603 24233.0011 23781.2573 24635.7649</span></span>
<span><span class="co"># 2   357.2347   365.2845   405.549   412.0143   488.3003   543.303   528.7366   576.1901   587.5651</span></span>
<span><span class="co"># 3  2896.5547  3116.1810  3424.372  3668.0799  3565.0569  3587.884  3579.9599  3748.4507  3796.8822</span></span>
<span><span class="co">#         2014       2015       2016       2017     2018      2019 2020</span></span>
<span><span class="co"># 1 24563.2343 25822.2514 26231.0267 26630.2053       NA        NA   NA</span></span>
<span><span class="co"># 2   583.6562   574.1841   571.0738   571.4407  564.610  573.2876   NA</span></span>
<span><span class="co"># 3  3843.1979  3748.3201  3530.3107  3409.9303 3233.906 3111.1577   NA</span></span></code></pre></div>
<p>Of course we could also have applied some transformation (like
computing pairwise correlations) to each matrix before unlisting. In any
case this kind of programming provides lots of possibilities to explore
and manipulate panel data (as we will see in Part 2).</p>
</div>
<div class="section level3">
<h3 id="benchmarks">Benchmarks<a class="anchor" aria-label="anchor" href="#benchmarks"></a>
</h3>
<p>Below benchmarks are provided of the <em>collapse</em> implementation
against native <em>plm</em>. To do this the dataset used so far is
extended to have approx 1 million observations:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wlddevsmall</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="va">wlddev</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iso3c"</span>,<span class="st">"year"</span>,<span class="st">"OECD"</span>,<span class="st">"PCGDP"</span>,<span class="st">"LIFEEX"</span>,<span class="st">"GINI"</span>,<span class="st">"ODA"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">wlddevsmall</span><span class="op">$</span><span class="va">iso3c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">wlddevsmall</span><span class="op">$</span><span class="va">iso3c</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="fl">100</span>, <span class="va">wlddevsmall</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">wlddevsmall</span><span class="op">)</span></span>
<span><span class="va">uniquify</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">$</span><span class="va">iso3c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">iso3c</span>, <span class="va">i</span><span class="op">)</span></span>
<span>  <span class="va">x</span></span>
<span><span class="op">}</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unlist2d.html">unlist2d</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Map</a></span><span class="op">(</span><span class="va">uniquify</span>, <span class="va">data</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span>, idcols <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/plm/man/pdata.frame.html" class="external-link">pdata.frame</a></span><span class="op">(</span><span class="va">data</span>, index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iso3c"</span>, <span class="st">"year"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/plm/man/pdim.html" class="external-link">pdim</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co"># Balanced Panel: n = 21600, T = 61, N = 1317600</span></span></code></pre></div>
<p>The data has 21600 individuals (countries) observed for up to 61
years (1960-2020), the total number of rows is 1317600. We can pull out
a series of life expectancy and run some benchmarks. The Windows laptop
on which these benchmarks were run has a 2x 2.2 GHZ Intel i5 processor,
8GB DDR3 RAM and a Samsung SSD hard drive.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/joshuaulrich/microbenchmark/" class="external-link">microbenchmark</a></span><span class="op">)</span></span>
<span><span class="co"># Creating the extended panel series for Life Expectancy (l for large)</span></span>
<span><span class="va">LIFEEX_l</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">LIFEEX</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">LIFEEX_l</span><span class="op">)</span></span>
<span><span class="co">#  'pseries' Named num [1:1317600] 65.7 66.1 66.4 66.8 67.1 ...</span></span>
<span><span class="co">#  - attr(*, "names")= chr [1:1317600] "ABW1-1960" "ABW1-1961" "ABW1-1962" "ABW1-1963" ...</span></span>
<span><span class="co">#  - attr(*, "index")=Classes 'pindex' and 'data.frame':    1317600 obs. of  2 variables:</span></span>
<span><span class="co">#   ..$ iso3c: Factor w/ 21600 levels "ABW1","ABW10",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#   ..$ year : Factor w/ 61 levels "1960","1961",..: 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span></span>
<span><span class="co"># Between Transformations</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/plm/man/pseries.html" class="external-link">Between</a></span><span class="op">(</span><span class="va">LIFEEX_l</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#                             expr      min       lq     mean   median       uq      max neval</span></span>
<span><span class="co">#  Between(LIFEEX_l, na.rm = TRUE) 17.73594 18.71248 21.84342 20.13574 22.35853 37.94689    10</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">fbetween</a></span><span class="op">(</span><span class="va">LIFEEX_l</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#                expr      min       lq     mean   median       uq      max neval</span></span>
<span><span class="co">#  fbetween(LIFEEX_l) 4.408771 4.639519 4.705529 4.718424 4.771498 4.908684    10</span></span>
<span></span>
<span><span class="co"># Within Transformations</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/plm/man/pseries.html" class="external-link">Within</a></span><span class="op">(</span><span class="va">LIFEEX_l</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#                            expr      min       lq     mean  median       uq      max neval</span></span>
<span><span class="co">#  Within(LIFEEX_l, na.rm = TRUE) 10.17887 10.74663 10.91092 10.8766 11.24224 11.37664    10</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">fwithin</a></span><span class="op">(</span><span class="va">LIFEEX_l</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#               expr      min       lq     mean   median       uq      max neval</span></span>
<span><span class="co">#  fwithin(LIFEEX_l) 4.522218 4.550303 4.735344 4.644296 4.696017 5.297036    10</span></span>
<span></span>
<span><span class="co"># Higher-Dimenional Between and Within Transformations</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/fhdbetween_fhdwithin.html">fhdbetween</a></span><span class="op">(</span><span class="va">LIFEEX_l</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#                  expr    min       lq    mean   median       uq      max neval</span></span>
<span><span class="co">#  fhdbetween(LIFEEX_l) 56.916 57.29971 66.0179 58.13864 76.50108 84.10625    10</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/fhdbetween_fhdwithin.html">fhdwithin</a></span><span class="op">(</span><span class="va">LIFEEX_l</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#                 expr      min      lq     mean   median       uq      max neval</span></span>
<span><span class="co">#  fhdwithin(LIFEEX_l) 55.55906 56.2372 62.31852 56.56555 75.78784 77.20657    10</span></span>
<span></span>
<span><span class="co"># Single Lag</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">LIFEEX_l</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#           expr      min       lq     mean   median       uq      max neval</span></span>
<span><span class="co">#  lag(LIFEEX_l) 7.967776 8.144896 8.542879 8.632468 8.840092 8.949357    10</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/flag.html">flag</a></span><span class="op">(</span><span class="va">LIFEEX_l</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#            expr      min       lq     mean   median       uq     max neval</span></span>
<span><span class="co">#  flag(LIFEEX_l) 7.994057 8.038747 8.337862 8.180484 8.603481 9.12086    10</span></span>
<span></span>
<span><span class="co"># Sequence of Lags / Leads</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">LIFEEX_l</span>, <span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#                 expr     min       lq     mean   median       uq     max neval</span></span>
<span><span class="co">#  lag(LIFEEX_l, -1:3) 18.7525 19.29476 28.61876 27.95813 38.11081 39.5329    10</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/flag.html">flag</a></span><span class="op">(</span><span class="va">LIFEEX_l</span>, <span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#                  expr     min       lq     mean   median       uq      max neval</span></span>
<span><span class="co">#  flag(LIFEEX_l, -1:3) 15.5415 15.64335 21.10042 15.83998 33.37699 34.10265    10</span></span>
<span></span>
<span><span class="co"># Single difference</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">LIFEEX_l</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#            expr     min      lq     mean   median       uq      max neval</span></span>
<span><span class="co">#  diff(LIFEEX_l) 8.00525 8.16884 8.370421 8.368776 8.554404 8.733697    10</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/fdiff.html">fdiff</a></span><span class="op">(</span><span class="va">LIFEEX_l</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#             expr      min       lq   mean median       uq     max neval</span></span>
<span><span class="co">#  fdiff(LIFEEX_l) 7.937805 8.020502 8.3458 8.2451 8.426238 9.34923    10</span></span>
<span></span>
<span><span class="co"># Iterated Difference</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/fdiff.html">fdiff</a></span><span class="op">(</span><span class="va">LIFEEX_l</span>, diff <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#                       expr      min       lq     mean   median       uq      max neval</span></span>
<span><span class="co">#  fdiff(LIFEEX_l, diff = 2) 10.20129 10.62786 10.72184 10.77488 10.82326 11.21805    10</span></span>
<span></span>
<span><span class="co"># Sequence of Lagged / Leaded and iterated differences</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/fdiff.html">fdiff</a></span><span class="op">(</span><span class="va">LIFEEX_l</span>, <span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#                        expr      min       lq     mean   median       uq      max neval</span></span>
<span><span class="co">#  fdiff(LIFEEX_l, -1:3, 1:2) 45.90159 52.22494 66.83236 53.21347 57.53222 187.8582    10</span></span>
<span></span>
<span><span class="co"># Single Growth Rate</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/fgrowth.html">fgrowth</a></span><span class="op">(</span><span class="va">LIFEEX_l</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#               expr      min       lq    mean   median       uq      max neval</span></span>
<span><span class="co">#  fgrowth(LIFEEX_l) 8.222304 8.357153 8.69059 8.727158 8.884167 9.436683    10</span></span>
<span></span>
<span><span class="co"># Single Log-Difference</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/fdiff.html">fdiff</a></span><span class="op">(</span><span class="va">LIFEEX_l</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#                         expr      min      lq     mean   median       uq      max neval</span></span>
<span><span class="co">#  fdiff(LIFEEX_l, log = TRUE) 12.41394 12.8583 15.06961 13.17156 13.61659 32.51989    10</span></span>
<span></span>
<span><span class="co"># Panel Series to Matrix Conversion</span></span>
<span><span class="co"># system.time(as.matrix(LIFEEX_l))  This takes about 3 minutes to compute</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/psmat.html">psmat</a></span><span class="op">(</span><span class="va">LIFEEX_l</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#             expr      min       lq     mean   median       uq      max neval</span></span>
<span><span class="co">#  psmat(LIFEEX_l) 1.482478 1.500149 1.628028 1.520813 1.553941 2.438639    10</span></span></code></pre></div>
<!-- The results show that I did not promise too much in the introduction. A speed gain of 20-40x is the norm, and for certain operations such as the sequence of lags and leads the speed gain is about 100x, and for the panel series to matrix conversion a 300x speed gain by using *collapse* vs. native *plm*.  -->
<p>This shows a comparison between flag and <em>data.table</em>’s
shift:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/flag.html">L</a></span><span class="op">(</span><span class="va">data</span>, cols <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#                 expr      min       lq     mean median       uq      max neval</span></span>
<span><span class="co">#  L(data, cols = 3:6) 14.13692 14.43877 20.88276 18.865 19.73141 37.06244    10</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co"># 'Improper' panel-lag</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>, <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/shift.html" class="external-link">shift</a></span><span class="op">(</span><span class="va">.SD</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">iso3c</span>, .SDcols <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#                                           expr      min       lq     mean   median      uq      max</span></span>
<span><span class="co">#  data[, shift(.SD), by = iso3c, .SDcols = 3:6] 176.5308 199.9415 215.6897 204.0719 230.089 268.9992</span></span>
<span><span class="co">#  neval</span></span>
<span><span class="co">#     10</span></span>
<span></span>
<span><span class="co"># This does what L is actually doing (without sorting the data)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>, <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/shift.html" class="external-link">shift</a></span><span class="op">(</span><span class="va">.SD</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">iso3c</span>, .SDcols <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#                                                      expr      min       lq     mean   median</span></span>
<span><span class="co">#  data[order(year), shift(.SD), by = iso3c, .SDcols = 3:6] 193.9684 210.7025 213.7664 213.0727</span></span>
<span><span class="co">#        uq      max neval</span></span>
<span><span class="co">#  221.9783 226.3685    10</span></span></code></pre></div>
<p>The above dataset has 1 million obs in 20 thousand groups, but what
about 10 million obs and 1 million groups? Do <em>collapse</em>
functions scale efficiently as data and the number of groups grows
large? Here is a simple benchmark:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1e7</span><span class="op">)</span>                                     <span class="co"># 10 million obs</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/qF.html">qF</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">1e6</span>, each <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, na.exclude <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>  <span class="co"># 1 million individuals</span></span>
<span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/qF.html">qF</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fl">1e6</span><span class="op">)</span>, na.exclude <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>         <span class="co"># 10 time-periods per individual</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">fbetween</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">g</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#            expr      min       lq     mean   median       uq      max neval</span></span>
<span><span class="co">#  fbetween(x, g) 51.66189 53.60693 91.00168 62.54655 73.87835 233.3696    10</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">fwithin</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">g</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#           expr      min       lq    mean   median       uq      max neval</span></span>
<span><span class="co">#  fwithin(x, g) 43.46291 44.03954 77.0216 45.33919 58.65132 196.7248    10</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/flag.html">flag</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, <span class="va">g</span>, <span class="va">t</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#              expr      min       lq     mean   median       uq      max neval</span></span>
<span><span class="co">#  flag(x, 1, g, t) 42.65382 55.05332 87.72527 59.55935 80.86143 210.8074    10</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/flag.html">flag</a></span><span class="op">(</span><span class="va">x</span>, <span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">1</span>, <span class="va">g</span>, <span class="va">t</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#                 expr      min      lq     mean  median       uq      max neval</span></span>
<span><span class="co">#  flag(x, -1:1, g, t) 92.19842 92.5559 162.8994 166.736 228.6354 239.6953    10</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/fdiff.html">fdiff</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="va">g</span>, <span class="va">t</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#                  expr      min       lq     mean   median       uq      max neval</span></span>
<span><span class="co">#  fdiff(x, 1, 1, g, t) 42.51778 46.29306 82.27838 53.85735 67.54295 205.0114    10</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/fdiff.html">fdiff</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="va">g</span>, <span class="va">t</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#                  expr     min       lq     mean   median       uq      max neval</span></span>
<span><span class="co">#  fdiff(x, 1, 2, g, t) 59.9363 62.11689 84.42818 69.85072 75.38506 217.1431    10</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/fdiff.html">fdiff</a></span><span class="op">(</span><span class="va">x</span>, <span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="va">g</span>, <span class="va">t</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#                       expr      min       lq     mean  median       uq      max neval</span></span>
<span><span class="co">#  fdiff(x, -1:1, 1:2, g, t) 163.5046 182.9127 246.2855 250.664 301.4046 339.1415    10</span></span></code></pre></div>
<p>The results show that <em>collapse</em> functions perform very well
even as the number of groups grows large.</p>
<!-- in fact tests show that the large sample performance for aggregations with *collapse* is similar to *data.table*, and *collapse* grouped transformations like the ones shown here are generally faster than what can be done with *data.table*.  -->
<p>The conclusion of this benchmark analysis is that <em>collapse</em>’s
fast functions, with or without the help of <em>plm</em> classes, allow
for very fast transformations of panel data, and should enable R
programmers and econometricians to implement high-performance panel data
estimators without having to dive into C/C++ themselves or resorting to
<em>data.table</em> metaprogramming.</p>
</div>
</div>
<div class="section level2">
<h2 id="part-2-fast-exploration-of-panel-data">Part 2: Fast Exploration of Panel Data<a class="anchor" aria-label="anchor" href="#part-2-fast-exploration-of-panel-data"></a>
</h2>
<p><em>collapse</em> also provides some essential functions to summarize
and explore panel data, such as a fast check of variation over different
dimensions, fast summary-statistics for panel data, panel-auto,
partial-auto and cross-correlation functions, and a fast F-test to test
fixed effects and other exclusion restrictions on (large) panel data
models. Panel data to matrix conversion further allows the application
of some correlational and unsupervised learning tools such as PCA,
clustering or dynamic factor analysis.</p>
<div class="section level3">
<h3 id="variation-check-for-panel-data">2.1 Variation Check for Panel Data<a class="anchor" aria-label="anchor" href="#variation-check-for-panel-data"></a>
</h3>
<p>The function <code>varying</code> can be used to check over which
panel-dimensions different variable have variation. When passed a
<em>pdata.frame</em>, <code>varying</code> by default takes the first
identifier and checks for variation <em>within</em> that dimension.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This checks for any variation within "iso3c", the first index variable: TRUE means data vary within country i.e. over time.</span></span>
<span><span class="fu"><a href="../reference/varying.html">varying</a></span><span class="op">(</span><span class="va">pwlddev</span><span class="op">)</span></span>
<span><span class="co"># country    date    year  decade  region  income    OECD   PCGDP  LIFEEX    GINI     ODA     POP </span></span>
<span><span class="co">#   FALSE    TRUE    TRUE    TRUE   FALSE   FALSE   FALSE    TRUE    TRUE    TRUE    TRUE    TRUE</span></span></code></pre></div>
<p>Alternatively any index variable or combination of index variables
can be specified:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This checks any variation within time variable, i.e. cross-sectional variation.</span></span>
<span><span class="fu"><a href="../reference/varying.html">varying</a></span><span class="op">(</span><span class="va">pwlddev</span>, effect <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span></span>
<span><span class="co"># country   iso3c    date  decade  region  income    OECD   PCGDP  LIFEEX    GINI     ODA     POP </span></span>
<span><span class="co">#    TRUE    TRUE   FALSE   FALSE    TRUE    TRUE    TRUE    TRUE    TRUE    TRUE    TRUE    TRUE</span></span></code></pre></div>
<p>Another possibility is checking for variation within each group:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This checks cross-sectional variation within each year for 4 indicators.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/varying.html">varying</a></span><span class="op">(</span><span class="va">pwlddev</span>, effect <span class="op">=</span> <span class="st">"year"</span>, cols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">12</span>, any_group <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#      PCGDP LIFEEX GINI  ODA</span></span>
<span><span class="co"># 1960  TRUE   TRUE   NA TRUE</span></span>
<span><span class="co"># 1961  TRUE   TRUE   NA TRUE</span></span>
<span><span class="co"># 1962  TRUE   TRUE   NA TRUE</span></span>
<span><span class="co"># 1963  TRUE   TRUE   NA TRUE</span></span>
<span><span class="co"># 1964  TRUE   TRUE   NA TRUE</span></span>
<span><span class="co"># 1965  TRUE   TRUE   NA TRUE</span></span></code></pre></div>
<p><code>varying</code> also has a pseries method. The code below checks
for time-variation of the GINI index within each country. A
<code>NA</code> is returned when there are no observations within a
particular country.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/varying.html">varying</a></span><span class="op">(</span><span class="va">pwlddev</span><span class="op">$</span><span class="va">GINI</span>, any_group <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, <span class="fl">20</span><span class="op">)</span></span>
<span><span class="co">#  ABW  AFG  AGO  ALB  AND  ARE  ARG  ARM  ASM  ATG  AUS  AUT  AZE  BDI  BEL  BEN  BFA  BGD  BGR  BHR </span></span>
<span><span class="co">#   NA   NA TRUE TRUE   NA TRUE TRUE TRUE   NA   NA TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE   NA</span></span></code></pre></div>
<p>If we would like to gave more information about this variation, we
could also invoke the functions <code>fndistinct</code> and
<code>fsd</code>, which do not have <em>pseries</em> methods:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fndistinct.html">fndistinct</a></span><span class="op">(</span><span class="va">pwlddev</span><span class="op">$</span><span class="va">GINI</span>, <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html" class="external-link">index</a></span><span class="op">(</span><span class="va">pwlddev</span>, <span class="st">"iso3c"</span><span class="op">)</span><span class="op">)</span>, <span class="fl">20</span><span class="op">)</span></span>
<span><span class="co"># ABW AFG AGO ALB AND ARE ARG ARM ASM ATG AUS AUT AZE BDI BEL BEN BFA BGD BGR BHR </span></span>
<span><span class="co">#   0   0   3   9   0   2  29  20   0   0   9  16   5   4  16   3   5   9  12   0</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/fvar_fsd.html">fsd</a></span><span class="op">(</span><span class="va">pwlddev</span><span class="op">$</span><span class="va">GINI</span>, <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html" class="external-link">index</a></span><span class="op">(</span><span class="va">pwlddev</span>, <span class="st">"iso3c"</span><span class="op">)</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fl">20</span><span class="op">)</span></span>
<span><span class="co">#  ABW  AFG  AGO  ALB  AND  ARE  ARG  ARM  ASM  ATG  AUS  AUT  AZE  BDI  BEL  BEN  BFA  BGD  BGR  BHR </span></span>
<span><span class="co">#   NA   NA 5.18 2.47   NA 4.60 3.84 2.76   NA   NA 1.19 1.76 4.85 4.37 1.71 4.60 5.98 3.02 2.58   NA</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="summary-statistics-for-panel-data">2.2 Summary Statistics for Panel Data<a class="anchor" aria-label="anchor" href="#summary-statistics-for-panel-data"></a>
</h3>
<p>Efficient summary statistics for panel data have long been
implemented in other statistical softwares. The command
<code>qsu</code>, shorthand for ‘quick-summary’, is a very efficient
summary statistics command inspired by the <em>xtsummarize</em> command
in the Stata statistical software. It computes a default set of 5
statistics (N, mean, sd, min and max) and can also computed higher
moments (skewness and kurtosis) in a single pass through the data (using
a numerically stable online algorithm generalized from Welford’s
Algorithm for variance computations). With panel data, <code>qsu</code>
computes these statistics not just on the raw data, but also on the
between-transformed and within-transformed data:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/qsu.html">qsu</a></span><span class="op">(</span><span class="va">pwlddev</span>, cols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">12</span>, higher <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># , , PCGDP</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#              N/T        Mean          SD          Min         Max    Skew     Kurt</span></span>
<span><span class="co"># Overall     9470   12048.778  19077.6416     132.0776  196061.417  3.1276  17.1154</span></span>
<span><span class="co"># Between      206  12962.6054  20189.9007     253.1886   141200.38  3.1263  16.2299</span></span>
<span><span class="co"># Within   45.9709   12048.778   6723.6808  -33504.8721  76767.5254  0.6576  17.2003</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># , , LIFEEX</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#              N/T     Mean       SD      Min      Max     Skew    Kurt</span></span>
<span><span class="co"># Overall    11670  64.2963  11.4764   18.907  85.4171  -0.6748  2.6718</span></span>
<span><span class="co"># Between      207  64.9537   9.8936  40.9663  85.4171  -0.5012  2.1693</span></span>
<span><span class="co"># Within   56.3768  64.2963   6.0842  32.9068  84.4198  -0.2643  3.7027</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># , , GINI</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#              N/T     Mean      SD      Min      Max    Skew    Kurt</span></span>
<span><span class="co"># Overall     1744  38.5341  9.2006     20.7     65.8   0.596  2.5329</span></span>
<span><span class="co"># Between      167  39.4233  8.1356  24.8667  61.7143  0.5832  2.8256</span></span>
<span><span class="co"># Within   10.4431  38.5341  2.9277  25.3917  55.3591  0.3263  5.3389</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># , , ODA</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#              N/T        Mean          SD              Min             Max    Skew      Kurt</span></span>
<span><span class="co"># Overall     8608  454'720131  868'712654      -997'679993  2.56715605e+10  6.9832   114.889</span></span>
<span><span class="co"># Between      178  439'168412  569'049959       468717.916  3.62337432e+09   2.355    9.9487</span></span>
<span><span class="co"># Within   48.3596  454'720131  650'709624  -2.44379420e+09  2.45610972e+10  9.6047  263.3716</span></span></code></pre></div>
<p>Key statistics to look at in this summary are the sample size and the
standard-deviation decomposed into the between-individuals and the
within-individuals standard-deviation: For GDP per Capita we have 8995
observations in the panel series for 203 countries, with on average
44.31 observations (time-periods T) per country. The between-country
standard deviation is 19600 USD, around 3-times larger than the
within-country (over-time) standard deviation of 6300 USD. Regarding the
mean, the between-mean, computed as a cross-sectional average of country
averages, usually differs slightly from the overall average taken across
all data points. The within-transformed data is computed and summarized
with the overall mean added back (i.e. as in
<code>fwithin(PCGDP, mean = "overall.mean")</code>).</p>
<p>We can also do groupwise panel-statistics and <code>qsu</code> also
supports weights (not shown):</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/qsu.html">qsu</a></span><span class="op">(</span><span class="va">pwlddev</span>, <span class="op">~</span> <span class="va">income</span>, cols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">12</span>, higher <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># , , Overall, PCGDP</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#                       N/T        Mean          SD       Min         Max    Skew     Kurt</span></span>
<span><span class="co"># High income          3179  30280.7283  23847.0483  932.0417  196061.417  2.1702  10.3425</span></span>
<span><span class="co"># Low income           1311    597.4053    288.4392  164.3366   1864.7925  1.2385   4.7115</span></span>
<span><span class="co"># Lower middle income  2246   1574.2535    858.7183  144.9863   4818.1922  0.9093   3.7153</span></span>
<span><span class="co"># Upper middle income  2734   4945.3258   2979.5609  132.0776  20532.9523  1.2286   4.9391</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># , , Between, PCGDP</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#                      N/T        Mean          SD        Min         Max    Skew    Kurt</span></span>
<span><span class="co"># High income           71  30280.7283  20908.5323  5413.4495   141200.38  2.1347  9.9673</span></span>
<span><span class="co"># Low income            28    597.4053    243.8219   253.1886   1357.3326  1.4171  5.3137</span></span>
<span><span class="co"># Lower middle income   47   1574.2535    676.3157   444.2899   2896.8682  0.3562  2.2358</span></span>
<span><span class="co"># Upper middle income   60   4945.3258   2327.3834   1604.595  13344.5423    1.24  4.7803</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># , , Within, PCGDP</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#                          N/T       Mean          SD          Min         Max    Skew    Kurt</span></span>
<span><span class="co"># High income          44.7746  12048.778  11467.9987  -33504.8721  76767.5254  0.3924  6.0523</span></span>
<span><span class="co"># Low income           46.8214  12048.778    154.1039   11606.2382   12698.296  0.5098  4.0676</span></span>
<span><span class="co"># Lower middle income  47.7872  12048.778    529.1449   10377.7234  14603.1055  0.7658  5.4272</span></span>
<span><span class="co"># Upper middle income  45.5667  12048.778    1860.395    4846.3834  24883.1246  0.6858  7.8469</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># , , Overall, LIFEEX</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#                       N/T     Mean      SD     Min      Max     Skew    Kurt</span></span>
<span><span class="co"># High income          3831  73.6246  5.6693  42.672  85.4171  -1.0067  5.5553</span></span>
<span><span class="co"># Low income           1800  49.7301  9.0944  26.172    74.43   0.2748  2.6721</span></span>
<span><span class="co"># Lower middle income  2790  58.1481  9.3115  18.907   76.699  -0.3406  2.6845</span></span>
<span><span class="co"># Upper middle income  3249  66.6466   7.537  36.535   80.279  -1.0988  4.2262</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># , , Between, LIFEEX</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#                      N/T     Mean      SD      Min      Max     Skew    Kurt</span></span>
<span><span class="co"># High income           73  73.6246  3.3499  64.0302  85.4171  -0.6537  2.9946</span></span>
<span><span class="co"># Low income            30  49.7301  4.8321  40.9663   66.945   1.5195  6.6802</span></span>
<span><span class="co"># Lower middle income   47  58.1481  5.9945  45.7687  71.6078   0.0352  2.2126</span></span>
<span><span class="co"># Upper middle income   57  66.6466  4.9955   48.057  74.0504  -1.3647   5.303</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># , , Within, LIFEEX</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#                          N/T     Mean      SD      Min      Max     Skew    Kurt</span></span>
<span><span class="co"># High income          52.4795  64.2963  4.5738  42.9381  78.1271  -0.4838  3.8923</span></span>
<span><span class="co"># Low income                60  64.2963  7.7045  41.5678  84.4198   0.0402  2.6086</span></span>
<span><span class="co"># Lower middle income  59.3617  64.2963  7.1253  32.9068  83.9918  -0.2522   3.181</span></span>
<span><span class="co"># Upper middle income       57  64.2963  5.6437  41.4342  83.0122   -0.507  4.0355</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># , , Overall, GINI</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#                      N/T     Mean      SD   Min   Max    Skew    Kurt</span></span>
<span><span class="co"># High income          680  33.3037  6.7885  20.7  58.9  1.4864  5.6772</span></span>
<span><span class="co"># Low income           107  41.1327  6.5767  29.5  65.8  0.7523   4.236</span></span>
<span><span class="co"># Lower middle income  369  40.0504  9.3032    24  63.2  0.4388  2.2218</span></span>
<span><span class="co"># Upper middle income  588  43.1585  8.9549  25.2  64.8  0.0814  2.3517</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># , , Between, GINI</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#                      N/T     Mean      SD      Min      Max    Skew    Kurt</span></span>
<span><span class="co"># High income           41  33.3037  6.5238  24.8667  53.6296  1.5091  5.3913</span></span>
<span><span class="co"># Low income            28  41.1327  5.1706  32.1333    58.75  0.6042  4.0473</span></span>
<span><span class="co"># Lower middle income   46  40.0504  8.4622  27.6955   54.925   0.334   1.797</span></span>
<span><span class="co"># Upper middle income   52  43.1585  8.4359  27.9545  61.7143  0.0336  2.2441</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># , , Within, GINI</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#                          N/T     Mean      SD      Min      Max     Skew    Kurt</span></span>
<span><span class="co"># High income          16.5854  38.5341  1.8771  31.1841  45.8841  -0.0818   4.902</span></span>
<span><span class="co"># Low income            3.8214  38.5341  4.0643  29.4591  55.3591   0.6766  5.1025</span></span>
<span><span class="co"># Lower middle income   8.0217  38.5341  3.8654  27.9452  55.1008   0.4093  4.0058</span></span>
<span><span class="co"># Upper middle income  11.3077  38.5341  3.0043  25.3917  48.0131   0.0728  3.5115</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># , , Overall, ODA</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#                       N/T        Mean              SD          Min             Max     Skew</span></span>
<span><span class="co"># High income          1575  153'663194      425'918409  -464'709991  4.34612988e+09   5.2505</span></span>
<span><span class="co"># Low income           1692  631'660165      941'498380      -500000  1.04032100e+10   4.4628</span></span>
<span><span class="co"># Lower middle income  2544  692'072692  1.02452490e+09  -605'969971  1.18790801e+10   3.7913</span></span>
<span><span class="co"># Upper middle income  2797  301'326218      765'116131  -997'679993  2.56715605e+10  16.3123</span></span>
<span><span class="co">#                          Kurt</span></span>
<span><span class="co"># High income           36.2748</span></span>
<span><span class="co"># Low income            32.1305</span></span>
<span><span class="co"># Lower middle income   25.2442</span></span>
<span><span class="co"># Upper middle income  464.8625</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># , , Between, ODA</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#                      N/T        Mean          SD          Min             Max    Skew     Kurt</span></span>
<span><span class="co"># High income           42  153'663194  339'972909   468717.916  2.05456932e+09  3.9522  19.0792</span></span>
<span><span class="co"># Low income            30  631'660165  466'265486    91'536334  1.67220583e+09  0.9769   2.6602</span></span>
<span><span class="co"># Lower middle income   47  692'072692  765'003585  28'919000.2  3.62337432e+09  2.0429   7.2664</span></span>
<span><span class="co"># Upper middle income   59  301'326218  382'148153    13'160000  1.91297800e+09  2.1072   7.0291</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># , , Within, ODA</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#                          N/T        Mean          SD              Min             Max     Skew</span></span>
<span><span class="co"># High income             37.5  454'720131  256'563661      -920'977647  2.87632242e+09   2.2074</span></span>
<span><span class="co"># Low income              56.4  454'720131  817'933797  -1.19519570e+09  9.18572426e+09   3.8872</span></span>
<span><span class="co"># Lower middle income  54.1277  454'720131  681'484247  -2.44379420e+09  1.12814455e+10   3.8965</span></span>
<span><span class="co"># Upper middle income  47.4068  454'720131  662'846500  -2.04042108e+09  2.45610972e+10  19.6351</span></span>
<span><span class="co">#                          Kurt</span></span>
<span><span class="co"># High income           28.8682</span></span>
<span><span class="co"># Low income            33.5194</span></span>
<span><span class="co"># Lower middle income   47.7246</span></span>
<span><span class="co"># Upper middle income  657.3041</span></span></code></pre></div>
<p>Here it should be noted that any grouping is applied independently
from the data-transformation, i.e. the data is first transformed, and
then grouped statistics are calculated on the transformed data. The
computation of statistics is very efficient:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/qsu.html">qsu</a></span><span class="op">(</span><span class="va">LIFEEX_l</span><span class="op">)</span></span>
<span><span class="co">#               N/T     Mean       SD      Min      Max</span></span>
<span><span class="co"># Overall  1'167000  64.2963  11.4759   18.907  85.4171</span></span>
<span><span class="co"># Between     20700  64.9537     9.87  40.9663  85.4171</span></span>
<span><span class="co"># Within    56.3768  64.2963   6.0839  32.9068  84.4198</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/qsu.html">qsu</a></span><span class="op">(</span><span class="va">LIFEEX_l</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#           expr     min       lq     mean   median       uq      max neval</span></span>
<span><span class="co">#  qsu(LIFEEX_l) 9.49355 10.25679 11.07317 10.37214 10.78839 50.22574   100</span></span></code></pre></div>
<p>Using the transformation functions and the functions
<code>pwcor</code> and <code>pwcov</code>, we can also easily explore
the correlation structure of the data:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Overall pairwise correlations with pairwise observation count and significance testing (* = significant at 5% level)</span></span>
<span><span class="fu"><a href="../reference/pwcor_pwcov_pwnobs.html">pwcor</a></span><span class="op">(</span><span class="fu"><a href="../reference/select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="va">pwlddev</span>, <span class="fl">9</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span>, N <span class="op">=</span> <span class="cn">TRUE</span>, P <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#               PCGDP        LIFEEX         GINI          ODA</span></span>
<span><span class="co"># PCGDP    1   (9470)   .57* (9022) -.44* (1735) -.16* (7128)</span></span>
<span><span class="co"># LIFEEX  .57* (9022)   1   (11670) -.35* (1742) -.02  (8142)</span></span>
<span><span class="co"># GINI   -.44* (1735)  -.35* (1742)   1   (1744) -.20* (1109)</span></span>
<span><span class="co"># ODA    -.16* (7128)  -.02  (8142) -.20* (1109)   1   (8608)</span></span>
<span></span>
<span><span class="co"># Between correlations</span></span>
<span><span class="fu"><a href="../reference/pwcor_pwcov_pwnobs.html">pwcor</a></span><span class="op">(</span><span class="fu"><a href="../reference/fmean.html">fmean</a></span><span class="op">(</span><span class="fu"><a href="../reference/select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="va">pwlddev</span>, <span class="fl">9</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span>, <span class="va">pwlddev</span><span class="op">$</span><span class="va">iso3c</span><span class="op">)</span>, N <span class="op">=</span> <span class="cn">TRUE</span>, P <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#              PCGDP      LIFEEX        GINI         ODA</span></span>
<span><span class="co"># PCGDP    1   (206)  .60* (199) -.42* (165) -.25* (172)</span></span>
<span><span class="co"># LIFEEX  .60* (199)   1   (207) -.40* (165) -.21* (172)</span></span>
<span><span class="co"># GINI   -.42* (165) -.40* (165)   1   (167) -.19* (145)</span></span>
<span><span class="co"># ODA    -.25* (172) -.21* (172) -.19* (145)   1   (178)</span></span>
<span></span>
<span><span class="co"># Within correlations</span></span>
<span><span class="fu"><a href="../reference/pwcor_pwcov_pwnobs.html">pwcor</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">W</a></span><span class="op">(</span><span class="va">pwlddev</span>, cols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">12</span>, keep.ids <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, N <span class="op">=</span> <span class="cn">TRUE</span>, P <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#               W.PCGDP      W.LIFEEX       W.GINI        W.ODA</span></span>
<span><span class="co"># W.PCGDP    1   (9470)   .31* (9022) -.01  (1735) -.01  (7128)</span></span>
<span><span class="co"># W.LIFEEX  .31* (9022)   1   (11670) -.16* (1742)  .17* (8142)</span></span>
<span><span class="co"># W.GINI   -.01  (1735)  -.16* (1742)   1   (1744) -.08* (1109)</span></span>
<span><span class="co"># W.ODA    -.01  (7128)   .17* (8142) -.08* (1109)   1   (8608)</span></span></code></pre></div>
<p>The correlations show that the between (cross-country) relationships
of these macro-variables are quite strong, but within countries the
relationships are much weaker, for example there seems to be no
significant relationship between GDP per Capita and either inequality or
ODA received within countries over time.</p>
</div>
<div class="section level3">
<h3 id="exploring-panel-data-in-matrix-array-form">2.3 Exploring Panel Data in Matrix / Array Form<a class="anchor" aria-label="anchor" href="#exploring-panel-data-in-matrix-array-form"></a>
</h3>
<p>We can take a single panel series such as GDP per Capita and explore
it further:
<!-- The function `psmat` very efficiently generates a matrix from the series: -->
<!-- , fig.width=15 --></p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generating a (transposed) matrix of country GDPs per capita</span></span>
<span><span class="va">tGDPmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/psmat.html">psmat</a></span><span class="op">(</span><span class="va">PCGDP</span>, transpose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">tGDPmat</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span>
<span><span class="co">#      ABW AFG AGO ALB AND ARE  ARG ARM ASM ATG</span></span>
<span><span class="co"># 1960  NA  NA  NA  NA  NA  NA 5643  NA  NA  NA</span></span>
<span><span class="co"># 1961  NA  NA  NA  NA  NA  NA 5853  NA  NA  NA</span></span>
<span><span class="co"># 1962  NA  NA  NA  NA  NA  NA 5711  NA  NA  NA</span></span>
<span><span class="co"># 1963  NA  NA  NA  NA  NA  NA 5323  NA  NA  NA</span></span>
<span><span class="co"># 1964  NA  NA  NA  NA  NA  NA 5773  NA  NA  NA</span></span>
<span><span class="co"># 1965  NA  NA  NA  NA  NA  NA 6286  NA  NA  NA</span></span>
<span><span class="co"># 1966  NA  NA  NA  NA  NA  NA 6152  NA  NA  NA</span></span>
<span><span class="co"># 1967  NA  NA  NA  NA  NA  NA 6255  NA  NA  NA</span></span>
<span><span class="co"># 1968  NA  NA  NA  NA  NA  NA 6461  NA  NA  NA</span></span>
<span><span class="co"># 1969  NA  NA  NA  NA  NA  NA 6981  NA  NA  NA</span></span>
<span></span>
<span><span class="co"># plot the matrix (it will plot correctly no matter how the matrix is transposed)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tGDPmat</span>, main <span class="op">=</span> <span class="st">"GDP per Capita"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/PLMGDPmat-1.png" alt="plot of chunk PLMGDPmat" width="100%"><p class="caption">
plot of chunk PLMGDPmat
</p>
</div>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Taking series with more than 20 observation</span></span>
<span><span class="va">suffsamp</span> <span class="op">&lt;-</span> <span class="va">tGDPmat</span><span class="op">[</span>, <span class="fu"><a href="../reference/fnobs.html">fnobs</a></span><span class="op">(</span><span class="va">tGDPmat</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">20</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Minimum pairwise observations between any two series:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="../reference/pwcor_pwcov_pwnobs.html">pwnobs</a></span><span class="op">(</span><span class="va">suffsamp</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># [1] 16</span></span>
<span></span>
<span><span class="co"># We can use the pairwise-correlations of the annual growth rates to hierarchically cluster the economies:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">as.dist</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="../reference/pwcor_pwcov_pwnobs.html">pwcor</a></span><span class="op">(</span><span class="fu"><a href="../reference/fgrowth.html">G</a></span><span class="op">(</span><span class="va">suffsamp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/PLMGDPmat-2.png" alt="plot of chunk PLMGDPmat" width="100%"><p class="caption">
plot of chunk PLMGDPmat
</p>
</div>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Finally we could do PCA on the growth rates:</span></span>
<span><span class="va">eig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/eigen.html" class="external-link">eigen</a></span><span class="op">(</span><span class="fu"><a href="../reference/pwcor_pwcov_pwnobs.html">pwcor</a></span><span class="op">(</span><span class="fu"><a href="../reference/fgrowth.html">G</a></span><span class="op">(</span><span class="va">suffsamp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/efficient-programming.html">seq_col</a></span><span class="op">(</span><span class="va">suffsamp</span><span class="op">)</span>, <span class="va">eig</span><span class="op">$</span><span class="va">values</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">eig</span><span class="op">$</span><span class="va">values</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span>, xlab <span class="op">=</span> <span class="st">"Number of Principal Components"</span>, ylab <span class="op">=</span> <span class="st">"% Variance Explained"</span>, main <span class="op">=</span> <span class="st">"Screeplot"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/PLMGDPmat-3.png" alt="plot of chunk PLMGDPmat" width="100%"><p class="caption">
plot of chunk PLMGDPmat
</p>
</div>
<p>There is also a nice plot-method applied to panel series arrays
returned when <code>psmat</code> is applied to a panel data.frame:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/psmat.html">psmat</a></span><span class="op">(</span><span class="va">pwlddev</span>, cols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span>, legend <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/pwlddev_plot-1.png" alt="plot of chunk pwlddev_plot" width="100%"><p class="caption">
plot of chunk pwlddev_plot
</p>
</div>
<!-- Returning a list of panel series matrices allows efficient unlisting to data.frame, although of course there are other ways to reshape data in this way (i.e. `reshape2`, `tidyr`): -->
<!-- ```{r, eval = NCRAN} -->
<!-- # head(unlist2d(psmat(pwlddev, cols = 9:12, array = FALSE), idcols = "Variable", row.names = "Country Code")) -->
<!-- ``` -->
<p>Above we have explored the cross-sectional relationship between the
different national GDP series. Now we explore the time-dependence of the
panel-vectors as a whole:</p>
</div>
<div class="section level3">
<h3 id="panel--auto--partial-auto-and-cross-correlation-functions">2.4 Panel- Auto-, Partial-Auto and Cross-Correlation Functions<a class="anchor" aria-label="anchor" href="#panel--auto--partial-auto-and-cross-correlation-functions"></a>
</h3>
<p>The functions <code>psacf</code>, <code>pspacf</code> and
<code>psccf</code> mimic <code><a href="https://rdrr.io/r/stats/acf.html" class="external-link">stats::acf</a></code>,
<code><a href="https://rdrr.io/r/stats/acf.html" class="external-link">stats::pacf</a></code> and <code><a href="https://rdrr.io/r/stats/acf.html" class="external-link">stats::ccf</a></code> for panel-vectors
and panel data.frames. Below we compute the panel series autocorrelation
function of the data:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/psacf.html">psacf</a></span><span class="op">(</span><span class="va">pwlddev</span>, cols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/plm_psacf-1.png" alt="plot of chunk plm_psacf" width="100%"><p class="caption">
plot of chunk plm_psacf
</p>
</div>
<p>The computation is conducted by first scaling and centering
(i.e. standardizing) the panel-vectors by groups (using
<code>fscale</code>, default argument <code>gscale = TRUE</code>), and
then taking the covariance of each series with a matrix of properly
computed panel-lags of itself (using <code>flag</code>), and dividing
that by the variance of the overall series (using
<code>fvar</code>).</p>
<p>In a similar way we can compute the Partial-ACF (using a multivariate
Yule-Walker decomposition on the ACF, as in
<code><a href="https://rdrr.io/r/stats/acf.html" class="external-link">stats::pacf</a></code>),</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/psacf.html">pspacf</a></span><span class="op">(</span><span class="va">pwlddev</span>, cols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/plm_pspacf-1.png" alt="plot of chunk plm_pspacf" width="100%"><p class="caption">
plot of chunk plm_pspacf
</p>
</div>
<p>and the panel-cross-correlation function between GDP per capita and
life expectancy (which is already contained in the ACF plot above):</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/psacf.html">psccf</a></span><span class="op">(</span><span class="va">PCGDP</span>, <span class="va">LIFEEX</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/plm_psccf-1.png" alt="plot of chunk plm_psccf" width="100%"><p class="caption">
plot of chunk plm_psccf
</p>
</div>
</div>
<div class="section level3">
<h3 id="testing-for-individual-specific-and-time-effects">2.5 Testing for Individual Specific and Time-Effects<a class="anchor" aria-label="anchor" href="#testing-for-individual-specific-and-time-effects"></a>
</h3>
<p>As a final step of exploration, we could analyze our series and
simple models for the significance and explanatory power of individual
or time-fixed effects, without going all the way to running a Hausman
Test of fixed vs. random effects on a fully specified model. The main
function here is <code>fFtest</code> which efficiently computes a fast
R-Squared based F-test of exclusion restrictions on models potentially
involving many factors. By default (argument
<code>full.df = TRUE</code>) the degrees of freedom of the test are
adjusted to make it identical to the F-statistic from regressing the
series on a set of country and time dummies<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;In fact factors are projected out using
&lt;code&gt;&lt;a href="https://lrberge.github.io/fixest/reference/demean.html" class="external-link"&gt;fixest::demean&lt;/a&gt;&lt;/code&gt; and no regression is run at all&lt;/p&gt;'><sup>1</sup></a>.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Testing GDP per Capita</span></span>
<span><span class="fu"><a href="../reference/fFtest.html">fFtest</a></span><span class="op">(</span><span class="va">PCGDP</span>, <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html" class="external-link">index</a></span><span class="op">(</span><span class="va">PCGDP</span><span class="op">)</span><span class="op">)</span>    <span class="co"># Testing individual and time-fixed effects</span></span>
<span><span class="co">#    R-Sq.      DF1      DF2  F-Stat.  P-value </span></span>
<span><span class="co">#    0.905      264     9205  330.349    0.000</span></span>
<span><span class="fu"><a href="../reference/fFtest.html">fFtest</a></span><span class="op">(</span><span class="va">PCGDP</span>, <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html" class="external-link">index</a></span><span class="op">(</span><span class="va">PCGDP</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co"># Testing individual effects</span></span>
<span><span class="co">#    R-Sq.      DF1      DF2  F-Stat.  P-value </span></span>
<span><span class="co">#    0.876      215     9254  303.476    0.000</span></span>
<span><span class="fu"><a href="../reference/fFtest.html">fFtest</a></span><span class="op">(</span><span class="va">PCGDP</span>, <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html" class="external-link">index</a></span><span class="op">(</span><span class="va">PCGDP</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co"># Testing time effects</span></span>
<span><span class="co">#    R-Sq.      DF1      DF2  F-Stat.  P-value </span></span>
<span><span class="co">#    0.027       60     9409    4.276    0.000</span></span>
<span></span>
<span><span class="co"># Same for Life-Expectancy</span></span>
<span><span class="fu"><a href="../reference/fFtest.html">fFtest</a></span><span class="op">(</span><span class="va">LIFEEX</span>, <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html" class="external-link">index</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span><span class="op">)</span>    <span class="co"># Testing individual and time-fixed effects</span></span>
<span><span class="co">#     R-Sq.       DF1       DF2   F-Stat.   P-value </span></span>
<span><span class="co">#     0.924       265     11404   519.762     0.000</span></span>
<span><span class="fu"><a href="../reference/fFtest.html">fFtest</a></span><span class="op">(</span><span class="va">LIFEEX</span>, <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html" class="external-link">index</a></span><span class="op">(</span><span class="va">LIFEEX</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co"># Testing individual effects</span></span>
<span><span class="co">#     R-Sq.       DF1       DF2   F-Stat.   P-value </span></span>
<span><span class="co">#     0.719       215     11454   136.276     0.000</span></span>
<span><span class="fu"><a href="../reference/fFtest.html">fFtest</a></span><span class="op">(</span><span class="va">LIFEEX</span>, <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html" class="external-link">index</a></span><span class="op">(</span><span class="va">LIFEEX</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co"># Testing time effects</span></span>
<span><span class="co">#     R-Sq.       DF1       DF2   F-Stat.   P-value </span></span>
<span><span class="co">#     0.218        60     11609    54.075     0.000</span></span></code></pre></div>
<p>Below we test the correlation between the country and time-means of
GDP and Life-Expectancy:</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html" class="external-link">cor.test</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">B</a></span><span class="op">(</span><span class="va">PCGDP</span><span class="op">)</span>, <span class="fu"><a href="../reference/fbetween_fwithin.html">B</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span><span class="op">)</span> <span class="co"># Testing correlation of country means</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#   Pearson's product-moment correlation</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># data:  B(PCGDP) and B(LIFEEX)</span></span>
<span><span class="co"># t = 78.752, df = 9020, p-value &lt; 2.2e-16</span></span>
<span><span class="co"># alternative hypothesis: true correlation is not equal to 0</span></span>
<span><span class="co"># 95 percent confidence interval:</span></span>
<span><span class="co">#  0.6259141 0.6503737</span></span>
<span><span class="co"># sample estimates:</span></span>
<span><span class="co">#      cor </span></span>
<span><span class="co"># 0.638305</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html" class="external-link">cor.test</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">B</a></span><span class="op">(</span><span class="va">PCGDP</span>, effect <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="../reference/fbetween_fwithin.html">B</a></span><span class="op">(</span><span class="va">LIFEEX</span>, effect <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co"># Same for time-means</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#   Pearson's product-moment correlation</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># data:  B(PCGDP, effect = 2) and B(LIFEEX, effect = 2)</span></span>
<span><span class="co"># t = 325.6, df = 9020, p-value &lt; 2.2e-16</span></span>
<span><span class="co"># alternative hypothesis: true correlation is not equal to 0</span></span>
<span><span class="co"># 95 percent confidence interval:</span></span>
<span><span class="co">#  0.9583431 0.9615804</span></span>
<span><span class="co"># sample estimates:</span></span>
<span><span class="co">#       cor </span></span>
<span><span class="co"># 0.9599938</span></span></code></pre></div>
<p>We can also test for the significance of individual and time-fixed
effects (or both) in the regression of GDP on life expectancy and ODA
received:</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fFtest.html">fFtest</a></span><span class="op">(</span><span class="va">PCGDP</span>, <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html" class="external-link">index</a></span><span class="op">(</span><span class="va">PCGDP</span><span class="op">)</span>, <span class="fu"><a href="../reference/select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="va">pwlddev</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LIFEEX"</span>,<span class="st">"ODA"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>    <span class="co"># Testing individual and time-fixed effects</span></span>
<span><span class="co">#                     R-Sq.  DF1  DF2  F-Stat.  P-Value</span></span>
<span><span class="co"># Full Model          0.915  227 6682  316.551    0.000</span></span>
<span><span class="co"># Restricted Model    0.162    2 6907  668.816    0.000</span></span>
<span><span class="co"># Exclusion Rest.     0.753  225 6682  262.732    0.000</span></span>
<span><span class="fu"><a href="../reference/fFtest.html">fFtest</a></span><span class="op">(</span><span class="va">PCGDP</span>, <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html" class="external-link">index</a></span><span class="op">(</span><span class="va">PCGDP</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="../reference/select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="va">pwlddev</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iso3c"</span>,<span class="st">"LIFEEX"</span>,<span class="st">"ODA"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>    <span class="co"># Testing time-fixed effects</span></span>
<span><span class="co">#                     R-Sq.  DF1  DF2  F-Stat.  P-Value</span></span>
<span><span class="co"># Full Model          0.915  227 6682  316.551    0.000</span></span>
<span><span class="co"># Restricted Model    0.909  168 6741  403.168    0.000</span></span>
<span><span class="co"># Exclusion Rest.     0.005   59 6682    7.238    0.000</span></span></code></pre></div>
<p>As can be expected in this cross-country data, individual and
time-fixed effects play a large role in explaining the data, and these
effects are correlated across series, suggesting that a fixed-effects
model with both types of fixed-effects would be appropriate. To round
things off, below we compute the Hausman test of Fixed vs. Random
effects, which confirms this conclusion:</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/plm/man/phtest.html" class="external-link">phtest</a></span><span class="op">(</span><span class="va">PCGDP</span> <span class="op">~</span> <span class="va">LIFEEX</span>, data <span class="op">=</span> <span class="va">pwlddev</span><span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#   Hausman Test</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># data:  PCGDP ~ LIFEEX</span></span>
<span><span class="co"># chisq = 397.04, df = 1, p-value &lt; 2.2e-16</span></span>
<span><span class="co"># alternative hypothesis: one model is inconsistent</span></span></code></pre></div>
<!-- ## Part 1: Fast Transformation of Panel Data -->
<!-- ## 1. Between and Within Transformations -->
<!-- ```{r, eval = NCRAN} -->
<!-- # This creates a panel data frame -->
<!-- pwlddev <- pdata.frame(wlddev, index = c("iso3c", "year")) -->
<!-- # Panel Series of GDP per capita -->
<!-- PCGDP <- pwlddev$PCGDP -->
<!-- # Between-Transformations -->
<!-- head(fbetween(PCGDP), 100) -->
<!-- head(fbetween(PCGDP, effect = "year"), 100) -->
<!-- # Within-Transformations -->
<!-- head(fwithin(PCGDP), 100) -->
<!-- head(fwithin(PCGDP, effect = "year"), 100) -->
<!-- ``` -->
<!-- These transformations can easily be applied to multiple columns..  -->
<!-- ```{r, eval = NCRAN} -->
<!-- summary(plm(PCGDP ~ LIFEEX, data = pwlddev, model = "within")) -->
<!-- summary(plm(W(PCGDP) ~ W(LIFEEX), data = pwlddev, model = "pooling", na.action = na.exclude)) -->
<!-- summary(lm(PCGDP ~ LIFEEX, data = fwithin(nv(pwlddev)))) -->
<!-- ``` -->
<!-- ```{r, eval = NCRAN} -->
<!-- summary(plm(PCGDP ~ L(LIFEEX, 0:3), data = pwlddev, model = "within")) -->
<!-- summary(plm(PCGDP ~ lag(LIFEEX, 0:3), data = pwlddev, model = "within")) -->
<!-- ``` -->
</div>
</div>
<div class="section level2">
<h2 id="part-3-programming-panel-data-estimators">Part 3: Programming Panel Data Estimators<a class="anchor" aria-label="anchor" href="#part-3-programming-panel-data-estimators"></a>
</h2>
<p>A central goal of the <em>collapse</em> package is to facilitate
advanced and fast programming with data. A primary field of application
for the fast functions introduced above is to program efficient panel
data estimators. In this section we walk through a short example of how
this can be done. The application will be an implementation of the
Hausman and Taylor (1981) estimator, considering a more general case
than currently implemented in the <em>plm</em> package.</p>
<p>In Hausman and Taylor (1981), in a more general scenario, we have a
linear panel-model of the form <span class="math display">y_{it} =
\beta_1X_{1it} + \beta_2X_{2it} + \beta_3Z_{1i} + \beta_4Z_{2i} +
\alpha_i + \gamma_t + \epsilon</span> where <span class="math inline">\alpha_i</span> denotes unobserved individual
specific effects and <span class="math inline">\gamma_t</span> denotes
unobserved global events. This model has up to 4 kinds of
covariates:</p>
<ul>
<li><p>Time-Varying covariates <span class="math inline">X_{1it}</span>
that are uncorrelated with the individual specific effect <span class="math inline">\alpha_i</span>, such that <span class="math inline">E[X_{1it}\alpha_i] = 0</span>. It may be the case
that <span class="math inline">E[X_{1it}\gamma_t] \neq 0</span></p></li>
<li><p>Time-Varying covariates <span class="math inline">X_{2it}</span>
with <span class="math inline">E[X_{2it}\alpha_i] \neq 0</span> and
possibly <span class="math inline">E[X_{2it}\gamma_t] \neq
0</span></p></li>
<li><p>Time-Invariant covariates <span class="math inline">Z_{1i}</span>
with <span class="math inline">E[Z_{1i}\alpha_i] = 0</span></p></li>
<li><p>Time-Invariant covariates <span class="math inline">Z_{2i}</span>
with <span class="math inline">E[Z_{2i}\alpha_i] \neq 0</span></p></li>
</ul>
<p>The main estimation problem arises from <span class="math inline">E[Z_{2i}\alpha_i] \neq 0</span>, which would usually
prevent us from estimating <span class="math inline">\beta_4</span>
since taking a within-transformation (fixed effects) would remove <span class="math inline">Z_{2i}</span> from the equation. Hausman and Taylor
(1981) stipulated that since <span class="math inline">E[X_{1it}\alpha_i] = 0</span>, once could use <span class="math inline">X_{1i.}</span> i.e. the between-transformed <span class="math inline">X_{1it}</span> to instrument for <span class="math inline">Z_{2i}</span>. They propose an IV/2SLS estimation of
the whole equation where the within-transformed covariates <span class="math inline">\tilde{X}_{1it}</span> and <span class="math inline">\tilde{X}_{2it}</span> are used to instrument <span class="math inline">X_{1it}</span> and <span class="math inline">X_{2it}</span>, and <span class="math inline">X_{1i.}</span> instruments <span class="math inline">Z_{2i}</span>. Assuming that missing values have
been removed beforehand, and also taking into account the possibility
that <span class="math inline">E[X_{1it}\gamma_t] \neq 0</span> and
<span class="math inline">E[X_{2it}\gamma_t] \neq 0</span>
(i.e. accounting for time fixed-effects), this estimator can be coded as
follows:</p>
<p><!-- # This function converts atomic vectors passed to named lists -->
<!-- ln <- function(x, nam) if(!is.null(x) && is.atomic(x)) `names<-`(list(x), nam) else x  --></p>
<p><!-- # Create instrument matrix: if time.FE, higher-order demean X1 and X2, else normal demeaning -->
<!-- IVS <- do.call(cbind, c(ln(if(time.FE) fhdwithin(X1, na.rm = FALSE) else fwithin(X1, na.rm = FALSE), "W.X1"),  -->
<!--             ln(fbetween(X1, na.rm = FALSE), "B.X1"), ln(Z1, "Z1"), -->
<!--             ln(if(is.null(X2)) X2 else if(time.FE) fhdwithin(X2, na.rm = FALSE) else fwithin(X2, na.rm = FALSE), "W.X2"))) --></p>
<p><!-- # Create matrix of independent variables -->
<!-- X <- do.call(cbind, c(ln(X1, "X1"), ln(X2, "X2"), ln(Z1, "Z1"), ln(Z2, "Z2")))  --></p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">HT_est</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">X1</span>, <span class="va">Z2</span>, <span class="va">X2</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">Z1</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">time.FE</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># Create matrix of independent variables</span></span>
<span>  <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>Intercept <span class="op">=</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">cbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">X1</span>, <span class="va">X2</span>, <span class="va">Z1</span>, <span class="va">Z2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Create instrument matrix: if time.FE, higher-order demean X1 and X2, else normal demeaning</span></span>
<span>  <span class="va">IVS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>Intercept <span class="op">=</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">cbind</span>,</span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="kw">if</span><span class="op">(</span><span class="va">time.FE</span><span class="op">)</span> <span class="fu"><a href="../reference/fhdbetween_fhdwithin.html">fhdwithin</a></span><span class="op">(</span><span class="va">X1</span>, na.rm <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="kw">else</span> <span class="fu"><a href="../reference/fbetween_fwithin.html">fwithin</a></span><span class="op">(</span><span class="va">X1</span>, na.rm <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>                 <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">X2</span><span class="op">)</span><span class="op">)</span> <span class="va">X2</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">time.FE</span><span class="op">)</span> <span class="fu"><a href="../reference/fhdbetween_fhdwithin.html">fhdwithin</a></span><span class="op">(</span><span class="va">X2</span>, na.rm <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="kw">else</span> <span class="fu"><a href="../reference/fbetween_fwithin.html">fwithin</a></span><span class="op">(</span><span class="va">X2</span>, na.rm <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>                 <span class="va">Z1</span>, <span class="fu"><a href="../reference/fbetween_fwithin.html">fbetween</a></span><span class="op">(</span><span class="va">X1</span>, na.rm <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">IVS</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="co"># The IV estimator case</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/drop.html" class="external-link">drop</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/crossprod.html" class="external-link">crossprod</a></span><span class="op">(</span><span class="va">IVS</span>, <span class="va">X</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/crossprod.html" class="external-link">crossprod</a></span><span class="op">(</span><span class="va">IVS</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span> <span class="co"># The 2SLS case</span></span>
<span>    <span class="va">Xhat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/qr.html" class="external-link">qr.fitted</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/qr.html" class="external-link">qr</a></span><span class="op">(</span><span class="va">IVS</span><span class="op">)</span>, <span class="va">X</span><span class="op">)</span>  <span class="co"># First stage</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/drop.html" class="external-link">drop</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/qr.html" class="external-link">qr.coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/qr.html" class="external-link">qr</a></span><span class="op">(</span><span class="va">Xhat</span><span class="op">)</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>   <span class="co"># Second stage</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The estimator is written in such a way that variables of the type
<span class="math inline">X_{2it}</span> and <span class="math inline">Z_{1i}</span> are optional, and it also includes an
option to also project out time-FE or not. The expected inputs for <span class="math inline">X_{1it}</span> (<code>X1</code>), and <span class="math inline">X_{2it}</span> (<code>X2</code>) are column-subsets
of a <em>pdata.frame</em>.</p>
<p>Having coded the estimator, it would be good to have an example to
run it on. I have tried to squeeze an example out of the
<code>wlddev</code> data used so far in this vignette. It is quite
crappy and suffers from a weak-IV problem, but for there sake of
illustration lets do it:</p>
<p>We want to estimate the panel-regression of life-expectancy on GDP
per Capita, ODA received, the GINI index and a time-invariant dummy
indicating whether the country is an OECD member. All variables except
the dummy enter in logs, so this is an elasticity regression.
<!-- dat <- fdroplevels(na_omit(get_vars(wlddev, c("iso3c","year","OECD","PCGDP","GINI","LIFEEX","ODA")))) -->
<!-- get_vars(dat, 4:7) <- log(get_vars(dat, 4:7)) -->
<!-- dat <- pdata.frame(dat, index = c("iso3c", "year")) -->
<!-- dat$OECD <- as.numeric(dat$OECD) # Creating OECD dummy --> &lt;
<!-- # This tests each oth the covariates is correlated with with alpha_i -->
<!-- phtest(ODA ~ PCGDP, dat) --> <!-- phtest(ODA ~ LIFEEX, dat) -->
<!-- phtest(ODA ~ GINI, dat) -->
<!-- phtest(ODA ~ PCGDP + LIFEEX + GINI, dat) --></p>
<!-- # We expect ODA membershi -->
<!-- cor.test(dat$OECD, B(dat$ODA)) -->
<!-- fe <- fixef(plm(ODA ~ PCGDP + LIFEEX + GINI, dat)) -->
<!-- cor.test(fe, fmean(dat$OECD, index(dat, 1))) -->
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="va">wlddev</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iso3c"</span>,<span class="st">"year"</span>,<span class="st">"OECD"</span>,<span class="st">"PCGDP"</span>,<span class="st">"LIFEEX"</span>,<span class="st">"GINI"</span>,<span class="st">"ODA"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fl">4</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="../reference/select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fl">4</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span>, <span class="va">log</span><span class="op">)</span> <span class="co"># Taking logs of the data</span></span>
<span><span class="va">dat</span><span class="op">$</span><span class="va">OECD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">OECD</span><span class="op">)</span>                      <span class="co"># Creating OECD dummy</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/plm/man/pdata.frame.html" class="external-link">pdata.frame</a></span><span class="op">(</span><span class="fu"><a href="../reference/fdroplevels.html">fdroplevels</a></span><span class="op">(</span><span class="fu"><a href="../reference/efficient-programming.html">na_omit</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span><span class="op">)</span>,         <span class="co"># Creating Panel data.frame, after removing missing values</span></span>
<span>                   index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iso3c"</span>, <span class="st">"year"</span><span class="op">)</span><span class="op">)</span>        <span class="co"># and dropping unused factor levels</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/plm/man/pdim.html" class="external-link">pdim</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="co"># Unbalanced Panel: n = 134, T = 1-34, N = 1068</span></span>
<span><span class="fu"><a href="../reference/varying.html">varying</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="co">#   year   OECD  PCGDP LIFEEX   GINI    ODA </span></span>
<span><span class="co">#   TRUE  FALSE   TRUE   TRUE   TRUE   TRUE</span></span></code></pre></div>
<p>Using the GINI index cost a lot of observations and brought the
sample size down to 918, but the GINI index will be a key variable in
what follows. Clearly the OECD dummy is time-invariant. Below we run
Hausman-tests of fixed vs. random effects to determine which covariates
might be correlated with the unobserved individual effects, and which
model would be most appropriate.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This tests whether each of the covariates is correlated with alpha_i</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/plm/man/phtest.html" class="external-link">phtest</a></span><span class="op">(</span><span class="va">LIFEEX</span> <span class="op">~</span> <span class="va">PCGDP</span>, <span class="va">dat</span><span class="op">)</span>  <span class="co"># Likely correlated</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#   Hausman Test</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># data:  LIFEEX ~ PCGDP</span></span>
<span><span class="co"># chisq = 17.495, df = 1, p-value = 2.881e-05</span></span>
<span><span class="co"># alternative hypothesis: one model is inconsistent</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/plm/man/phtest.html" class="external-link">phtest</a></span><span class="op">(</span><span class="va">LIFEEX</span> <span class="op">~</span> <span class="va">ODA</span>, <span class="va">dat</span><span class="op">)</span>    <span class="co"># Likely correlated</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#   Hausman Test</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># data:  LIFEEX ~ ODA</span></span>
<span><span class="co"># chisq = 43.925, df = 1, p-value = 3.413e-11</span></span>
<span><span class="co"># alternative hypothesis: one model is inconsistent</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/plm/man/phtest.html" class="external-link">phtest</a></span><span class="op">(</span><span class="va">LIFEEX</span> <span class="op">~</span> <span class="va">GINI</span>, <span class="va">dat</span><span class="op">)</span>   <span class="co"># Likely not correlated !</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#   Hausman Test</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># data:  LIFEEX ~ GINI</span></span>
<span><span class="co"># chisq = 0.56851, df = 1, p-value = 0.4509</span></span>
<span><span class="co"># alternative hypothesis: one model is inconsistent</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/plm/man/phtest.html" class="external-link">phtest</a></span><span class="op">(</span><span class="va">LIFEEX</span> <span class="op">~</span> <span class="va">PCGDP</span> <span class="op">+</span> <span class="va">ODA</span> <span class="op">+</span> <span class="va">GINI</span>, <span class="va">dat</span><span class="op">)</span>  <span class="co"># Fixed Effects is the appropriate model for this regression</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#   Hausman Test</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># data:  LIFEEX ~ PCGDP + ODA + GINI</span></span>
<span><span class="co"># chisq = 24.198, df = 3, p-value = 2.272e-05</span></span>
<span><span class="co"># alternative hypothesis: one model is inconsistent</span></span></code></pre></div>
<p>The tests suggest that both GDP per Capita and ODA are correlated
with country-specific unobservables affecting life-expectancy, and
overall a fixed-effects model would be appropriate. However, the Hausman
test on the GINI index fails to reject: Country specific unobservables
affecting average life-expectancy are not necessarily correlated with
the level of inequality across countries.</p>
<p>Now if we want to include the OECD dummy in the regression, we cannot
use fixed-effects as this would wipe-out the dummy as well. If the dummy
is uncorrelated with the country-specific unobservables affecting
life-expectancy (the <span class="math inline">\alpha_i</span>), then we
could use a solution suggested by Mundlak (1978) and simply add
between-transformed versions of PCGDP and ODA in the regression (in
addition to PCGDP and ODA in levels), and so ‘control’ for the part of
PCGDP and ODA correlated with the <span class="math inline">\alpha_i</span> (in the IV literature this is known
as the control-function approach). If however the OECD dummy is
correlated with the <span class="math inline">\alpha_i</span>, then we
need to use the Hausman and Taylor (1981) estimator. Below I suggest 2
methods of testing this correlation:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Testing the correlation between OECD dummy and the Between-transformed Life-Expectancy (i.e. not accounting for other covariates)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html" class="external-link">cor.test</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">OECD</span>, <span class="fu"><a href="../reference/fbetween_fwithin.html">B</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">LIFEEX</span><span class="op">)</span><span class="op">)</span> <span class="co"># -&gt; Significant correlation of 0.21</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#   Pearson's product-moment correlation</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># data:  dat$OECD and B(dat$LIFEEX)</span></span>
<span><span class="co"># t = 6.797, df = 1066, p-value = 1.774e-11</span></span>
<span><span class="co"># alternative hypothesis: true correlation is not equal to 0</span></span>
<span><span class="co"># 95 percent confidence interval:</span></span>
<span><span class="co">#  0.1456048 0.2606109</span></span>
<span><span class="co"># sample estimates:</span></span>
<span><span class="co">#       cor </span></span>
<span><span class="co"># 0.2038109</span></span>
<span></span>
<span><span class="co"># Getting the fixed-effects (estimates of alpha_i) from the model (i.e. accounting for the other covariates)</span></span>
<span><span class="va">fe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/fixed.effects.html" class="external-link">fixef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/plm/man/plm.html" class="external-link">plm</a></span><span class="op">(</span><span class="va">LIFEEX</span> <span class="op">~</span> <span class="va">PCGDP</span> <span class="op">+</span> <span class="va">ODA</span> <span class="op">+</span> <span class="va">GINI</span>, <span class="va">dat</span>, model <span class="op">=</span> <span class="st">"within"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mODA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fmean.html">fmean</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">ODA</span>, <span class="va">dat</span><span class="op">$</span><span class="va">iso3c</span><span class="op">)</span></span>
<span><span class="co"># Again testing the correlation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html" class="external-link">cor.test</a></span><span class="op">(</span><span class="va">fe</span>, <span class="va">mODA</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fe</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mODA</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="co"># -&gt; Not Significant.. but probably due to small sample size, the correlation is still 0.13</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#   Pearson's product-moment correlation</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># data:  fe and mODA[match(names(fe), names(mODA))]</span></span>
<span><span class="co"># t = 1.1218, df = 132, p-value = 0.264</span></span>
<span><span class="co"># alternative hypothesis: true correlation is not equal to 0</span></span>
<span><span class="co"># 95 percent confidence interval:</span></span>
<span><span class="co">#  -0.07362567  0.26243949</span></span>
<span><span class="co"># sample estimates:</span></span>
<span><span class="co">#        cor </span></span>
<span><span class="co"># 0.09717608</span></span></code></pre></div>
<p>I interpret the test results as rejecting the hypothesis that the
dummy is uncorrelated with <span class="math inline">\alpha_i</span>,
thus we do have a case for Hausman and Taylor (1981) here: the OECD
dummy is a <span class="math inline">Z_{2i}</span> with <span class="math inline">E[Z_{2i}\alpha_i]\neq 0</span>. The Hausman tests
above suggested that the GINI index is the only variable uncorrelated
with <span class="math inline">\alpha_i</span>, thus GINI is <span class="math inline">X_{1it}</span> with <span class="math inline">E[X_{1it}\alpha_i] = 0</span>. Finally PCGDP and ODA
jointly constitute <span class="math inline">X_{2it}</span>, where the
Hausman tests strongly suggested that <span class="math inline">E[X_{2it}\alpha_i] \neq 0</span>. We do not have a
<span class="math inline">Z_{1i}</span> in this setup, i.e. a
time-invariant variable uncorrelated with the <span class="math inline">\alpha_i</span>.</p>
<p>The Hausman and Taylor (1981) estimator stipulates that we should
instrument the OECD dummy with <span class="math inline">X_{1i.}</span>,
the between-transformed GINI index. Let us therefore test the regression
of the dummy on this instrument to see of it would be a good
(i.e. relevant) instrument:</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This computes the regression of OECD on the GINI instrument: Weak IV problem !!</span></span>
<span><span class="fu"><a href="../reference/fFtest.html">fFtest</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">OECD</span>, <span class="fu"><a href="../reference/fbetween_fwithin.html">B</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">GINI</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#    R-Sq.      DF1      DF2  F-Stat.  P-value </span></span>
<span><span class="co">#    0.000        1     1066    0.153    0.695</span></span></code></pre></div>
<p>The 0 R-Squared and the F-Statistic of 0.21 suggest that the
instrument is very weak indeed, rubbish to be precise, thus the
implementation of the HT estimator below is also a rubbish example, but
it is still good for illustration purposes:</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">HT_est</span><span class="op">(</span>y <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">LIFEEX</span>,</span>
<span>       X1 <span class="op">=</span> <span class="fu"><a href="../reference/select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="va">dat</span>, <span class="st">"GINI"</span><span class="op">)</span>,</span>
<span>       Z2 <span class="op">=</span> <span class="fu"><a href="../reference/select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="va">dat</span>, <span class="st">"OECD"</span><span class="op">)</span>,</span>
<span>       X2 <span class="op">=</span> <span class="fu"><a href="../reference/select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PCGDP"</span>,<span class="st">"ODA"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#    Intercept         GINI        PCGDP          ODA         OECD </span></span>
<span><span class="co">#  3.638486969 -0.035596160  0.120981946  0.005744747 -5.862368476</span></span></code></pre></div>
<p>Now a central questions is of course: How computationally efficient
is this estimator? Let us try to re-run it on the data generated for the
benchmark in Part 1:</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iso3c"</span>,<span class="st">"year"</span>,<span class="st">"OECD"</span>,<span class="st">"PCGDP"</span>,<span class="st">"LIFEEX"</span>,<span class="st">"GINI"</span>,<span class="st">"ODA"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fl">4</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="../reference/select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fl">4</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span>, <span class="va">log</span><span class="op">)</span> <span class="co"># Taking logs of the data</span></span>
<span><span class="va">dat</span><span class="op">$</span><span class="va">OECD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">OECD</span><span class="op">)</span>                      <span class="co"># Creating OECD dummy</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/plm/man/pdata.frame.html" class="external-link">pdata.frame</a></span><span class="op">(</span><span class="fu"><a href="../reference/fdroplevels.html">fdroplevels</a></span><span class="op">(</span><span class="fu"><a href="../reference/efficient-programming.html">na_omit</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span><span class="op">)</span>,         <span class="co"># Creating Panel data.frame, after removing missing values</span></span>
<span>                   index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iso3c"</span>, <span class="st">"year"</span><span class="op">)</span><span class="op">)</span>        <span class="co"># and dropping unused factor levels</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/plm/man/pdim.html" class="external-link">pdim</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="co"># Unbalanced Panel: n = 13400, T = 1-34, N = 106800</span></span>
<span><span class="fu"><a href="../reference/varying.html">varying</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="co">#   year   OECD  PCGDP LIFEEX   GINI    ODA </span></span>
<span><span class="co">#   TRUE  FALSE   TRUE   TRUE   TRUE   TRUE</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/joshuaulrich/microbenchmark/" class="external-link">microbenchmark</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>HT_est <span class="op">=</span> <span class="fu">HT_est</span><span class="op">(</span>y <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">LIFEEX</span>,     <span class="co"># The estimator as before</span></span>
<span>                      X1 <span class="op">=</span> <span class="fu"><a href="../reference/select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="va">dat</span>, <span class="st">"GINI"</span><span class="op">)</span>,</span>
<span>                      Z2 <span class="op">=</span> <span class="fu"><a href="../reference/select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="va">dat</span>, <span class="st">"OECD"</span><span class="op">)</span>,</span>
<span>                      X2 <span class="op">=</span> <span class="fu"><a href="../reference/select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PCGDP"</span>,<span class="st">"ODA"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              HT_est_TFE <span class="op">=</span>  <span class="fu">HT_est</span><span class="op">(</span>y <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">LIFEEX</span>, <span class="co"># Also Projecting out Time-FE</span></span>
<span>                      X1 <span class="op">=</span> <span class="fu"><a href="../reference/select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="va">dat</span>, <span class="st">"GINI"</span><span class="op">)</span>,</span>
<span>                      Z2 <span class="op">=</span> <span class="fu"><a href="../reference/select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="va">dat</span>, <span class="st">"OECD"</span><span class="op">)</span>,</span>
<span>                      X2 <span class="op">=</span> <span class="fu"><a href="../reference/select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PCGDP"</span>,<span class="st">"ODA"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                      time.FE <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#        expr       min       lq      mean    median        uq      max neval</span></span>
<span><span class="co">#      HT_est  7.919437  8.46937  9.761301  8.869612  9.508597 45.08717   100</span></span>
<span><span class="co">#  HT_est_TFE 22.501128 23.18640 25.387041 23.469835 24.490612 85.96462   100</span></span></code></pre></div>
<p>At around 100,000 obs and 13,000 groups in an unbalanced panel, the
computation involving 3 grouped centering and 1 grouped averaging task
as well as 2 list-to matrix conversions and an IV-procedure took about
10 milliseconds with only individual effects, and about 40 - 45
milliseconds with individual and time-fixed effects (projected out
iteratively). This should leave some room for running this on much
larger data.
<!--, and even for implementing a bootstrap standard error at this sample size. --></p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Hausman J, Taylor W (1981). “Panel Data and Unobservable Individual
Effects.” <em>Econometrica</em>, 49, 1377–1398.</p>
<p>Mundlak, Yair. 1978. “On the Pooling of Time Series and Cross Section
Data.” <em>Econometrica</em> 46 (1): 69–85.</p>
<p>Cochrane, D. &amp; Orcutt, G. H. (1949). “Application of Least
Squares Regression to Relationships Containing Auto-Correlated Error
Terms”. <em>Journal of the American Statistical Association.</em> 44
(245): 32–61.</p>
<p>Prais, S. J. &amp; Winsten, C. B. (1954). “Trend Estimators and
Serial Correlation”. <em>Cowles Commission Discussion Paper
No. 383.</em> Chicago.</p>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sebastian Krantz.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
