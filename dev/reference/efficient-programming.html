<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Small Functions to Make R Programming More Efficient — efficient-programming • collapse</title><!-- favicons --><link rel="icon" type="image/png" sizes="48x48" href="../favicon-48x48.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Small Functions to Make R Programming More Efficient — efficient-programming"><meta name="description" content="A small set of functions to address some common inefficiencies in R, such as the creation of logical vectors to compare quantities, unnecessary copies of objects in elementary mathematical or subsetting operations, obtaining information about objects (esp. data frames), or dealing with missing values. "><meta property="og:description" content="A small set of functions to address some common inefficiencies in R, such as the creation of logical vectors to compare quantities, unnecessary copies of objects in elementary mathematical or subsetting operations, obtaining information about objects (esp. data frames), or dealing with missing values. "><meta property="og:image" content="https://sebkrantz.github.io/collapse/logo.png"><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">collapse</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">2.0.19.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Documentation</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://sebkrantz.github.io/Rblog/">Blog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://bsky.app/profile/rcollapse.bsky.social" aria-label="BlueSky"><span class="fa fa-bluesky"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://twitter.com/collapse_R" aria-label="Twitter"><span class="fa fa-twitter"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/SebKrantz/collapse" aria-label="GitHub"><span class="fa fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Small Functions to Make R Programming More Efficient</h1>

      <div class="d-none name"><code>efficient-programming.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>A small set of functions to address some common inefficiencies in R, such as the creation of logical vectors to compare quantities, unnecessary copies of objects in elementary mathematical or subsetting operations, obtaining information about objects (esp. data frames), or dealing with missing values. <!-- % It makes sense to use them when dealing with &gt; 10,000 obs. on modern computers. --></p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">anyv</span><span class="op">(</span><span class="va">x</span>, <span class="va">value</span><span class="op">)</span>              <span class="co"># Faster than any(x == value). See also kit::panyv()</span></span>
<span><span class="fu">allv</span><span class="op">(</span><span class="va">x</span>, <span class="va">value</span><span class="op">)</span>              <span class="co"># Faster than all(x == value). See also kit::pallv()</span></span>
<span><span class="fu">allNA</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>                    <span class="co"># Faster than all(is.na(x)). See also kit::pallNA()</span></span>
<span><span class="fu">whichv</span><span class="op">(</span><span class="va">x</span>, <span class="va">value</span>,            <span class="co"># Faster than which(x == value)</span></span>
<span>       invert <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>      <span class="co"># or which(x != value). See also Note (3)</span></span>
<span><span class="fu">whichNA</span><span class="op">(</span><span class="va">x</span>, invert <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>  <span class="co"># Faster than which((!)is.na(x))</span></span>
<span><span class="va">x</span> <span class="op">%==%</span> <span class="va">value</span></span>
<span><span class="va">x</span> <span class="op">%!=%</span> <span class="va">value</span></span>
<span><span class="fu">alloc</span><span class="op">(</span><span class="va">value</span>, <span class="va">n</span>,             <span class="co"># Fast rep_len(value, n) or replicate(n, value).</span></span>
<span>      simplify <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>      <span class="co"># simplify only works if length(value) == 1. See Details.</span></span>
<span><span class="fu">copyv</span><span class="op">(</span><span class="va">X</span>, <span class="va">v</span>, <span class="va">R</span>, <span class="va">...</span>, invert  <span class="co"># Fast replace(X, v, R), replace(X, X (!/=)= v, R) or</span></span>
<span>    <span class="op">=</span> <span class="cn">FALSE</span>, vind1 <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># replace(X, (!)v, R[(!)v]). See Details and Note (4).</span></span>
<span>    xlist <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>          <span class="co"># For multi-replacement see also kit::vswitch()</span></span>
<span><span class="fu">setv</span><span class="op">(</span><span class="va">X</span>, <span class="va">v</span>, <span class="va">R</span>, <span class="va">...</span>, invert   <span class="co"># Same for X[v] &lt;- r, X[x (!/=)= v] &lt;- r or</span></span>
<span>    <span class="op">=</span> <span class="cn">FALSE</span>, vind1 <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># x[(!)v] &lt;- r[(!)v]. Modifies X by reference, fastest.</span></span>
<span>    xlist <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>          <span class="co"># X/R/V can also be lists/DFs. See Details and Examples.</span></span>
<span><span class="fu">setop</span><span class="op">(</span><span class="va">X</span>, <span class="va">op</span>, <span class="va">V</span>, <span class="va">...</span>,        <span class="co"># Faster than X &lt;- X +\-\*\/ V (modifies by reference)</span></span>
<span>      rowwise <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>      <span class="co"># optionally can also add v to rows of a matrix or list</span></span>
<span><span class="va">X</span> <span class="op">%+=%</span> <span class="va">V</span></span>
<span><span class="va">X</span> <span class="op">%-=%</span> <span class="va">V</span></span>
<span><span class="va">X</span> <span class="op">%*=%</span> <span class="va">V</span></span>
<span><span class="va">X</span> <span class="op">%/=%</span> <span class="va">V</span></span>
<span><span class="fu">na_rm</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>                    <span class="co"># Fast: if(anyNA(x)) x[!is.na(x)] else x, last</span></span>
<span><span class="fu">na_locf</span><span class="op">(</span><span class="va">x</span>, set <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>     <span class="co"># obs. carried forward and first obs. carried back.</span></span>
<span><span class="fu">na_focb</span><span class="op">(</span><span class="va">x</span>, set <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>     <span class="co"># (by reference). These also support lists (NULL/empty)</span></span>
<span><span class="fu">na_omit</span><span class="op">(</span><span class="va">X</span>, cols <span class="op">=</span> <span class="cn">NULL</span>,     <span class="co"># Faster na.omit for matrices and data frames,</span></span>
<span>        na.attr <span class="op">=</span> <span class="cn">FALSE</span>,    <span class="co"># can use selected columns to check, attach indices,</span></span>
<span>        prop <span class="op">=</span> <span class="fl">0</span>, <span class="va">...</span><span class="op">)</span>      <span class="co"># and remove cases with a proportion of values missing</span></span>
<span><span class="fu">na_insert</span><span class="op">(</span><span class="va">X</span>, prop <span class="op">=</span> <span class="fl">0.1</span>,    <span class="co"># Insert missing values at random</span></span>
<span>          value <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="fu">missing_cases</span><span class="op">(</span><span class="va">X</span>, cols<span class="op">=</span><span class="cn">NULL</span>, <span class="co"># The opposite of complete.cases(), faster for DF's.</span></span>
<span>  prop <span class="op">=</span> <span class="fl">0</span>, count <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>  <span class="co"># See also kit::panyNA(), kit::pallNA(), kit::pcountNA()</span></span>
<span><span class="fu">vlengths</span><span class="op">(</span><span class="va">X</span>, use.names<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="co"># Faster lengths() and nchar() (in C, no method dispatch)</span></span>
<span><span class="fu">vtypes</span><span class="op">(</span><span class="va">X</span>, use.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># Get data storage types (faster vapply(X, typeof, ...))</span></span>
<span><span class="fu">vgcd</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>                     <span class="co"># Greatest common divisor of positive integers or doubles</span></span>
<span><span class="fu">fnlevels</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>                 <span class="co"># Faster version of nlevels(x) (for factors)</span></span>
<span><span class="fu">fnrow</span><span class="op">(</span><span class="va">X</span><span class="op">)</span>                    <span class="co"># Faster nrow for data frames (not faster for matrices)</span></span>
<span><span class="fu">fncol</span><span class="op">(</span><span class="va">X</span><span class="op">)</span>                    <span class="co"># Faster ncol for data frames (not faster for matrices)</span></span>
<span><span class="fu">fdim</span><span class="op">(</span><span class="va">X</span><span class="op">)</span>                     <span class="co"># Faster dim for data frames (not faster for matrices)</span></span>
<span><span class="fu">seq_row</span><span class="op">(</span><span class="va">X</span><span class="op">)</span>                  <span class="co"># Fast integer sequences along rows of X</span></span>
<span><span class="fu">seq_col</span><span class="op">(</span><span class="va">X</span><span class="op">)</span>                  <span class="co"># Fast integer sequences along columns of X</span></span>
<span><span class="fu">vec</span><span class="op">(</span><span class="va">X</span><span class="op">)</span>                      <span class="co"># Vectorization (stacking) of matrix or data frame/list</span></span>
<span><span class="fu">cinv</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>                     <span class="co"># Choleski (fast) inverse of symmetric PD matrix, e.g. X'X</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <p></p>
<dl><dt id="arg-x-v-r">X, V, R<a class="anchor" aria-label="anchor" href="#arg-x-v-r"></a></dt>
<dd><p>a vector, matrix or data frame.</p></dd>

  <dt id="arg-x-v">x, v<a class="anchor" aria-label="anchor" href="#arg-x-v"></a></dt>
<dd><p>a (atomic) vector or matrix (<code>na_rm</code> also supports lists).</p></dd>

  <dt id="arg-value">value<a class="anchor" aria-label="anchor" href="#arg-value"></a></dt>
<dd><p>a single value of any (atomic) vector type. For <code>whichv</code> it can also be a <code>length(x)</code> vector.</p></dd>

  <dt id="arg-invert">invert<a class="anchor" aria-label="anchor" href="#arg-invert"></a></dt>
<dd><p>logical. <code>TRUE</code> considers elements <code>x != value</code>.</p></dd>

  <dt id="arg-set">set<a class="anchor" aria-label="anchor" href="#arg-set"></a></dt>
<dd><p>logical. <code>TRUE</code> transforms <code>x</code> by reference.</p></dd>

  <dt id="arg-simplify">simplify<a class="anchor" aria-label="anchor" href="#arg-simplify"></a></dt>
<dd><p>logical. If <code>value</code> is a length-1 atomic vector, <code>alloc()</code> with <code>simplify = TRUE</code> returns a length-n atomic vector. If <code>simplify = FALSE</code>, the result is always a list.</p></dd>

  <dt id="arg-vind-">vind1<a class="anchor" aria-label="anchor" href="#arg-vind-"></a></dt>
<dd><p>logical. If <code>length(v) == 1L</code>, setting <code>vind1 = TRUE</code> will interpret <code>v</code> as an index, rather than a value to search and replace.</p></dd>

  <dt id="arg-xlist">xlist<a class="anchor" aria-label="anchor" href="#arg-xlist"></a></dt>
<dd><p>logical. If <code>X</code> is a list, the default is to treat it like a data frame and replace rows. Setting <code>xlist = TRUE</code> will treat <code>X</code> and its replacement <code>R</code> like 1-dimensional list vectors.</p></dd>

  <dt id="arg-op">op<a class="anchor" aria-label="anchor" href="#arg-op"></a></dt>
<dd><p>an integer or character string indicating the operation to perform.</p><table class="table table"><tr><td><em> Int. </em></td><td></td><td><em> String </em></td><td></td><td><em> Description </em></td></tr><tr><td>1</td><td></td><td><code>"+"</code></td><td></td><td>add <code>V</code></td></tr><tr><td>2</td><td></td><td><code>"-"</code></td><td></td><td>subtract <code>V</code></td></tr><tr><td>3</td><td></td><td><code>"*"</code></td><td></td><td>multiply by <code>V</code></td></tr><tr><td>4</td><td></td><td><code>"/"</code></td><td></td><td>divide by <code>V</code></td></tr></table><p></p></dd>

  <dt id="arg-rowwise">rowwise<a class="anchor" aria-label="anchor" href="#arg-rowwise"></a></dt>
<dd><p>logical. <code>TRUE</code> performs the operation between <code>V</code> and each row of <code>X</code>.</p></dd>

   <dt id="arg-cols">cols<a class="anchor" aria-label="anchor" href="#arg-cols"></a></dt>
<dd><p>select columns to check for missing values using column names, indices, a logical vector or a function (e.g. <code>is.numeric</code>). The default is to check all columns, which could be inefficient.</p></dd>

  <dt id="arg-n">n<a class="anchor" aria-label="anchor" href="#arg-n"></a></dt>
<dd><p>integer. The length of the vector to allocate with <code>value</code>.</p></dd>

  <dt id="arg-na-attr">na.attr<a class="anchor" aria-label="anchor" href="#arg-na-attr"></a></dt>
<dd><p>logical. <code>TRUE</code> adds an attribute containing the removed cases. For compatibility reasons this is exactly the same format as <code>na.omit</code> i.e. the attribute is called "na.action" and of class "omit".</p></dd>

  <dt id="arg-prop">prop<a class="anchor" aria-label="anchor" href="#arg-prop"></a></dt>
<dd><p>double. For <code>na_insert</code>: the proportion of observations to be randomly replaced with <code>NA</code>. For <code>missing_cases</code> and <code>na_omit</code>: the proportion of values missing for the case to be considered missing (within <code>cols</code> if specified). For matrices this is implemented in R as <code>rowSums(is.na(X)) &gt;= max(as.integer(prop * ncol(X)), 1L)</code>. The C code for data frames works equivalently, and skips list- and raw-columns (<code>ncol(X)</code> is adjusted downwards).</p></dd>

  <dt id="arg-count">count<a class="anchor" aria-label="anchor" href="#arg-count"></a></dt>
<dd><p>logical. <code>TRUE</code> returns the row-wise missing value count (within <code>cols</code>). This ignores <code>prop</code>.</p></dd>

  <dt id="arg-use-names">use.names<a class="anchor" aria-label="anchor" href="#arg-use-names"></a></dt>
<dd><p>logical. Preserve names if <code>X</code> is a list.</p></dd>

  <dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>for <code>na_omit</code>: further arguments passed to <code>[</code> for vectors and matrices. With indexed data it is also possible to specify the <code>drop.index.levels</code> argument, see <a href="indexing.html">indexing</a>. For <code>copyv</code>, <code>setv</code> and <code>setop</code>, the argument is unused, and serves as a placeholder for possible future arguments.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>alloc</code> is a fusion of <code><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep_len</a></code> and <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></code> that is faster in both cases. If <code>value</code> is a length one atomic vector (logical, integer, double, string, complex or raw) and <code>simplify = TRUE</code>, the functionality is as <code>rep_len(value, n)</code> i.e. the output is a length <code>n</code> atomic vector with the same attributes as <code>value</code> (apart from <code>"names"</code>, <code>"dim"</code> and <code>"dimnames"</code>). For all other cases the functionality is as <code>replicate(n, value, simplify = FALSE)</code> i.e. the output is a length-<code>n</code> list of the objects. For efficiency reasons the object is not copied i.e. only the pointer to the object is replicated.</p>
<p><code>copyv</code> and <code>setv</code> are designed to optimize operations that require replacing data in objects in the broadest sense. The only difference between them is that <code>copyv</code> first deep-copies <code>X</code> before doing replacements whereas <code>setv</code> modifies <code>X</code> in place and returns the result invisibly. There are 3 ways these functions can be used:</p>
<ol><li><p>To replace a single value, <code>setv(X, v, R)</code> is an efficient alternative to <code>X[X == v] &lt;- R</code>, and  <code>copyv(X, v, R)</code> is more efficient than <code>replace(X, X == v, R)</code>. This can be inverted using <code>setv(X, v, R, invert = TRUE)</code>, equivalent to <code>X[X != v] &lt;- R</code>.</p></li>
<li><p>To do standard replacement with integer or logical indices i.e. <code>X[v] &lt;- R</code> is more efficient using <code>setv(X, v, R)</code>, and, if <code>v</code> is logical, <code>setv(X, v, R, invert = TRUE)</code> is efficient for <code>X[!v] &lt;- R</code>. To distinguish this from use case (1) when <code>length(v) == 1</code>, the argument <code>vind1 = TRUE</code> can be set to ensure that <code>v</code> is always interpreted as an index.</p></li>
<li><p>To copy values from objects of equal size i.e. <code>setv(X, v, R)</code> is faster than <code>X[v] &lt;- R[v]</code>, and <code>setv(X, v, R, invert = TRUE)</code> is faster than <code>X[!v] &lt;- R[!v]</code>.</p></li>
</ol><p>Both <code>X</code> and <code>R</code> can be atomic or data frames / lists. If <code>X</code> is a list, the default behavior is to interpret it like a data frame, and apply <code>setv/copyv</code> to each element/column of <code>X</code>. If <code>R</code> is also a list, this is done using <code><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></code>. Thus <code>setv/copyv</code> can also be used to replace elements or rows in data frames, or copy rows from equally sized frames. Note that for replacing subsets in data frames <code><a href="https://rdatatable.gitlab.io/data.table/reference/assign.html" class="external-link">set</a></code> from <code>data.table</code> provides a more convenient interface (and there is also <code><a href="https://rdatatable.gitlab.io/data.table/reference/copy.html" class="external-link">copy</a></code> if you just want to deep-copy an object without any modifications to it).</p>
<p>If <code>X</code> should not be interpreted like a data frame, setting <code>xlist = TRUE</code> will interpret it like a 1D list-vector analogous to atomic vectors, except that use case (1) is not permitted i.e. no value comparisons on list elements.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>


<ol><li><p>None of these functions (apart from <code>alloc</code>) currently support complex vectors.</p></li>
<li><p><code>setop</code> and the operators <code>%+=%</code>, <code>%-=%</code>, <code>%*=%</code> and <code>%/=%</code> also work with integer data, but do not perform any integer related checks. R's integers are bounded between +-2,147,483,647 and <code>NA_integer_</code> is stored as the value -2,147,483,648. Thus computations resulting in values exceeding +-2,147,483,647 will result in integer overflows, and <code>NA_integer_</code> should not occur on either side of a <code>setop</code> call. These are programmers functions and meant to provide the most efficient math possible to responsible users.</p></li>
<li><p>It is possible to compare factors by the levels (e.g. <code>iris$Species %==% "setosa")</code>) or using integers (<code>iris$Species %==% 1L</code>). The latter is slightly more efficient. Nothing special is implemented for other objects apart from basic types, e.g. for dates (which are stored as doubles) you need to generate a date object i.e. <code>wlddev$date %==% as.Date("2019-01-01")</code>. Using <code>wlddev$date %==% "2019-01-01"</code> will give <code>integer(0)</code>.</p></li>
<li><p><code>setv/copyv</code> only allow positive integer indices being passed to <code>v</code>, and, for efficiency reasons, they only check the first and the last index. Thus if there are indices in the middle that fall outside of the data range it will terminate R.</p></li>
</ol></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><a href="data-transformations.html">Data Transformations</a>, <a href="small-helpers.html">Small (Helper) Functions</a>, <a href="collapse-documentation.html">Collapse Overview</a></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">oldopts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>max.print <span class="op">=</span> <span class="fl">70</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## Which value</span></span></span>
<span class="r-in"><span><span class="fu">whichNA</span><span class="op">(</span><span class="va">wlddev</span><span class="op">$</span><span class="va">PCGDP</span><span class="op">)</span>                <span class="co"># Same as which(is.na(wlddev$PCGDP))</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [20]  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35  36  37  38</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [39]  39  40  41  42  61  62  63  64  65  66  67  68  69  70  71  72  73  74  75</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [58]  76  77  78  79  80  81 122 183 184 185 186 187 188</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached getOption("max.print") -- omitted 3636 entries ]</span>
<span class="r-in"><span><span class="fu">whichNA</span><span class="op">(</span><span class="va">wlddev</span><span class="op">$</span><span class="va">PCGDP</span>, invert <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># Same as which(!is.na(wlddev$PCGDP))</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]  43  44  45  46  47  48  49  50  51  52  53  54  55  56  57  58  59  60  82</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [20]  83  84  85  86  87  88  89  90  91  92  93  94  95  96  97  98  99 100 101</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [39] 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [58] 121 123 124 125 126 127 128 129 130 131 132 133 134</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached getOption("max.print") -- omitted 9400 entries ]</span>
<span class="r-in"><span><span class="fu">whichv</span><span class="op">(</span><span class="va">wlddev</span><span class="op">$</span><span class="va">country</span>, <span class="st">"Chad"</span><span class="op">)</span>       <span class="co"># Same as which(wlddev$county == "Chad")</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 2319 2320 2321 2322 2323 2324 2325 2326 2327 2328 2329 2330 2331 2332 2333</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [16] 2334 2335 2336 2337 2338 2339 2340 2341 2342 2343 2344 2345 2346 2347 2348</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [31] 2349 2350 2351 2352 2353 2354 2355 2356 2357 2358 2359 2360 2361 2362 2363</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [46] 2364 2365 2366 2367 2368 2369 2370 2371 2372 2373 2374 2375 2376 2377 2378</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [61] 2379</span>
<span class="r-in"><span><span class="va">wlddev</span><span class="op">$</span><span class="va">country</span> <span class="op">%==%</span> <span class="st">"Chad"</span>           <span class="co"># Same thing</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 2319 2320 2321 2322 2323 2324 2325 2326 2327 2328 2329 2330 2331 2332 2333</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [16] 2334 2335 2336 2337 2338 2339 2340 2341 2342 2343 2344 2345 2346 2347 2348</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [31] 2349 2350 2351 2352 2353 2354 2355 2356 2357 2358 2359 2360 2361 2362 2363</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [46] 2364 2365 2366 2367 2368 2369 2370 2371 2372 2373 2374 2375 2376 2377 2378</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [61] 2379</span>
<span class="r-in"><span><span class="fu">whichv</span><span class="op">(</span><span class="va">wlddev</span><span class="op">$</span><span class="va">country</span>, <span class="st">"Chad"</span>, <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># Same as which(wlddev$county != "Chad")</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [26] 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [51] 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached getOption("max.print") -- omitted 13045 entries ]</span>
<span class="r-in"><span><span class="va">wlddev</span><span class="op">$</span><span class="va">country</span> <span class="op">%!=%</span> <span class="st">"Chad"</span>           <span class="co"># Same thing</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [26] 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [51] 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached getOption("max.print") -- omitted 13045 entries ]</span>
<span class="r-in"><span><span class="va">lvec</span> <span class="op">&lt;-</span> <span class="va">wlddev</span><span class="op">$</span><span class="va">country</span> <span class="op">==</span> <span class="st">"Chad"</span>     <span class="co"># If we already have a logical vector...</span></span></span>
<span class="r-in"><span><span class="fu">whichv</span><span class="op">(</span><span class="va">lvec</span>, <span class="cn">FALSE</span><span class="op">)</span>                  <span class="co"># is fastver than which(!lvec)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [26] 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [51] 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached getOption("max.print") -- omitted 13045 entries ]</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">lvec</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Using the %==% operator can yield tangible performance gains</span></span></span>
<span class="r-in"><span><span class="fu"><a href="fsubset.html">fsubset</a></span><span class="op">(</span><span class="va">wlddev</span>, <span class="va">iso3c</span> <span class="op">%==%</span> <span class="st">"DEU"</span><span class="op">)</span> <span class="co"># 3x faster than:</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   country iso3c       date year decade                region      income OECD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Germany   DEU 1961-01-01 1960   1960 Europe &amp; Central Asia High income TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Germany   DEU 1962-01-01 1961   1960 Europe &amp; Central Asia High income TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Germany   DEU 1963-01-01 1962   1960 Europe &amp; Central Asia High income TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Germany   DEU 1964-01-01 1963   1960 Europe &amp; Central Asia High income TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Germany   DEU 1965-01-01 1964   1960 Europe &amp; Central Asia High income TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   PCGDP   LIFEEX GINI ODA      POP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    NA 69.31002   NA  NA 72814900</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2    NA 69.50800   NA  NA 73377632</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3    NA 69.69154   NA  NA 74025784</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4    NA 69.85961   NA  NA 74714353</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5    NA 70.01371   NA  NA 75318337</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 56 rows ]</span>
<span class="r-in"><span><span class="fu"><a href="fsubset.html">fsubset</a></span><span class="op">(</span><span class="va">wlddev</span>, <span class="va">iso3c</span> <span class="op">==</span> <span class="st">"DEU"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   country iso3c       date year decade                region      income OECD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Germany   DEU 1961-01-01 1960   1960 Europe &amp; Central Asia High income TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Germany   DEU 1962-01-01 1961   1960 Europe &amp; Central Asia High income TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Germany   DEU 1963-01-01 1962   1960 Europe &amp; Central Asia High income TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Germany   DEU 1964-01-01 1963   1960 Europe &amp; Central Asia High income TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Germany   DEU 1965-01-01 1964   1960 Europe &amp; Central Asia High income TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   PCGDP   LIFEEX GINI ODA      POP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    NA 69.31002   NA  NA 72814900</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2    NA 69.50800   NA  NA 73377632</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3    NA 69.69154   NA  NA 74025784</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4    NA 69.85961   NA  NA 74714353</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5    NA 70.01371   NA  NA 75318337</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 56 rows ]</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># With multiple categories we can use %iin%</span></span></span>
<span class="r-in"><span><span class="fu"><a href="fsubset.html">fsubset</a></span><span class="op">(</span><span class="va">wlddev</span>, <span class="va">iso3c</span> <span class="op"><a href="fmatch.html">%iin%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DEU"</span>, <span class="st">"ITA"</span>, <span class="st">"FRA"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   country iso3c       date year decade                region      income OECD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  France   FRA 1961-01-01 1960   1960 Europe &amp; Central Asia High income TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  France   FRA 1962-01-01 1961   1960 Europe &amp; Central Asia High income TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  France   FRA 1963-01-01 1962   1960 Europe &amp; Central Asia High income TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  France   FRA 1964-01-01 1963   1960 Europe &amp; Central Asia High income TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  France   FRA 1965-01-01 1964   1960 Europe &amp; Central Asia High income TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      PCGDP   LIFEEX GINI ODA      POP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 12743.93 69.86829   NA  NA 46621669</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 13203.32 70.11707   NA  NA 47240543</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 13911.26 70.31463   NA  NA 47904877</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 14572.28 70.51463   NA  NA 48582611</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 15337.08 70.66341   NA  NA 49230595</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 178 rows ]</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Math by reference: permissible types of operations</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">alloc</span><span class="op">(</span><span class="fl">1.0</span>, <span class="fl">1e5</span><span class="op">)</span> <span class="co"># Vector</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">%+=%</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">%+=%</span> <span class="fl">1</span><span class="op">:</span><span class="fl">1e5</span></span></span>
<span class="r-in"><span><span class="va">xm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu">alloc</span><span class="op">(</span><span class="fl">1.0</span>, <span class="fl">1e5</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="co"># Matrix</span></span></span>
<span class="r-in"><span><span class="va">xm</span> <span class="op">%+=%</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="va">xm</span> <span class="op">%+=%</span> <span class="fl">1</span><span class="op">:</span><span class="fl">1e3</span></span></span>
<span class="r-in"><span><span class="fu">setop</span><span class="op">(</span><span class="va">xm</span>, <span class="st">"+"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, rowwise <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">xm</span> <span class="op">%+=%</span> <span class="va">xm</span></span></span>
<span class="r-in"><span><span class="va">xm</span> <span class="op">%+=%</span> <span class="fl">1</span><span class="op">:</span><span class="fl">1e5</span></span></span>
<span class="r-in"><span><span class="va">xd</span> <span class="op">&lt;-</span> <span class="fu"><a href="quick-conversion.html">qDF</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fu">alloc</span><span class="op">(</span><span class="fl">1.0</span>, <span class="fl">1e3</span><span class="op">)</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="co"># Data Frame</span></span></span>
<span class="r-in"><span><span class="va">xd</span> <span class="op">%+=%</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="va">xd</span> <span class="op">%+=%</span> <span class="fl">1</span><span class="op">:</span><span class="fl">1e3</span></span></span>
<span class="r-in"><span><span class="fu">setop</span><span class="op">(</span><span class="va">xd</span>, <span class="st">"+"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, rowwise <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">xd</span> <span class="op">%+=%</span> <span class="va">xd</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">xm</span>, <span class="va">xd</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## setv() and copyv()</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">setv</span><span class="op">(</span><span class="va">y</span>, <span class="fl">5</span>, <span class="fl">0</span><span class="op">)</span>            <span class="co"># Faster than y[y == 5] &lt;- 0</span></span></span>
<span class="r-in"><span><span class="fu">setv</span><span class="op">(</span><span class="va">y</span>, <span class="fl">4</span>, <span class="va">x</span><span class="op">)</span>            <span class="co"># Faster than y[y == 4] &lt;- x[y == 4]</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Type of R (double) is larger than X (integer) and thus coerced. This incurs loss of information, such as digits of real numbers being truncated upon coercion to integer. To avoid this, make sure X has a larger type than R: character &gt; double &gt; integer &gt; logical.</span>
<span class="r-in"><span><span class="fu">setv</span><span class="op">(</span><span class="va">y</span>, <span class="fl">20</span><span class="op">:</span><span class="fl">30</span>, <span class="va">y</span><span class="op">[</span><span class="fl">40</span><span class="op">:</span><span class="fl">50</span><span class="op">]</span><span class="op">)</span> <span class="co"># Faster than y[20:30] &lt;- y[40:50]</span></span></span>
<span class="r-in"><span><span class="fu">setv</span><span class="op">(</span><span class="va">y</span>, <span class="fl">20</span><span class="op">:</span><span class="fl">30</span>, <span class="va">x</span><span class="op">)</span>        <span class="co"># Faster than y[20:30] &lt;- x[20:30]</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Type of R (double) is larger than X (integer) and thus coerced. This incurs loss of information, such as digits of real numbers being truncated upon coercion to integer. To avoid this, make sure X has a larger type than R: character &gt; double &gt; integer &gt; logical.</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Working with data frames, here returning copies of the frame</span></span></span>
<span class="r-in"><span><span class="fu">copyv</span><span class="op">(</span><span class="va">mtcars</span>, <span class="fl">20</span><span class="op">:</span><span class="fl">30</span>, <span class="fu"><a href="fsubset.html">ss</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="fl">10</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    mpg cyl disp  hp drat    wt  qsec vs am gear carb</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 26 rows ]</span>
<span class="r-in"><span><span class="fu">copyv</span><span class="op">(</span><span class="va">mtcars</span>, <span class="fl">20</span><span class="op">:</span><span class="fl">30</span>, <span class="fu"><a href="fscale.html">fscale</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    mpg cyl disp  hp drat    wt  qsec vs am gear carb</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 26 rows ]</span>
<span class="r-in"><span><span class="fu"><a href="ftransform.html">ftransform</a></span><span class="op">(</span><span class="va">mtcars</span>, new <span class="op">=</span> <span class="fu">copyv</span><span class="op">(</span><span class="va">cyl</span>, <span class="fl">4</span>, <span class="va">vs</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    mpg cyl disp  hp drat    wt  qsec vs am gear carb new</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4   6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4   6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1   1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1   6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2   8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 27 rows ]</span>
<span class="r-in"><span><span class="co"># Column-wise:</span></span></span>
<span class="r-in"><span><span class="fu">copyv</span><span class="op">(</span><span class="va">mtcars</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span>, <span class="fu"><a href="fscale.html">fscale</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span>, xlist <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    mpg        cyl        disp  hp drat    wt  qsec vs am gear</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4         21.0 -0.1049878 -0.57061982 110 3.90 2.620 16.46  0  1    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4 Wag     21.0 -0.1049878 -0.57061982 110 3.90 2.875 17.02  0  1    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Datsun 710        22.8 -1.2248578 -0.99018209  93 3.85 2.320 18.61  1  1    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet 4 Drive    21.4 -0.1049878  0.22009369 110 3.08 3.215 19.44  1  0    3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet Sportabout 18.7  1.0148821  1.04308123 175 3.15 3.440 17.02  0  0    3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Valiant           18.1 -0.1049878 -0.04616698 105 2.76 3.460 20.22  1  0    3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   carb</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4            4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4 Wag        4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Datsun 710           1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet 4 Drive       1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet Sportabout    2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Valiant              1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 26 rows ]</span>
<span class="r-in"><span><span class="fu">copyv</span><span class="op">(</span><span class="va">mtcars</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span>, <span class="va">mtcars</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, xlist <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    mpg cyl disp  hp drat    wt  qsec vs am gear carb</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4         21.0 110 3.90 110 3.90 2.620 16.46  0  1    4    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4 Wag     21.0 110 3.90 110 3.90 2.875 17.02  0  1    4    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Datsun 710        22.8  93 3.85  93 3.85 2.320 18.61  1  1    4    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet 4 Drive    21.4 110 3.08 110 3.08 3.215 19.44  1  0    3    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet Sportabout 18.7 175 3.15 175 3.15 3.440 17.02  0  0    3    2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Valiant           18.1 105 2.76 105 2.76 3.460 20.22  1  0    3    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 26 rows ]</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Missing values</span></span></span>
<span class="r-in"><span><span class="va">mtc_na</span> <span class="op">&lt;-</span> <span class="fu">na_insert</span><span class="op">(</span><span class="va">mtcars</span>, <span class="fl">0.15</span><span class="op">)</span>    <span class="co"># Set 15% of values missing at random</span></span></span>
<span class="r-in"><span><span class="fu"><a href="fnobs.html">fnobs</a></span><span class="op">(</span><span class="va">mtc_na</span><span class="op">)</span>                        <span class="co"># See observation count</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  mpg  cyl disp   hp drat   wt qsec   vs   am gear carb </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   28   28   28   28   28   28   28   28   28   28   28 </span>
<span class="r-in"><span><span class="fu">missing_cases</span><span class="op">(</span><span class="va">mtc_na</span><span class="op">)</span>                <span class="co"># Fast equivalent to !complete.cases(mtc_na)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]  TRUE  TRUE  TRUE FALSE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [13]  TRUE FALSE  TRUE FALSE  TRUE FALSE  TRUE  TRUE  TRUE FALSE  TRUE  TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [25] FALSE FALSE  TRUE FALSE  TRUE  TRUE  TRUE FALSE</span>
<span class="r-in"><span><span class="fu">missing_cases</span><span class="op">(</span><span class="va">mtc_na</span>, cols <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>    <span class="co"># Missing cases on certain columns?</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] FALSE FALSE  TRUE FALSE  TRUE FALSE FALSE FALSE  TRUE  TRUE FALSE FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [13] FALSE FALSE  TRUE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE  TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [25] FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE</span>
<span class="r-in"><span><span class="fu">missing_cases</span><span class="op">(</span><span class="va">mtc_na</span>, count <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>  <span class="co"># Missing case count</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 3 2 1 0 1 0 2 2 6 3 1 2 1 0 1 0 2 0 1 4 2 0 2 1 0 0 2 0 2 1 2 0</span>
<span class="r-in"><span><span class="fu">missing_cases</span><span class="op">(</span><span class="va">mtc_na</span>, prop <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span>    <span class="co"># Cases with 80% or more missing</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [13] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [25] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</span>
<span class="r-in"><span><span class="fu">missing_cases</span><span class="op">(</span><span class="va">mtc_na</span>, cols <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">4</span>, prop <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>     <span class="co"># Cases mssing columns 3 and 4</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [13] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [25] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</span>
<span class="r-in"><span><span class="fu">missing_cases</span><span class="op">(</span><span class="va">mtc_na</span>, cols <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">4</span>, count <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># Missing case count on columns 3 and 4</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 0 0 1 0 1 0 0 0 1 1 0 0 0 0 1 0 0 0 0 1 0 0 0 1 0 0 1 0 0 0 0 0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">na_omit</span><span class="op">(</span><span class="va">mtc_na</span><span class="op">)</span>                      <span class="co"># 12x faster than na.omit(mtc_na)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                      mpg cyl  disp  hp drat    wt  qsec vs am gear carb</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet 4 Drive      21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Valiant             18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Merc 450SLC         15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fiat 128            32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dodge Challenger    15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 4 rows ]</span>
<span class="r-in"><span><span class="fu">na_omit</span><span class="op">(</span><span class="va">mtc_na</span>, prop <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span>          <span class="co"># Only remove cases missing 80% or more</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    mpg cyl disp  hp drat    wt  qsec vs am gear carb</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4         21.0   6  160 110 3.90 2.620 16.46 NA  1   NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4 Wag     21.0  NA  160 110 3.90 2.875 17.02  0 NA    4    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Datsun 710        22.8   4   NA  93 3.85 2.320 18.61  1  1    4    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet Sportabout 18.7   8   NA 175 3.15 3.440 17.02  0  0    3    2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 26 rows ]</span>
<span class="r-in"><span><span class="fu">na_omit</span><span class="op">(</span><span class="va">mtc_na</span>, na.attr <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>      <span class="co"># Adds attribute with removed cases, like na.omit</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                      mpg cyl  disp  hp drat    wt  qsec vs am gear carb</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet 4 Drive      21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Valiant             18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Merc 450SLC         15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fiat 128            32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dodge Challenger    15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 4 rows ]</span>
<span class="r-in"><span><span class="fu">na_omit</span><span class="op">(</span><span class="va">mtc_na</span>, cols <span class="op">=</span> <span class="fu"><a href="small-helpers.html">.c</a></span><span class="op">(</span><span class="va">vs</span>, <span class="va">am</span><span class="op">)</span><span class="op">)</span>   <span class="co"># Removes only cases missing vs or am</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    mpg cyl  disp  hp drat    wt  qsec vs am gear carb</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Datsun 710        22.8   4    NA  93 3.85 2.320 18.61  1  1    4    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet 4 Drive    21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet Sportabout 18.7   8    NA 175 3.15 3.440 17.02  0  0    3    2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Valiant           18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Duster 360        14.3   8 360.0 245   NA 3.570 15.84  0  0   NA    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Merc 280            NA   6 167.6  NA 3.92 3.440 18.30  1  0   NA    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 18 rows ]</span>
<span class="r-in"><span><span class="fu">na_omit</span><span class="op">(</span><span class="fu"><a href="quick-conversion.html">qM</a></span><span class="op">(</span><span class="va">mtc_na</span><span class="op">)</span><span class="op">)</span>                  <span class="co"># Also works for matrices</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                      mpg cyl  disp  hp drat    wt  qsec vs am gear carb</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet 4 Drive      21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Valiant             18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Merc 450SLC         15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fiat 128            32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dodge Challenger    15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached getOption("max.print") -- omitted 4 rows ]</span>
<span class="r-in"><span><span class="fu">na_omit</span><span class="op">(</span><span class="va">mtc_na</span><span class="op">$</span><span class="va">vs</span>, na.attr <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>   <span class="co"># Also works with vectors</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 0 1 1 0 1 0 1 1 0 0 0 0 0 0 1 1 1 0 0 0 0 1 0 1 0 0 0 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"na.action")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  1  8  9 20</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "omit"</span>
<span class="r-in"><span><span class="fu">na_rm</span><span class="op">(</span><span class="va">mtc_na</span><span class="op">$</span><span class="va">vs</span><span class="op">)</span>                     <span class="co"># For vectors na_rm is faster ...</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 0 1 1 0 1 0 1 1 0 0 0 0 0 0 1 1 1 0 0 0 0 1 0 1 0 0 0 1</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">mtc_na</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Efficient vectorization</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">vec</span><span class="op">(</span><span class="va">EuStockMarkets</span><span class="op">)</span><span class="op">)</span> <span class="co"># Atomic objects: no copy at all</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1628.75 1613.63 1606.51 1621.04 1618.16 1610.61</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">vec</span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span><span class="op">)</span>         <span class="co"># Lists: directly in C</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 21.0 21.0 22.8 21.4 18.7 18.1</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="va">oldopts</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sebastian Krantz.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer></div>





  </body></html>

