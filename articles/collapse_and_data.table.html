<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>collapse and data.table • collapse</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="48x48" href="../favicon-48x48.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><link href="../deps/KaTex-0.16.10/katex.min.css" rel="stylesheet">
<script src="../deps/KaTex-0.16.10/katex.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="collapse and data.table">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">collapse</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Documentation</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://sebkrantz.github.io/Rblog/">Blog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://bsky.app/profile/rcollapse.bsky.social" aria-label="BlueSky"><span class="fa fa-bluesky"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://twitter.com/collapse_R" aria-label="Twitter"><span class="fa fa-twitter"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/SebKrantz/collapse" aria-label="GitHub"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>collapse and data.table</h1>
            <h3 data-toc-skip class="subtitle">Harmony and High
Performance</h3>
                        <h4 data-toc-skip class="author">Sebastian
Krantz</h4>
            
            <h4 data-toc-skip class="date">2021-06-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/SebKrantz/collapse/blob/development/vignettes/collapse_and_data.table.Rmd" class="external-link"><code>vignettes/collapse_and_data.table.Rmd</code></a></small>
      <div class="d-none name"><code>collapse_and_data.table.Rmd</code></div>
    </div>

    
    
<style type="text/css">
pre {
  max-height: 500px;
  overflow-y: auto;
}

pre[class] {
  max-height: 500px;
}
</style>
<!--
*collapse* is a C/C++ based package for data transformation and statistical computing in R. It's aims are:

1. To facilitate complex data transformation, exploration and computing tasks in R.
2. To help make R code fast, flexible, parsimonious and programmer friendly. 
--><p>This vignette focuses on using <em>collapse</em> with the popular
<em>data.table</em> package by Matt Dowle and Arun Srinivasan. In
contrast to <em>dplyr</em> and <em>plm</em> whose methods (‘grouped_df’,
‘pseries’, ‘pdata.frame’) <em>collapse</em> supports, the integration
between <em>collapse</em> and <em>data.table</em> is hidden in the
‘data.frame’ methods and <em>collapse</em>’s C code.</p>
<p>From version 1.6.0 <em>collapse</em> seamlessly handles
<em>data.tables</em>, permitting reference operations
(<code>set*</code>, <code>:=</code>) on data tables created with
collapse (<code>qDT</code>) or returned from <em>collapse</em>’s data
manipulation functions (= all functions except <code>.FAST_FUN</code>,
<code>.OPERATOR_FUN</code>, <code>BY</code> and <code>TRA</code>, see
the <a href="https://sebkrantz.github.io/collapse/news/index.html#collapse-1-6-0-2021-06-28">NEWS</a>
for details on the low-level integration). Apart from
<em>data.table</em> reference semantics, both packages work similarly on
the C/C++ side of things, and nicely complement each other in
functionality.</p>
<div class="section level2">
<h2 id="overview-of-both-packages">Overview of Both Packages<a class="anchor" aria-label="anchor" href="#overview-of-both-packages"></a>
</h2>
<p>Both <em>data.table</em> and <em>collapse</em> are high-performance
packages that work well together. For effective co-use it is helpful to
understand where each has its strengths, what one can do what the other
cannot, and where they overlap. Therefore this small comparison:</p>
<ul>
<li><p><em>data.table</em> offers an enhanced data frame based class to
contain data (including list columns). For this class it provides a
concise data manipulation syntax which also includes fast aggregation /
slit-apply-combine computing, (rolling, non-equi) joins, keying,
reshaping, some time-series functionality like lagging and rolling
statistics, set operations on tables and a number of very useful other
functions like the fast csv reader, fast switches, list-transpose etc..
<em>data.table</em> makes data management, and computations on data very
easy and scalable, supporting huge datasets in a very memory efficient
way. The package caters well to the end user by compressing an enormous
amount of functionality into two square brackets <code>[]</code>. Some
of the exported functions are great for programming and also support
other classes, but a lot of the functionality and optimization of
<em>data.table</em> happens under the hood and can only be accessed
through the non-standard evaluation table <code>[i, j, by]</code>
syntax. This syntax has a cost of about 1-3 milliseconds for each call.
Memory efficiency and thread-parallelization make <em>data.table</em>
the star performer on huge data.</p></li>
<li><p><em>collapse</em> is class-agnostic in nature, supporting
vectors, matrices, data frames and non-destructively handling most R
classes and objects. It focuses on advanced statistical computing,
proving fast column-wise grouped and weighted statistical functions,
fast and complex data aggregation and transformations, linear fitting,
time series and panel data computations, advanced summary statistics,
and recursive processing of lists of data objects. It also includes
powerful functions for data manipulation, grouping / factor generation,
recoding, handling outliers and missing values. The package default for
missing values is <code>na.rm = TRUE</code>, which is implemented
efficiently in C/C++ in all functions. <em>collapse</em> supports both
<em>tidyverse</em> (piped) and base R / standard evaluation programming.
It makes accessible most of it’s internal C/C++ based functionality
(like grouping objects). <em>collapse</em>’s R functions are simple and
strongly optimized, i.e. they access the serial C/C++ code quickly,
resulting in baseline execution speeds of 10-50 microseconds. All of
this makes <em>collapse</em> ideal for advanced statistical computing on
matrices and larger datasets, and tasks requiring fast programs with
repeated function executions.</p></li>
</ul>
<!-- (< 10 mio obs.). --><!-- 
Thus you don't need to choose between these two. I created *collapse* because I wanted more flexibility and programmability and *data.table* fell short on my statistical demands. I still manage most of my data using *data.table*. -->
</div>
<div class="section level2">
<h2 id="interoperating-and-some-dos-and-donts">Interoperating and some Do’s and Dont’s<a class="anchor" aria-label="anchor" href="#interoperating-and-some-dos-and-donts"></a>
</h2>
<p>Applying <em>collapse</em> functions to a data.table always gives a
data.table back e.g. </p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sebkrantz.github.io/collapse/">collapse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quick-conversion.html">qDT</a></span><span class="op">(</span><span class="va">wlddev</span><span class="op">)</span> <span class="co"># collapse::qDT converts objects to data.table using a shallow copy</span></span>
<span></span>
<span></span>
<span><span class="va">DT</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://sebkrantz.github.io/collapse/reference/GRP.html">gby</a></span><span class="op">(</span><span class="va">country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://sebkrantz.github.io/collapse/reference/select_replace_vars.html">gv</a></span><span class="op">(</span><span class="fl">9</span><span class="op">:</span><span class="fl">13</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">fmean</span></span>
<span><span class="co">#                    country      PCGDP   LIFEEX     GINI        ODA         POP</span></span>
<span><span class="co">#                     &lt;char&gt;      &lt;num&gt;    &lt;num&gt;    &lt;num&gt;      &lt;num&gt;       &lt;num&gt;</span></span>
<span><span class="co">#   1:           Afghanistan   483.8351 49.19717       NA 1487548499 18362258.22</span></span>
<span><span class="co">#   2:               Albania  2819.2400 71.68027 31.41111  312928126  2708297.17</span></span>
<span><span class="co">#   3:               Algeria  3532.2714 63.56290 34.36667  612238500 25305290.68</span></span>
<span><span class="co">#   4:        American Samoa 10071.0659       NA       NA         NA    43115.10</span></span>
<span><span class="co">#   5:               Andorra 40083.0911       NA       NA         NA    51547.35</span></span>
<span><span class="co">#  ---                                                                          </span></span>
<span><span class="co"># 212: Virgin Islands (U.S.) 35629.7336 73.71292       NA         NA    92238.53</span></span>
<span><span class="co"># 213:    West Bank and Gaza  2388.4348 71.60780 34.52500 1638581462  3312289.13</span></span>
<span><span class="co"># 214:           Yemen, Rep.  1069.6596 52.53707 35.46667  859950996 13741375.82</span></span>
<span><span class="co"># 215:                Zambia  1318.8627 51.09263 52.68889  734624330  8614972.38</span></span>
<span><span class="co"># 216:              Zimbabwe  1219.4360 54.53360 45.93333  397104997  9402160.33</span></span>
<span></span>
<span><span class="co"># Same thing, but notice that fmean give's NA's for missing countries</span></span>
<span><span class="va">DT</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">mean</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, keyby <span class="op">=</span> <span class="va">country</span>, .SDcols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">13</span><span class="op">]</span></span>
<span><span class="co"># Key: &lt;country&gt;</span></span>
<span><span class="co">#                    country      PCGDP   LIFEEX     GINI        ODA         POP</span></span>
<span><span class="co">#                     &lt;char&gt;      &lt;num&gt;    &lt;num&gt;    &lt;num&gt;      &lt;num&gt;       &lt;num&gt;</span></span>
<span><span class="co">#   1:           Afghanistan   483.8351 49.19717      NaN 1487548499 18362258.22</span></span>
<span><span class="co">#   2:               Albania  2819.2400 71.68027 31.41111  312928126  2708297.17</span></span>
<span><span class="co">#   3:               Algeria  3532.2714 63.56290 34.36667  612238500 25305290.68</span></span>
<span><span class="co">#   4:        American Samoa 10071.0659      NaN      NaN        NaN    43115.10</span></span>
<span><span class="co">#   5:               Andorra 40083.0911      NaN      NaN        NaN    51547.35</span></span>
<span><span class="co">#  ---                                                                          </span></span>
<span><span class="co"># 212: Virgin Islands (U.S.) 35629.7336 73.71292      NaN        NaN    92238.53</span></span>
<span><span class="co"># 213:    West Bank and Gaza  2388.4348 71.60780 34.52500 1638581462  3312289.13</span></span>
<span><span class="co"># 214:           Yemen, Rep.  1069.6596 52.53707 35.46667  859950996 13741375.82</span></span>
<span><span class="co"># 215:                Zambia  1318.8627 51.09263 52.68889  734624330  8614972.38</span></span>
<span><span class="co"># 216:              Zimbabwe  1219.4360 54.53360 45.93333  397104997  9402160.33</span></span>
<span></span>
<span><span class="co"># This also works without magrittr pipes with the collap() function</span></span>
<span><span class="fu"><a href="../reference/collap.html">collap</a></span><span class="op">(</span><span class="va">DT</span>, <span class="op">~</span> <span class="va">country</span>, <span class="va">fmean</span>, cols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">13</span><span class="op">)</span></span>
<span><span class="co">#                    country      PCGDP   LIFEEX     GINI        ODA         POP</span></span>
<span><span class="co">#                     &lt;char&gt;      &lt;num&gt;    &lt;num&gt;    &lt;num&gt;      &lt;num&gt;       &lt;num&gt;</span></span>
<span><span class="co">#   1:           Afghanistan   483.8351 49.19717       NA 1487548499 18362258.22</span></span>
<span><span class="co">#   2:               Albania  2819.2400 71.68027 31.41111  312928126  2708297.17</span></span>
<span><span class="co">#   3:               Algeria  3532.2714 63.56290 34.36667  612238500 25305290.68</span></span>
<span><span class="co">#   4:        American Samoa 10071.0659       NA       NA         NA    43115.10</span></span>
<span><span class="co">#   5:               Andorra 40083.0911       NA       NA         NA    51547.35</span></span>
<span><span class="co">#  ---                                                                          </span></span>
<span><span class="co"># 212: Virgin Islands (U.S.) 35629.7336 73.71292       NA         NA    92238.53</span></span>
<span><span class="co"># 213:    West Bank and Gaza  2388.4348 71.60780 34.52500 1638581462  3312289.13</span></span>
<span><span class="co"># 214:           Yemen, Rep.  1069.6596 52.53707 35.46667  859950996 13741375.82</span></span>
<span><span class="co"># 215:                Zambia  1318.8627 51.09263 52.68889  734624330  8614972.38</span></span>
<span><span class="co"># 216:              Zimbabwe  1219.4360 54.53360 45.93333  397104997  9402160.33</span></span></code></pre></div>
<p>By default, <em>collapse</em> orders groups in aggregations, which is
equivalent to using <code>keyby</code> with <em>data.table</em>.
<code>gby / fgroup_by</code> has an argument <code>sort = FALSE</code>
to yield an unordered grouping equivalent to <em>data.table</em>’s
<code>by</code> on character data<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Grouping on numeric variables in &lt;em&gt;collapse&lt;/em&gt; is
always ordered.&lt;/p&gt;"><sup>1</sup></a>.</p>
<p>At this data size <em>collapse</em> outperforms <em>data.table</em>
(which might reverse as data size grows, depending in your computer, the
number of <em>data.table</em> threads used, and the function in
question):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/joshuaulrich/microbenchmark/" class="external-link">microbenchmark</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="va">DT</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://sebkrantz.github.io/collapse/reference/GRP.html">gby</a></span><span class="op">(</span><span class="va">country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="fl">9</span><span class="op">:</span><span class="fl">13</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">fmean</span>,</span>
<span>               data.table <span class="op">=</span> <span class="va">DT</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">mean</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, keyby <span class="op">=</span> <span class="va">country</span>, .SDcols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">13</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># Unit: microseconds</span></span>
<span><span class="co">#        expr     min       lq     mean   median       uq      max neval</span></span>
<span><span class="co">#    collapse 203.073 212.7285 223.4156 217.1565 225.6230  475.559   100</span></span>
<span><span class="co">#  data.table 758.623 777.4010 929.5450 793.1655 854.4605 2292.515   100</span></span></code></pre></div>
<p>It is critical to never do something like this:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DT</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">fmean</span><span class="op">)</span>, keyby <span class="op">=</span> <span class="va">country</span>, .SDcols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">13</span><span class="op">]</span></span>
<span><span class="co"># Key: &lt;country&gt;</span></span>
<span><span class="co">#                    country      PCGDP   LIFEEX     GINI        ODA         POP</span></span>
<span><span class="co">#                     &lt;char&gt;      &lt;num&gt;    &lt;num&gt;    &lt;num&gt;      &lt;num&gt;       &lt;num&gt;</span></span>
<span><span class="co">#   1:           Afghanistan   483.8351 49.19717       NA 1487548499 18362258.22</span></span>
<span><span class="co">#   2:               Albania  2819.2400 71.68027 31.41111  312928126  2708297.17</span></span>
<span><span class="co">#   3:               Algeria  3532.2714 63.56290 34.36667  612238500 25305290.68</span></span>
<span><span class="co">#   4:        American Samoa 10071.0659       NA       NA         NA    43115.10</span></span>
<span><span class="co">#   5:               Andorra 40083.0911       NA       NA         NA    51547.35</span></span>
<span><span class="co">#  ---                                                                          </span></span>
<span><span class="co"># 212: Virgin Islands (U.S.) 35629.7336 73.71292       NA         NA    92238.53</span></span>
<span><span class="co"># 213:    West Bank and Gaza  2388.4348 71.60780 34.52500 1638581462  3312289.13</span></span>
<span><span class="co"># 214:           Yemen, Rep.  1069.6596 52.53707 35.46667  859950996 13741375.82</span></span>
<span><span class="co"># 215:                Zambia  1318.8627 51.09263 52.68889  734624330  8614972.38</span></span>
<span><span class="co"># 216:              Zimbabwe  1219.4360 54.53360 45.93333  397104997  9402160.33</span></span></code></pre></div>
<p>The reason is that <em>collapse</em> functions are S3 generic with
methods for vectors, matrices and data frames among others. So you incur
a method-dispatch for every column and every group the function is
applied to.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fmean</span></span>
<span><span class="co"># function (x, ...) </span></span>
<span><span class="co"># UseMethod("fmean")</span></span>
<span><span class="co"># &lt;bytecode: 0x10fb58540&gt;</span></span>
<span><span class="co"># &lt;environment: namespace:collapse&gt;</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/methods.html" class="external-link">methods</a></span><span class="op">(</span><span class="va">fmean</span><span class="op">)</span></span>
<span><span class="co"># [1] fmean.data.frame* fmean.default*    fmean.grouped_df* fmean.list*       fmean.matrix*    </span></span>
<span><span class="co"># [6] fmean.units*      fmean.zoo*       </span></span>
<span><span class="co"># see '?methods' for accessing help and source code</span></span></code></pre></div>
<p>You may now contend that <code><a href="https://rdrr.io/r/base/mean.html" class="external-link">base::mean</a></code> is also S3 generic,
but in this
<code>DT[, lapply(.SD, mean, na.rm = TRUE), by = country, .SDcols = 9:13]</code>
code <em>data.table</em> does not use <code><a href="https://rdrr.io/r/base/mean.html" class="external-link">base::mean</a></code>, but
<code>data.table:::gmean</code>, an internal optimized mean function
which is efficiently applied over those groups (see
<code><a href="https://rdatatable.gitlab.io/data.table/reference/datatable-optimize.html" class="external-link">?data.table::GForce</a></code>). <code>fmean</code> works similar, and
includes this functionality explicitly.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/args.html" class="external-link">args</a></span><span class="op">(</span><span class="va">fmean.data.frame</span><span class="op">)</span></span>
<span><span class="co"># function (x, g = NULL, w = NULL, TRA = NULL, na.rm = .op[["na.rm"]], </span></span>
<span><span class="co">#     use.g.names = TRUE, drop = TRUE, nthreads = .op[["nthreads"]], </span></span>
<span><span class="co">#     ...) </span></span>
<span><span class="co"># NULL</span></span></code></pre></div>
<p>Here we can see the <code>x</code> argument for the data, the
<code>g</code> argument for grouping vectors, a weight vector
<code>w</code>, different options <code>TRA</code> to transform the
original data using the computed means, and some functionality regarding
missing values (default: removed / skipped), group names (which are
added as row-names to a data frame, but not to a <em>data.table</em>)
etc. So we can also do</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fmean.html">fmean</a></span><span class="op">(</span><span class="fu"><a href="https://sebkrantz.github.io/collapse/reference/select_replace_vars.html">gv</a></span><span class="op">(</span><span class="va">DT</span>, <span class="fl">9</span><span class="op">:</span><span class="fl">13</span><span class="op">)</span>, <span class="va">DT</span><span class="op">$</span><span class="va">country</span><span class="op">)</span></span>
<span><span class="co">#           PCGDP   LIFEEX     GINI        ODA         POP</span></span>
<span><span class="co">#           &lt;num&gt;    &lt;num&gt;    &lt;num&gt;      &lt;num&gt;       &lt;num&gt;</span></span>
<span><span class="co">#   1:   483.8351 49.19717       NA 1487548499 18362258.22</span></span>
<span><span class="co">#   2:  2819.2400 71.68027 31.41111  312928126  2708297.17</span></span>
<span><span class="co">#   3:  3532.2714 63.56290 34.36667  612238500 25305290.68</span></span>
<span><span class="co">#   4: 10071.0659       NA       NA         NA    43115.10</span></span>
<span><span class="co">#   5: 40083.0911       NA       NA         NA    51547.35</span></span>
<span><span class="co">#  ---                                                    </span></span>
<span><span class="co"># 212: 35629.7336 73.71292       NA         NA    92238.53</span></span>
<span><span class="co"># 213:  2388.4348 71.60780 34.52500 1638581462  3312289.13</span></span>
<span><span class="co"># 214:  1069.6596 52.53707 35.46667  859950996 13741375.82</span></span>
<span><span class="co"># 215:  1318.8627 51.09263 52.68889  734624330  8614972.38</span></span>
<span><span class="co"># 216:  1219.4360 54.53360 45.93333  397104997  9402160.33</span></span>
<span></span>
<span><span class="co"># Or</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GRP.html">GRP</a></span><span class="op">(</span><span class="va">DT</span>, <span class="st">"country"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/select_replace_vars.html">add_vars</a></span><span class="op">(</span><span class="va">g</span><span class="op">[[</span><span class="st">"groups"</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="../reference/fmean.html">fmean</a></span><span class="op">(</span><span class="fu"><a href="https://sebkrantz.github.io/collapse/reference/select_replace_vars.html">gv</a></span><span class="op">(</span><span class="va">DT</span>, <span class="fl">9</span><span class="op">:</span><span class="fl">13</span><span class="op">)</span>, <span class="va">g</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#                    country      PCGDP   LIFEEX     GINI        ODA         POP</span></span>
<span><span class="co">#                     &lt;char&gt;      &lt;num&gt;    &lt;num&gt;    &lt;num&gt;      &lt;num&gt;       &lt;num&gt;</span></span>
<span><span class="co">#   1:           Afghanistan   483.8351 49.19717       NA 1487548499 18362258.22</span></span>
<span><span class="co">#   2:               Albania  2819.2400 71.68027 31.41111  312928126  2708297.17</span></span>
<span><span class="co">#   3:               Algeria  3532.2714 63.56290 34.36667  612238500 25305290.68</span></span>
<span><span class="co">#   4:        American Samoa 10071.0659       NA       NA         NA    43115.10</span></span>
<span><span class="co">#   5:               Andorra 40083.0911       NA       NA         NA    51547.35</span></span>
<span><span class="co">#  ---                                                                          </span></span>
<span><span class="co"># 212: Virgin Islands (U.S.) 35629.7336 73.71292       NA         NA    92238.53</span></span>
<span><span class="co"># 213:    West Bank and Gaza  2388.4348 71.60780 34.52500 1638581462  3312289.13</span></span>
<span><span class="co"># 214:           Yemen, Rep.  1069.6596 52.53707 35.46667  859950996 13741375.82</span></span>
<span><span class="co"># 215:                Zambia  1318.8627 51.09263 52.68889  734624330  8614972.38</span></span>
<span><span class="co"># 216:              Zimbabwe  1219.4360 54.53360 45.93333  397104997  9402160.33</span></span></code></pre></div>
<p>To give us the same result obtained through the high-level functions
<code>gby / fgroup_by</code> or <code>collap</code>. This is however not
what <em>data.table</em> is doing in
<code>DT[, lapply(.SD, fmean), by = country, .SDcols = 9:13]</code>.
Since <code>fmean</code> is not a function it recognizes and is able to
optimize, it does something like this,</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/BY.html">BY</a></span><span class="op">(</span><span class="fu"><a href="https://sebkrantz.github.io/collapse/reference/select_replace_vars.html">gv</a></span><span class="op">(</span><span class="va">DT</span>, <span class="fl">9</span><span class="op">:</span><span class="fl">13</span><span class="op">)</span>, <span class="va">g</span>, <span class="va">fmean</span><span class="op">)</span> <span class="co"># using collapse::BY</span></span>
<span><span class="co">#           PCGDP   LIFEEX     GINI        ODA         POP</span></span>
<span><span class="co">#           &lt;num&gt;    &lt;num&gt;    &lt;num&gt;      &lt;num&gt;       &lt;num&gt;</span></span>
<span><span class="co">#   1:   483.8351 49.19717       NA 1487548499 18362258.22</span></span>
<span><span class="co">#   2:  2819.2400 71.68027 31.41111  312928126  2708297.17</span></span>
<span><span class="co">#   3:  3532.2714 63.56290 34.36667  612238500 25305290.68</span></span>
<span><span class="co">#   4: 10071.0659       NA       NA         NA    43115.10</span></span>
<span><span class="co">#   5: 40083.0911       NA       NA         NA    51547.35</span></span>
<span><span class="co">#  ---                                                    </span></span>
<span><span class="co"># 212: 35629.7336 73.71292       NA         NA    92238.53</span></span>
<span><span class="co"># 213:  2388.4348 71.60780 34.52500 1638581462  3312289.13</span></span>
<span><span class="co"># 214:  1069.6596 52.53707 35.46667  859950996 13741375.82</span></span>
<span><span class="co"># 215:  1318.8627 51.09263 52.68889  734624330  8614972.38</span></span>
<span><span class="co"># 216:  1219.4360 54.53360 45.93333  397104997  9402160.33</span></span></code></pre></div>
<p>which applies <code>fmean</code> to every group in every column of
the data.</p>
<p>More generally, it is very important to understand that
<em>collapse</em> is not based around applying functions to data by
groups using some universal mechanism: The <em>dplyr</em>
<code>data %&gt;% group_by(...) %&gt;% summarize(...) / mutate(...)</code>
and <em>data.table</em> <code>[i, j, by]</code> syntax are essentially
universal mechanisms to apply any function to data by groups.
<em>data.table</em> additionally internally optimizes some functions
(<code>min, max, mean, median, var, sd, sum, prod, first, last, head, tail</code>)
which they called GForce, <code><a href="https://rdatatable.gitlab.io/data.table/reference/datatable-optimize.html" class="external-link">?data.table::GForce</a></code>.</p>
<p><em>collapse</em> instead provides grouped statistical and
transformation functions where all grouped computation is done
efficiently in C++, and some supporting mechanisms
(<code>fgroup_by</code>, <code>collap</code>) to operate them. In
<em>data.table</em> words, everything<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Apart from &lt;code&gt;&lt;a href="../reference/BY.html"&gt;collapse::BY&lt;/a&gt;&lt;/code&gt; which is only an
auxiliary function written in base R to perform flexible split-apply
combine computing on vectors, matrices and data frames.&lt;/p&gt;'><sup>2</sup></a> in <em>collapse</em>, the <em>Fast
Statistical Functions</em>, data transformations, time series etc. is
GForce optimized.</p>
<p>The full set of optimized grouped statistical and transformation
functions in <em>collapse</em> is:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">.FAST_FUN</span></span>
<span><span class="co">#  [1] "fmean"      "fmedian"    "fmode"      "fsum"       "fprod"      "fsd"        "fvar"      </span></span>
<span><span class="co">#  [8] "fmin"       "fmax"       "fnth"       "ffirst"     "flast"      "fnobs"      "fndistinct"</span></span>
<span><span class="co"># [15] "fcumsum"    "fscale"     "fbetween"   "fwithin"    "fhdbetween" "fhdwithin"  "flag"      </span></span>
<span><span class="co"># [22] "fdiff"      "fgrowth"</span></span></code></pre></div>
<p>Additional optimized grouped functions include <code>TRA</code>,
<code>qsu</code>, <code>varying</code>, <code>fFtest</code>,
<code>psmat</code>, <code>psacf</code>, <code>pspacf</code>,
<code>psccf</code>.</p>
<p>The nice thing about those GForce (fast) functions provided by
<em>collapse</em> is that they can be accessed explicitly and
programmatically without any overhead as incurred through
<em>data.table</em>, they cover a broader range of statistical
operations (such as mode, distinct values, order statistics), support
sampling weights, operate in a class-agnostic way on vectors, matrices,
data.frame’s and many related classes, and cover transformations
(replacing and sweeping, scaling, (higher order) centering, linear
fitting) and time series functionality (lags, differences and growth
rates, including irregular time series and unbalanced panels).</p>
<!-- *collapse* allows you to do explicitly and programmatically with the *Fast Statistical Functions*. -->
<p>So if we would want to use <code>fmean</code> inside the
<em>data.table</em>, we should do something like this:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This does not save the grouping columns, we are simply passing a grouping vector to g</span></span>
<span><span class="co"># and aggregating the subset of the data table (.SD).</span></span>
<span><span class="va">DT</span><span class="op">[</span>, <span class="fu"><a href="../reference/fmean.html">fmean</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">country</span><span class="op">)</span>, .SDcols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">13</span><span class="op">]</span></span>
<span><span class="co">#           PCGDP   LIFEEX     GINI        ODA         POP</span></span>
<span><span class="co">#           &lt;num&gt;    &lt;num&gt;    &lt;num&gt;      &lt;num&gt;       &lt;num&gt;</span></span>
<span><span class="co">#   1:   483.8351 49.19717       NA 1487548499 18362258.22</span></span>
<span><span class="co">#   2:  2819.2400 71.68027 31.41111  312928126  2708297.17</span></span>
<span><span class="co">#   3:  3532.2714 63.56290 34.36667  612238500 25305290.68</span></span>
<span><span class="co">#   4: 10071.0659       NA       NA         NA    43115.10</span></span>
<span><span class="co">#   5: 40083.0911       NA       NA         NA    51547.35</span></span>
<span><span class="co">#  ---                                                    </span></span>
<span><span class="co"># 212: 35629.7336 73.71292       NA         NA    92238.53</span></span>
<span><span class="co"># 213:  2388.4348 71.60780 34.52500 1638581462  3312289.13</span></span>
<span><span class="co"># 214:  1069.6596 52.53707 35.46667  859950996 13741375.82</span></span>
<span><span class="co"># 215:  1318.8627 51.09263 52.68889  734624330  8614972.38</span></span>
<span><span class="co"># 216:  1219.4360 54.53360 45.93333  397104997  9402160.33</span></span>
<span></span>
<span><span class="co"># If we want to keep the grouping columns, we need to group .SD first.</span></span>
<span><span class="va">DT</span><span class="op">[</span>, <span class="fu"><a href="../reference/fmean.html">fmean</a></span><span class="op">(</span><span class="fu"><a href="https://sebkrantz.github.io/collapse/reference/GRP.html">gby</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">country</span><span class="op">)</span><span class="op">)</span>, .SDcols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">9</span><span class="op">:</span><span class="fl">13</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#                    country      PCGDP   LIFEEX     GINI        ODA         POP</span></span>
<span><span class="co">#                     &lt;char&gt;      &lt;num&gt;    &lt;num&gt;    &lt;num&gt;      &lt;num&gt;       &lt;num&gt;</span></span>
<span><span class="co">#   1:           Afghanistan   483.8351 49.19717       NA 1487548499 18362258.22</span></span>
<span><span class="co">#   2:               Albania  2819.2400 71.68027 31.41111  312928126  2708297.17</span></span>
<span><span class="co">#   3:               Algeria  3532.2714 63.56290 34.36667  612238500 25305290.68</span></span>
<span><span class="co">#   4:        American Samoa 10071.0659       NA       NA         NA    43115.10</span></span>
<span><span class="co">#   5:               Andorra 40083.0911       NA       NA         NA    51547.35</span></span>
<span><span class="co">#  ---                                                                          </span></span>
<span><span class="co"># 212: Virgin Islands (U.S.) 35629.7336 73.71292       NA         NA    92238.53</span></span>
<span><span class="co"># 213:    West Bank and Gaza  2388.4348 71.60780 34.52500 1638581462  3312289.13</span></span>
<span><span class="co"># 214:           Yemen, Rep.  1069.6596 52.53707 35.46667  859950996 13741375.82</span></span>
<span><span class="co"># 215:                Zambia  1318.8627 51.09263 52.68889  734624330  8614972.38</span></span>
<span><span class="co"># 216:              Zimbabwe  1219.4360 54.53360 45.93333  397104997  9402160.33</span></span></code></pre></div>
<p>Needless to say this kind of programming seems a bit arcane, so there
is actually not that great of a scope to use collapse’s <em>Fast
Statistical Functions</em> for aggregations inside <em>data.table</em>.
I drive this point home with a benchmark:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="va">DT</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://sebkrantz.github.io/collapse/reference/GRP.html">gby</a></span><span class="op">(</span><span class="va">country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="fl">9</span><span class="op">:</span><span class="fl">13</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">fmean</span>,</span>
<span>               data.table <span class="op">=</span> <span class="va">DT</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">mean</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, keyby <span class="op">=</span> <span class="va">country</span>, .SDcols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">13</span><span class="op">]</span>,</span>
<span>               data.table_base <span class="op">=</span> <span class="va">DT</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="fu">base</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, keyby <span class="op">=</span> <span class="va">country</span>, .SDcols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">13</span><span class="op">]</span>,</span>
<span>               hybrid_bad <span class="op">=</span> <span class="va">DT</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">fmean</span><span class="op">)</span>, keyby <span class="op">=</span> <span class="va">country</span>, .SDcols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">13</span><span class="op">]</span>,</span>
<span>               hybrid_ok <span class="op">=</span> <span class="va">DT</span><span class="op">[</span>, <span class="fu"><a href="../reference/fmean.html">fmean</a></span><span class="op">(</span><span class="fu"><a href="https://sebkrantz.github.io/collapse/reference/GRP.html">gby</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">country</span><span class="op">)</span><span class="op">)</span>, .SDcols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">9</span><span class="op">:</span><span class="fl">13</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># Unit: microseconds</span></span>
<span><span class="co">#             expr      min        lq      mean    median        uq       max neval</span></span>
<span><span class="co">#         collapse  207.419  234.9915  322.3994  255.6760  283.6790  1685.305   100</span></span>
<span><span class="co">#       data.table  755.630  845.7685 1029.9024  904.6650  962.1060  2409.529   100</span></span>
<span><span class="co">#  data.table_base 2795.257 3148.4310 4034.2081 3349.8025 3561.9570 37919.916   100</span></span>
<span><span class="co">#       hybrid_bad 2198.994 2481.3815 3737.1102 2650.5680 2909.4215 62158.747   100</span></span>
<span><span class="co">#        hybrid_ok  374.699  451.1025  564.6873  484.9275  542.8605  2082.554   100</span></span></code></pre></div>
<p>It is evident that <em>data.table</em> has some overhead, so there is
absolutely no need to do this kind of syntax manipulation.</p>
<p>There is more scope to use <em>collapse</em> transformation functions
inside <em>data.table</em>. <!--
Note that `:=` operations (transformations) are not GForce optimized in *data.table*, nor are any weighted computations. So *collapse* gives you a lot of extra speed on these areas. --></p>
<p>Below some basic examples:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Computing a column containing the sum of ODA received by country</span></span>
<span><span class="va">DT</span><span class="op">[</span>, <span class="va">sum_ODA</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">ODA</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">country</span><span class="op">]</span></span>
<span><span class="co"># Same using fsum; "replace_fill" overwrites missing values, "replace" keeps the</span></span>
<span><span class="va">DT</span><span class="op">[</span>, <span class="va">sum_ODA</span> <span class="op">:=</span> <span class="fu"><a href="../reference/fsum.html">fsum</a></span><span class="op">(</span><span class="va">ODA</span>, <span class="va">country</span>, TRA <span class="op">=</span> <span class="st">"replace_fill"</span><span class="op">)</span><span class="op">]</span>  </span>
<span><span class="co"># Same: A native collapse solution using settransform (or its shortcut form)</span></span>
<span><span class="fu"><a href="https://sebkrantz.github.io/collapse/reference/ftransform.html">settfm</a></span><span class="op">(</span><span class="va">DT</span>, sum_ODA <span class="op">=</span> <span class="fu"><a href="../reference/fsum.html">fsum</a></span><span class="op">(</span><span class="va">ODA</span>, <span class="va">country</span>, TRA <span class="op">=</span> <span class="st">"replace_fill"</span><span class="op">)</span><span class="op">)</span>  </span>
<span></span>
<span><span class="co"># settfm may be more convenient than `:=` for multiple column modifications,</span></span>
<span><span class="co"># each involving a different grouping:</span></span>
<span>  <span class="co"># This computes the percentage of total ODA distributed received by </span></span>
<span>  <span class="co"># each country both over time and within a given year</span></span>
<span><span class="fu"><a href="https://sebkrantz.github.io/collapse/reference/ftransform.html">settfm</a></span><span class="op">(</span><span class="va">DT</span>, perc_c_ODA <span class="op">=</span> <span class="fu"><a href="../reference/fsum.html">fsum</a></span><span class="op">(</span><span class="va">ODA</span>, <span class="va">country</span>, TRA <span class="op">=</span> <span class="st">"%"</span><span class="op">)</span>,</span>
<span>           perc_y_ODA <span class="op">=</span> <span class="fu"><a href="../reference/fsum.html">fsum</a></span><span class="op">(</span><span class="va">ODA</span>, <span class="va">year</span>, TRA <span class="op">=</span> <span class="st">"%"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The <code>TRA</code> argument is available to all <em>Fast
Statistical Functions</em> (see the macro <code>.FAST_STAT_FUN</code>)
and offers 10 different replacing and sweeping operations. Note that
<code><a href="../reference/TRA.html">TRA()</a></code> can also be called directly to replace or sweep with
a previously aggregated <em>data.table</em>. A set of operators
<code>%rr%</code>, <code>%r+%</code>, <code>%r-%</code>,
<code>%r*%</code>, <code>%r/%</code>, <code>%cr%</code>,
<code>%c+%</code>, <code>%c-%</code>, <code>%c*%</code>,
<code>%c/%</code> additionally facilitate row- or column-wise replacing
or sweeping out vectors of statistics or other
<em>data.table</em>’s.</p>
<p>Similarly, we can use the following vector valued functions</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">.FAST_FUN</span>, <span class="va">.FAST_STAT_FUN</span><span class="op">)</span></span>
<span><span class="co"># [1] "fcumsum"    "fscale"     "fbetween"   "fwithin"    "fhdbetween" "fhdwithin"  "flag"      </span></span>
<span><span class="co"># [8] "fdiff"      "fgrowth"</span></span></code></pre></div>
<p>for very efficient data transformations:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Centering GDP</span></span>
<span><span class="va">DT</span><span class="op">[</span>, <span class="va">demean_PCGDP</span> <span class="op">:=</span> <span class="va">PCGDP</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">PCGDP</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">country</span><span class="op">]</span></span>
<span><span class="va">DT</span><span class="op">[</span>, <span class="va">demean_PCGDP</span> <span class="op">:=</span> <span class="fu"><a href="../reference/fbetween_fwithin.html">fwithin</a></span><span class="op">(</span><span class="va">PCGDP</span>, <span class="va">country</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Lagging GDP</span></span>
<span><span class="va">DT</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>, <span class="va">lag_PCGDP</span> <span class="op">:=</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/shift.html" class="external-link">shift</a></span><span class="op">(</span><span class="va">PCGDP</span>, <span class="fl">1L</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">country</span><span class="op">]</span></span>
<span><span class="va">DT</span><span class="op">[</span>, <span class="va">lag_PCGDP</span> <span class="op">:=</span> <span class="fu"><a href="../reference/flag.html">flag</a></span><span class="op">(</span><span class="va">PCGDP</span>, <span class="fl">1L</span>, <span class="va">country</span>, <span class="va">year</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Computing a growth rate</span></span>
<span><span class="va">DT</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>, <span class="va">growth_PCGDP</span> <span class="op">:=</span> <span class="op">(</span><span class="va">PCGDP</span> <span class="op">/</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/shift.html" class="external-link">shift</a></span><span class="op">(</span><span class="va">PCGDP</span>, <span class="fl">1L</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, by <span class="op">=</span> <span class="va">country</span><span class="op">]</span></span>
<span><span class="va">DT</span><span class="op">[</span>, <span class="va">lag_PCGDP</span> <span class="op">:=</span> <span class="fu"><a href="../reference/fgrowth.html">fgrowth</a></span><span class="op">(</span><span class="va">PCGDP</span>, <span class="fl">1L</span>, <span class="fl">1L</span>, <span class="va">country</span>, <span class="va">year</span><span class="op">)</span><span class="op">]</span> <span class="co"># 1 lag, 1 iteration</span></span>
<span></span>
<span><span class="co"># Several Growth rates</span></span>
<span><span class="va">DT</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"growth_"</span>, <span class="fu"><a href="../reference/small-helpers.html">.c</a></span><span class="op">(</span><span class="va">PCGDP</span>, <span class="va">LIFEEX</span>, <span class="va">GINI</span>, <span class="va">ODA</span><span class="op">)</span><span class="op">)</span> <span class="op">:=</span> <span class="op">(</span><span class="va">.SD</span> <span class="op">/</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/shift.html" class="external-link">shift</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="fl">1L</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, </span>
<span>   by <span class="op">=</span> <span class="va">country</span>, .SDcols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">13</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Same thing using collapse</span></span>
<span><span class="va">DT</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> <span class="fu"><a href="https://sebkrantz.github.io/collapse/reference/ftransform.html">tfm</a></span><span class="op">(</span><span class="fu"><a href="https://sebkrantz.github.io/collapse/reference/select_replace_vars.html">gv</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">9</span><span class="op">:</span><span class="fl">13</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/fgrowth.html">fgrowth</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">1L</span>, <span class="va">country</span>, <span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/small-helpers.html">add_stub</a></span><span class="op">(</span><span class="st">"growth_"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Or even simpler using settransform and the Growth operator</span></span>
<span><span class="fu"><a href="https://sebkrantz.github.io/collapse/reference/ftransform.html">settfmv</a></span><span class="op">(</span><span class="va">DT</span>, <span class="fl">9</span><span class="op">:</span><span class="fl">13</span>, <span class="va">G</span>, <span class="fl">1L</span>, <span class="fl">1L</span>, <span class="va">country</span>, <span class="va">year</span>, apply <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">DT</span><span class="op">)</span></span>
<span><span class="co">#        country  iso3c       date  year decade     region     income   OECD PCGDP LIFEEX  GINI</span></span>
<span><span class="co">#         &lt;char&gt; &lt;fctr&gt;     &lt;Date&gt; &lt;int&gt;  &lt;int&gt;     &lt;fctr&gt;     &lt;fctr&gt; &lt;lgcl&gt; &lt;num&gt;  &lt;num&gt; &lt;num&gt;</span></span>
<span><span class="co"># 1: Afghanistan    AFG 1961-01-01  1960   1960 South Asia Low income  FALSE    NA 32.446    NA</span></span>
<span><span class="co"># 2: Afghanistan    AFG 1962-01-01  1961   1960 South Asia Low income  FALSE    NA 32.962    NA</span></span>
<span><span class="co"># 3: Afghanistan    AFG 1963-01-01  1962   1960 South Asia Low income  FALSE    NA 33.471    NA</span></span>
<span><span class="co"># 4: Afghanistan    AFG 1964-01-01  1963   1960 South Asia Low income  FALSE    NA 33.971    NA</span></span>
<span><span class="co"># 5: Afghanistan    AFG 1965-01-01  1964   1960 South Asia Low income  FALSE    NA 34.463    NA</span></span>
<span><span class="co"># 6: Afghanistan    AFG 1966-01-01  1965   1960 South Asia Low income  FALSE    NA 34.948    NA</span></span>
<span><span class="co">#          ODA     POP     sum_ODA perc_c_ODA perc_y_ODA demean_PCGDP lag_PCGDP growth_PCGDP</span></span>
<span><span class="co">#        &lt;num&gt;   &lt;num&gt;       &lt;num&gt;      &lt;num&gt;      &lt;num&gt;        &lt;num&gt;     &lt;num&gt;        &lt;num&gt;</span></span>
<span><span class="co"># 1: 116769997 8996973 89252909923  0.1308305  0.4441407           NA        NA           NA</span></span>
<span><span class="co"># 2: 232080002 9169410 89252909923  0.2600251  0.7356654           NA        NA           NA</span></span>
<span><span class="co"># 3: 112839996 9351441 89252909923  0.1264272  0.3494956           NA        NA           NA</span></span>
<span><span class="co"># 4: 237720001 9543205 89252909923  0.2663443  0.7003399           NA        NA           NA</span></span>
<span><span class="co"># 5: 295920013 9744781 89252909923  0.3315522  0.8570540           NA        NA           NA</span></span>
<span><span class="co"># 6: 341839996 9956320 89252909923  0.3830015  0.8992630           NA        NA           NA</span></span>
<span><span class="co">#    growth_LIFEEX growth_GINI growth_ODA growth_POP G1.PCGDP G1.LIFEEX G1.GINI    G1.ODA   G1.POP</span></span>
<span><span class="co">#            &lt;num&gt;       &lt;num&gt;      &lt;num&gt;      &lt;num&gt;    &lt;num&gt;     &lt;num&gt;   &lt;num&gt;     &lt;num&gt;    &lt;num&gt;</span></span>
<span><span class="co"># 1:            NA          NA         NA         NA       NA        NA      NA        NA       NA</span></span>
<span><span class="co"># 2:      1.590335          NA   98.74969   1.916611       NA  1.590335      NA  98.74969 1.916611</span></span>
<span><span class="co"># 3:      1.544202          NA  -51.37884   1.985199       NA  1.544202      NA -51.37884 1.985199</span></span>
<span><span class="co"># 4:      1.493830          NA  110.66998   2.050636       NA  1.493830      NA 110.66998 2.050636</span></span>
<span><span class="co"># 5:      1.448294          NA   24.48259   2.112246       NA  1.448294      NA  24.48259 2.112246</span></span>
<span><span class="co"># 6:      1.407306          NA   15.51770   2.170793       NA  1.407306      NA  15.51770 2.170793</span></span></code></pre></div>
<!--
# av(DT) <- DT %>% gby(country) %>% slt(year, 9:13) %>% 
#     fgrowth(1L, 1L, year, keep.ids = FALSE) %>% add_stub("growth_")
-->
<p>Since transformations (<code>:=</code> operations) are not highly
optimized in <em>data.table</em>, <em>collapse</em> will be faster in
most circumstances.
<!-- even on very large data with a strong computer. --> Also time
series functionality in <em>collapse</em> is significantly faster as it
does not require data to be ordered or balanced to compute. For example
<code>flag</code> computes an ordered lag without sorting the entire
data first.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Lets generate a large dataset and benchmark this stuff</span></span>
<span><span class="va">DT_large</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fu"><a href="../reference/quick-conversion.html">qDT</a></span><span class="op">(</span><span class="va">wlddev</span><span class="op">)</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">tfm</span>, country <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">country</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="va">rbindlist</span></span>
<span></span>
<span><span class="co"># 12.7 million Obs</span></span>
<span><span class="fu"><a href="../reference/efficient-programming.html">fdim</a></span><span class="op">(</span><span class="va">DT_large</span><span class="op">)</span></span>
<span><span class="co"># [1] 13176000       13</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>  S1 <span class="op">=</span> <span class="va">DT_large</span><span class="op">[</span>, <span class="va">sum_ODA</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">ODA</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">country</span><span class="op">]</span>,</span>
<span>  S2 <span class="op">=</span> <span class="va">DT_large</span><span class="op">[</span>, <span class="va">sum_ODA</span> <span class="op">:=</span> <span class="fu"><a href="../reference/fsum.html">fsum</a></span><span class="op">(</span><span class="va">ODA</span>, <span class="va">country</span>, TRA <span class="op">=</span> <span class="st">"replace_fill"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  S3 <span class="op">=</span> <span class="fu"><a href="https://sebkrantz.github.io/collapse/reference/ftransform.html">settfm</a></span><span class="op">(</span><span class="va">DT_large</span>, sum_ODA <span class="op">=</span> <span class="fu"><a href="../reference/fsum.html">fsum</a></span><span class="op">(</span><span class="va">ODA</span>, <span class="va">country</span>, TRA <span class="op">=</span> <span class="st">"replace_fill"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  W1 <span class="op">=</span> <span class="va">DT_large</span><span class="op">[</span>, <span class="va">demean_PCGDP</span> <span class="op">:=</span> <span class="va">PCGDP</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">PCGDP</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">country</span><span class="op">]</span>,</span>
<span>  W2 <span class="op">=</span> <span class="va">DT_large</span><span class="op">[</span>, <span class="va">demean_PCGDP</span> <span class="op">:=</span> <span class="fu"><a href="../reference/fbetween_fwithin.html">fwithin</a></span><span class="op">(</span><span class="va">PCGDP</span>, <span class="va">country</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  L1 <span class="op">=</span> <span class="va">DT_large</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>, <span class="va">lag_PCGDP</span> <span class="op">:=</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/shift.html" class="external-link">shift</a></span><span class="op">(</span><span class="va">PCGDP</span>, <span class="fl">1L</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">country</span><span class="op">]</span>,</span>
<span>  L2 <span class="op">=</span> <span class="va">DT_large</span><span class="op">[</span>, <span class="va">lag_PCGDP</span> <span class="op">:=</span> <span class="fu"><a href="../reference/flag.html">flag</a></span><span class="op">(</span><span class="va">PCGDP</span>, <span class="fl">1L</span>, <span class="va">country</span>, <span class="va">year</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  L3 <span class="op">=</span> <span class="va">DT_large</span><span class="op">[</span>, <span class="va">lag_PCGDP</span> <span class="op">:=</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/shift.html" class="external-link">shift</a></span><span class="op">(</span><span class="va">PCGDP</span>, <span class="fl">1L</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">country</span><span class="op">]</span>, <span class="co"># Not ordered</span></span>
<span>  L4 <span class="op">=</span> <span class="va">DT_large</span><span class="op">[</span>, <span class="va">lag_PCGDP</span> <span class="op">:=</span> <span class="fu"><a href="../reference/flag.html">flag</a></span><span class="op">(</span><span class="va">PCGDP</span>, <span class="fl">1L</span>, <span class="va">country</span><span class="op">)</span><span class="op">]</span>, <span class="co"># Not ordered</span></span>
<span>  times <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#  expr        min         lq      mean     median        uq       max neval</span></span>
<span><span class="co">#    S1  343.03396  347.18443  391.7494  364.51431  379.7866  524.2279     5</span></span>
<span><span class="co">#    S2  100.52544  101.72645  165.8369  128.76042  153.6818  344.4906     5</span></span>
<span><span class="co">#    S3   98.48249  104.80830  120.3499  114.20591  127.0192  157.2335     5</span></span>
<span><span class="co">#    W1  913.00883 1009.29930 1071.0633 1035.74446 1104.7680 1292.4957     5</span></span>
<span><span class="co">#    W2   99.48199   99.69654  110.0907  113.95884  118.5229  118.7931     5</span></span>
<span><span class="co">#    L1 1812.59987 1822.58026 1896.8809 1905.67377 1942.9434 2000.6074     5</span></span>
<span><span class="co">#    L2  110.36056  128.45845  135.0995  133.80219  139.1405  163.7357     5</span></span>
<span><span class="co">#    L3  611.28392  665.22123  768.0616  718.38679  803.7170 1041.6991     5</span></span>
<span><span class="co">#    L4   64.26369   66.99006  105.7952   84.26537  106.1809  207.2758     5</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">DT_large</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#           used  (Mb) gc trigger   (Mb) limit (Mb)  max used   (Mb)</span></span>
<span><span class="co"># Ncells 3113072 166.3    8413097  449.4         NA   8413097  449.4</span></span>
<span><span class="co"># Vcells 7897587  60.3  324289364 2474.2      16384 405361681 3092.7</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="further-collapse-features-supporting-data-tables">Further <em>collapse</em> features supporting
<em>data.table</em>’s<a class="anchor" aria-label="anchor" href="#further-collapse-features-supporting-data-tables"></a>
</h2>
<p>As mentioned, <code>qDT</code> is a flexible and very fast function
to create / column-wise convert R objects to <em>data.table</em>’s. You
can also row-wise convert a matrix to data.table using
<code>mrtl</code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Creating a matrix from mtcars</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quick-conversion.html">qM</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span><span class="co">#  num [1:32, 1:11] 21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...</span></span>
<span><span class="co">#  - attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#   ..$ : chr [1:32] "Mazda RX4" "Mazda RX4 Wag" "Datsun 710" "Hornet 4 Drive" ...</span></span>
<span><span class="co">#   ..$ : chr [1:11] "mpg" "cyl" "disp" "hp" ...</span></span>
<span></span>
<span><span class="co"># Demonstrating another nice feature of qDT</span></span>
<span><span class="fu"><a href="../reference/quick-conversion.html">qDT</a></span><span class="op">(</span><span class="va">m</span>, row.names.col <span class="op">=</span> <span class="st">"car"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">head</span></span>
<span><span class="co">#                  car   mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb</span></span>
<span><span class="co">#               &lt;char&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;</span></span>
<span><span class="co"># 1:         Mazda RX4  21.0     6   160   110  3.90 2.620 16.46     0     1     4     4</span></span>
<span><span class="co"># 2:     Mazda RX4 Wag  21.0     6   160   110  3.90 2.875 17.02     0     1     4     4</span></span>
<span><span class="co"># 3:        Datsun 710  22.8     4   108    93  3.85 2.320 18.61     1     1     4     1</span></span>
<span><span class="co"># 4:    Hornet 4 Drive  21.4     6   258   110  3.08 3.215 19.44     1     0     3     1</span></span>
<span><span class="co"># 5: Hornet Sportabout  18.7     8   360   175  3.15 3.440 17.02     0     0     3     2</span></span>
<span><span class="co"># 6:           Valiant  18.1     6   225   105  2.76 3.460 20.22     1     0     3     1</span></span>
<span></span>
<span><span class="co"># Row-wise conversion to data.table</span></span>
<span><span class="fu"><a href="../reference/quick-conversion.html">mrtl</a></span><span class="op">(</span><span class="va">m</span>, names <span class="op">=</span> <span class="cn">TRUE</span>, return <span class="op">=</span> <span class="st">"data.table"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#    Mazda RX4 Mazda RX4 Wag Datsun 710 Hornet 4 Drive Hornet Sportabout Valiant Duster 360 Merc 240D</span></span>
<span><span class="co">#        &lt;num&gt;         &lt;num&gt;      &lt;num&gt;          &lt;num&gt;             &lt;num&gt;   &lt;num&gt;      &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co"># 1:        21            21       22.8           21.4              18.7    18.1       14.3      24.4</span></span>
<span><span class="co"># 2:         6             6        4.0            6.0               8.0     6.0        8.0       4.0</span></span>
<span><span class="co">#    Merc 230 Merc 280 Merc 280C Merc 450SE Merc 450SL Merc 450SLC Cadillac Fleetwood</span></span>
<span><span class="co">#       &lt;num&gt;    &lt;num&gt;     &lt;num&gt;      &lt;num&gt;      &lt;num&gt;       &lt;num&gt;              &lt;num&gt;</span></span>
<span><span class="co"># 1:     22.8     19.2      17.8       16.4       17.3        15.2               10.4</span></span>
<span><span class="co"># 2:      4.0      6.0       6.0        8.0        8.0         8.0                8.0</span></span>
<span><span class="co">#    Lincoln Continental Chrysler Imperial Fiat 128 Honda Civic Toyota Corolla Toyota Corona</span></span>
<span><span class="co">#                  &lt;num&gt;             &lt;num&gt;    &lt;num&gt;       &lt;num&gt;          &lt;num&gt;         &lt;num&gt;</span></span>
<span><span class="co"># 1:                10.4              14.7     32.4        30.4           33.9          21.5</span></span>
<span><span class="co"># 2:                 8.0               8.0      4.0         4.0            4.0           4.0</span></span>
<span><span class="co">#    Dodge Challenger AMC Javelin Camaro Z28 Pontiac Firebird Fiat X1-9 Porsche 914-2 Lotus Europa</span></span>
<span><span class="co">#               &lt;num&gt;       &lt;num&gt;      &lt;num&gt;            &lt;num&gt;     &lt;num&gt;         &lt;num&gt;        &lt;num&gt;</span></span>
<span><span class="co"># 1:             15.5        15.2       13.3             19.2      27.3            26         30.4</span></span>
<span><span class="co"># 2:              8.0         8.0        8.0              8.0       4.0             4          4.0</span></span>
<span><span class="co">#    Ford Pantera L Ferrari Dino Maserati Bora Volvo 142E</span></span>
<span><span class="co">#             &lt;num&gt;        &lt;num&gt;         &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co"># 1:           15.8         19.7            15       21.4</span></span>
<span><span class="co"># 2:            8.0          6.0             8        4.0</span></span></code></pre></div>
<p>The computational efficiency of these functions makes them very
useful to use in <em>data.table</em> based workflows.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Benchmark</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/quick-conversion.html">qDT</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"car"</span><span class="op">)</span>, <span class="fu"><a href="../reference/quick-conversion.html">mrtl</a></span><span class="op">(</span><span class="va">m</span>, <span class="cn">TRUE</span>, <span class="st">"data.table"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Unit: microseconds</span></span>
<span><span class="co">#                         expr   min    lq    mean median    uq    max neval</span></span>
<span><span class="co">#                qDT(m, "car") 4.838 5.043 6.16230 5.3300 6.437 20.049   100</span></span>
<span><span class="co">#  mrtl(m, TRUE, "data.table") 3.608 3.854 4.23981 3.9975 4.182 15.908   100</span></span></code></pre></div>
<p>For example we could regress the growth rate of GDP per capita on the
Growth rate of life expectancy in each country and save results in a
<em>data.table</em>:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">lmtest</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wlddev</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">PCGDP</span>, <span class="va">LIFEEX</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># This counts missing values on PCGDP and LIFEEX only</span></span>
<span>  <span class="fu"><a href="../reference/efficient-programming.html">na_omit</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="fl">1L</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># This removes countries with less than 20 observations</span></span>
<span>  <span class="fu"><a href="../reference/fsubset.html">fsubset</a></span><span class="op">(</span><span class="fu"><a href="../reference/fnobs.html">fnobs</a></span><span class="op">(</span><span class="va">PCGDP</span>, <span class="va">country</span>, <span class="st">"replace_fill"</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">20L</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="va">qDT</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># Run estimations by country using data.table</span></span>
<span>  <span class="va">.</span><span class="op">[</span>, <span class="fu"><a href="../reference/quick-conversion.html">qDT</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/coeftest.html" class="external-link">coeftest</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="../reference/fgrowth.html">G</a></span><span class="op">(</span><span class="va">PCGDP</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="../reference/fgrowth.html">G</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="st">"Coef"</span><span class="op">)</span>, keyby <span class="op">=</span> <span class="va">country</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">head</span></span>
<span><span class="co"># Key: &lt;country&gt;</span></span>
<span><span class="co">#    country        Coef   Estimate Std. Error    t value    Pr(&gt;|t|)</span></span>
<span><span class="co">#     &lt;char&gt;      &lt;char&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;       &lt;num&gt;</span></span>
<span><span class="co"># 1: Albania (Intercept) -3.6146411   2.371885 -1.5239527 0.136023086</span></span>
<span><span class="co"># 2: Albania   G(LIFEEX) 22.1596308   7.288971  3.0401591 0.004325856</span></span>
<span><span class="co"># 3: Algeria (Intercept)  0.5973329   1.740619  0.3431726 0.732731107</span></span>
<span><span class="co"># 4: Algeria   G(LIFEEX)  0.8412547   1.689221  0.4980134 0.620390703</span></span>
<span><span class="co"># 5:  Angola (Intercept) -3.3793976   1.540330 -2.1939445 0.034597175</span></span>
<span><span class="co"># 6:  Angola   G(LIFEEX)  4.2362895   1.402380  3.0207852 0.004553260</span></span></code></pre></div>
<p>If we only need the coefficients, not the standard errors, we can
also use <code><a href="../reference/flm.html">collapse::flm</a></code> together with <code>mrtl</code>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wlddev</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">PCGDP</span>, <span class="va">LIFEEX</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/efficient-programming.html">na_omit</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="fl">1L</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/fsubset.html">fsubset</a></span><span class="op">(</span><span class="fu"><a href="../reference/fnobs.html">fnobs</a></span><span class="op">(</span><span class="va">PCGDP</span>, <span class="va">country</span>, <span class="st">"replace_fill"</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">20L</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="va">qDT</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="va">.</span><span class="op">[</span>, <span class="fu"><a href="../reference/quick-conversion.html">mrtl</a></span><span class="op">(</span><span class="fu"><a href="../reference/flm.html">flm</a></span><span class="op">(</span><span class="fu"><a href="../reference/fgrowth.html">fgrowth</a></span><span class="op">(</span><span class="va">PCGDP</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1L</span><span class="op">]</span>, </span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>Intercept <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                     LIFEEX <span class="op">=</span> <span class="fu"><a href="../reference/fgrowth.html">fgrowth</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1L</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>    keyby <span class="op">=</span> <span class="va">country</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">head</span></span>
<span><span class="co"># Key: &lt;country&gt;</span></span>
<span><span class="co">#                country   Intercept     LIFEEX</span></span>
<span><span class="co">#                 &lt;char&gt;       &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co"># 1:             Albania -3.61464113 22.1596308</span></span>
<span><span class="co"># 2:             Algeria  0.59733291  0.8412547</span></span>
<span><span class="co"># 3:              Angola -3.37939760  4.2362895</span></span>
<span><span class="co"># 4: Antigua and Barbuda -3.11880717 18.8700870</span></span>
<span><span class="co"># 5:           Argentina  1.14613567 -0.2896305</span></span>
<span><span class="co"># 6:             Armenia  0.08178344 11.5523992</span></span></code></pre></div>
<p>… which provides a significant speed gain here:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>  </span>
<span>A <span class="op">=</span> <span class="va">wlddev</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">PCGDP</span>, <span class="va">LIFEEX</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/efficient-programming.html">na_omit</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="fl">1L</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/fsubset.html">fsubset</a></span><span class="op">(</span><span class="fu"><a href="../reference/fnobs.html">fnobs</a></span><span class="op">(</span><span class="va">PCGDP</span>, <span class="va">country</span>, <span class="st">"replace_fill"</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">20L</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="va">qDT</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="va">.</span><span class="op">[</span>, <span class="fu"><a href="../reference/quick-conversion.html">qDT</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/coeftest.html" class="external-link">coeftest</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="../reference/fgrowth.html">G</a></span><span class="op">(</span><span class="va">PCGDP</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="../reference/fgrowth.html">G</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="st">"Coef"</span><span class="op">)</span>, keyby <span class="op">=</span> <span class="va">country</span><span class="op">]</span>,</span>
<span></span>
<span>B <span class="op">=</span> <span class="va">wlddev</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">PCGDP</span>, <span class="va">LIFEEX</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/efficient-programming.html">na_omit</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="fl">1L</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/fsubset.html">fsubset</a></span><span class="op">(</span><span class="fu"><a href="../reference/fnobs.html">fnobs</a></span><span class="op">(</span><span class="va">PCGDP</span>, <span class="va">country</span>, <span class="st">"replace_fill"</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">20L</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="va">qDT</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="va">.</span><span class="op">[</span>, <span class="fu"><a href="../reference/quick-conversion.html">mrtl</a></span><span class="op">(</span><span class="fu"><a href="../reference/flm.html">flm</a></span><span class="op">(</span><span class="fu"><a href="../reference/fgrowth.html">fgrowth</a></span><span class="op">(</span><span class="va">PCGDP</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1L</span><span class="op">]</span>, </span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>Intercept <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                     LIFEEX <span class="op">=</span> <span class="fu"><a href="../reference/fgrowth.html">fgrowth</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1L</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>    keyby <span class="op">=</span> <span class="va">country</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#  expr       min        lq      mean    median        uq        max neval</span></span>
<span><span class="co">#     A 58.914253 60.063381 68.770933 60.865217 73.507813 241.594509   100</span></span>
<span><span class="co">#     B  3.145766  3.293715  3.463643  3.377006  3.503983   5.378995   100</span></span></code></pre></div>
<p>Another feature to highlight at this point are <em>collapse</em>’s
list processing functions, in particular <code>rsplit</code>,
<code>rapply2d</code>, <code>get_elem</code> and <code>unlist2d</code>.
<code>rsplit</code> is an efficient recursive generalization of
<code>split</code>:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DT_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rsplit.html">rsplit</a></span><span class="op">(</span><span class="va">DT</span>, <span class="va">country</span> <span class="op">+</span> <span class="va">year</span> <span class="op">+</span> <span class="va">PCGDP</span> <span class="op">+</span> <span class="va">LIFEEX</span> <span class="op">~</span> <span class="va">region</span> <span class="op">+</span> <span class="va">income</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Note: rsplit(DT, year + PCGDP + LIFEEX ~ region + income, flatten = TRUE) </span></span>
<span><span class="co"># would yield a simple list with interacted categories (like split) </span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">DT_list</span>, give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># List of 7</span></span>
<span><span class="co">#  $ East Asia &amp; Pacific       :List of 3</span></span>
<span><span class="co">#   ..$ High income        :Classes 'data.table' and 'data.frame':  793 obs. of  4 variables:</span></span>
<span><span class="co">#   .. ..$ country: chr [1:793] "Australia" "Australia" "Australia" "Australia" ...</span></span>
<span><span class="co">#   .. ..$ year   : int [1:793] 1960 1961 1962 1963 1964 1965 1966 1967 1968 1969 ...</span></span>
<span><span class="co">#   .. ..$ PCGDP  : num [1:793] 19378 19469 19246 20053 21036 ...</span></span>
<span><span class="co">#   .. ..$ LIFEEX : num [1:793] 70.8 71 70.9 70.9 70.9 ...</span></span>
<span><span class="co">#   ..$ Lower middle income:Classes 'data.table' and 'data.frame':  793 obs. of  4 variables:</span></span>
<span><span class="co">#   .. ..$ country: chr [1:793] "Cambodia" "Cambodia" "Cambodia" "Cambodia" ...</span></span>
<span><span class="co">#   .. ..$ year   : int [1:793] 1960 1961 1962 1963 1964 1965 1966 1967 1968 1969 ...</span></span>
<span><span class="co">#   .. ..$ PCGDP  : num [1:793] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#   .. ..$ LIFEEX : num [1:793] 41.2 41.4 41.5 41.7 41.9 ...</span></span>
<span><span class="co">#   ..$ Upper middle income:Classes 'data.table' and 'data.frame':  610 obs. of  4 variables:</span></span>
<span><span class="co">#   .. ..$ country: chr [1:610] "American Samoa" "American Samoa" "American Samoa" "American Samoa" ...</span></span>
<span><span class="co">#   .. ..$ year   : int [1:610] 1960 1961 1962 1963 1964 1965 1966 1967 1968 1969 ...</span></span>
<span><span class="co">#   .. ..$ PCGDP  : num [1:610] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#   .. ..$ LIFEEX : num [1:610] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#  $ Europe &amp; Central Asia     :List of 4</span></span>
<span><span class="co">#   ..$ High income        :Classes 'data.table' and 'data.frame':  2257 obs. of  4 variables:</span></span>
<span><span class="co">#   .. ..$ country: chr [1:2257] "Andorra" "Andorra" "Andorra" "Andorra" ...</span></span>
<span><span class="co">#   .. ..$ year   : int [1:2257] 1960 1961 1962 1963 1964 1965 1966 1967 1968 1969 ...</span></span>
<span><span class="co">#   .. ..$ PCGDP  : num [1:2257] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#   .. ..$ LIFEEX : num [1:2257] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#   ..$ Low income         :Classes 'data.table' and 'data.frame':  61 obs. of  4 variables:</span></span>
<span><span class="co">#   .. ..$ country: chr [1:61] "Tajikistan" "Tajikistan" "Tajikistan" "Tajikistan" ...</span></span>
<span><span class="co">#   .. ..$ year   : int [1:61] 1960 1961 1962 1963 1964 1965 1966 1967 1968 1969 ...</span></span>
<span><span class="co">#   .. ..$ PCGDP  : num [1:61] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#   .. ..$ LIFEEX : num [1:61] 50.6 50.9 51.2 51.5 51.9 ...</span></span>
<span><span class="co">#   ..$ Lower middle income:Classes 'data.table' and 'data.frame':  244 obs. of  4 variables:</span></span>
<span><span class="co">#   .. ..$ country: chr [1:244] "Kyrgyz Republic" "Kyrgyz Republic" "Kyrgyz Republic" "Kyrgyz Republic" ...</span></span>
<span><span class="co">#   .. ..$ year   : int [1:244] 1960 1961 1962 1963 1964 1965 1966 1967 1968 1969 ...</span></span>
<span><span class="co">#   .. ..$ PCGDP  : num [1:244] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#   .. ..$ LIFEEX : num [1:244] 56.1 56.6 57 57.4 57.9 ...</span></span>
<span><span class="co">#   ..$ Upper middle income:Classes 'data.table' and 'data.frame':  976 obs. of  4 variables:</span></span>
<span><span class="co">#   .. ..$ country: chr [1:976] "Albania" "Albania" "Albania" "Albania" ...</span></span>
<span><span class="co">#   .. ..$ year   : int [1:976] 1960 1961 1962 1963 1964 1965 1966 1967 1968 1969 ...</span></span>
<span><span class="co">#   .. ..$ PCGDP  : num [1:976] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#   .. ..$ LIFEEX : num [1:976] 62.3 63.3 64.2 64.9 65.5 ...</span></span>
<span><span class="co">#  $ Latin America &amp; Caribbean :List of 4</span></span>
<span><span class="co">#   ..$ High income        :Classes 'data.table' and 'data.frame':  1037 obs. of  4 variables:</span></span>
<span><span class="co">#   .. ..$ country: chr [1:1037] "Antigua and Barbuda" "Antigua and Barbuda" "Antigua and Barbuda" "Antigua and Barbuda" ...</span></span>
<span><span class="co">#   .. ..$ year   : int [1:1037] 1960 1961 1962 1963 1964 1965 1966 1967 1968 1969 ...</span></span>
<span><span class="co">#   .. ..$ PCGDP  : num [1:1037] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#   .. ..$ LIFEEX : num [1:1037] 62 62.5 63 63.5 64 ...</span></span>
<span><span class="co">#   ..$ Low income         :Classes 'data.table' and 'data.frame':  61 obs. of  4 variables:</span></span>
<span><span class="co">#   .. ..$ country: chr [1:61] "Haiti" "Haiti" "Haiti" "Haiti" ...</span></span>
<span><span class="co">#   .. ..$ year   : int [1:61] 1960 1961 1962 1963 1964 1965 1966 1967 1968 1969 ...</span></span>
<span><span class="co">#   .. ..$ PCGDP  : num [1:61] 1512 1439 1523 1466 1414 ...</span></span>
<span><span class="co">#   .. ..$ LIFEEX : num [1:61] 41.8 42.2 42.6 43 43.4 ...</span></span>
<span><span class="co">#   ..$ Lower middle income:Classes 'data.table' and 'data.frame':  244 obs. of  4 variables:</span></span>
<span><span class="co">#   .. ..$ country: chr [1:244] "Bolivia" "Bolivia" "Bolivia" "Bolivia" ...</span></span>
<span><span class="co">#   .. ..$ year   : int [1:244] 1960 1961 1962 1963 1964 1965 1966 1967 1968 1969 ...</span></span>
<span><span class="co">#   .. ..$ PCGDP  : num [1:244] 1005 1007 1042 1091 1112 ...</span></span>
<span><span class="co">#   .. ..$ LIFEEX : num [1:244] 41.8 42.1 42.5 42.8 43.2 ...</span></span>
<span><span class="co">#   ..$ Upper middle income:Classes 'data.table' and 'data.frame':  1220 obs. of  4 variables:</span></span>
<span><span class="co">#   .. ..$ country: chr [1:1220] "Argentina" "Argentina" "Argentina" "Argentina" ...</span></span>
<span><span class="co">#   .. ..$ year   : int [1:1220] 1960 1961 1962 1963 1964 1965 1966 1967 1968 1969 ...</span></span>
<span><span class="co">#   .. ..$ PCGDP  : num [1:1220] 5643 5853 5711 5323 5773 ...</span></span>
<span><span class="co">#   .. ..$ LIFEEX : num [1:1220] 65.1 65.2 65.3 65.3 65.4 ...</span></span>
<span><span class="co">#  $ Middle East &amp; North Africa:List of 4</span></span>
<span><span class="co">#   ..$ High income        :Classes 'data.table' and 'data.frame':  488 obs. of  4 variables:</span></span>
<span><span class="co">#   .. ..$ country: chr [1:488] "Bahrain" "Bahrain" "Bahrain" "Bahrain" ...</span></span>
<span><span class="co">#   .. ..$ year   : int [1:488] 1960 1961 1962 1963 1964 1965 1966 1967 1968 1969 ...</span></span>
<span><span class="co">#   .. ..$ PCGDP  : num [1:488] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#   .. ..$ LIFEEX : num [1:488] 51.9 53.2 54.6 55.9 57.2 ...</span></span>
<span><span class="co">#   ..$ Low income         :Classes 'data.table' and 'data.frame':  122 obs. of  4 variables:</span></span>
<span><span class="co">#   .. ..$ country: chr [1:122] "Syrian Arab Republic" "Syrian Arab Republic" "Syrian Arab Republic" "Syrian Arab Republic" ...</span></span>
<span><span class="co">#   .. ..$ year   : int [1:122] 1960 1961 1962 1963 1964 1965 1966 1967 1968 1969 ...</span></span>
<span><span class="co">#   .. ..$ PCGDP  : num [1:122] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#   .. ..$ LIFEEX : num [1:122] 52 52.6 53.2 53.8 54.4 ...</span></span>
<span><span class="co">#   ..$ Lower middle income:Classes 'data.table' and 'data.frame':  305 obs. of  4 variables:</span></span>
<span><span class="co">#   .. ..$ country: chr [1:305] "Djibouti" "Djibouti" "Djibouti" "Djibouti" ...</span></span>
<span><span class="co">#   .. ..$ year   : int [1:305] 1960 1961 1962 1963 1964 1965 1966 1967 1968 1969 ...</span></span>
<span><span class="co">#   .. ..$ PCGDP  : num [1:305] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#   .. ..$ LIFEEX : num [1:305] 44 44.5 44.9 45.3 45.7 ...</span></span>
<span><span class="co">#   ..$ Upper middle income:Classes 'data.table' and 'data.frame':  366 obs. of  4 variables:</span></span>
<span><span class="co">#   .. ..$ country: chr [1:366] "Algeria" "Algeria" "Algeria" "Algeria" ...</span></span>
<span><span class="co">#   .. ..$ year   : int [1:366] 1960 1961 1962 1963 1964 1965 1966 1967 1968 1969 ...</span></span>
<span><span class="co">#   .. ..$ PCGDP  : num [1:366] 2481 2091 1638 2146 2214 ...</span></span>
<span><span class="co">#   .. ..$ LIFEEX : num [1:366] 46.1 46.6 47.1 47.5 48 ...</span></span>
<span><span class="co">#  $ North America             :List of 1</span></span>
<span><span class="co">#   ..$ High income:Classes 'data.table' and 'data.frame':  183 obs. of  4 variables:</span></span>
<span><span class="co">#   .. ..$ country: chr [1:183] "Bermuda" "Bermuda" "Bermuda" "Bermuda" ...</span></span>
<span><span class="co">#   .. ..$ year   : int [1:183] 1960 1961 1962 1963 1964 1965 1966 1967 1968 1969 ...</span></span>
<span><span class="co">#   .. ..$ PCGDP  : num [1:183] 33363 34080 34763 34324 37202 ...</span></span>
<span><span class="co">#   .. ..$ LIFEEX : num [1:183] NA NA NA NA NA ...</span></span>
<span><span class="co">#  $ South Asia                :List of 3</span></span>
<span><span class="co">#   ..$ Low income         :Classes 'data.table' and 'data.frame':  122 obs. of  4 variables:</span></span>
<span><span class="co">#   .. ..$ country: chr [1:122] "Afghanistan" "Afghanistan" "Afghanistan" "Afghanistan" ...</span></span>
<span><span class="co">#   .. ..$ year   : int [1:122] 1960 1961 1962 1963 1964 1965 1966 1967 1968 1969 ...</span></span>
<span><span class="co">#   .. ..$ PCGDP  : num [1:122] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#   .. ..$ LIFEEX : num [1:122] 32.4 33 33.5 34 34.5 ...</span></span>
<span><span class="co">#   ..$ Lower middle income:Classes 'data.table' and 'data.frame':  244 obs. of  4 variables:</span></span>
<span><span class="co">#   .. ..$ country: chr [1:244] "Bangladesh" "Bangladesh" "Bangladesh" "Bangladesh" ...</span></span>
<span><span class="co">#   .. ..$ year   : int [1:244] 1960 1961 1962 1963 1964 1965 1966 1967 1968 1969 ...</span></span>
<span><span class="co">#   .. ..$ PCGDP  : num [1:244] 372 384 394 381 411 ...</span></span>
<span><span class="co">#   .. ..$ LIFEEX : num [1:244] 45.4 46 46.6 47.1 47.6 ...</span></span>
<span><span class="co">#   ..$ Upper middle income:Classes 'data.table' and 'data.frame':  122 obs. of  4 variables:</span></span>
<span><span class="co">#   .. ..$ country: chr [1:122] "Maldives" "Maldives" "Maldives" "Maldives" ...</span></span>
<span><span class="co">#   .. ..$ year   : int [1:122] 1960 1961 1962 1963 1964 1965 1966 1967 1968 1969 ...</span></span>
<span><span class="co">#   .. ..$ PCGDP  : num [1:122] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#   .. ..$ LIFEEX : num [1:122] 37.3 37.9 38.6 39.2 39.9 ...</span></span>
<span><span class="co">#  $ Sub-Saharan Africa        :List of 4</span></span>
<span><span class="co">#   ..$ High income        :Classes 'data.table' and 'data.frame':  61 obs. of  4 variables:</span></span>
<span><span class="co">#   .. ..$ country: chr [1:61] "Seychelles" "Seychelles" "Seychelles" "Seychelles" ...</span></span>
<span><span class="co">#   .. ..$ year   : int [1:61] 1960 1961 1962 1963 1964 1965 1966 1967 1968 1969 ...</span></span>
<span><span class="co">#   .. ..$ PCGDP  : num [1:61] 2830 2617 2763 2966 3064 ...</span></span>
<span><span class="co">#   .. ..$ LIFEEX : num [1:61] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#   ..$ Low income         :Classes 'data.table' and 'data.frame':  1464 obs. of  4 variables:</span></span>
<span><span class="co">#   .. ..$ country: chr [1:1464] "Benin" "Benin" "Benin" "Benin" ...</span></span>
<span><span class="co">#   .. ..$ year   : int [1:1464] 1960 1961 1962 1963 1964 1965 1966 1967 1968 1969 ...</span></span>
<span><span class="co">#   .. ..$ PCGDP  : num [1:1464] 712 724 689 710 745 ...</span></span>
<span><span class="co">#   .. ..$ LIFEEX : num [1:1464] 37.3 37.7 38.2 38.7 39.1 ...</span></span>
<span><span class="co">#   ..$ Lower middle income:Classes 'data.table' and 'data.frame':  1037 obs. of  4 variables:</span></span>
<span><span class="co">#   .. ..$ country: chr [1:1037] "Angola" "Angola" "Angola" "Angola" ...</span></span>
<span><span class="co">#   .. ..$ year   : int [1:1037] 1960 1961 1962 1963 1964 1965 1966 1967 1968 1969 ...</span></span>
<span><span class="co">#   .. ..$ PCGDP  : num [1:1037] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#   .. ..$ LIFEEX : num [1:1037] 37.5 37.8 38.1 38.4 38.8 ...</span></span>
<span><span class="co">#   ..$ Upper middle income:Classes 'data.table' and 'data.frame':  366 obs. of  4 variables:</span></span>
<span><span class="co">#   .. ..$ country: chr [1:366] "Botswana" "Botswana" "Botswana" "Botswana" ...</span></span>
<span><span class="co">#   .. ..$ year   : int [1:366] 1960 1961 1962 1963 1964 1965 1966 1967 1968 1969 ...</span></span>
<span><span class="co">#   .. ..$ PCGDP  : num [1:366] 408 425 444 460 480 ...</span></span>
<span><span class="co">#   .. ..$ LIFEEX : num [1:366] 49.2 49.7 50.2 50.6 51.1 ...</span></span></code></pre></div>
<p>We can use <code>rapply2d</code> to apply a function to each data
frame / data.table in an arbitrary nested structure:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This runs region-income level regressions, with country fixed effects</span></span>
<span><span class="co"># following Mundlak (1978)</span></span>
<span><span class="va">lm_summary_list</span> <span class="op">&lt;-</span> <span class="va">DT_list</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/rapply2d.html">rapply2d</a></span><span class="op">(</span><span class="va">lm</span>, formula <span class="op">=</span> <span class="fu"><a href="../reference/fgrowth.html">G</a></span><span class="op">(</span><span class="va">PCGDP</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="../reference/fgrowth.html">G</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/fbetween_fwithin.html">B</a></span><span class="op">(</span><span class="fu"><a href="../reference/fgrowth.html">G</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span>, <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># Summarizing the results</span></span>
<span>  <span class="fu"><a href="../reference/rapply2d.html">rapply2d</a></span><span class="op">(</span><span class="va">summary</span>, classes <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This is a nested list of linear model summaries</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">lm_summary_list</span>, give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># List of 7</span></span>
<span><span class="co">#  $ East Asia &amp; Pacific       :List of 3</span></span>
<span><span class="co">#   ..$ High income        :List of 12</span></span>
<span><span class="co">#   .. ..$ call         : language FUN(formula = ..1, data = y)</span></span>
<span><span class="co">#   .. ..$ terms        :Classes 'terms', 'formula'  language G(PCGDP) ~ G(LIFEEX) + B(G(LIFEEX), country)</span></span>
<span><span class="co">#   .. ..$ residuals    : Named num [1:441] -1.64 -2.59 2.75 3.45 2.48 ...</span></span>
<span><span class="co">#   .. ..$ coefficients : num [1:3, 1:4] 0.531 2.494 3.83 0.706 0.759 ...</span></span>
<span><span class="co">#   .. ..$ aliased      : Named logi [1:3] FALSE FALSE FALSE</span></span>
<span><span class="co">#   .. ..$ sigma        : num 4.59</span></span>
<span><span class="co">#   .. ..$ df           : int [1:3] 3 438 3</span></span>
<span><span class="co">#   .. ..$ r.squared    : num 0.0525</span></span>
<span><span class="co">#   .. ..$ adj.r.squared: num 0.0481</span></span>
<span><span class="co">#   .. ..$ fstatistic   : Named num [1:3] 12.1 2 438</span></span>
<span><span class="co">#   .. ..$ cov.unscaled : num [1:3, 1:3] 0.02361 -0.00158 -0.04895 -0.00158 0.02728 ...</span></span>
<span><span class="co">#   .. ..$ na.action    : 'omit' Named int [1:352] 1 61 62 63 64 65 66 67 68 69 ...</span></span>
<span><span class="co">#   ..$ Lower middle income:List of 12</span></span>
<span><span class="co">#   .. ..$ call         : language FUN(formula = ..1, data = y)</span></span>
<span><span class="co">#   .. ..$ terms        :Classes 'terms', 'formula'  language G(PCGDP) ~ G(LIFEEX) + B(G(LIFEEX), country)</span></span>
<span><span class="co">#   .. ..$ residuals    : Named num [1:549] -39.6968 3.6618 -0.0944 -1.8261 -1.0491 ...</span></span>
<span><span class="co">#   .. ..$ coefficients : num [1:3, 1:4] 1.348 0.524 0.949 0.701 0.757 ...</span></span>
<span><span class="co">#   .. ..$ aliased      : Named logi [1:3] FALSE FALSE FALSE</span></span>
<span><span class="co">#   .. ..$ sigma        : num 5.4</span></span>
<span><span class="co">#   .. ..$ df           : int [1:3] 3 546 3</span></span>
<span><span class="co">#   .. ..$ r.squared    : num 0.00471</span></span>
<span><span class="co">#   .. ..$ adj.r.squared: num 0.00106</span></span>
<span><span class="co">#   .. ..$ fstatistic   : Named num [1:3] 1.29 2 546</span></span>
<span><span class="co">#   .. ..$ cov.unscaled : num [1:3, 1:3] 0.016821 0.000511 -0.022767 0.000511 0.01965 ...</span></span>
<span><span class="co">#   .. ..$ na.action    : 'omit' Named int [1:244] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#   ..$ Upper middle income:List of 12</span></span>
<span><span class="co">#   .. ..$ call         : language FUN(formula = ..1, data = y)</span></span>
<span><span class="co">#   .. ..$ terms        :Classes 'terms', 'formula'  language G(PCGDP) ~ G(LIFEEX) + B(G(LIFEEX), country)</span></span>
<span><span class="co">#   .. ..$ residuals    : Named num [1:312] -32.29 -11.61 2.91 11.23 10.28 ...</span></span>
<span><span class="co">#   .. ..$ coefficients : num [1:3, 1:4] 1.507 -0.547 4.816 0.428 0.478 ...</span></span>
<span><span class="co">#   .. ..$ aliased      : Named logi [1:3] FALSE FALSE FALSE</span></span>
<span><span class="co">#   .. ..$ sigma        : num 4.39</span></span>
<span><span class="co">#   .. ..$ df           : int [1:3] 3 309 3</span></span>
<span><span class="co">#   .. ..$ r.squared    : num 0.103</span></span>
<span><span class="co">#   .. ..$ adj.r.squared: num 0.0976</span></span>
<span><span class="co">#   .. ..$ fstatistic   : Named num [1:3] 17.8 2 309</span></span>
<span><span class="co">#   .. ..$ cov.unscaled : num [1:3, 1:3] 0.009471 0.000492 -0.013551 0.000492 0.011842 ...</span></span>
<span><span class="co">#   .. ..$ na.action    : 'omit' Named int [1:298] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#  $ Europe &amp; Central Asia     :List of 4</span></span>
<span><span class="co">#   ..$ High income        :List of 12</span></span>
<span><span class="co">#   .. ..$ call         : language FUN(formula = ..1, data = y)</span></span>
<span><span class="co">#   .. ..$ terms        :Classes 'terms', 'formula'  language G(PCGDP) ~ G(LIFEEX) + B(G(LIFEEX), country)</span></span>
<span><span class="co">#   .. ..$ residuals    : Named num [1:1355] 2.706 -0.548 1.001 3.034 0.257 ...</span></span>
<span><span class="co">#   .. ..$ coefficients : num [1:3, 1:4] 3.254 -0.172 -2.506 0.407 0.227 ...</span></span>
<span><span class="co">#   .. ..$ aliased      : Named logi [1:3] FALSE FALSE FALSE</span></span>
<span><span class="co">#   .. ..$ sigma        : num 3.3</span></span>
<span><span class="co">#   .. ..$ df           : int [1:3] 3 1352 3</span></span>
<span><span class="co">#   .. ..$ r.squared    : num 0.00257</span></span>
<span><span class="co">#   .. ..$ adj.r.squared: num 0.00109</span></span>
<span><span class="co">#   .. ..$ fstatistic   : Named num [1:3] 1.74 2 1352</span></span>
<span><span class="co">#   .. ..$ cov.unscaled : num [1:3, 1:3] 0.015254 -0.000863 -0.05461 -0.000863 0.004722 ...</span></span>
<span><span class="co">#   .. ..$ na.action    : 'omit' Named int [1:902] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#   ..$ Low income         :List of 12</span></span>
<span><span class="co">#   .. ..$ call         : language FUN(formula = ..1, data = y)</span></span>
<span><span class="co">#   .. ..$ terms        :Classes 'terms', 'formula'  language G(PCGDP) ~ G(LIFEEX) + B(G(LIFEEX), country)</span></span>
<span><span class="co">#   .. ..$ residuals    : Named num [1:34] 0.166 -1.804 15.949 -0.778 7.165 ...</span></span>
<span><span class="co">#   .. ..$ coefficients : num [1:2, 1:4] -5.31 9.36 2.03 2.56 -2.61 ...</span></span>
<span><span class="co">#   .. ..$ aliased      : Named logi [1:3] FALSE FALSE TRUE</span></span>
<span><span class="co">#   .. ..$ sigma        : num 8.43</span></span>
<span><span class="co">#   .. ..$ df           : int [1:3] 2 32 3</span></span>
<span><span class="co">#   .. ..$ r.squared    : num 0.295</span></span>
<span><span class="co">#   .. ..$ adj.r.squared: num 0.273</span></span>
<span><span class="co">#   .. ..$ fstatistic   : Named num [1:3] 13.4 1 32</span></span>
<span><span class="co">#   .. ..$ cov.unscaled : num [1:2, 1:2] 0.0582 -0.0514 -0.0514 0.092</span></span>
<span><span class="co">#   .. ..$ na.action    : 'omit' Named int [1:27] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#   ..$ Lower middle income:List of 12</span></span>
<span><span class="co">#   .. ..$ call         : language FUN(formula = ..1, data = y)</span></span>
<span><span class="co">#   .. ..$ terms        :Classes 'terms', 'formula'  language G(PCGDP) ~ G(LIFEEX) + B(G(LIFEEX), country)</span></span>
<span><span class="co">#   .. ..$ residuals    : Named num [1:121] -1.626 8.745 -14.47 0.298 -11.886 ...</span></span>
<span><span class="co">#   .. ..$ coefficients : num [1:3, 1:4] 0.106 4.631 1.499 1.315 0.938 ...</span></span>
<span><span class="co">#   .. ..$ aliased      : Named logi [1:3] FALSE FALSE FALSE</span></span>
<span><span class="co">#   .. ..$ sigma        : num 6.02</span></span>
<span><span class="co">#   .. ..$ df           : int [1:3] 3 118 3</span></span>
<span><span class="co">#   .. ..$ r.squared    : num 0.178</span></span>
<span><span class="co">#   .. ..$ adj.r.squared: num 0.164</span></span>
<span><span class="co">#   .. ..$ fstatistic   : Named num [1:3] 12.7 2 118</span></span>
<span><span class="co">#   .. ..$ cov.unscaled : num [1:3, 1:3] 0.047775 -0.000927 -0.142782 -0.000927 0.024298 ...</span></span>
<span><span class="co">#   .. ..$ na.action    : 'omit' Named int [1:123] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#   ..$ Upper middle income:List of 12</span></span>
<span><span class="co">#   .. ..$ call         : language FUN(formula = ..1, data = y)</span></span>
<span><span class="co">#   .. ..$ terms        :Classes 'terms', 'formula'  language G(PCGDP) ~ G(LIFEEX) + B(G(LIFEEX), country)</span></span>
<span><span class="co">#   .. ..$ residuals    : Named num [1:511] 0.761 -2.153 -4.091 -6.476 -3.43 ...</span></span>
<span><span class="co">#   .. ..$ coefficients : num [1:3, 1:4] 2.983 4.147 -3.351 0.698 0.779 ...</span></span>
<span><span class="co">#   .. ..$ aliased      : Named logi [1:3] FALSE FALSE FALSE</span></span>
<span><span class="co">#   .. ..$ sigma        : num 8.28</span></span>
<span><span class="co">#   .. ..$ df           : int [1:3] 3 508 3</span></span>
<span><span class="co">#   .. ..$ r.squared    : num 0.0531</span></span>
<span><span class="co">#   .. ..$ adj.r.squared: num 0.0493</span></span>
<span><span class="co">#   .. ..$ fstatistic   : Named num [1:3] 14.2 2 508</span></span>
<span><span class="co">#   .. ..$ cov.unscaled : num [1:3, 1:3] 7.11e-03 4.52e-05 -1.45e-02 4.52e-05 8.85e-03 ...</span></span>
<span><span class="co">#   .. ..$ na.action    : 'omit' Named int [1:465] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#  $ Latin America &amp; Caribbean :List of 4</span></span>
<span><span class="co">#   ..$ High income        :List of 12</span></span>
<span><span class="co">#   .. ..$ call         : language FUN(formula = ..1, data = y)</span></span>
<span><span class="co">#   .. ..$ terms        :Classes 'terms', 'formula'  language G(PCGDP) ~ G(LIFEEX) + B(G(LIFEEX), country)</span></span>
<span><span class="co">#   .. ..$ residuals    : Named num [1:487] 2.39 6.02 6.1 1.71 -2.27 ...</span></span>
<span><span class="co">#   .. ..$ coefficients : num [1:3, 1:4] 1.015 0.483 2.613 0.677 0.952 ...</span></span>
<span><span class="co">#   .. ..$ aliased      : Named logi [1:3] FALSE FALSE FALSE</span></span>
<span><span class="co">#   .. ..$ sigma        : num 4.71</span></span>
<span><span class="co">#   .. ..$ df           : int [1:3] 3 484 3</span></span>
<span><span class="co">#   .. ..$ r.squared    : num 0.00592</span></span>
<span><span class="co">#   .. ..$ adj.r.squared: num 0.00181</span></span>
<span><span class="co">#   .. ..$ fstatistic   : Named num [1:3] 1.44 2 484</span></span>
<span><span class="co">#   .. ..$ cov.unscaled : num [1:3, 1:3] 0.02062 0.00155 -0.05714 0.00155 0.04082 ...</span></span>
<span><span class="co">#   .. ..$ na.action    : 'omit' Named int [1:550] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#   ..$ Low income         :List of 12</span></span>
<span><span class="co">#   .. ..$ call         : language FUN(formula = ..1, data = y)</span></span>
<span><span class="co">#   .. ..$ terms        :Classes 'terms', 'formula'  language G(PCGDP) ~ G(LIFEEX) + B(G(LIFEEX), country)</span></span>
<span><span class="co">#   .. ..$ residuals    : Named num [1:59] -5.667 5.091 -4.46 -4.224 -0.526 ...</span></span>
<span><span class="co">#   .. ..$ coefficients : num [1:2, 1:4] -3.18 4.02 1.73 2.28 -1.83 ...</span></span>
<span><span class="co">#   .. ..$ aliased      : Named logi [1:3] FALSE FALSE TRUE</span></span>
<span><span class="co">#   .. ..$ sigma        : num 3.79</span></span>
<span><span class="co">#   .. ..$ df           : int [1:3] 2 57 3</span></span>
<span><span class="co">#   .. ..$ r.squared    : num 0.0516</span></span>
<span><span class="co">#   .. ..$ adj.r.squared: num 0.0349</span></span>
<span><span class="co">#   .. ..$ fstatistic   : Named num [1:3] 3.1 1 57</span></span>
<span><span class="co">#   .. ..$ cov.unscaled : num [1:2, 1:2] 0.209 -0.265 -0.265 0.364</span></span>
<span><span class="co">#   .. ..$ na.action    : 'omit' Named int [1:2] 1 61</span></span>
<span><span class="co">#   ..$ Lower middle income:List of 12</span></span>
<span><span class="co">#   .. ..$ call         : language FUN(formula = ..1, data = y)</span></span>
<span><span class="co">#   .. ..$ terms        :Classes 'terms', 'formula'  language G(PCGDP) ~ G(LIFEEX) + B(G(LIFEEX), country)</span></span>
<span><span class="co">#   .. ..$ residuals    : Named num [1:231] -1.386 2.029 3.213 0.413 1.334 ...</span></span>
<span><span class="co">#   .. ..$ coefficients : num [1:3, 1:4] -1.678 -0.479 3.896 2.26 0.709 ...</span></span>
<span><span class="co">#   .. ..$ aliased      : Named logi [1:3] FALSE FALSE FALSE</span></span>
<span><span class="co">#   .. ..$ sigma        : num 3.96</span></span>
<span><span class="co">#   .. ..$ df           : int [1:3] 3 228 3</span></span>
<span><span class="co">#   .. ..$ r.squared    : num 0.0081</span></span>
<span><span class="co">#   .. ..$ adj.r.squared: num -0.000602</span></span>
<span><span class="co">#   .. ..$ fstatistic   : Named num [1:3] 0.931 2 228</span></span>
<span><span class="co">#   .. ..$ cov.unscaled : num [1:3, 1:3] 0.3264 0.005 -0.4084 0.005 0.0321 ...</span></span>
<span><span class="co">#   .. ..$ na.action    : 'omit' Named int [1:13] 1 61 62 63 64 65 66 67 122 123 ...</span></span>
<span><span class="co">#   ..$ Upper middle income:List of 12</span></span>
<span><span class="co">#   .. ..$ call         : language FUN(formula = ..1, data = y)</span></span>
<span><span class="co">#   .. ..$ terms        :Classes 'terms', 'formula'  language G(PCGDP) ~ G(LIFEEX) + B(G(LIFEEX), country)</span></span>
<span><span class="co">#   .. ..$ residuals    : Named num [1:1065] 1.97 -4.16 -8.5 6.72 7.17 ...</span></span>
<span><span class="co">#   .. ..$ coefficients : num [1:3, 1:4] 1.681 0.583 -0.124 0.353 0.512 ...</span></span>
<span><span class="co">#   .. ..$ aliased      : Named logi [1:3] FALSE FALSE FALSE</span></span>
<span><span class="co">#   .. ..$ sigma        : num 4.22</span></span>
<span><span class="co">#   .. ..$ df           : int [1:3] 3 1062 3</span></span>
<span><span class="co">#   .. ..$ r.squared    : num 0.0016</span></span>
<span><span class="co">#   .. ..$ adj.r.squared: num -0.000283</span></span>
<span><span class="co">#   .. ..$ fstatistic   : Named num [1:3] 0.85 2 1062</span></span>
<span><span class="co">#   .. ..$ cov.unscaled : num [1:3, 1:3] 0.006982 0.000348 -0.013936 0.000348 0.014734 ...</span></span>
<span><span class="co">#   .. ..$ na.action    : 'omit' Named int [1:155] 1 61 62 122 123 183 184 244 245 305 ...</span></span>
<span><span class="co">#  $ Middle East &amp; North Africa:List of 4</span></span>
<span><span class="co">#   ..$ High income        :List of 12</span></span>
<span><span class="co">#   .. ..$ call         : language FUN(formula = ..1, data = y)</span></span>
<span><span class="co">#   .. ..$ terms        :Classes 'terms', 'formula'  language G(PCGDP) ~ G(LIFEEX) + B(G(LIFEEX), country)</span></span>
<span><span class="co">#   .. ..$ residuals    : Named num [1:334] -10.728 -11.988 2.151 0.985 -8.618 ...</span></span>
<span><span class="co">#   .. ..$ coefficients : num [1:3, 1:4] 1.929 3.963 -3.533 1.102 0.996 ...</span></span>
<span><span class="co">#   .. ..$ aliased      : Named logi [1:3] FALSE FALSE FALSE</span></span>
<span><span class="co">#   .. ..$ sigma        : num 8.36</span></span>
<span><span class="co">#   .. ..$ df           : int [1:3] 3 331 3</span></span>
<span><span class="co">#   .. ..$ r.squared    : num 0.0456</span></span>
<span><span class="co">#   .. ..$ adj.r.squared: num 0.0399</span></span>
<span><span class="co">#   .. ..$ fstatistic   : Named num [1:3] 7.91 2 331</span></span>
<span><span class="co">#   .. ..$ cov.unscaled : num [1:3, 1:3] 0.01738 0.00101 -0.02441 0.00101 0.01419 ...</span></span>
<span><span class="co">#   .. ..$ na.action    : 'omit' Named int [1:154] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#   ..$ Low income         :List of 12</span></span>
<span><span class="co">#   .. ..$ call         : language FUN(formula = ..1, data = y)</span></span>
<span><span class="co">#   .. ..$ terms        :Classes 'terms', 'formula'  language G(PCGDP) ~ G(LIFEEX) + B(G(LIFEEX), country)</span></span>
<span><span class="co">#   .. ..$ residuals    : Named num [1:29] 0.468 3.424 0.415 3.842 3.342 ...</span></span>
<span><span class="co">#   .. ..$ coefficients : num [1:2, 1:4] -6.91 11.38 2.11 3.64 -3.27 ...</span></span>
<span><span class="co">#   .. ..$ aliased      : Named logi [1:3] FALSE FALSE TRUE</span></span>
<span><span class="co">#   .. ..$ sigma        : num 6.05</span></span>
<span><span class="co">#   .. ..$ df           : int [1:3] 2 27 3</span></span>
<span><span class="co">#   .. ..$ r.squared    : num 0.266</span></span>
<span><span class="co">#   .. ..$ adj.r.squared: num 0.239</span></span>
<span><span class="co">#   .. ..$ fstatistic   : Named num [1:3] 9.81 1 27</span></span>
<span><span class="co">#   .. ..$ cov.unscaled : num [1:2, 1:2] 0.122 -0.178 -0.178 0.361</span></span>
<span><span class="co">#   .. ..$ na.action    : 'omit' Named int [1:93] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#   ..$ Lower middle income:List of 12</span></span>
<span><span class="co">#   .. ..$ call         : language FUN(formula = ..1, data = y)</span></span>
<span><span class="co">#   .. ..$ terms        :Classes 'terms', 'formula'  language G(PCGDP) ~ G(LIFEEX) + B(G(LIFEEX), country)</span></span>
<span><span class="co">#   .. ..$ residuals    : Named num [1:191] -0.95 -2.047 4.541 5.594 -0.723 ...</span></span>
<span><span class="co">#   .. ..$ coefficients : num [1:3, 1:4] 2.238 1.271 -0.647 1.002 0.599 ...</span></span>
<span><span class="co">#   .. ..$ aliased      : Named logi [1:3] FALSE FALSE FALSE</span></span>
<span><span class="co">#   .. ..$ sigma        : num 3.94</span></span>
<span><span class="co">#   .. ..$ df           : int [1:3] 3 188 3</span></span>
<span><span class="co">#   .. ..$ r.squared    : num 0.0244</span></span>
<span><span class="co">#   .. ..$ adj.r.squared: num 0.014</span></span>
<span><span class="co">#   .. ..$ fstatistic   : Named num [1:3] 2.35 2 188</span></span>
<span><span class="co">#   .. ..$ cov.unscaled : num [1:3, 1:3] 0.06471 -0.00043 -0.07801 -0.00043 0.02309 ...</span></span>
<span><span class="co">#   .. ..$ na.action    : 'omit' Named int [1:114] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#   ..$ Upper middle income:List of 12</span></span>
<span><span class="co">#   .. ..$ call         : language FUN(formula = ..1, data = y)</span></span>
<span><span class="co">#   .. ..$ terms        :Classes 'terms', 'formula'  language G(PCGDP) ~ G(LIFEEX) + B(G(LIFEEX), country)</span></span>
<span><span class="co">#   .. ..$ residuals    : Named num [1:263] -18.068 -23.976 28.692 0.858 1.141 ...</span></span>
<span><span class="co">#   .. ..$ coefficients : num [1:3, 1:4] 2.663 0.718 -1.19 3.538 1.318 ...</span></span>
<span><span class="co">#   .. ..$ aliased      : Named logi [1:3] FALSE FALSE FALSE</span></span>
<span><span class="co">#   .. ..$ sigma        : num 13.8</span></span>
<span><span class="co">#   .. ..$ df           : int [1:3] 3 260 3</span></span>
<span><span class="co">#   .. ..$ r.squared    : num 0.00119</span></span>
<span><span class="co">#   .. ..$ adj.r.squared: num -0.00649</span></span>
<span><span class="co">#   .. ..$ fstatistic   : Named num [1:3] 0.155 2 260</span></span>
<span><span class="co">#   .. ..$ cov.unscaled : num [1:3, 1:3] 0.065741 0.000795 -0.084456 0.000795 0.009122 ...</span></span>
<span><span class="co">#   .. ..$ na.action    : 'omit' Named int [1:103] 1 61 62 122 123 124 125 126 127 128 ...</span></span>
<span><span class="co">#  $ North America             :List of 1</span></span>
<span><span class="co">#   ..$ High income:List of 12</span></span>
<span><span class="co">#   .. ..$ call         : language FUN(formula = ..1, data = y)</span></span>
<span><span class="co">#   .. ..$ terms        :Classes 'terms', 'formula'  language G(PCGDP) ~ G(LIFEEX) + B(G(LIFEEX), country)</span></span>
<span><span class="co">#   .. ..$ residuals    : Named num [1:137] 4.6986 -3.1098 1.8243 0.5643 0.0176 ...</span></span>
<span><span class="co">#   .. ..$ coefficients : num [1:3, 1:4] 6.542 -1.461 -19.53 2.272 0.662 ...</span></span>
<span><span class="co">#   .. ..$ aliased      : Named logi [1:3] FALSE FALSE FALSE</span></span>
<span><span class="co">#   .. ..$ sigma        : num 2.49</span></span>
<span><span class="co">#   .. ..$ df           : int [1:3] 3 134 3</span></span>
<span><span class="co">#   .. ..$ r.squared    : num 0.0657</span></span>
<span><span class="co">#   .. ..$ adj.r.squared: num 0.0518</span></span>
<span><span class="co">#   .. ..$ fstatistic   : Named num [1:3] 4.71 2 134</span></span>
<span><span class="co">#   .. ..$ cov.unscaled : num [1:3, 1:3] 8.36e-01 1.59e-17 -3.60 1.59e-17 7.10e-02 ...</span></span>
<span><span class="co">#   .. ..$ na.action    : 'omit' Named int [1:46] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#  $ South Asia                :List of 3</span></span>
<span><span class="co">#   ..$ Low income         :List of 12</span></span>
<span><span class="co">#   .. ..$ call         : language FUN(formula = ..1, data = y)</span></span>
<span><span class="co">#   .. ..$ terms        :Classes 'terms', 'formula'  language G(PCGDP) ~ G(LIFEEX) + B(G(LIFEEX), country)</span></span>
<span><span class="co">#   .. ..$ residuals    : Named num [1:76] 0.544 -6.17 3.951 -0.964 7.829 ...</span></span>
<span><span class="co">#   .. ..$ coefficients : num [1:3, 1:4] -108.62 -1.72 96.06 174.19 1.25 ...</span></span>
<span><span class="co">#   .. ..$ aliased      : Named logi [1:3] FALSE FALSE FALSE</span></span>
<span><span class="co">#   .. ..$ sigma        : num 3.7</span></span>
<span><span class="co">#   .. ..$ df           : int [1:3] 3 73 3</span></span>
<span><span class="co">#   .. ..$ r.squared    : num 0.0494</span></span>
<span><span class="co">#   .. ..$ adj.r.squared: num 0.0233</span></span>
<span><span class="co">#   .. ..$ fstatistic   : Named num [1:3] 1.9 2 73</span></span>
<span><span class="co">#   .. ..$ cov.unscaled : num [1:3, 1:3] 2210.639 -6.979 -1875.261 -6.979 0.114 ...</span></span>
<span><span class="co">#   .. ..$ na.action    : 'omit' Named int [1:46] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#   ..$ Lower middle income:List of 12</span></span>
<span><span class="co">#   .. ..$ call         : language FUN(formula = ..1, data = y)</span></span>
<span><span class="co">#   .. ..$ terms        :Classes 'terms', 'formula'  language G(PCGDP) ~ G(LIFEEX) + B(G(LIFEEX), country)</span></span>
<span><span class="co">#   .. ..$ residuals    : Named num [1:216] 0.294 -0.293 -6.067 4.954 -4.164 ...</span></span>
<span><span class="co">#   .. ..$ coefficients : num [1:3, 1:4] -2.232 0.238 5.972 1.074 0.493 ...</span></span>
<span><span class="co">#   .. ..$ aliased      : Named logi [1:3] FALSE FALSE FALSE</span></span>
<span><span class="co">#   .. ..$ sigma        : num 3.44</span></span>
<span><span class="co">#   .. ..$ df           : int [1:3] 3 213 3</span></span>
<span><span class="co">#   .. ..$ r.squared    : num 0.111</span></span>
<span><span class="co">#   .. ..$ adj.r.squared: num 0.103</span></span>
<span><span class="co">#   .. ..$ fstatistic   : Named num [1:3] 13.3 2 213</span></span>
<span><span class="co">#   .. ..$ cov.unscaled : num [1:3, 1:3] 0.09757 -0.00201 -0.10483 -0.00201 0.02054 ...</span></span>
<span><span class="co">#   .. ..$ na.action    : 'omit' Named int [1:28] 1 61 62 63 64 65 66 67 68 69 ...</span></span>
<span><span class="co">#   ..$ Upper middle income:List of 12</span></span>
<span><span class="co">#   .. ..$ call         : language FUN(formula = ..1, data = y)</span></span>
<span><span class="co">#   .. ..$ terms        :Classes 'terms', 'formula'  language G(PCGDP) ~ G(LIFEEX) + B(G(LIFEEX), country)</span></span>
<span><span class="co">#   .. ..$ residuals    : Named num [1:82] 3.262 3.976 3.128 1.67 -0.901 ...</span></span>
<span><span class="co">#   .. ..$ coefficients : num [1:3, 1:4] 3.859 -0.577 -0.476 1.036 1.365 ...</span></span>
<span><span class="co">#   .. ..$ aliased      : Named logi [1:3] FALSE FALSE FALSE</span></span>
<span><span class="co">#   .. ..$ sigma        : num 4.25</span></span>
<span><span class="co">#   .. ..$ df           : int [1:3] 3 79 3</span></span>
<span><span class="co">#   .. ..$ r.squared    : num 0.00622</span></span>
<span><span class="co">#   .. ..$ adj.r.squared: num -0.0189</span></span>
<span><span class="co">#   .. ..$ fstatistic   : Named num [1:3] 0.247 2 79</span></span>
<span><span class="co">#   .. ..$ cov.unscaled : num [1:3, 1:3] 0.0595 -0.028 -0.0473 -0.028 0.1034 ...</span></span>
<span><span class="co">#   .. ..$ na.action    : 'omit' Named int [1:40] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#  $ Sub-Saharan Africa        :List of 4</span></span>
<span><span class="co">#   ..$ High income        :List of 12</span></span>
<span><span class="co">#   .. ..$ call         : language FUN(formula = ..1, data = y)</span></span>
<span><span class="co">#   .. ..$ terms        :Classes 'terms', 'formula'  language G(PCGDP) ~ G(LIFEEX) + B(G(LIFEEX), country)</span></span>
<span><span class="co">#   .. ..$ residuals    : Named num [1:39] -11.33 -5.041 -3.158 0.585 7.81 ...</span></span>
<span><span class="co">#   .. ..$ coefficients : num [1:2, 1:4] 2.551 -0.644 0.775 0.55 3.293 ...</span></span>
<span><span class="co">#   .. ..$ aliased      : Named logi [1:3] FALSE FALSE TRUE</span></span>
<span><span class="co">#   .. ..$ sigma        : num 4.8</span></span>
<span><span class="co">#   .. ..$ df           : int [1:3] 2 37 3</span></span>
<span><span class="co">#   .. ..$ r.squared    : num 0.0357</span></span>
<span><span class="co">#   .. ..$ adj.r.squared: num 0.00959</span></span>
<span><span class="co">#   .. ..$ fstatistic   : Named num [1:3] 1.37 1 37</span></span>
<span><span class="co">#   .. ..$ cov.unscaled : num [1:2, 1:2] 0.026 -0.00217 -0.00217 0.01312</span></span>
<span><span class="co">#   .. ..$ na.action    : 'omit' Named int [1:22] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#   ..$ Low income         :List of 12</span></span>
<span><span class="co">#   .. ..$ call         : language FUN(formula = ..1, data = y)</span></span>
<span><span class="co">#   .. ..$ terms        :Classes 'terms', 'formula'  language G(PCGDP) ~ G(LIFEEX) + B(G(LIFEEX), country)</span></span>
<span><span class="co">#   .. ..$ residuals    : Named num [1:1085] 0.694 -5.869 2.069 3.855 2.415 ...</span></span>
<span><span class="co">#   .. ..$ coefficients : num [1:3, 1:4] -0.0756 0.5308 0.5124 0.8887 0.137 ...</span></span>
<span><span class="co">#   .. ..$ aliased      : Named logi [1:3] FALSE FALSE FALSE</span></span>
<span><span class="co">#   .. ..$ sigma        : num 5.88</span></span>
<span><span class="co">#   .. ..$ df           : int [1:3] 3 1082 3</span></span>
<span><span class="co">#   .. ..$ r.squared    : num 0.0146</span></span>
<span><span class="co">#   .. ..$ adj.r.squared: num 0.0128</span></span>
<span><span class="co">#   .. ..$ fstatistic   : Named num [1:3] 8.01 2 1082</span></span>
<span><span class="co">#   .. ..$ cov.unscaled : num [1:3, 1:3] 0.022858 -0.000025 -0.025534 -0.000025 0.000543 ...</span></span>
<span><span class="co">#   .. ..$ na.action    : 'omit' Named int [1:379] 1 61 62 122 123 183 184 244 245 305 ...</span></span>
<span><span class="co">#   ..$ Lower middle income:List of 12</span></span>
<span><span class="co">#   .. ..$ call         : language FUN(formula = ..1, data = y)</span></span>
<span><span class="co">#   .. ..$ terms        :Classes 'terms', 'formula'  language G(PCGDP) ~ G(LIFEEX) + B(G(LIFEEX), country)</span></span>
<span><span class="co">#   .. ..$ residuals    : Named num [1:891] -8.2839 -4.0289 0.0449 1.8231 -0.5267 ...</span></span>
<span><span class="co">#   .. ..$ coefficients : num [1:3, 1:4] 2.352 0.782 -2.616 0.608 0.169 ...</span></span>
<span><span class="co">#   .. ..$ aliased      : Named logi [1:3] FALSE FALSE FALSE</span></span>
<span><span class="co">#   .. ..$ sigma        : num 5.27</span></span>
<span><span class="co">#   .. ..$ df           : int [1:3] 3 888 3</span></span>
<span><span class="co">#   .. ..$ r.squared    : num 0.0277</span></span>
<span><span class="co">#   .. ..$ adj.r.squared: num 0.0255</span></span>
<span><span class="co">#   .. ..$ fstatistic   : Named num [1:3] 12.7 2 888</span></span>
<span><span class="co">#   .. ..$ cov.unscaled : num [1:3, 1:3] 1.33e-02 -1.13e-05 -2.00e-02 -1.13e-05 1.02e-03 ...</span></span>
<span><span class="co">#   .. ..$ na.action    : 'omit' Named int [1:146] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#   ..$ Upper middle income:List of 12</span></span>
<span><span class="co">#   .. ..$ call         : language FUN(formula = ..1, data = y)</span></span>
<span><span class="co">#   .. ..$ terms        :Classes 'terms', 'formula'  language G(PCGDP) ~ G(LIFEEX) + B(G(LIFEEX), country)</span></span>
<span><span class="co">#   .. ..$ residuals    : Named num [1:298] 0.7659 0.9133 0.0921 0.996 0.0765 ...</span></span>
<span><span class="co">#   .. ..$ coefficients : num [1:3, 1:4] 0.584 0.456 4.112 2.472 0.652 ...</span></span>
<span><span class="co">#   .. ..$ aliased      : Named logi [1:3] FALSE FALSE FALSE</span></span>
<span><span class="co">#   .. ..$ sigma        : num 11.4</span></span>
<span><span class="co">#   .. ..$ df           : int [1:3] 3 295 3</span></span>
<span><span class="co">#   .. ..$ r.squared    : num 0.00658</span></span>
<span><span class="co">#   .. ..$ adj.r.squared: num -0.000152</span></span>
<span><span class="co">#   .. ..$ fstatistic   : Named num [1:3] 0.977 2 295</span></span>
<span><span class="co">#   .. ..$ cov.unscaled : num [1:3, 1:3] 0.047213 0.000438 -0.070778 0.000438 0.003285 ...</span></span>
<span><span class="co">#   .. ..$ na.action    : 'omit' Named int [1:68] 1 61 62 63 64 65 66 67 68 69 ...</span></span></code></pre></div>
<p>We can turn this list into a <em>data.table</em> again by calling
first <code>get_elem</code> to recursively extract the coefficient
matrices and then <code>unlist2d</code> to recursively bind them to a
new <em>data.table</em>:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm_summary_list</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/extract_list.html">get_elem</a></span><span class="op">(</span><span class="st">"coefficients"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/unlist2d.html">unlist2d</a></span><span class="op">(</span>idcols <span class="op">=</span> <span class="fu"><a href="../reference/small-helpers.html">.c</a></span><span class="op">(</span><span class="va">Region</span>, <span class="va">Income</span><span class="op">)</span>, </span>
<span>           row.names <span class="op">=</span> <span class="st">"Coef"</span>, </span>
<span>           DT <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">head</span></span>
<span><span class="co">#                 Region              Income                  Coef  Estimate Std. Error   t value</span></span>
<span><span class="co">#                 &lt;char&gt;              &lt;char&gt;                &lt;char&gt;     &lt;num&gt;      &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co"># 1: East Asia &amp; Pacific         High income           (Intercept) 0.5313479  0.7058550 0.7527720</span></span>
<span><span class="co"># 2: East Asia &amp; Pacific         High income             G(LIFEEX) 2.4935584  0.7586943 3.2866443</span></span>
<span><span class="co"># 3: East Asia &amp; Pacific         High income B(G(LIFEEX), country) 3.8297123  1.6916770 2.2638554</span></span>
<span><span class="co"># 4: East Asia &amp; Pacific Lower middle income           (Intercept) 1.3476602  0.7008556 1.9228785</span></span>
<span><span class="co"># 5: East Asia &amp; Pacific Lower middle income             G(LIFEEX) 0.5238856  0.7574904 0.6916069</span></span>
<span><span class="co"># 6: East Asia &amp; Pacific Lower middle income B(G(LIFEEX), country) 0.9494439  1.2031228 0.7891496</span></span>
<span><span class="co">#       Pr(&gt;|t|)</span></span>
<span><span class="co">#          &lt;num&gt;</span></span>
<span><span class="co"># 1: 0.451991327</span></span>
<span><span class="co"># 2: 0.001095466</span></span>
<span><span class="co"># 3: 0.024071386</span></span>
<span><span class="co"># 4: 0.055015131</span></span>
<span><span class="co"># 5: 0.489478164</span></span>
<span><span class="co"># 6: 0.430367103</span></span></code></pre></div>
<p>The fact that this is a nested list of matrices, and that we can save
both the names of the lists at each level of nesting and the row- and
column- names of the matrices make <code>unlist2d</code> a significant
generalization of <code>rbindlist</code><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;&lt;code&gt;unlist2d&lt;/code&gt; can similarly bind nested lists of
arrays, data frames or &lt;em&gt;data.table&lt;/em&gt;’s&lt;/p&gt;"><sup>3</sup></a>.</p>
<p>But why do all this fuzz if we could have simply done:?</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DT</span><span class="op">[</span>, <span class="fu"><a href="../reference/quick-conversion.html">qDT</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/coeftest.html" class="external-link">coeftest</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="../reference/fgrowth.html">G</a></span><span class="op">(</span><span class="va">PCGDP</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="../reference/fgrowth.html">G</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/fbetween_fwithin.html">B</a></span><span class="op">(</span><span class="fu"><a href="../reference/fgrowth.html">G</a></span><span class="op">(</span><span class="va">LIFEEX</span><span class="op">)</span>, <span class="va">country</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="st">"Coef"</span><span class="op">)</span>, </span>
<span>   keyby <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">region</span>, <span class="va">income</span><span class="op">)</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">head</span></span>
<span><span class="co"># Key: &lt;region, income&gt;</span></span>
<span><span class="co">#                 region              income                  Coef  Estimate Std. Error   t value</span></span>
<span><span class="co">#                 &lt;fctr&gt;              &lt;fctr&gt;                &lt;char&gt;     &lt;num&gt;      &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co"># 1: East Asia &amp; Pacific         High income           (Intercept) 0.5313479  0.7058550 0.7527720</span></span>
<span><span class="co"># 2: East Asia &amp; Pacific         High income             G(LIFEEX) 2.4935584  0.7586943 3.2866443</span></span>
<span><span class="co"># 3: East Asia &amp; Pacific         High income B(G(LIFEEX), country) 3.8297123  1.6916770 2.2638554</span></span>
<span><span class="co"># 4: East Asia &amp; Pacific Lower middle income           (Intercept) 1.3476602  0.7008556 1.9228785</span></span>
<span><span class="co"># 5: East Asia &amp; Pacific Lower middle income             G(LIFEEX) 0.5238856  0.7574904 0.6916069</span></span>
<span><span class="co"># 6: East Asia &amp; Pacific Lower middle income B(G(LIFEEX), country) 0.9494439  1.2031228 0.7891496</span></span>
<span><span class="co">#       Pr(&gt;|t|)</span></span>
<span><span class="co">#          &lt;num&gt;</span></span>
<span><span class="co"># 1: 0.451991327</span></span>
<span><span class="co"># 2: 0.001095466</span></span>
<span><span class="co"># 3: 0.024071386</span></span>
<span><span class="co"># 4: 0.055015131</span></span>
<span><span class="co"># 5: 0.489478164</span></span>
<span><span class="co"># 6: 0.430367103</span></span></code></pre></div>
<p>Well we might want to do more things with that list of linear models
first before tidying it, so this is a more general workflow. We might
also be interested in additional statistics like the R-squared or the
F-statistic:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DT_sum</span> <span class="op">&lt;-</span> <span class="va">lm_summary_list</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu"><a href="../reference/extract_list.html">get_elem</a></span><span class="op">(</span><span class="st">"coef|r.sq|fstat"</span>, regex <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/unlist2d.html">unlist2d</a></span><span class="op">(</span>idcols <span class="op">=</span> <span class="fu"><a href="../reference/small-helpers.html">.c</a></span><span class="op">(</span><span class="va">Region</span>, <span class="va">Income</span>, <span class="va">Statistic</span><span class="op">)</span>, </span>
<span>           row.names <span class="op">=</span> <span class="st">"Coef"</span>, </span>
<span>           DT <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">DT_sum</span><span class="op">)</span></span>
<span><span class="co">#                 Region      Income     Statistic                  Coef  Estimate Std. Error</span></span>
<span><span class="co">#                 &lt;char&gt;      &lt;char&gt;        &lt;char&gt;                &lt;char&gt;     &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co"># 1: East Asia &amp; Pacific High income  coefficients           (Intercept) 0.5313479  0.7058550</span></span>
<span><span class="co"># 2: East Asia &amp; Pacific High income  coefficients             G(LIFEEX) 2.4935584  0.7586943</span></span>
<span><span class="co"># 3: East Asia &amp; Pacific High income  coefficients B(G(LIFEEX), country) 3.8297123  1.6916770</span></span>
<span><span class="co"># 4: East Asia &amp; Pacific High income     r.squared                  &lt;NA&gt;        NA         NA</span></span>
<span><span class="co"># 5: East Asia &amp; Pacific High income adj.r.squared                  &lt;NA&gt;        NA         NA</span></span>
<span><span class="co"># 6: East Asia &amp; Pacific High income    fstatistic                  &lt;NA&gt;        NA         NA</span></span>
<span><span class="co">#     t value    Pr(&gt;|t|)         V1    value numdf dendf</span></span>
<span><span class="co">#       &lt;num&gt;       &lt;num&gt;      &lt;num&gt;    &lt;num&gt; &lt;num&gt; &lt;num&gt;</span></span>
<span><span class="co"># 1: 0.752772 0.451991327         NA       NA    NA    NA</span></span>
<span><span class="co"># 2: 3.286644 0.001095466         NA       NA    NA    NA</span></span>
<span><span class="co"># 3: 2.263855 0.024071386         NA       NA    NA    NA</span></span>
<span><span class="co"># 4:       NA          NA 0.05245359       NA    NA    NA</span></span>
<span><span class="co"># 5:       NA          NA 0.04812690       NA    NA    NA</span></span>
<span><span class="co"># 6:       NA          NA         NA 12.12325     2   438</span></span>
<span></span>
<span><span class="co"># Reshaping to long form: </span></span>
<span><span class="va">DT_sum</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/melt.data.table.html" class="external-link">melt</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/roworder.html">roworderv</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span></span>
<span><span class="co">#                  Region              Income     Statistic                  Coef   variable</span></span>
<span><span class="co">#                  &lt;char&gt;              &lt;char&gt;        &lt;char&gt;                &lt;char&gt;     &lt;fctr&gt;</span></span>
<span><span class="co">#  1: East Asia &amp; Pacific         High income  coefficients           (Intercept)   Estimate</span></span>
<span><span class="co">#  2: East Asia &amp; Pacific         High income  coefficients             G(LIFEEX)   Estimate</span></span>
<span><span class="co">#  3: East Asia &amp; Pacific         High income  coefficients B(G(LIFEEX), country)   Estimate</span></span>
<span><span class="co">#  4: East Asia &amp; Pacific         High income  coefficients           (Intercept) Std. Error</span></span>
<span><span class="co">#  5: East Asia &amp; Pacific         High income  coefficients             G(LIFEEX) Std. Error</span></span>
<span><span class="co">#  6: East Asia &amp; Pacific         High income  coefficients B(G(LIFEEX), country) Std. Error</span></span>
<span><span class="co">#  7: East Asia &amp; Pacific         High income  coefficients           (Intercept)    t value</span></span>
<span><span class="co">#  8: East Asia &amp; Pacific         High income  coefficients             G(LIFEEX)    t value</span></span>
<span><span class="co">#  9: East Asia &amp; Pacific         High income  coefficients B(G(LIFEEX), country)    t value</span></span>
<span><span class="co"># 10: East Asia &amp; Pacific         High income  coefficients           (Intercept)   Pr(&gt;|t|)</span></span>
<span><span class="co"># 11: East Asia &amp; Pacific         High income  coefficients             G(LIFEEX)   Pr(&gt;|t|)</span></span>
<span><span class="co"># 12: East Asia &amp; Pacific         High income  coefficients B(G(LIFEEX), country)   Pr(&gt;|t|)</span></span>
<span><span class="co"># 13: East Asia &amp; Pacific         High income     r.squared                  &lt;NA&gt;         V1</span></span>
<span><span class="co"># 14: East Asia &amp; Pacific         High income adj.r.squared                  &lt;NA&gt;         V1</span></span>
<span><span class="co"># 15: East Asia &amp; Pacific         High income    fstatistic                  &lt;NA&gt;      value</span></span>
<span><span class="co"># 16: East Asia &amp; Pacific         High income    fstatistic                  &lt;NA&gt;      numdf</span></span>
<span><span class="co"># 17: East Asia &amp; Pacific         High income    fstatistic                  &lt;NA&gt;      dendf</span></span>
<span><span class="co"># 18: East Asia &amp; Pacific Lower middle income  coefficients           (Intercept)   Estimate</span></span>
<span><span class="co"># 19: East Asia &amp; Pacific Lower middle income  coefficients             G(LIFEEX)   Estimate</span></span>
<span><span class="co"># 20: East Asia &amp; Pacific Lower middle income  coefficients B(G(LIFEEX), country)   Estimate</span></span>
<span><span class="co">#                  Region              Income     Statistic                  Coef   variable</span></span>
<span><span class="co">#            value</span></span>
<span><span class="co">#            &lt;num&gt;</span></span>
<span><span class="co">#  1: 5.313479e-01</span></span>
<span><span class="co">#  2: 2.493558e+00</span></span>
<span><span class="co">#  3: 3.829712e+00</span></span>
<span><span class="co">#  4: 7.058550e-01</span></span>
<span><span class="co">#  5: 7.586943e-01</span></span>
<span><span class="co">#  6: 1.691677e+00</span></span>
<span><span class="co">#  7: 7.527720e-01</span></span>
<span><span class="co">#  8: 3.286644e+00</span></span>
<span><span class="co">#  9: 2.263855e+00</span></span>
<span><span class="co"># 10: 4.519913e-01</span></span>
<span><span class="co"># 11: 1.095466e-03</span></span>
<span><span class="co"># 12: 2.407139e-02</span></span>
<span><span class="co"># 13: 5.245359e-02</span></span>
<span><span class="co"># 14: 4.812690e-02</span></span>
<span><span class="co"># 15: 1.212325e+01</span></span>
<span><span class="co"># 16: 2.000000e+00</span></span>
<span><span class="co"># 17: 4.380000e+02</span></span>
<span><span class="co"># 18: 1.347660e+00</span></span>
<span><span class="co"># 19: 5.238856e-01</span></span>
<span><span class="co"># 20: 9.494439e-01</span></span>
<span><span class="co">#            value</span></span></code></pre></div>
<p>As a final example of this kind, lets suppose we are interested in
the within-country correlations of all these variables by region and
income group:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DT</span><span class="op">[</span>, <span class="fu"><a href="../reference/quick-conversion.html">qDT</a></span><span class="op">(</span><span class="fu"><a href="../reference/pwcor_pwcov_pwnobs.html">pwcor</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">W</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">country</span><span class="op">)</span><span class="op">)</span>, <span class="st">"Variable"</span><span class="op">)</span>, </span>
<span>   keyby <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">region</span>, <span class="va">income</span><span class="op">)</span>, .SDcols <span class="op">=</span> <span class="va">PCGDP</span><span class="op">:</span><span class="va">ODA</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">head</span></span>
<span><span class="co"># Key: &lt;region, income&gt;</span></span>
<span><span class="co">#                 region              income Variable    W.PCGDP   W.LIFEEX    W.GINI       W.ODA</span></span>
<span><span class="co">#                 &lt;fctr&gt;              &lt;fctr&gt;   &lt;char&gt;      &lt;num&gt;      &lt;num&gt;     &lt;num&gt;       &lt;num&gt;</span></span>
<span><span class="co"># 1: East Asia &amp; Pacific         High income  W.PCGDP  1.0000000  0.7562668 0.6253844 -0.25258496</span></span>
<span><span class="co"># 2: East Asia &amp; Pacific         High income W.LIFEEX  0.7562668  1.0000000 0.3191255 -0.33611662</span></span>
<span><span class="co"># 3: East Asia &amp; Pacific         High income   W.GINI  0.6253844  0.3191255 1.0000000          NA</span></span>
<span><span class="co"># 4: East Asia &amp; Pacific         High income    W.ODA -0.2525850 -0.3361166        NA  1.00000000</span></span>
<span><span class="co"># 5: East Asia &amp; Pacific Lower middle income  W.PCGDP  1.0000000  0.4685618 0.4428879 -0.02508852</span></span>
<span><span class="co"># 6: East Asia &amp; Pacific Lower middle income W.LIFEEX  0.4685618  1.0000000 0.3231520  0.09356733</span></span></code></pre></div>
<p>In summary: The list processing features, statistical capabilities
and efficient converters of <em>collapse</em> and the flexibility of
<em>data.table</em> work well together, facilitating more complex
workflows.</p>
</div>
<div class="section level2">
<h2 id="additional-benchmarks">Additional Benchmarks<a class="anchor" aria-label="anchor" href="#additional-benchmarks"></a>
</h2>
<p>See <a href="https://sebkrantz.github.io/Rblog/2020/08/31/welcome-to-collapse/" class="external-link">here</a>
or <a href="https://sebkrantz.github.io/collapse/reference/fsum.html#benchmark">here</a>.</p>
<p>These are all run on a 2 core laptop, so I honestly don’t know how
<em>collapse</em> scales on powerful multi-core machines. My own limited
computational resources are part of the reason I did not opt for a
thread-parallel package from the start. But a multi-core version of
<em>collapse</em> will eventually be released, maybe by end of 2021.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Mundlak, Yair. 1978. “On the Pooling of Time Series and Cross Section
Data.” <em>Econometrica</em> 46 (1): 69–85.</p>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sebastian Krantz.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
