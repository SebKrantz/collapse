<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="collapse">
<title>collapse and dplyr • collapse</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="collapse and dplyr">
<meta property="og:description" content="collapse">
<meta property="og:image" content="https://sebkrantz.github.io/collapse/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">collapse</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.0.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Documentation</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Vignettes</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://sebkrantz.github.io/Rblog/">Blog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://twitter.com/collapse_R" aria-label="Twitter">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/SebKrantz/collapse" aria-label="GitHub">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>collapse and dplyr</h1>
            <h3 data-toc-skip class="subtitle">Fast (Weighted)
Aggregations and Transformations in a Piped Workflow</h3>
                        <h4 data-toc-skip class="author">Sebastian
Krantz</h4>
            
            <h4 data-toc-skip class="date">2021-01-04</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/SebKrantz/collapse/blob/HEAD/vignettes/collapse_and_dplyr.Rmd" class="external-link"><code>vignettes/collapse_and_dplyr.Rmd</code></a></small>
      <div class="d-none name"><code>collapse_and_dplyr.Rmd</code></div>
    </div>

    
    
<style type="text/css">
pre {
  max-height: 500px;
  overflow-y: auto;
}

pre[class] {
  max-height: 500px;
}
</style>
<!--
*collapse* is a C/C++ based package for data transformation and statistical computing in R. It's aims are:

1. To facilitate complex data transformation, exploration and computing tasks in R.
2. To help make R code fast, flexible, parsimonious and programmer friendly. 
--><p>This vignette focuses on the integration of <em>collapse</em> and the
popular <em>dplyr</em> package by Hadley Wickham. In particular it will
demonstrate how using <em>collapse</em>’s fast functions and some fast
alternatives for <em>dplyr</em> verbs can substantially facilitate and
speed up basic data manipulation, grouped and weighted aggregations and
transformations, and panel data computations (i.e. between- and
within-transformations, panel-lags, differences and growth rates) in a
<em>dplyr</em> (piped) workflow.</p>
<hr>
<p><strong>Notes:</strong></p>
<ul>
<li><p>This vignette is targeted at <em>dplyr</em> / <em>tidyverse</em>
users. <em>collapse</em> is a standalone package and can be programmed
efficiently without pipes or <em>dplyr</em> verbs.</p></li>
<li><p>The ‘Introduction to <em>collapse</em>’ vignette provides a
thorough introduction to the package and a built-in structured
documentation is available under
<code><a href="../reference/collapse-documentation.html">help("collapse-documentation")</a></code> after installing the
package. In addition <code><a href="../reference/collapse-package.html">help("collapse-package")</a></code> provides a
compact set of examples for quick-start.</p></li>
<li><p>Documentation and vignettes can also be viewed <a href="https://sebkrantz.github.io/collapse/">online</a>.</p></li>
</ul>
<hr>
<div class="section level2">
<h2 id="fast-aggregations">1. Fast Aggregations<a class="anchor" aria-label="anchor" href="#fast-aggregations"></a>
</h2>
<p>A key feature of <em>collapse</em> is it’s broad set of <em>Fast
Statistical Functions</em>
(<code>fsum, fprod, fmean, fmedian, fmode, fvar, fsd, fmin, fmax, fnth, ffirst, flast, fnobs, fndistinct</code>)
which are able to substantially speed-up column-wise, grouped and
weighted computations on vectors, matrices or data frames. The functions
are S3 generic, with a default (vector), matrix and data frame method,
as well as a grouped_df method for grouped tibbles used by
<em>dplyr</em>. The grouped tibble method has the following
arguments:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">FUN.grouped_df</span>(x, [<span class="at">w =</span> <span class="cn">NULL</span>,] <span class="at">TRA =</span> <span class="cn">NULL</span>, [<span class="at">na.rm =</span> <span class="cn">TRUE</span>,]</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">use.g.names =</span> <span class="cn">FALSE</span>, <span class="at">keep.group_vars =</span> <span class="cn">TRUE</span>, [<span class="at">keep.w =</span> <span class="cn">TRUE</span>,] ...)</span></code></pre></div>
<p>where <code>w</code> is a weight variable, and <code>TRA</code> and
can be used to transform <code>x</code> using the computed statistics
and one of 10 available transformations
(<code>"replace_fill", "replace", "-", "-+", "/", "%", "+", "*", "%%", "-%%"</code>,
discussed in section 2). <code>na.rm</code> efficiently removes missing
values and is <code>TRUE</code> by default. <code>use.g.names</code>
generates new row-names from the unique combinations of groups (default:
disabled), whereas <code>keep.group_vars</code> (default: enabled) will
keep the grouping columns as is custom in the native
<code>data %&gt;% group_by(...) %&gt;% summarize(...)</code> workflow in
<em>dplyr</em>. Finally, <code>keep.w</code> regulates whether a
weighting variable used is also aggregated and saved in a column. For
<code>fsum, fmean, fmedian, fnth, fvar, fsd</code> and
<code>fmode</code> this will compute the sum of the weights in each
group, whereas <code>fprod</code> returns the product of the
weights.</p>
<p>With that in mind, let’s consider some straightforward
applications.</p>
<div class="section level3">
<h3 id="simple-aggregations">1.1 Simple Aggregations<a class="anchor" aria-label="anchor" href="#simple-aggregations"></a>
</h3>
<p>Consider the Groningen Growth and Development Center 10-Sector
Database included in <em>collapse</em> and introduced in the main
vignette:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sebkrantz.github.io/collapse/">collapse</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">GGDC10S</span><span class="op">)</span></span>
<span><span class="co">#   Country Regioncode             Region Variable Year      AGR      MIN       MAN        PU</span></span>
<span><span class="co"># 1     BWA        SSA Sub-saharan Africa       VA 1960       NA       NA        NA        NA</span></span>
<span><span class="co"># 2     BWA        SSA Sub-saharan Africa       VA 1961       NA       NA        NA        NA</span></span>
<span><span class="co"># 3     BWA        SSA Sub-saharan Africa       VA 1962       NA       NA        NA        NA</span></span>
<span><span class="co"># 4     BWA        SSA Sub-saharan Africa       VA 1963       NA       NA        NA        NA</span></span>
<span><span class="co"># 5     BWA        SSA Sub-saharan Africa       VA 1964 16.30154 3.494075 0.7365696 0.1043936</span></span>
<span><span class="co"># 6     BWA        SSA Sub-saharan Africa       VA 1965 15.72700 2.495768 1.0181992 0.1350976</span></span>
<span><span class="co">#         CON      WRT      TRA     FIRE      GOV      OTH      SUM</span></span>
<span><span class="co"># 1        NA       NA       NA       NA       NA       NA       NA</span></span>
<span><span class="co"># 2        NA       NA       NA       NA       NA       NA       NA</span></span>
<span><span class="co"># 3        NA       NA       NA       NA       NA       NA       NA</span></span>
<span><span class="co"># 4        NA       NA       NA       NA       NA       NA       NA</span></span>
<span><span class="co"># 5 0.6600454 6.243732 1.658928 1.119194 4.822485 2.341328 37.48229</span></span>
<span><span class="co"># 6 1.3462312 7.064825 1.939007 1.246789 5.695848 2.678338 39.34710</span></span>
<span></span>
<span><span class="co"># Summarize the Data: </span></span>
<span><span class="co"># descr(GGDC10S, cols = is_categorical)</span></span>
<span><span class="co"># aperm(qsu(GGDC10S, ~Variable, cols = is.numeric))</span></span>
<span></span>
<span><span class="co"># Efficiently converting to tibble (no deep copy)</span></span>
<span><span class="va">GGDC10S</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quick-conversion.html">qTBL</a></span><span class="op">(</span><span class="va">GGDC10S</span><span class="op">)</span></span></code></pre></div>
<p>Simple column-wise computations using the fast functions and pipe
operators are performed as follows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">fnobs</span>                       <span class="co"># Number of Observations</span></span>
<span><span class="co">#    Country Regioncode     Region   Variable       Year        AGR        MIN        MAN         PU </span></span>
<span><span class="co">#       5027       5027       5027       5027       5027       4364       4355       4355       4354 </span></span>
<span><span class="co">#        CON        WRT        TRA       FIRE        GOV        OTH        SUM </span></span>
<span><span class="co">#       4355       4355       4355       4355       3482       4248       4364</span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">fndistinct</span>                  <span class="co"># Number of distinct values</span></span>
<span><span class="co">#    Country Regioncode     Region   Variable       Year        AGR        MIN        MAN         PU </span></span>
<span><span class="co">#         43          6          6          2         67       4353       4224       4353       4237 </span></span>
<span><span class="co">#        CON        WRT        TRA       FIRE        GOV        OTH        SUM </span></span>
<span><span class="co">#       4339       4344       4334       4349       3470       4238       4364</span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html" class="external-link">select_at</a></span><span class="op">(</span><span class="fl">6</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">fmedian</span> <span class="co"># Median</span></span>
<span><span class="co">#        AGR        MIN        MAN         PU        CON        WRT        TRA       FIRE        GOV </span></span>
<span><span class="co">#  4394.5194   173.2234  3718.0981   167.9500  1473.4470  3773.6430  1174.8000   960.1251  3928.5127 </span></span>
<span><span class="co">#        OTH        SUM </span></span>
<span><span class="co">#  1433.1722 23186.1936</span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html" class="external-link">select_at</a></span><span class="op">(</span><span class="fl">6</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">fmean</span>   <span class="co"># Mean</span></span>
<span><span class="co">#        AGR        MIN        MAN         PU        CON        WRT        TRA       FIRE        GOV </span></span>
<span><span class="co">#  2526696.5  1867908.9  5538491.4   335679.5  1801597.6  3392909.5  1473269.7  1657114.8  1712300.3 </span></span>
<span><span class="co">#        OTH        SUM </span></span>
<span><span class="co">#  1684527.3 21566436.8</span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">fmode</span>                       <span class="co"># Mode</span></span>
<span><span class="co">#            Country         Regioncode             Region           Variable               Year </span></span>
<span><span class="co">#              "USA"              "ASI"             "Asia"              "EMP"             "2010" </span></span>
<span><span class="co">#                AGR                MIN                MAN                 PU                CON </span></span>
<span><span class="co"># "171.315882316326"                "0" "4645.12507642586"                "0" "1.34623115930777" </span></span>
<span><span class="co">#                WRT                TRA               FIRE                GOV                OTH </span></span>
<span><span class="co"># "21.8380052682527" "8.97743416914571" "40.0701608636442"                "0" "3626.84423577048" </span></span>
<span><span class="co">#                SUM </span></span>
<span><span class="co"># "37.4822945751317"</span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/fmode.html">fmode</a></span><span class="op">(</span>drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>         <span class="co"># Keep data structure intact</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 1 × 16</span></span></span>
<span><span class="co">#   Country Regioncode Region Variable  Year   AGR   MIN   MAN    PU   CON   WRT   TRA  FIRE   GOV</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> USA     ASI        Asia   EMP       <span style="text-decoration: underline;">2</span>010  171.     0 <span style="text-decoration: underline;">4</span>645.     0  1.35  21.8  8.98  40.1     0</span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 2 more variables: OTH &lt;dbl&gt;, SUM &lt;dbl&gt;</span></span></span></code></pre></div>
<p>Moving on to grouped statistics, we can compute the average value
added and employment by sector and country using:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html" class="external-link">select_at</a></span><span class="op">(</span><span class="fl">6</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">fmean</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 85 × 13</span></span></span>
<span><span class="co">#    Variable Country     AGR     MIN     MAN     PU    CON    WRT    TRA   FIRE     GOV    OTH    SUM</span></span>
<span><span class="co">#    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 1</span> EMP      ARG       <span style="text-decoration: underline;">1</span>420.   52.1   <span style="text-decoration: underline;">1</span>932.  1.02<span style="color: #949494;">e</span>2 7.42<span style="color: #949494;">e</span>2 1.98<span style="color: #949494;">e</span>3 6.49<span style="color: #949494;">e</span>2  628.   <span style="text-decoration: underline;">2</span>043.  9.92<span style="color: #949494;">e</span>2 1.05<span style="color: #949494;">e</span>4</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 2</span> EMP      BOL        964.   56.0    235.  5.35<span style="color: #949494;">e</span>0 1.23<span style="color: #949494;">e</span>2 2.82<span style="color: #949494;">e</span>2 1.15<span style="color: #949494;">e</span>2   44.6    <span style="color: #BB0000;">NA</span>   3.96<span style="color: #949494;">e</span>2 2.22<span style="color: #949494;">e</span>3</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 3</span> EMP      BRA      <span style="text-decoration: underline;">17</span>191.  206.    <span style="text-decoration: underline;">6</span>991.  3.65<span style="color: #949494;">e</span>2 3.52<span style="color: #949494;">e</span>3 8.51<span style="color: #949494;">e</span>3 2.05<span style="color: #949494;">e</span>3 <span style="text-decoration: underline;">4</span>414.   <span style="text-decoration: underline;">5</span>307.  5.71<span style="color: #949494;">e</span>3 5.43<span style="color: #949494;">e</span>4</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 4</span> EMP      BWA        188.   10.5     18.1 3.09<span style="color: #949494;">e</span>0 2.53<span style="color: #949494;">e</span>1 3.63<span style="color: #949494;">e</span>1 8.36<span style="color: #949494;">e</span>0   15.3    61.1 2.76<span style="color: #949494;">e</span>1 3.94<span style="color: #949494;">e</span>2</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 5</span> EMP      CHL        702.  101.     625.  2.94<span style="color: #949494;">e</span>1 2.96<span style="color: #949494;">e</span>2 6.95<span style="color: #949494;">e</span>2 2.58<span style="color: #949494;">e</span>2  272.     <span style="color: #BB0000;">NA</span>   1.00<span style="color: #949494;">e</span>3 3.98<span style="color: #949494;">e</span>3</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 6</span> EMP      CHN     <span style="text-decoration: underline;">287</span>744. <span style="text-decoration: underline;">7</span>050.   <span style="text-decoration: underline;">67</span>144.  1.61<span style="color: #949494;">e</span>3 2.09<span style="color: #949494;">e</span>4 2.89<span style="color: #949494;">e</span>4 1.39<span style="color: #949494;">e</span>4 <span style="text-decoration: underline;">4</span>929.  <span style="text-decoration: underline;">22</span>669.  3.10<span style="color: #949494;">e</span>4 4.86<span style="color: #949494;">e</span>5</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 7</span> EMP      COL       <span style="text-decoration: underline;">3</span>091.  145.    <span style="text-decoration: underline;">1</span>175.  3.39<span style="color: #949494;">e</span>1 5.24<span style="color: #949494;">e</span>2 2.07<span style="color: #949494;">e</span>3 4.70<span style="color: #949494;">e</span>2  649.     <span style="color: #BB0000;">NA</span>   1.73<span style="color: #949494;">e</span>3 9.89<span style="color: #949494;">e</span>3</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 8</span> EMP      CRI        231.    1.70   136.  1.43<span style="color: #949494;">e</span>1 5.76<span style="color: #949494;">e</span>1 1.57<span style="color: #949494;">e</span>2 4.24<span style="color: #949494;">e</span>1   54.9   128.  6.51<span style="color: #949494;">e</span>1 8.87<span style="color: #949494;">e</span>2</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 9</span> EMP      DEW       <span style="text-decoration: underline;">2</span>490.  407.    <span style="text-decoration: underline;">8</span>473.  2.26<span style="color: #949494;">e</span>2 2.09<span style="color: #949494;">e</span>3 4.44<span style="color: #949494;">e</span>3 1.48<span style="color: #949494;">e</span>3 <span style="text-decoration: underline;">1</span>689.   <span style="text-decoration: underline;">3</span>945.  9.99<span style="color: #949494;">e</span>2 2.62<span style="color: #949494;">e</span>4</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">10</span> EMP      DNK        236.    8.03   507.  1.38<span style="color: #949494;">e</span>1 1.71<span style="color: #949494;">e</span>2 4.55<span style="color: #949494;">e</span>2 1.61<span style="color: #949494;">e</span>2  181.    549.  1.11<span style="color: #949494;">e</span>2 2.39<span style="color: #949494;">e</span>3</span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 75 more rows</span></span></span></code></pre></div>
<p>Similarly we can aggregate using any other of the above
functions.</p>
<!-- ```{r} -->
<!-- GGDC10S %>%  -->
<!--   group_by(Variable, Country) %>% -->
<!--   select_at(6:16) %>% fmedian -->
<!-- GGDC10S %>%  -->
<!--   group_by(Variable, Country) %>% -->
<!--   select_at(6:16) %>% fsd -->
<!-- ``` -->
<p>It is important to not use <em>dplyr</em>’s <code>summarize</code>
together with these functions since that would eliminate their speed
gain. These functions are fast because they are executed only once and
carry out the grouped computations in C++, whereas
<code>summarize</code> will apply the function to each group in the
grouped tibble.</p>
<!-- - It will also work with the fast functions, but is slower than using primitive base functions since the fast functions are S3 generic -.  -->
<hr>
<div class="section level4">
<h4 id="excursus-what-is-happening-behind-the-scenes">Excursus: What is Happening Behind the Scenes?<a class="anchor" aria-label="anchor" href="#excursus-what-is-happening-behind-the-scenes"></a>
</h4>
<p>To better explain this point it is perhaps good to shed some light on
what is happening behind the scenes of <em>dplyr</em> and
<em>collapse</em>. Fundamentally both packages follow different
computing paradigms:</p>
<p><em>dplyr</em> is an efficient implementation of the
Split-Apply-Combine computing paradigm. Data is split into groups, these
data-chunks are then passed to a function carrying out the computation,
and finally recombined to produce the aggregated data.frame.
<!-- The efficiency of that process depends on the efficiency of the grouping, splitting, the function(s) applied and the recombining.  -->
This modus operandi is evident in the grouping mechanism of
<em>dplyr</em>. When a data.frame is passed through <em>group_by</em>, a
‘groups’ attribute is attached:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="st">"groups"</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 85 × 3</span></span></span>
<span><span class="co">#    Variable Country       .rows</span></span>
<span><span class="co">#    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&lt;int&gt;&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 1</span> EMP      ARG            <span style="color: #949494;">[62]</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 2</span> EMP      BOL            <span style="color: #949494;">[61]</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 3</span> EMP      BRA            <span style="color: #949494;">[62]</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 4</span> EMP      BWA            <span style="color: #949494;">[52]</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 5</span> EMP      CHL            <span style="color: #949494;">[63]</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 6</span> EMP      CHN            <span style="color: #949494;">[62]</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 7</span> EMP      COL            <span style="color: #949494;">[61]</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 8</span> EMP      CRI            <span style="color: #949494;">[62]</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 9</span> EMP      DEW            <span style="color: #949494;">[61]</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">10</span> EMP      DNK            <span style="color: #949494;">[64]</span></span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 75 more rows</span></span></span></code></pre></div>
<p>This object is a data.frame giving the unique groups and in the third
(last) column vectors containing the indices of the rows belonging to
that group. A command like <code>summarize</code> uses this information
to split the data.frame into groups which are then passed sequentially
to the function used and later recombined. These steps are also done in
C++ which makes <em>dplyr</em> quite efficient.</p>
<p>Now <em>collapse</em> is based around one-pass grouped computations
at the C++ level using its own grouped statistical functions. In other
words the data is not split and recombined at all but the entire
computation is performed in a single C++ loop running through that data
and completing the computations for each group simultaneously. This
modus operandi is also evident in <em>collapse</em> grouping objects.
The method <code>GRP.grouped_df</code> takes a <em>dplyr</em> grouping
object from a grouped tibble and efficiently converts it to a
<em>collapse</em> grouping object:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">GRP</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">str</span></span>
<span><span class="co"># Class 'GRP'  hidden list of 9</span></span>
<span><span class="co">#  $ N.groups    : int 85</span></span>
<span><span class="co">#  $ group.id    : int [1:5027] 46 46 46 46 46 46 46 46 46 46 ...</span></span>
<span><span class="co">#  $ group.sizes : int [1:85] 62 61 62 52 63 62 61 62 61 64 ...</span></span>
<span><span class="co">#  $ groups      :List of 2</span></span>
<span><span class="co">#   ..$ Variable: chr [1:85] "EMP" "EMP" "EMP" "EMP" ...</span></span>
<span><span class="co">#   .. ..- attr(*, "label")= chr "Variable"</span></span>
<span><span class="co">#   .. ..- attr(*, "format.stata")= chr "%9s"</span></span>
<span><span class="co">#   ..$ Country : chr [1:85] "ARG" "BOL" "BRA" "BWA" ...</span></span>
<span><span class="co">#   .. ..- attr(*, "label")= chr "Country"</span></span>
<span><span class="co">#   .. ..- attr(*, "format.stata")= chr "%9s"</span></span>
<span><span class="co">#  $ group.vars  : chr [1:2] "Variable" "Country"</span></span>
<span><span class="co">#  $ ordered     : Named logi [1:2] TRUE FALSE</span></span>
<span><span class="co">#   ..- attr(*, "names")= chr [1:2] "ordered" "sorted"</span></span>
<span><span class="co">#  $ order       : NULL</span></span>
<span><span class="co">#  $ group.starts: NULL</span></span>
<span><span class="co">#  $ call        : language GRP.grouped_df(X = .)</span></span></code></pre></div>
<p>This object is a list where the first three elements give the number
of groups, the group-id to which each row belongs and a vector of
group-sizes. A function like <code>fsum</code> uses this information to
(for each column) create a result vector of size ‘N.groups’ and the run
through the column using the ‘group.id’ vector to add the i’th data
point to the ’group.id[i]’th element of the result vector. When the loop
is finished, the grouped computation is also finished.</p>
<p>It is obvious that <em>collapse</em> is faster than <em>dplyr</em>
since it’s method of computing involves less steps, and it does not need
to call statistical functions multiple times. See the benchmark section.
<!-- This performance gain is realized especially as data become large, since the conversion perfomed by `GRP.grouped_df` also involves a small computational cost.  --></p>
<hr>
</div>
</div>
<div class="section level3">
<h3 id="more-speed-using-collapse-verbs">1.2 More Speed using <em>collapse</em> Verbs<a class="anchor" aria-label="anchor" href="#more-speed-using-collapse-verbs"></a>
</h3>
<p><em>collapse</em> fast functions do not develop their maximal
performance on a grouped tibble created with <code>group_by</code>
because of the additional conversion cost of the grouping object
incurred by <code>GRP.grouped_df</code>. This cost is already minimized
through the use of C++, but we can do even better replacing
<code>group_by</code> with <code><a href="../reference/GRP.html">collapse::fgroup_by</a></code>.
<code>fgroup_by</code> works like <code>group_by</code> but does the
grouping with <code><a href="../reference/GRP.html">collapse::GRP</a></code> (up to 10x faster than
<code>group_by</code>) and simply attaches a <em>collapse</em> grouping
object to the grouped_df. Thus the speed gain is 2-fold: Faster grouping
and no conversion cost when calling <em>collapse</em> functions.</p>
<p>Another improvement comes from replacing the <em>dplyr</em> verb
<code>select</code> with <code><a href="../reference/select_replace_vars.html">collapse::fselect</a></code>, and, for
selection using column names, indices or functions use
<code><a href="../reference/select_replace_vars.html">collapse::get_vars</a></code> instead of <code>select_at</code> or
<code>select_if</code>. Next to <code>get_vars</code>, <em>collapse</em>
also introduces the predicates <code>num_vars</code>,
<code>cat_vars</code>, <code>char_vars</code>, <code>fact_vars</code>,
<code>logi_vars</code> and <code>date_vars</code> to efficiently select
columns by type.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="fl">6</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">fmedian</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 85 × 13</span></span></span>
<span><span class="co">#    Variable Country     AGR     MIN     MAN     PU    CON    WRT    TRA   FIRE     GOV    OTH    SUM</span></span>
<span><span class="co">#    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 1</span> EMP      ARG       <span style="text-decoration: underline;">1</span>325.   47.4   <span style="text-decoration: underline;">1</span>988.  1.05<span style="color: #949494;">e</span>2 7.82<span style="color: #949494;">e</span>2 1.85<span style="color: #949494;">e</span>3 5.80<span style="color: #949494;">e</span>2  464.   <span style="text-decoration: underline;">1</span>739.   866.  9.74<span style="color: #949494;">e</span>3</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 2</span> EMP      BOL        943.   53.5    167.  4.46<span style="color: #949494;">e</span>0 6.60<span style="color: #949494;">e</span>1 1.32<span style="color: #949494;">e</span>2 9.70<span style="color: #949494;">e</span>1   15.3    <span style="color: #BB0000;">NA</span>    384.  1.84<span style="color: #949494;">e</span>3</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 3</span> EMP      BRA      <span style="text-decoration: underline;">17</span>481.  225.    <span style="text-decoration: underline;">7</span>208.  3.76<span style="color: #949494;">e</span>2 4.05<span style="color: #949494;">e</span>3 6.45<span style="color: #949494;">e</span>3 1.58<span style="color: #949494;">e</span>3 <span style="text-decoration: underline;">4</span>355.   <span style="text-decoration: underline;">4</span>450.  <span style="text-decoration: underline;">4</span>479.  5.19<span style="color: #949494;">e</span>4</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 4</span> EMP      BWA        175.   12.2     13.1 3.71<span style="color: #949494;">e</span>0 1.90<span style="color: #949494;">e</span>1 2.11<span style="color: #949494;">e</span>1 6.75<span style="color: #949494;">e</span>0   10.4    53.8   31.2 3.61<span style="color: #949494;">e</span>2</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 5</span> EMP      CHL        690.   93.9    607.  2.58<span style="color: #949494;">e</span>1 2.30<span style="color: #949494;">e</span>2 4.84<span style="color: #949494;">e</span>2 2.05<span style="color: #949494;">e</span>2  106.     <span style="color: #BB0000;">NA</span>    900.  3.31<span style="color: #949494;">e</span>3</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 6</span> EMP      CHN     <span style="text-decoration: underline;">293</span>915  <span style="text-decoration: underline;">8</span>150.   <span style="text-decoration: underline;">61</span>761.  1.14<span style="color: #949494;">e</span>3 1.06<span style="color: #949494;">e</span>4 1.70<span style="color: #949494;">e</span>4 9.56<span style="color: #949494;">e</span>3 <span style="text-decoration: underline;">4</span>328.  <span style="text-decoration: underline;">19</span>468.  <span style="text-decoration: underline;">9</span>954.  4.45<span style="color: #949494;">e</span>5</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 7</span> EMP      COL       <span style="text-decoration: underline;">3</span>006.   84.0   <span style="text-decoration: underline;">1</span>033.  3.71<span style="color: #949494;">e</span>1 4.19<span style="color: #949494;">e</span>2 1.55<span style="color: #949494;">e</span>3 3.91<span style="color: #949494;">e</span>2  655.     <span style="color: #BB0000;">NA</span>   <span style="text-decoration: underline;">1</span>430.  8.63<span style="color: #949494;">e</span>3</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 8</span> EMP      CRI        216.    1.49   114.  7.92<span style="color: #949494;">e</span>0 5.50<span style="color: #949494;">e</span>1 8.98<span style="color: #949494;">e</span>1 2.55<span style="color: #949494;">e</span>1   19.6   122.    60.6 7.19<span style="color: #949494;">e</span>2</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 9</span> EMP      DEW       <span style="text-decoration: underline;">2</span>178   320.    <span style="text-decoration: underline;">8</span>459.  2.47<span style="color: #949494;">e</span>2 2.10<span style="color: #949494;">e</span>3 4.45<span style="color: #949494;">e</span>3 1.53<span style="color: #949494;">e</span>3 <span style="text-decoration: underline;">1</span>656    <span style="text-decoration: underline;">3</span>700    900   2.65<span style="color: #949494;">e</span>4</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">10</span> EMP      DNK        187.    3.75   508.  1.36<span style="color: #949494;">e</span>1 1.65<span style="color: #949494;">e</span>2 4.61<span style="color: #949494;">e</span>2 1.61<span style="color: #949494;">e</span>2  169.    642.   104.  2.42<span style="color: #949494;">e</span>3</span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 75 more rows</span></span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="fl">6</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">fmedian</span>,</span>
<span>               hybrid <span class="op">=</span> <span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html" class="external-link">select_at</a></span><span class="op">(</span><span class="fl">6</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">fmedian</span>,</span>
<span>               dplyr <span class="op">=</span> <span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html" class="external-link">select_at</a></span><span class="op">(</span><span class="fl">6</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html" class="external-link">summarise_all</a></span><span class="op">(</span><span class="va">median</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Unit: microseconds</span></span>
<span><span class="co">#      expr       min        lq       mean     median         uq        max neval</span></span>
<span><span class="co">#  collapse   423.816   495.785   569.9145   550.0615    585.428   1261.145   100</span></span>
<span><span class="co">#    hybrid 13448.108 14911.780 17313.8106 15550.9470  17750.772  44522.403   100</span></span>
<span><span class="co">#     dplyr 70346.362 80051.080 99248.1221 88413.3725 104944.992 272894.259   100</span></span></code></pre></div>
<p>Benchmarks on the different components of this code and with larger
data are provided under ‘Benchmarks’. Note that a grouped tibble created
with <code>fgroup_by</code> can no longer be used for grouped
computations with <em>dplyr</em> verbs like <code>mutate</code> or
<code>summarize</code>. <code>fgroup_by</code> first assigns the class
<em>GDP_df</em> which is for printing grouping information and
subsetting, then the object classes (<em>tbl_df</em>,
<em>data.table</em> or whatever else), followed by classes
<em>grouped_df</em> and <em>data.frame</em>, and adds the grouping
object in a ‘groups’ attribute. Since <em>tbl_df</em> is assigned before
<em>grouped_df</em>, the object is treated by the <em>dplyr</em>
ecosystem like a normal tibble.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># [1] "grouped_df" "tbl_df"     "tbl"        "data.frame"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># [1] "GRP_df"     "tbl_df"     "tbl"        "grouped_df" "data.frame"</span></span></code></pre></div>
<p>The function <code>fungroup</code> removes classes ‘GDP_df’ and
‘grouped_df’ and the ‘groups’ attribute (and can thus also be used for
grouped tibbles created with <code><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">dplyr::group_by</a></code>).</p>
<p>Note that any kind of data frame based class can be grouped with
<code>fgroup_by</code>, and still retain full responsiveness to all
methods defined for that class. Functions performing aggregation on the
grouped data frame remove the grouping object and classes afterwards,
yielding an object with the same class and attributes as the input.</p>
<p>The print method shown below reports the grouping variables, and then
in square brackets the information
<code>[number of groups | average group size (standard-deviation of group sizes)]</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 5,027 × 16</span></span></span>
<span><span class="co">#    Country Regioncode Region Variable  Year   AGR   MIN    MAN     PU    CON   WRT   TRA  FIRE   GOV</span></span>
<span><span class="co">#    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 1</span> BWA     SSA        Sub-s… VA        <span style="text-decoration: underline;">1</span>960  <span style="color: #BB0000;">NA</span>   <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 2</span> BWA     SSA        Sub-s… VA        <span style="text-decoration: underline;">1</span>961  <span style="color: #BB0000;">NA</span>   <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 3</span> BWA     SSA        Sub-s… VA        <span style="text-decoration: underline;">1</span>962  <span style="color: #BB0000;">NA</span>   <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 4</span> BWA     SSA        Sub-s… VA        <span style="text-decoration: underline;">1</span>963  <span style="color: #BB0000;">NA</span>   <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 5</span> BWA     SSA        Sub-s… VA        <span style="text-decoration: underline;">1</span>964  16.3  3.49  0.737  0.104  0.660  6.24  1.66  1.12  4.82</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 6</span> BWA     SSA        Sub-s… VA        <span style="text-decoration: underline;">1</span>965  15.7  2.50  1.02   0.135  1.35   7.06  1.94  1.25  5.70</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 7</span> BWA     SSA        Sub-s… VA        <span style="text-decoration: underline;">1</span>966  17.7  1.97  0.804  0.203  1.35   8.27  2.15  1.36  6.37</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 8</span> BWA     SSA        Sub-s… VA        <span style="text-decoration: underline;">1</span>967  19.1  2.30  0.938  0.203  0.897  4.31  1.72  1.54  7.04</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 9</span> BWA     SSA        Sub-s… VA        <span style="text-decoration: underline;">1</span>968  21.1  1.84  0.750  0.203  1.22   5.17  2.44  1.03  5.03</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">10</span> BWA     SSA        Sub-s… VA        <span style="text-decoration: underline;">1</span>969  21.9  5.24  2.14   0.578  3.47   5.75  2.72  1.23  5.59</span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 5,017 more rows</span></span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 2 more variables: OTH &lt;dbl&gt;, SUM &lt;dbl&gt;</span></span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Grouped by:  Variable, Country  [85 | 59 (7.7) 4-65]</span></span></code></pre></div>
<p>Note further that <code>fselect</code> and <code>get_vars</code> are
not full drop-in replacements for <code>select</code> because they do
not have a grouped_df method:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html" class="external-link">select_at</a></span><span class="op">(</span><span class="fl">6</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 3 × 13</span></span></span>
<span><span class="co"># <span style="color: #949494;"># Groups:   Variable, Country [1]</span></span></span>
<span><span class="co">#   Variable Country   AGR   MIN   MAN    PU   CON   WRT   TRA  FIRE   GOV   OTH    SUM</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> EMP      EGY     <span style="text-decoration: underline;">5</span>206.  29.0 <span style="text-decoration: underline;">2</span>436.  307. <span style="text-decoration: underline;">2</span>733. <span style="text-decoration: underline;">2</span>977. <span style="text-decoration: underline;">1</span>992.  801. <span style="text-decoration: underline;">5</span>539.    <span style="color: #BB0000;">NA</span> <span style="text-decoration: underline;">22</span>020.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> EMP      EGY     <span style="text-decoration: underline;">5</span>186.  27.6 <span style="text-decoration: underline;">2</span>374.  318. <span style="text-decoration: underline;">2</span>795. <span style="text-decoration: underline;">3</span>020. <span style="text-decoration: underline;">2</span>048.  815. <span style="text-decoration: underline;">5</span>636.    <span style="color: #BB0000;">NA</span> <span style="text-decoration: underline;">22</span>219.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> EMP      EGY     <span style="text-decoration: underline;">5</span>161.  24.8 <span style="text-decoration: underline;">2</span>348.  325. <span style="text-decoration: underline;">2</span>931. <span style="text-decoration: underline;">3</span>110. <span style="text-decoration: underline;">2</span>065.  832. <span style="text-decoration: underline;">5</span>736.    <span style="color: #BB0000;">NA</span> <span style="text-decoration: underline;">22</span>533.</span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="fl">6</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 3 × 11</span></span></span>
<span><span class="co">#     AGR   MIN   MAN    PU   CON   WRT   TRA  FIRE   GOV   OTH    SUM</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> <span style="text-decoration: underline;">5</span>206.  29.0 <span style="text-decoration: underline;">2</span>436.  307. <span style="text-decoration: underline;">2</span>733. <span style="text-decoration: underline;">2</span>977. <span style="text-decoration: underline;">1</span>992.  801. <span style="text-decoration: underline;">5</span>539.    <span style="color: #BB0000;">NA</span> <span style="text-decoration: underline;">22</span>020.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> <span style="text-decoration: underline;">5</span>186.  27.6 <span style="text-decoration: underline;">2</span>374.  318. <span style="text-decoration: underline;">2</span>795. <span style="text-decoration: underline;">3</span>020. <span style="text-decoration: underline;">2</span>048.  815. <span style="text-decoration: underline;">5</span>636.    <span style="color: #BB0000;">NA</span> <span style="text-decoration: underline;">22</span>219.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> <span style="text-decoration: underline;">5</span>161.  24.8 <span style="text-decoration: underline;">2</span>348.  325. <span style="text-decoration: underline;">2</span>931. <span style="text-decoration: underline;">3</span>110. <span style="text-decoration: underline;">2</span>065.  832. <span style="text-decoration: underline;">5</span>736.    <span style="color: #BB0000;">NA</span> <span style="text-decoration: underline;">22</span>533.</span></span></code></pre></div>
<p>Since by default <code>keep.group_vars = TRUE</code> in the <em>Fast
Statistical Functions</em>, the end result is nevertheless the same:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html" class="external-link">select_at</a></span><span class="op">(</span><span class="fl">6</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">fmean</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 3 × 13</span></span></span>
<span><span class="co">#   Variable Country      AGR      MIN    MAN     PU    CON    WRT    TRA   FIRE     GOV    OTH    SUM</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> VA       VEN        <span style="text-decoration: underline;">6</span>860.   <span style="text-decoration: underline;">35</span>478. 1.96<span style="color: #949494;">e</span>4 1.06<span style="color: #949494;">e</span>3 1.17<span style="color: #949494;">e</span>4 1.93<span style="color: #949494;">e</span>4 8.03<span style="color: #949494;">e</span>3 5.60<span style="color: #949494;">e</span>3 <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>  <span style="text-decoration: underline;">19</span>986. 1.28<span style="color: #949494;">e</span>5</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> VA       ZAF       <span style="text-decoration: underline;">16</span>419.   <span style="text-decoration: underline;">42</span>928. 8.76<span style="color: #949494;">e</span>4 1.38<span style="color: #949494;">e</span>4 1.64<span style="color: #949494;">e</span>4 6.83<span style="color: #949494;">e</span>4 4.53<span style="color: #949494;">e</span>4 6.64<span style="color: #949494;">e</span>4  7.58<span style="color: #949494;">e</span>4 <span style="text-decoration: underline;">30</span>167. 4.63<span style="color: #949494;">e</span>5</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> VA       ZMB     1<span style="text-decoration: underline;">268</span>849. 1<span style="text-decoration: underline;">006</span>099. 9.00<span style="color: #949494;">e</span>5 2.19<span style="color: #949494;">e</span>5 8.66<span style="color: #949494;">e</span>5 2.10<span style="color: #949494;">e</span>6 7.05<span style="color: #949494;">e</span>5 9.10<span style="color: #949494;">e</span>5  1.10<span style="color: #949494;">e</span>6 <span style="text-decoration: underline;">81</span>871. 9.16<span style="color: #949494;">e</span>6</span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="fl">6</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">fmean</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 3 × 13</span></span></span>
<span><span class="co">#   Variable Country      AGR      MIN    MAN     PU    CON    WRT    TRA   FIRE     GOV    OTH    SUM</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> VA       VEN        <span style="text-decoration: underline;">6</span>860.   <span style="text-decoration: underline;">35</span>478. 1.96<span style="color: #949494;">e</span>4 1.06<span style="color: #949494;">e</span>3 1.17<span style="color: #949494;">e</span>4 1.93<span style="color: #949494;">e</span>4 8.03<span style="color: #949494;">e</span>3 5.60<span style="color: #949494;">e</span>3 <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>  <span style="text-decoration: underline;">19</span>986. 1.28<span style="color: #949494;">e</span>5</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> VA       ZAF       <span style="text-decoration: underline;">16</span>419.   <span style="text-decoration: underline;">42</span>928. 8.76<span style="color: #949494;">e</span>4 1.38<span style="color: #949494;">e</span>4 1.64<span style="color: #949494;">e</span>4 6.83<span style="color: #949494;">e</span>4 4.53<span style="color: #949494;">e</span>4 6.64<span style="color: #949494;">e</span>4  7.58<span style="color: #949494;">e</span>4 <span style="text-decoration: underline;">30</span>167. 4.63<span style="color: #949494;">e</span>5</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> VA       ZMB     1<span style="text-decoration: underline;">268</span>849. 1<span style="text-decoration: underline;">006</span>099. 9.00<span style="color: #949494;">e</span>5 2.19<span style="color: #949494;">e</span>5 8.66<span style="color: #949494;">e</span>5 2.10<span style="color: #949494;">e</span>6 7.05<span style="color: #949494;">e</span>5 9.10<span style="color: #949494;">e</span>5  1.10<span style="color: #949494;">e</span>6 <span style="text-decoration: underline;">81</span>871. 9.16<span style="color: #949494;">e</span>6</span></span></code></pre></div>
<p>Another useful verb introduced by <em>collapse</em> is
<code>fgroup_vars</code>, which can be used to efficiently obtain the
grouping columns or grouping variables from a grouped tibble:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fgroup_by fully supports grouped tibbles created with group_by or fgroup_by: </span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">fgroup_vars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">#   Variable Country</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> VA       BWA    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> VA       BWA    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> VA       BWA</span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">fgroup_vars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">#   Variable Country</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> VA       BWA    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> VA       BWA    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> VA       BWA</span></span>
<span></span>
<span><span class="co"># The other possibilities:</span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/GRP.html">fgroup_vars</a></span><span class="op">(</span><span class="st">"unique"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">#   Variable Country</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> EMP      ARG    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> EMP      BOL    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> EMP      BRA</span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/GRP.html">fgroup_vars</a></span><span class="op">(</span><span class="st">"names"</span><span class="op">)</span></span>
<span><span class="co"># [1] "Variable" "Country"</span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/GRP.html">fgroup_vars</a></span><span class="op">(</span><span class="st">"indices"</span><span class="op">)</span></span>
<span><span class="co"># [1] 4 1</span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/GRP.html">fgroup_vars</a></span><span class="op">(</span><span class="st">"named_indices"</span><span class="op">)</span></span>
<span><span class="co"># Variable  Country </span></span>
<span><span class="co">#        4        1</span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/GRP.html">fgroup_vars</a></span><span class="op">(</span><span class="st">"logical"</span><span class="op">)</span></span>
<span><span class="co">#  [1]  TRUE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/GRP.html">fgroup_vars</a></span><span class="op">(</span><span class="st">"named_logical"</span><span class="op">)</span></span>
<span><span class="co">#    Country Regioncode     Region   Variable       Year        AGR        MIN        MAN         PU </span></span>
<span><span class="co">#       TRUE      FALSE      FALSE       TRUE      FALSE      FALSE      FALSE      FALSE      FALSE </span></span>
<span><span class="co">#        CON        WRT        TRA       FIRE        GOV        OTH        SUM </span></span>
<span><span class="co">#      FALSE      FALSE      FALSE      FALSE      FALSE      FALSE      FALSE</span></span></code></pre></div>
<p>Another <em>collapse</em> verb to mention here is
<code>fsubset</code>, a faster alternative to <code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">dplyr::filter</a></code>
which also provides an option to flexibly subset columns after the
select argument:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Two equivalent calls, the first is substantially faster</span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/fsubset.html">fsubset</a></span><span class="op">(</span><span class="va">Variable</span> <span class="op">==</span> <span class="st">"VA"</span> <span class="op">&amp;</span> <span class="va">Year</span> <span class="op">&gt;</span> <span class="fl">1990</span>, <span class="va">Country</span>, <span class="va">Year</span>, <span class="va">AGR</span><span class="op">:</span><span class="va">GOV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 3 × 11</span></span></span>
<span><span class="co">#   Country  Year   AGR   MIN   MAN    PU   CON   WRT   TRA  FIRE   GOV</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> BWA      <span style="text-decoration: underline;">1</span>991  303. <span style="text-decoration: underline;">2</span>647.  473.  161.  580.  807.  233.  433. <span style="text-decoration: underline;">1</span>073.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> BWA      <span style="text-decoration: underline;">1</span>992  333. <span style="text-decoration: underline;">2</span>691.  537.  178.  679.  725.  285.  517. <span style="text-decoration: underline;">1</span>234.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> BWA      <span style="text-decoration: underline;">1</span>993  405. <span style="text-decoration: underline;">2</span>625.  567.  219.  634.  772.  350.  673. <span style="text-decoration: underline;">1</span>487.</span></span>
<span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Variable</span> <span class="op">==</span> <span class="st">"VA"</span> <span class="op">&amp;</span> <span class="va">Year</span> <span class="op">&gt;</span> <span class="fl">1990</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Country</span>, <span class="va">Year</span>, <span class="va">AGR</span><span class="op">:</span><span class="va">GOV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 3 × 11</span></span></span>
<span><span class="co">#   Country  Year   AGR   MIN   MAN    PU   CON   WRT   TRA  FIRE   GOV</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> BWA      <span style="text-decoration: underline;">1</span>991  303. <span style="text-decoration: underline;">2</span>647.  473.  161.  580.  807.  233.  433. <span style="text-decoration: underline;">1</span>073.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> BWA      <span style="text-decoration: underline;">1</span>992  333. <span style="text-decoration: underline;">2</span>691.  537.  178.  679.  725.  285.  517. <span style="text-decoration: underline;">1</span>234.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> BWA      <span style="text-decoration: underline;">1</span>993  405. <span style="text-decoration: underline;">2</span>625.  567.  219.  634.  772.  350.  673. <span style="text-decoration: underline;">1</span>487.</span></span></code></pre></div>
<p><em>collapse</em> also offers <code>roworder</code>,
<code>frename</code>, <code>colorder</code> and
<code>ftransform</code>/<code>TRA</code> as fast replacements for
<code><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">dplyr::arrange</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">dplyr::rename</a></code>,
<code><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">dplyr::relocate</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">dplyr::mutate</a></code>.</p>
</div>
<div class="section level3">
<h3 id="multi-function-aggregations">1.3 Multi-Function Aggregations<a class="anchor" aria-label="anchor" href="#multi-function-aggregations"></a>
</h3>
<p>One can also aggregate with multiple functions at the same time. For
such operations it is often necessary to use curly braces <code>{</code>
to prevent first argument injection so that
<code>%&gt;% cbind(FUN1(.), FUN2(.))</code> does not evaluate as
<code>%&gt;% cbind(., FUN1(.), FUN2(.))</code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="fl">6</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="../reference/fnth_fmedian.html">fmedian</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="../reference/small-helpers.html">add_stub</a></span><span class="op">(</span><span class="fu"><a href="../reference/fmean.html">fmean</a></span><span class="op">(</span><span class="va">.</span>, keep.group_vars <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, <span class="st">"mean_"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#   Variable Country        AGR       MIN       MAN         PU        CON      WRT        TRA</span></span>
<span><span class="co"># 1      EMP     ARG  1324.5255  47.35255 1987.5912 104.738825  782.40283 1854.612  579.93982</span></span>
<span><span class="co"># 2      EMP     BOL   943.1612  53.53538  167.1502   4.457895   65.97904  132.225   96.96828</span></span>
<span><span class="co"># 3      EMP     BRA 17480.9810 225.43693 7207.7915 375.851832 4054.66103 6454.523 1580.81120</span></span>
<span><span class="co">#         FIRE      GOV       OTH       SUM   mean_AGR  mean_MIN  mean_MAN    mean_PU  mean_CON</span></span>
<span><span class="co"># 1  464.39920 1738.836  866.1119  9743.223  1419.8013  52.08903 1931.7602 101.720936  742.4044</span></span>
<span><span class="co"># 2   15.34259       NA  384.0678  1842.055   964.2103  56.03295  235.0332   5.346433  122.7827</span></span>
<span><span class="co"># 3 4354.86210 4449.942 4478.6927 51881.110 17191.3529 206.02389 6991.3710 364.573404 3524.7384</span></span>
<span><span class="co">#    mean_WRT  mean_TRA  mean_FIRE mean_GOV  mean_OTH  mean_SUM</span></span>
<span><span class="co"># 1 1982.1775  648.5119  627.79291 2043.471  992.4475 10542.177</span></span>
<span><span class="co"># 2  281.5164  115.4728   44.56442       NA  395.5650  2220.524</span></span>
<span><span class="co"># 3 8509.4612 2054.3731 4413.54448 5307.280 5710.2665 54272.985</span></span></code></pre></div>
<p>The function <code>add_stub</code> used above is a <em>collapse</em>
function adding a prefix (default) or suffix to variables names. The
<em>collapse</em> predicate <code>add_vars</code> provides a more
efficient alternative to <code>cbind.data.frame</code>. The idea here is
‘adding’ variables to the data.frame in the first argument i.e. the
attributes of the first argument are preserved, so the expression below
still gives a tibble instead of a data.frame:</p>
<!-- A slightly more elegant solution to such multi-function aggregations can be found using `get_vars`, a collapse predicate to efficiently select variables. In contrast to `select_at`, `get_vars` does not automatically add the grouping columns to the selection. -->
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="op">{</span></span>
<span>   <span class="fu"><a href="../reference/select_replace_vars.html">add_vars</a></span><span class="op">(</span><span class="fu"><a href="../reference/select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"Reg"</span>, regex <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">ffirst</span>, <span class="co"># Regular expression matching column names</span></span>
<span>            <span class="fu"><a href="../reference/select_replace_vars.html">num_vars</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/fmean.html">fmean</a></span><span class="op">(</span>keep.group_vars <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/small-helpers.html">add_stub</a></span><span class="op">(</span><span class="st">"mean_"</span><span class="op">)</span>, <span class="co"># num_vars selects all numeric variables</span></span>
<span>            <span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">PU</span><span class="op">:</span><span class="va">TRA</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/fnth_fmedian.html">fmedian</a></span><span class="op">(</span>keep.group_vars <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/small-helpers.html">add_stub</a></span><span class="op">(</span><span class="st">"median_"</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">PU</span><span class="op">:</span><span class="va">CON</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/fmin_fmax.html">fmin</a></span><span class="op">(</span>keep.group_vars <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/small-helpers.html">add_stub</a></span><span class="op">(</span><span class="st">"min_"</span><span class="op">)</span><span class="op">)</span>      </span>
<span>  <span class="op">}</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 3 × 22</span></span></span>
<span><span class="co">#   Variable Country Regioncode Region  mean_Year mean_AGR mean_MIN mean_MAN mean_PU mean_CON mean_WRT</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> EMP      ARG     LAM        Latin …     <span style="text-decoration: underline;">1</span>980.    <span style="text-decoration: underline;">1</span>420.     52.1    <span style="text-decoration: underline;">1</span>932.  102.       742.    <span style="text-decoration: underline;">1</span>982.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> EMP      BOL     LAM        Latin …     <span style="text-decoration: underline;">1</span>980      964.     56.0     235.    5.35     123.     282.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> EMP      BRA     LAM        Latin …     <span style="text-decoration: underline;">1</span>980.   <span style="text-decoration: underline;">17</span>191.    206.     <span style="text-decoration: underline;">6</span>991.  365.      <span style="text-decoration: underline;">3</span>525.    <span style="text-decoration: underline;">8</span>509.</span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 11 more variables: mean_TRA &lt;dbl&gt;, mean_FIRE &lt;dbl&gt;, mean_GOV &lt;dbl&gt;, mean_OTH &lt;dbl&gt;,</span></span></span>
<span><span class="co"># <span style="color: #949494;">#   mean_SUM &lt;dbl&gt;, median_PU &lt;dbl&gt;, median_CON &lt;dbl&gt;, median_WRT &lt;dbl&gt;, median_TRA &lt;dbl&gt;,</span></span></span>
<span><span class="co"># <span style="color: #949494;">#   min_PU &lt;dbl&gt;, min_CON &lt;dbl&gt;</span></span></span></code></pre></div>
<p>Another nice feature of <code>add_vars</code> is that it can also
very efficiently reorder columns i.e. bind columns in a different order
than they are passed. This can be done by simply specifying the
positions the added columns should have in the final data frame, and
then <code>add_vars</code> shifts the first argument columns to the
right to fill in the gaps.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/fsubset.html">fsubset</a></span><span class="op">(</span><span class="va">Variable</span> <span class="op">==</span> <span class="st">"VA"</span>, <span class="va">Country</span>, <span class="va">AGR</span>, <span class="va">SUM</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="op">{</span></span>
<span>   <span class="fu"><a href="../reference/select_replace_vars.html">add_vars</a></span><span class="op">(</span><span class="fu"><a href="../reference/GRP.html">fgroup_vars</a></span><span class="op">(</span><span class="va">.</span>,<span class="st">"unique"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="../reference/fmean.html">fmean</a></span><span class="op">(</span><span class="va">.</span>, keep.group_vars <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/small-helpers.html">add_stub</a></span><span class="op">(</span><span class="st">"mean_"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="../reference/fvar_fsd.html">fsd</a></span><span class="op">(</span><span class="va">.</span>, keep.group_vars <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/small-helpers.html">add_stub</a></span><span class="op">(</span><span class="st">"sd_"</span><span class="op">)</span>, </span>
<span>            pos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 3 × 5</span></span></span>
<span><span class="co">#   Country mean_AGR sd_AGR mean_SUM  sd_SUM</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> ARG       <span style="text-decoration: underline;">14</span>951. <span style="text-decoration: underline;">33</span>061.  <span style="text-decoration: underline;">152</span>534. <span style="text-decoration: underline;">301</span>316.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> BOL        <span style="text-decoration: underline;">3</span>300.  <span style="text-decoration: underline;">4</span>456.   <span style="text-decoration: underline;">22</span>619.  <span style="text-decoration: underline;">33</span>173.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> BRA       <span style="text-decoration: underline;">76</span>870. <span style="text-decoration: underline;">59</span>442. 1<span style="text-decoration: underline;">200</span>563. <span style="text-decoration: underline;">976</span>963.</span></span></code></pre></div>
<p>A much more compact solution to multi-function and multi-type
aggregation is offered by the function <em>collapg</em>:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This aggregates numeric colums using the mean (fmean) and categorical columns with the mode (fmode)</span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">collapg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 3 × 16</span></span></span>
<span><span class="co">#   Variable Country Regioncode Region   Year    AGR   MIN   MAN     PU   CON   WRT   TRA   FIRE   GOV</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> EMP      ARG     LAM        Latin … <span style="text-decoration: underline;">1</span>980.  <span style="text-decoration: underline;">1</span>420.  52.1 <span style="text-decoration: underline;">1</span>932. 102.    742. <span style="text-decoration: underline;">1</span>982.  649.  628.  <span style="text-decoration: underline;">2</span>043.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> EMP      BOL     LAM        Latin … <span style="text-decoration: underline;">1</span>980    964.  56.0  235.   5.35  123.  282.  115.   44.6   <span style="color: #BB0000;">NA</span> </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> EMP      BRA     LAM        Latin … <span style="text-decoration: underline;">1</span>980. <span style="text-decoration: underline;">17</span>191. 206.  <span style="text-decoration: underline;">6</span>991. 365.   <span style="text-decoration: underline;">3</span>525. <span style="text-decoration: underline;">8</span>509. <span style="text-decoration: underline;">2</span>054. <span style="text-decoration: underline;">4</span>414.  <span style="text-decoration: underline;">5</span>307.</span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 2 more variables: OTH &lt;dbl&gt;, SUM &lt;dbl&gt;</span></span></span></code></pre></div>
<p>By default it aggregates numeric columns using the <code>fmean</code>
and categorical columns using <code>fmode</code>, and preserves the
order of all columns. Changing these defaults is very easy:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This aggregates numeric colums using the median and categorical columns using the first value</span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/collap.html">collapg</a></span><span class="op">(</span><span class="va">fmedian</span>, <span class="va">flast</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 3 × 16</span></span></span>
<span><span class="co">#   Variable Country Regioncode Region       Year    AGR   MIN   MAN     PU    CON   WRT    TRA   FIRE</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> EMP      ARG     LAM        Latin Amer… <span style="text-decoration: underline;">1</span>980.  <span style="text-decoration: underline;">1</span>325.  47.4 <span style="text-decoration: underline;">1</span>988. 105.    782.  <span style="text-decoration: underline;">1</span>855.  580.   464. </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> EMP      BOL     LAM        Latin Amer… <span style="text-decoration: underline;">1</span>980    943.  53.5  167.   4.46   66.0  132.   97.0   15.3</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> EMP      BRA     LAM        Latin Amer… <span style="text-decoration: underline;">1</span>980. <span style="text-decoration: underline;">17</span>481. 225.  <span style="text-decoration: underline;">7</span>208. 376.   <span style="text-decoration: underline;">4</span>055.  <span style="text-decoration: underline;">6</span>455. <span style="text-decoration: underline;">1</span>581.  <span style="text-decoration: underline;">4</span>355. </span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 3 more variables: GOV &lt;dbl&gt;, OTH &lt;dbl&gt;, SUM &lt;dbl&gt;</span></span></span></code></pre></div>
<p>One can apply multiple functions to both numeric and/or categorical
data:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/collap.html">collapg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fmean</span>, <span class="va">fmedian</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">first</span>, <span class="va">fmode</span>, <span class="va">flast</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 3 × 32</span></span></span>
<span><span class="co">#   Variable Country first.Regioncode fmode.Regioncode flast.Regioncode first.Region  fmode.Region </span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> EMP      ARG     LAM              LAM              LAM              Latin America Latin America</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> EMP      BOL     LAM              LAM              LAM              Latin America Latin America</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> EMP      BRA     LAM              LAM              LAM              Latin America Latin America</span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 25 more variables: flast.Region &lt;chr&gt;, fmean.Year &lt;dbl&gt;, fmedian.Year &lt;dbl&gt;, fmean.AGR &lt;dbl&gt;,</span></span></span>
<span><span class="co"># <span style="color: #949494;">#   fmedian.AGR &lt;dbl&gt;, fmean.MIN &lt;dbl&gt;, fmedian.MIN &lt;dbl&gt;, fmean.MAN &lt;dbl&gt;, fmedian.MAN &lt;dbl&gt;,</span></span></span>
<span><span class="co"># <span style="color: #949494;">#   fmean.PU &lt;dbl&gt;, fmedian.PU &lt;dbl&gt;, fmean.CON &lt;dbl&gt;, fmedian.CON &lt;dbl&gt;, fmean.WRT &lt;dbl&gt;,</span></span></span>
<span><span class="co"># <span style="color: #949494;">#   fmedian.WRT &lt;dbl&gt;, fmean.TRA &lt;dbl&gt;, fmedian.TRA &lt;dbl&gt;, fmean.FIRE &lt;dbl&gt;, fmedian.FIRE &lt;dbl&gt;,</span></span></span>
<span><span class="co"># <span style="color: #949494;">#   fmean.GOV &lt;dbl&gt;, fmedian.GOV &lt;dbl&gt;, fmean.OTH &lt;dbl&gt;, fmedian.OTH &lt;dbl&gt;, fmean.SUM &lt;dbl&gt;,</span></span></span>
<span><span class="co"># <span style="color: #949494;">#   fmedian.SUM &lt;dbl&gt;</span></span></span></code></pre></div>
<p>Applying multiple functions to only numeric (or only categorical)
data allows return in a long format:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/collap.html">collapg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fmean</span>, <span class="va">fmedian</span><span class="op">)</span>, cols <span class="op">=</span> <span class="va">is.numeric</span>, return <span class="op">=</span> <span class="st">"long"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 3 × 15</span></span></span>
<span><span class="co">#   Function Variable Country  Year    AGR   MIN   MAN     PU   CON   WRT   TRA   FIRE   GOV   OTH</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> fmean    EMP      ARG     <span style="text-decoration: underline;">1</span>980.  <span style="text-decoration: underline;">1</span>420.  52.1 <span style="text-decoration: underline;">1</span>932. 102.    742. <span style="text-decoration: underline;">1</span>982.  649.  628.  <span style="text-decoration: underline;">2</span>043.  992.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> fmean    EMP      BOL     <span style="text-decoration: underline;">1</span>980    964.  56.0  235.   5.35  123.  282.  115.   44.6   <span style="color: #BB0000;">NA</span>   396.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> fmean    EMP      BRA     <span style="text-decoration: underline;">1</span>980. <span style="text-decoration: underline;">17</span>191. 206.  <span style="text-decoration: underline;">6</span>991. 365.   <span style="text-decoration: underline;">3</span>525. <span style="text-decoration: underline;">8</span>509. <span style="text-decoration: underline;">2</span>054. <span style="text-decoration: underline;">4</span>414.  <span style="text-decoration: underline;">5</span>307. <span style="text-decoration: underline;">5</span>710.</span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 1 more variable: SUM &lt;dbl&gt;</span></span></span></code></pre></div>
<p>Finally, <code>collapg</code> also makes it very easy to apply
aggregator functions to certain columns only:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/collap.html">collapg</a></span><span class="op">(</span>custom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fmean <span class="op">=</span> <span class="fl">6</span><span class="op">:</span><span class="fl">8</span>, fmedian <span class="op">=</span> <span class="fl">10</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 3 × 8</span></span></span>
<span><span class="co">#   Variable Country    AGR   MIN   MAN    CON   WRT    TRA</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> EMP      ARG      <span style="text-decoration: underline;">1</span>420.  52.1 <span style="text-decoration: underline;">1</span>932.  782.  <span style="text-decoration: underline;">1</span>855.  580. </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> EMP      BOL       964.  56.0  235.   66.0  132.   97.0</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> EMP      BRA     <span style="text-decoration: underline;">17</span>191. 206.  <span style="text-decoration: underline;">6</span>991. <span style="text-decoration: underline;">4</span>055.  <span style="text-decoration: underline;">6</span>455. <span style="text-decoration: underline;">1</span>581.</span></span></code></pre></div>
<p>To understand more about <code>collapg</code>, look it up in the
documentation (<code><a href="../reference/collap.html">?collapg</a></code>).</p>
</div>
<div class="section level3">
<h3 id="weighted-aggregations">1.4 Weighted Aggregations<a class="anchor" aria-label="anchor" href="#weighted-aggregations"></a>
</h3>
<p>Weighted aggregations are possible with the functions
<code>fsum, fprod, fmean, fmedian, fnth, fmode, fvar</code> and
<code>fsd</code>. The implementation is such that by default (option
<code>keep.w = TRUE</code>) these functions also aggregate the weights,
so that further weighted computations can be performed on the aggregated
data. <code>fprod</code> saves the product of the weights, whereas the
other functions save the sum of the weights in a column next to the
grouping variables. If <code>na.rm = TRUE</code> (the default), rows
with missing weights are omitted from the computation.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This computes a frequency-weighted grouped standard-deviation, taking the total EMP / VA as weight</span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="va">AGR</span><span class="op">:</span><span class="va">SUM</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/fvar_fsd.html">fsd</a></span><span class="op">(</span><span class="va">SUM</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 3 × 13</span></span></span>
<span><span class="co">#   Variable Country  sum.SUM    AGR   MIN   MAN    PU   CON   WRT    TRA   FIRE   GOV   OTH</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> EMP      ARG      <span style="text-decoration: underline;">653</span>615.  225.   22.2  176. 20.5   285.  856.  195.   493.  <span style="text-decoration: underline;">1</span>123.  506.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> EMP      BOL      <span style="text-decoration: underline;">135</span>452.   99.7  17.1  168.  4.87  123.  324.   98.1   69.8   <span style="color: #BB0000;">NA</span>   258.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> EMP      BRA     3<span style="text-decoration: underline;">364</span>925. <span style="text-decoration: underline;">1</span>587.   73.8 <span style="text-decoration: underline;">2</span>952. 93.8  <span style="text-decoration: underline;">1</span>861. <span style="text-decoration: underline;">6</span>285. <span style="text-decoration: underline;">1</span>306.  <span style="text-decoration: underline;">3</span>003.  <span style="text-decoration: underline;">3</span>621. <span style="text-decoration: underline;">4</span>257.</span></span>
<span></span>
<span><span class="co"># This computes a weighted grouped mode, taking the total EMP / VA as weight</span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="va">AGR</span><span class="op">:</span><span class="va">SUM</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/fmode.html">fmode</a></span><span class="op">(</span><span class="va">SUM</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 3 × 13</span></span></span>
<span><span class="co">#   Variable Country  sum.SUM    AGR   MIN    MAN    PU   CON    WRT   TRA   FIRE    GOV    OTH</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> EMP      ARG      <span style="text-decoration: underline;">653</span>615.  <span style="text-decoration: underline;">1</span>162. 127.   <span style="text-decoration: underline;">2</span>164. 152.  <span style="text-decoration: underline;">1</span>415.  <span style="text-decoration: underline;">3</span>768. <span style="text-decoration: underline;">1</span>060.  <span style="text-decoration: underline;">1</span>748.  <span style="text-decoration: underline;">4</span>336.  <span style="text-decoration: underline;">1</span>999.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> EMP      BOL      <span style="text-decoration: underline;">135</span>452.   819.  37.6   604.  10.8  433.   893.  333.   321.    <span style="color: #BB0000;">NA</span>   <span style="text-decoration: underline;">1</span>057.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> EMP      BRA     3<span style="text-decoration: underline;">364</span>925. <span style="text-decoration: underline;">16</span>451. 313.  <span style="text-decoration: underline;">11</span>841. 388.  <span style="text-decoration: underline;">8</span>154. <span style="text-decoration: underline;">21</span>860. <span style="text-decoration: underline;">5</span>169. <span style="text-decoration: underline;">12</span>011. <span style="text-decoration: underline;">12</span>149. <span style="text-decoration: underline;">14</span>235.</span></span></code></pre></div>
<p>The weighted variance / standard deviation is currently only
implemented with frequency weights.
<!-- Reliability weights may be implemented in a future update of *collapse*, if this is a strongly requested feature. --></p>
<p>Weighted aggregations may also be performed with
<code>collapg</code>. By default <code>fsum</code> is used to compute a
sum of the weights, but it is also possible here to aggregate the
weights with other functions:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This aggregates numeric colums using the weighted mean (the default) and categorical columns using the weighted mode (the default).</span></span>
<span><span class="co"># Weights (column SUM) are aggregated using both the sum and the maximum. </span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/collap.html">collapg</a></span><span class="op">(</span>w <span class="op">=</span> <span class="va">SUM</span>, wFUN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fsum</span>, <span class="va">fmax</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 3 × 17</span></span></span>
<span><span class="co">#   Variable Country fsum.SUM fmax.SUM Regioncode Region   Year    AGR   MIN   MAN     PU   CON    WRT</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> EMP      ARG      <span style="text-decoration: underline;">653</span>615.   <span style="text-decoration: underline;">17</span>929. LAM        Latin … <span style="text-decoration: underline;">1</span>985.  <span style="text-decoration: underline;">1</span>361.  56.5 <span style="text-decoration: underline;">1</span>935. 105.    811.  <span style="text-decoration: underline;">2</span>217.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> EMP      BOL      <span style="text-decoration: underline;">135</span>452.    <span style="text-decoration: underline;">4</span>508. LAM        Latin … <span style="text-decoration: underline;">1</span>987.   977.  57.9  296.   7.07  167.   400.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> EMP      BRA     3<span style="text-decoration: underline;">364</span>925.  <span style="text-decoration: underline;">102</span>572. LAM        Latin … <span style="text-decoration: underline;">1</span>989. <span style="text-decoration: underline;">17</span>746. 238.  <span style="text-decoration: underline;">8</span>466. 389.   <span style="text-decoration: underline;">4</span>436. <span style="text-decoration: underline;">11</span>376.</span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 4 more variables: TRA &lt;dbl&gt;, FIRE &lt;dbl&gt;, GOV &lt;dbl&gt;, OTH &lt;dbl&gt;</span></span></span></code></pre></div>
<!-- Thus to aggregate the entire data and save the weights one would need to opt for a manual solution: -->
<!-- ```{r} -->
<!-- GGDC10S %>% -->
<!--   fgroup_by(Variable, Country) %>% { -->
<!--     add_vars(fmean(get_vars(., 6:16), SUM), -->
<!--              fmode(get_vars(., c(2:3,16)), SUM, keep.group_vars = FALSE), -->
<!--              pos = c(5, 2:3)) -->
<!--   } -->
<!-- ``` -->
<!-- <!-- ```{r} -->
<!-- <!-- GGDC10S %>%  -->
<!-- <!--   group_by(Variable, Country) %>% collapg(w = .$SUM) -->
<!-- ``` -->
</div>
</div>
<div class="section level2">
<h2 id="fast-transformations">2. Fast Transformations<a class="anchor" aria-label="anchor" href="#fast-transformations"></a>
</h2>
<p><em>collapse</em> also provides some fast transformations that
significantly extend the scope and speed of manipulations that can be
performed with <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">dplyr::mutate</a></code>.
<!-- bring to *dplyr* in terms of grouped transformations. --></p>
<div class="section level3">
<h3 id="fast-transform-and-compute-variables">2.1 Fast Transform and Compute Variables<a class="anchor" aria-label="anchor" href="#fast-transform-and-compute-variables"></a>
</h3>
<p>The function <code>ftransform</code> can be used to manipulate
columns in the same ways as <code>mutate</code>:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/fsubset.html">fsubset</a></span><span class="op">(</span><span class="va">Variable</span> <span class="op">==</span> <span class="st">"VA"</span>, <span class="va">Country</span>, <span class="va">Year</span>, <span class="va">AGR</span>, <span class="va">SUM</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/ftransform.html">ftransform</a></span><span class="op">(</span>AGR_perc <span class="op">=</span> <span class="va">AGR</span> <span class="op">/</span> <span class="va">SUM</span> <span class="op">*</span> <span class="fl">100</span>,  <span class="co"># Computing % of VA in Agriculture</span></span>
<span>             AGR_mean <span class="op">=</span> <span class="fu"><a href="../reference/fmean.html">fmean</a></span><span class="op">(</span><span class="va">AGR</span><span class="op">)</span>,       <span class="co"># Average Agricultural VA</span></span>
<span>             AGR <span class="op">=</span> <span class="cn">NULL</span>, SUM <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  <span class="co"># Deleting columns AGR and SUM</span></span>
<span>             <span class="va">head</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#   Country  Year AGR_perc AGR_mean</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> BWA      <span style="text-decoration: underline;">1</span>960     <span style="color: #BB0000;">NA</span>   5<span style="text-decoration: underline;">137</span>561.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> BWA      <span style="text-decoration: underline;">1</span>961     <span style="color: #BB0000;">NA</span>   5<span style="text-decoration: underline;">137</span>561.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> BWA      <span style="text-decoration: underline;">1</span>962     <span style="color: #BB0000;">NA</span>   5<span style="text-decoration: underline;">137</span>561.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">4</span> BWA      <span style="text-decoration: underline;">1</span>963     <span style="color: #BB0000;">NA</span>   5<span style="text-decoration: underline;">137</span>561.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">5</span> BWA      <span style="text-decoration: underline;">1</span>964     43.5 5<span style="text-decoration: underline;">137</span>561.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">6</span> BWA      <span style="text-decoration: underline;">1</span>965     40.0 5<span style="text-decoration: underline;">137</span>561.</span></span></code></pre></div>
<p>The modification brought by <code>ftransformv</code> enables
transformations of groups of columns like <code><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">dplyr::mutate_at</a></code>
and <code><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">dplyr::mutate_if</a></code>:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This replaces variables mpg, carb and wt by their log (.c turns expressions into character vectors)</span></span>
<span><span class="va">mtcars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/ftransform.html">ftransformv</a></span><span class="op">(</span><span class="fu"><a href="../reference/small-helpers.html">.c</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="va">carb</span>, <span class="va">wt</span><span class="op">)</span>, <span class="va">log</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">head</span></span>
<span><span class="co">#                        mpg cyl disp  hp drat        wt  qsec vs am gear      carb</span></span>
<span><span class="co"># Mazda RX4         3.044522   6  160 110 3.90 0.9631743 16.46  0  1    4 1.3862944</span></span>
<span><span class="co"># Mazda RX4 Wag     3.044522   6  160 110 3.90 1.0560527 17.02  0  1    4 1.3862944</span></span>
<span><span class="co"># Datsun 710        3.126761   4  108  93 3.85 0.8415672 18.61  1  1    4 0.0000000</span></span>
<span><span class="co"># Hornet 4 Drive    3.063391   6  258 110 3.08 1.1678274 19.44  1  0    3 0.0000000</span></span>
<span><span class="co"># Hornet Sportabout 2.928524   8  360 175 3.15 1.2354715 17.02  0  0    3 0.6931472</span></span>
<span><span class="co"># Valiant           2.895912   6  225 105 2.76 1.2412686 20.22  1  0    3 0.0000000</span></span>
<span></span>
<span><span class="co"># Logging numeric variables</span></span>
<span><span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/ftransform.html">ftransformv</a></span><span class="op">(</span><span class="va">is.numeric</span>, <span class="va">log</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">head</span></span>
<span><span class="co">#   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span><span class="co"># 1     1.629241    1.252763    0.3364722  -1.6094379  setosa</span></span>
<span><span class="co"># 2     1.589235    1.098612    0.3364722  -1.6094379  setosa</span></span>
<span><span class="co"># 3     1.547563    1.163151    0.2623643  -1.6094379  setosa</span></span>
<span><span class="co"># 4     1.526056    1.131402    0.4054651  -1.6094379  setosa</span></span>
<span><span class="co"># 5     1.609438    1.280934    0.3364722  -1.6094379  setosa</span></span>
<span><span class="co"># 6     1.686399    1.360977    0.5306283  -0.9162907  setosa</span></span></code></pre></div>
<p>Instead of <code>column = value</code> type arguments, it is also
possible to pass a single list of transformed variables to
<code>ftransform</code>, which will be regarded in the same way as an
evaluated list of <code>column = value</code> arguments. It can be used
for more complex transformations:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Logging values and replacing generated Inf values</span></span>
<span><span class="va">mtcars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/ftransform.html">ftransform</a></span><span class="op">(</span><span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">mpg</span>, <span class="va">cyl</span>, <span class="va">vs</span><span class="op">:</span><span class="va">gear</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">log</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">replace_Inf</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">head</span></span>
<span><span class="co">#                        mpg      cyl disp  hp drat    wt  qsec vs am     gear carb</span></span>
<span><span class="co"># Mazda RX4         3.044522 1.791759  160 110 3.90 2.620 16.46 NA  0 1.386294    4</span></span>
<span><span class="co"># Mazda RX4 Wag     3.044522 1.791759  160 110 3.90 2.875 17.02 NA  0 1.386294    4</span></span>
<span><span class="co"># Datsun 710        3.126761 1.386294  108  93 3.85 2.320 18.61  0  0 1.386294    1</span></span>
<span><span class="co"># Hornet 4 Drive    3.063391 1.791759  258 110 3.08 3.215 19.44  0 NA 1.098612    1</span></span>
<span><span class="co"># Hornet Sportabout 2.928524 2.079442  360 175 3.15 3.440 17.02 NA NA 1.098612    2</span></span>
<span><span class="co"># Valiant           2.895912 1.791759  225 105 2.76 3.460 20.22  0 NA 1.098612    1</span></span></code></pre></div>
<p>If only the computed columns need to be returned,
<code>fcompute</code> provides an efficient alternative:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/fsubset.html">fsubset</a></span><span class="op">(</span><span class="va">Variable</span> <span class="op">==</span> <span class="st">"VA"</span>, <span class="va">Country</span>, <span class="va">Year</span>, <span class="va">AGR</span>, <span class="va">SUM</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/ftransform.html">fcompute</a></span><span class="op">(</span>AGR_perc <span class="op">=</span> <span class="va">AGR</span> <span class="op">/</span> <span class="va">SUM</span> <span class="op">*</span> <span class="fl">100</span>,</span>
<span>           AGR_mean <span class="op">=</span> <span class="fu"><a href="../reference/fmean.html">fmean</a></span><span class="op">(</span><span class="va">AGR</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">head</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">#   AGR_perc AGR_mean</span></span>
<span><span class="co">#      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span>     <span style="color: #BB0000;">NA</span>   5<span style="text-decoration: underline;">137</span>561.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span>     <span style="color: #BB0000;">NA</span>   5<span style="text-decoration: underline;">137</span>561.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span>     <span style="color: #BB0000;">NA</span>   5<span style="text-decoration: underline;">137</span>561.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">4</span>     <span style="color: #BB0000;">NA</span>   5<span style="text-decoration: underline;">137</span>561.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">5</span>     43.5 5<span style="text-decoration: underline;">137</span>561.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">6</span>     40.0 5<span style="text-decoration: underline;">137</span>561.</span></span></code></pre></div>
<p><code>ftransform</code> and <code>fcompute</code> are an order of
magnitude faster than <code>mutate</code>, but they do not support
grouped computations using arbitrary functions. We will see that this is
hardly a limitation as <em>collapse</em> provides very efficient and
elegant alternative programming mechanisms…</p>
</div>
<div class="section level3">
<h3 id="replacing-and-sweeping-out-statistics">2.2 Replacing and Sweeping out Statistics<a class="anchor" aria-label="anchor" href="#replacing-and-sweeping-out-statistics"></a>
</h3>
<!-- using Fast Statistical Functions -->
<p>All statistical (scalar-valued) functions in the collapse package
(<code>fsum, fprod, fmean, fmedian, fmode, fvar, fsd, fmin, fmax, fnth, ffirst, flast, fnobs, fndistinct</code>)
have a <code>TRA</code> argument which can be used to efficiently
transform data by either (column-wise) replacing data values with
computed statistics or sweeping the statistics out of the data.
Operations can be specified using either an integer or quoted operator /
string. The 10 operations supported by <code>TRA</code> are:</p>
<ul>
<li><p>1 - “replace_fill” : replace and overwrite missing values (same
as <code>mutate</code>)</p></li>
<li><p>2 - “replace” : replace but preserve missing values</p></li>
<li><p>3 - “-” : subtract (center)</p></li>
<li><p>4 - “-+” : subtract group-statistics but add average of group
statistics</p></li>
<li><p>5 - “/” : divide (scale)</p></li>
<li><p>6 - “%” : compute percentages (divide and multiply by
100)</p></li>
<li><p>7 - “+” : add</p></li>
<li><p>8 - “*” : multiply</p></li>
<li><p>9 - “%%” : modulus</p></li>
<li><p>10 - “-%%” : subtract modulus</p></li>
</ul>
<!-- For functions supporting weights (`fsum, fprod, fmean, fmode, fvar` and `fsd`) the `TRA` argument is in the third position following the data and weight vector (in the *grouped_df* method), whereas functions not supporting weights have the argument in the second position. --><p>Simple transformations are again straightforward to specify:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This subtracts the median value from all data points i.e. centers on the median</span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">num_vars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/fnth_fmedian.html">fmedian</a></span><span class="op">(</span>TRA <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">head</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 6 × 12</span></span></span>
<span><span class="co">#    Year    AGR   MIN    MAN    PU    CON    WRT    TRA  FIRE    GOV    OTH     SUM</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span>   -<span style="color: #BB0000;">22</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span> </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span>   -<span style="color: #BB0000;">21</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span> </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span>   -<span style="color: #BB0000;">20</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span> </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">4</span>   -<span style="color: #BB0000;">19</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span> </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">5</span>   -<span style="color: #BB0000;">18</span> -<span style="color: #BB0000; text-decoration: underline;">4</span><span style="color: #BB0000;">378.</span> -<span style="color: #BB0000;">170.</span> -<span style="color: #BB0000; text-decoration: underline;">3</span><span style="color: #BB0000;">717.</span> -<span style="color: #BB0000;">168.</span> -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">473.</span> -<span style="color: #BB0000; text-decoration: underline;">3</span><span style="color: #BB0000;">767.</span> -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">173.</span> -<span style="color: #BB0000;">959.</span> -<span style="color: #BB0000; text-decoration: underline;">3</span><span style="color: #BB0000;">924.</span> -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">431.</span> -<span style="color: #BB0000; text-decoration: underline;">23</span><span style="color: #BB0000;">149.</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">6</span>   -<span style="color: #BB0000;">17</span> -<span style="color: #BB0000; text-decoration: underline;">4</span><span style="color: #BB0000;">379.</span> -<span style="color: #BB0000;">171.</span> -<span style="color: #BB0000; text-decoration: underline;">3</span><span style="color: #BB0000;">717.</span> -<span style="color: #BB0000;">168.</span> -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">472.</span> -<span style="color: #BB0000; text-decoration: underline;">3</span><span style="color: #BB0000;">767.</span> -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">173.</span> -<span style="color: #BB0000;">959.</span> -<span style="color: #BB0000; text-decoration: underline;">3</span><span style="color: #BB0000;">923.</span> -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">430.</span> -<span style="color: #BB0000; text-decoration: underline;">23</span><span style="color: #BB0000;">147.</span></span></span>
<span></span>
<span><span class="co"># This replaces all data points with the mode</span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">char_vars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/fmode.html">fmode</a></span><span class="op">(</span>TRA <span class="op">=</span> <span class="st">"replace"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">head</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#   Country Regioncode Region Variable</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> USA     ASI        Asia   EMP     </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> USA     ASI        Asia   EMP     </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> USA     ASI        Asia   EMP     </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">4</span> USA     ASI        Asia   EMP     </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">5</span> USA     ASI        Asia   EMP     </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">6</span> USA     ASI        Asia   EMP</span></span></code></pre></div>
<p>Similarly for grouped transformations:</p>
<!-- We can also easily specify code to grouped demean, scale or compute percentages by groups: -->
<!-- ^[100% being the median of all annual VA/EMP values in a given sector and country across all years, not the sectoral output share which would have to be obtained using `sweep(GGDC10S[6:16], 1, GGDC10S$SUM, "/")`] -->
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Replacing data with the 2nd quartile (25%)</span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span>, <span class="va">AGR</span><span class="op">:</span><span class="va">SUM</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>   <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/fnth_fmedian.html">fnth</a></span><span class="op">(</span><span class="fl">0.25</span>, TRA <span class="op">=</span> <span class="st">"replace_fill"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 3 × 13</span></span></span>
<span><span class="co">#   Variable Country   AGR   MIN   MAN    PU   CON   WRT   TRA  FIRE   GOV   OTH   SUM</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> VA       BWA      63.5  33.1  27.3  7.36  26.8  31.1  13.2  12.0  33.6  11.5  262.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> VA       BWA      63.5  33.1  27.3  7.36  26.8  31.1  13.2  12.0  33.6  11.5  262.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> VA       BWA      63.5  33.1  27.3  7.36  26.8  31.1  13.2  12.0  33.6  11.5  262.</span></span>
<span></span>
<span><span class="co"># Scaling sectoral data by Variable and Country</span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span>, <span class="va">AGR</span><span class="op">:</span><span class="va">SUM</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>   <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/fvar_fsd.html">fsd</a></span><span class="op">(</span>TRA <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">head</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 6 × 13</span></span></span>
<span><span class="co">#   Variable Country     AGR       MIN       MAN       PU      CON      WRT      TRA     FIRE      GOV</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> VA       BWA     <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>   <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>   <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>   <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> VA       BWA     <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>   <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>   <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>   <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> VA       BWA     <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>   <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>   <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>   <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">4</span> VA       BWA     <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>   <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>   <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>   <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">5</span> VA       BWA      0.027<span style="text-decoration: underline;">0</span>  0.000<span style="text-decoration: underline;">556</span>  0.000<span style="text-decoration: underline;">523</span>  3.88<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span>  5.11<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span>  0.001<span style="text-decoration: underline;">94</span>  0.001<span style="text-decoration: underline;">54</span>  5.23<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span>  0.001<span style="text-decoration: underline;">34</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">6</span> VA       BWA      0.026<span style="text-decoration: underline;">0</span>  0.000<span style="text-decoration: underline;">397</span>  0.000<span style="text-decoration: underline;">723</span>  5.03<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span>  1.04<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span>  0.002<span style="text-decoration: underline;">20</span>  0.001<span style="text-decoration: underline;">80</span>  5.83<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span>  0.001<span style="text-decoration: underline;">58</span></span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 2 more variables: OTH &lt;dbl&gt;, SUM &lt;dbl&gt;</span></span></span></code></pre></div>
<!-- # Normalizing Data by expressing them in percentages of the median value within each country and sector (i.e. the median is 100%) -->
<!-- GGDC10S %>% -->
<!--   fselect(Variable, Country, AGR:SUM) %>%   -->
<!--    fgroup_by(Variable, Country) %>% fmedian(TRA = "%") %>% head(3) -->
<p>The benchmarks below will demonstrate that these internal sweeping
and replacement operations fully performed in C++ compute significantly
faster than using <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">dplyr::mutate</a></code>, especially as the number
of groups grows large. The S3 generic nature of the <em>Fast Statistical
Functions</em> further allows us to perform grouped mutations on the fly
(together with <code>ftransform</code> or <code>fcompute</code>),
without the need of first creating a grouped tibble:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># AGR_gmed = TRUE if AGR is greater than it's median value, grouped by Variable and Country</span></span>
<span><span class="co"># Note: This calls fmedian.default</span></span>
<span><span class="fu"><a href="../reference/ftransform.html">settransform</a></span><span class="op">(</span><span class="va">GGDC10S</span>, AGR_gmed <span class="op">=</span> <span class="va">AGR</span> <span class="op">&gt;</span> <span class="fu"><a href="../reference/fnth_fmedian.html">fmedian</a></span><span class="op">(</span><span class="va">AGR</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span>, TRA <span class="op">=</span> <span class="st">"replace"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 3 × 17</span></span></span>
<span><span class="co">#   Country Regioncode Region     Variable  Year   AGR   MIN   MAN    PU   CON   WRT   TRA  FIRE   GOV</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> EGY     MENA       Middle Ea… EMP       <span style="text-decoration: underline;">2</span>010 <span style="text-decoration: underline;">5</span>206.  29.0 <span style="text-decoration: underline;">2</span>436.  307. <span style="text-decoration: underline;">2</span>733. <span style="text-decoration: underline;">2</span>977. <span style="text-decoration: underline;">1</span>992.  801. <span style="text-decoration: underline;">5</span>539.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> EGY     MENA       Middle Ea… EMP       <span style="text-decoration: underline;">2</span>011 <span style="text-decoration: underline;">5</span>186.  27.6 <span style="text-decoration: underline;">2</span>374.  318. <span style="text-decoration: underline;">2</span>795. <span style="text-decoration: underline;">3</span>020. <span style="text-decoration: underline;">2</span>048.  815. <span style="text-decoration: underline;">5</span>636.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> EGY     MENA       Middle Ea… EMP       <span style="text-decoration: underline;">2</span>012 <span style="text-decoration: underline;">5</span>161.  24.8 <span style="text-decoration: underline;">2</span>348.  325. <span style="text-decoration: underline;">2</span>931. <span style="text-decoration: underline;">3</span>110. <span style="text-decoration: underline;">2</span>065.  832. <span style="text-decoration: underline;">5</span>736.</span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 3 more variables: OTH &lt;dbl&gt;, SUM &lt;dbl&gt;, AGR_gmed &lt;lgl&gt;</span></span></span>
<span></span>
<span><span class="co"># Dividing (scaling) the sectoral data (columns 6 through 16) by their grouped standard deviation</span></span>
<span><span class="fu"><a href="../reference/ftransform.html">settransformv</a></span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="fl">6</span><span class="op">:</span><span class="fl">16</span>, <span class="va">fsd</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span>, TRA <span class="op">=</span> <span class="st">"/"</span>, apply <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 3 × 17</span></span></span>
<span><span class="co">#   Country Regioncode Region     Variable  Year   AGR   MIN   MAN    PU   CON   WRT   TRA  FIRE   GOV</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> EGY     MENA       Middle Ea… EMP       <span style="text-decoration: underline;">2</span>010  8.41  2.28  4.32  3.56  3.62  3.75  3.75  3.14  3.80</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> EGY     MENA       Middle Ea… EMP       <span style="text-decoration: underline;">2</span>011  8.38  2.17  4.21  3.68  3.70  3.81  3.86  3.19  3.86</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> EGY     MENA       Middle Ea… EMP       <span style="text-decoration: underline;">2</span>012  8.34  1.95  4.17  3.76  3.88  3.92  3.89  3.26  3.93</span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 3 more variables: OTH &lt;dbl&gt;, SUM &lt;dbl&gt;, AGR_gmed &lt;lgl&gt;</span></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">GGDC10S</span><span class="op">)</span></span></code></pre></div>
<p>Weights are easily added to any grouped transformation:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This subtracts weighted group means from the data, using SUM column as weights.. </span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span>, <span class="va">AGR</span><span class="op">:</span><span class="va">SUM</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>   <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/fmean.html">fmean</a></span><span class="op">(</span><span class="va">SUM</span>, <span class="st">"-"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">head</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 6 × 13</span></span></span>
<span><span class="co">#   Variable Country   SUM    AGR     MIN    MAN    PU    CON    WRT    TRA   FIRE    GOV    OTH</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> VA       BWA      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span> </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> VA       BWA      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span> </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> VA       BWA      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span> </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">4</span> VA       BWA      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span> </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">5</span> VA       BWA      37.5 -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">301.</span> -<span style="color: #BB0000; text-decoration: underline;">13</span><span style="color: #BB0000;">317.</span> -<span style="color: #BB0000; text-decoration: underline;">2</span><span style="color: #BB0000;">965.</span> -<span style="color: #BB0000;">529.</span> -<span style="color: #BB0000; text-decoration: underline;">2</span><span style="color: #BB0000;">746.</span> -<span style="color: #BB0000; text-decoration: underline;">6</span><span style="color: #BB0000;">540.</span> -<span style="color: #BB0000; text-decoration: underline;">2</span><span style="color: #BB0000;">157.</span> -<span style="color: #BB0000; text-decoration: underline;">4</span><span style="color: #BB0000;">431.</span> -<span style="color: #BB0000; text-decoration: underline;">7</span><span style="color: #BB0000;">551.</span> -<span style="color: #BB0000; text-decoration: underline;">2</span><span style="color: #BB0000;">613.</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">6</span> VA       BWA      39.3 -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">302.</span> -<span style="color: #BB0000; text-decoration: underline;">13</span><span style="color: #BB0000;">318.</span> -<span style="color: #BB0000; text-decoration: underline;">2</span><span style="color: #BB0000;">964.</span> -<span style="color: #BB0000;">529.</span> -<span style="color: #BB0000; text-decoration: underline;">2</span><span style="color: #BB0000;">745.</span> -<span style="color: #BB0000; text-decoration: underline;">6</span><span style="color: #BB0000;">540.</span> -<span style="color: #BB0000; text-decoration: underline;">2</span><span style="color: #BB0000;">156.</span> -<span style="color: #BB0000; text-decoration: underline;">4</span><span style="color: #BB0000;">431.</span> -<span style="color: #BB0000; text-decoration: underline;">7</span><span style="color: #BB0000;">550.</span> -<span style="color: #BB0000; text-decoration: underline;">2</span><span style="color: #BB0000;">613.</span></span></span></code></pre></div>
<!-- # Weighted scaling, weighted by SUM -->
<!-- GGDC10S %>% -->
<!--   fselect(Variable, Country, AGR:SUM) %>%  -->
<!--    fgroup_by(Variable, Country) %>% fsd(SUM, "/") %>% head(3) -->
<!-- Alternatively we could also replace data points with their groupwise weighted mean or standard deviation: -->
<!-- ```{r} -->
<!-- # This conducts a weighted between transformation (replacing with weighted mean) -->
<!-- GGDC10S %>% -->
<!--   fselect(Variable, Country, AGR:SUM) %>%  -->
<!--    fgroup_by(Variable, Country) %>% fmean(SUM, "replace") -->
<!-- # This also replaces missing values in each group -->
<!-- GGDC10S %>% -->
<!--   fselect(Variable, Country, AGR:SUM) %>%  -->
<!--    fgroup_by(Variable, Country) %>% fmean(SUM, "replace_fill") -->
<!-- ``` -->
<!-- It is also possible to center data points on the overall mean, which is achieved by subtracting out group means and adding the overall mean of the data again: -->
<!-- ```{r} -->
<!-- # This group-centers data on the overall mean of the data -->
<!-- GGDC10S %>% -->
<!--   group_by(Variable, Country) %>% -->
<!--     select_at(6:16) %>% fmean(TRA = "-+") -->
<!-- ``` -->
<p>Sequential operations are also easily performed:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This scales and then subtracts the median</span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span>, <span class="va">AGR</span><span class="op">:</span><span class="va">SUM</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>   <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/fvar_fsd.html">fsd</a></span><span class="op">(</span>TRA <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/fnth_fmedian.html">fmedian</a></span><span class="op">(</span>TRA <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 5,027 × 13</span></span></span>
<span><span class="co">#    Variable Country    AGR    MIN    MAN     PU    CON     WRT     TRA    FIRE    GOV     OTH    SUM</span></span>
<span><span class="co">#  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 1</span> VA       BWA     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 2</span> VA       BWA     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 3</span> VA       BWA     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 4</span> VA       BWA     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 5</span> VA       BWA     -<span style="color: #BB0000;">0.182</span> -<span style="color: #BB0000;">0.235</span> -<span style="color: #BB0000;">0.183</span> -<span style="color: #BB0000;">0.245</span> -<span style="color: #BB0000;">0.118</span> -<span style="color: #BB0000;">0.082</span><span style="color: #BB0000; text-decoration: underline;">0</span> -<span style="color: #BB0000;">0.072</span><span style="color: #BB0000; text-decoration: underline;">4</span> -<span style="color: #BB0000;">0.066</span><span style="color: #BB0000; text-decoration: underline;">1</span> -<span style="color: #BB0000;">0.108</span> -<span style="color: #BB0000;">0.084</span><span style="color: #BB0000; text-decoration: underline;">8</span> -<span style="color: #BB0000;">0.146</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 6</span> VA       BWA     -<span style="color: #BB0000;">0.183</span> -<span style="color: #BB0000;">0.235</span> -<span style="color: #BB0000;">0.183</span> -<span style="color: #BB0000;">0.245</span> -<span style="color: #BB0000;">0.117</span> -<span style="color: #BB0000;">0.081</span><span style="color: #BB0000; text-decoration: underline;">7</span> -<span style="color: #BB0000;">0.072</span><span style="color: #BB0000; text-decoration: underline;">2</span> -<span style="color: #BB0000;">0.066</span><span style="color: #BB0000; text-decoration: underline;">0</span> -<span style="color: #BB0000;">0.108</span> -<span style="color: #BB0000;">0.084</span><span style="color: #BB0000; text-decoration: underline;">6</span> -<span style="color: #BB0000;">0.146</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 7</span> VA       BWA     -<span style="color: #BB0000;">0.180</span> -<span style="color: #BB0000;">0.235</span> -<span style="color: #BB0000;">0.183</span> -<span style="color: #BB0000;">0.245</span> -<span style="color: #BB0000;">0.117</span> -<span style="color: #BB0000;">0.081</span><span style="color: #BB0000; text-decoration: underline;">3</span> -<span style="color: #BB0000;">0.072</span><span style="color: #BB0000; text-decoration: underline;">0</span> -<span style="color: #BB0000;">0.065</span><span style="color: #BB0000; text-decoration: underline;">9</span> -<span style="color: #BB0000;">0.107</span> -<span style="color: #BB0000;">0.084</span><span style="color: #BB0000; text-decoration: underline;">3</span> -<span style="color: #BB0000;">0.145</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 8</span> VA       BWA     -<span style="color: #BB0000;">0.177</span> -<span style="color: #BB0000;">0.235</span> -<span style="color: #BB0000;">0.183</span> -<span style="color: #BB0000;">0.245</span> -<span style="color: #BB0000;">0.117</span> -<span style="color: #BB0000;">0.082</span><span style="color: #BB0000; text-decoration: underline;">6</span> -<span style="color: #BB0000;">0.072</span><span style="color: #BB0000; text-decoration: underline;">4</span> -<span style="color: #BB0000;">0.065</span><span style="color: #BB0000; text-decoration: underline;">9</span> -<span style="color: #BB0000;">0.107</span> -<span style="color: #BB0000;">0.084</span><span style="color: #BB0000; text-decoration: underline;">1</span> -<span style="color: #BB0000;">0.146</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 9</span> VA       BWA     -<span style="color: #BB0000;">0.174</span> -<span style="color: #BB0000;">0.235</span> -<span style="color: #BB0000;">0.183</span> -<span style="color: #BB0000;">0.245</span> -<span style="color: #BB0000;">0.117</span> -<span style="color: #BB0000;">0.082</span><span style="color: #BB0000; text-decoration: underline;">3</span> -<span style="color: #BB0000;">0.071</span><span style="color: #BB0000; text-decoration: underline;">7</span> -<span style="color: #BB0000;">0.066</span><span style="color: #BB0000; text-decoration: underline;">1</span> -<span style="color: #BB0000;">0.108</span> -<span style="color: #BB0000;">0.084</span><span style="color: #BB0000; text-decoration: underline;">8</span> -<span style="color: #BB0000;">0.146</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">10</span> VA       BWA     -<span style="color: #BB0000;">0.173</span> -<span style="color: #BB0000;">0.234</span> -<span style="color: #BB0000;">0.182</span> -<span style="color: #BB0000;">0.243</span> -<span style="color: #BB0000;">0.115</span> -<span style="color: #BB0000;">0.082</span><span style="color: #BB0000; text-decoration: underline;">1</span> -<span style="color: #BB0000;">0.071</span><span style="color: #BB0000; text-decoration: underline;">5</span> -<span style="color: #BB0000;">0.066</span><span style="color: #BB0000; text-decoration: underline;">0</span> -<span style="color: #BB0000;">0.108</span> -<span style="color: #BB0000;">0.084</span><span style="color: #BB0000; text-decoration: underline;">6</span> -<span style="color: #BB0000;">0.145</span></span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 5,017 more rows</span></span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Grouped by:  Variable, Country  [85 | 59 (7.7) 4-65]</span></span></code></pre></div>
<p>Of course it is also possible to combine multiple functions as in the
aggregation section, or to add variables to existing data:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This adds a groupwise observation count next to each column</span></span>
<span><span class="fu"><a href="../reference/select_replace_vars.html">add_vars</a></span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">7</span>,<span class="fl">27</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="va">AGR</span><span class="op">:</span><span class="va">SUM</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/fnobs.html">fnobs</a></span><span class="op">(</span><span class="st">"replace_fill"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/small-helpers.html">add_stub</a></span><span class="op">(</span><span class="st">"N_"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">GGDC10S</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 6 × 27</span></span></span>
<span><span class="co">#   Country Regioncode Region  Variable  Year   AGR N_AGR   MIN N_MIN    MAN N_MAN     PU  N_PU    CON</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> BWA     SSA        Sub-sa… VA        <span style="text-decoration: underline;">1</span>960  <span style="color: #BB0000;">NA</span>      47 <span style="color: #BB0000;">NA</span>       47 <span style="color: #BB0000;">NA</span>        47 <span style="color: #BB0000;">NA</span>        47 <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> BWA     SSA        Sub-sa… VA        <span style="text-decoration: underline;">1</span>961  <span style="color: #BB0000;">NA</span>      47 <span style="color: #BB0000;">NA</span>       47 <span style="color: #BB0000;">NA</span>        47 <span style="color: #BB0000;">NA</span>        47 <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> BWA     SSA        Sub-sa… VA        <span style="text-decoration: underline;">1</span>962  <span style="color: #BB0000;">NA</span>      47 <span style="color: #BB0000;">NA</span>       47 <span style="color: #BB0000;">NA</span>        47 <span style="color: #BB0000;">NA</span>        47 <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">4</span> BWA     SSA        Sub-sa… VA        <span style="text-decoration: underline;">1</span>963  <span style="color: #BB0000;">NA</span>      47 <span style="color: #BB0000;">NA</span>       47 <span style="color: #BB0000;">NA</span>        47 <span style="color: #BB0000;">NA</span>        47 <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">5</span> BWA     SSA        Sub-sa… VA        <span style="text-decoration: underline;">1</span>964  16.3    47  3.49    47  0.737    47  0.104    47  0.660</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">6</span> BWA     SSA        Sub-sa… VA        <span style="text-decoration: underline;">1</span>965  15.7    47  2.50    47  1.02     47  0.135    47  1.35 </span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 13 more variables: N_CON &lt;int&gt;, WRT &lt;dbl&gt;, N_WRT &lt;int&gt;, TRA &lt;dbl&gt;, N_TRA &lt;int&gt;, FIRE &lt;dbl&gt;,</span></span></span>
<span><span class="co"># <span style="color: #949494;">#   N_FIRE &lt;int&gt;, GOV &lt;dbl&gt;, N_GOV &lt;int&gt;, OTH &lt;dbl&gt;, N_OTH &lt;int&gt;, SUM &lt;dbl&gt;, N_SUM &lt;int&gt;</span></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">GGDC10S</span><span class="op">)</span></span></code></pre></div>
<p>There are lots of other examples one could construct using the 10
operations and 14 functions listed above, the examples provided just
outline the suggested programming basics. Performance considerations
make it very much worthwhile to spend some time and think how complex
operations can be implemented in this programming framework, before
defining some function in R and applying it to data using
<code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">dplyr::mutate</a></code>.</p>
<!-- ***could add add_vars example again*** -->
</div>
<div class="section level3">
<h3 id="more-control-using-the-tra-function">2.3 More Control using the <code>TRA</code> Function<a class="anchor" aria-label="anchor" href="#more-control-using-the-tra-function"></a>
</h3>
<p>Towards this end, calling <code><a href="../reference/TRA.html">TRA()</a></code> directly also
facilitates more complex and customized operations. Behind the scenes of
the <code>TRA = ...</code> argument, the <em>Fast Statistical
Functions</em> first compute the grouped statistics on all columns of
the data, and these statistics are then directly fed into a C++ function
that uses them to replace or sweep them out of data points in one of the
10 ways described above. This function can also be called directly by
the name of <code>TRA</code>.
<!-- (shorthand for 'transforming' data by replacing or sweeping out statistics).  --></p>
<p>Fundamentally, <code>TRA</code> is a generalization of
<code><a href="https://rdrr.io/r/base/sweep.html" class="external-link">base::sweep</a></code> for column-wise grouped operations<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Row-wise operations are not supported by TRA.&lt;/p&gt;"><sup>1</sup></a>. Direct
calls to <code>TRA</code> enable more control over inputs and
outputs.</p>
<p>The two operations below are equivalent, although the first is
slightly more efficient as it only requires one method dispatch and one
check of the inputs:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This divides by the product</span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="fl">6</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/fprod.html">fprod</a></span><span class="op">(</span>TRA <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">head</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 6 × 11</span></span></span>
<span><span class="co">#          AGR        MIN        MAN        PU        CON        WRT       TRA      FIRE        GOV</span></span>
<span><span class="co">#        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">4</span> <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">5</span>  1.29<span style="color: #949494;">e</span><span style="color: #BB0000;">-105</span>  2.81<span style="color: #949494;">e</span><span style="color: #BB0000;">-127</span>  1.40<span style="color: #949494;">e</span><span style="color: #BB0000;">-101</span>  4.44<span style="color: #949494;">e</span><span style="color: #BB0000;">-74</span>  4.19<span style="color: #949494;">e</span><span style="color: #BB0000;">-102</span>  3.97<span style="color: #949494;">e</span><span style="color: #BB0000;">-113</span>  6.91<span style="color: #949494;">e</span><span style="color: #BB0000;">-92</span>  1.01<span style="color: #949494;">e</span><span style="color: #BB0000;">-97</span>  2.51<span style="color: #949494;">e</span><span style="color: #BB0000;">-117</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">6</span>  1.24<span style="color: #949494;">e</span><span style="color: #BB0000;">-105</span>  2.00<span style="color: #949494;">e</span><span style="color: #BB0000;">-127</span>  1.94<span style="color: #949494;">e</span><span style="color: #BB0000;">-101</span>  5.75<span style="color: #949494;">e</span><span style="color: #BB0000;">-74</span>  8.55<span style="color: #949494;">e</span><span style="color: #BB0000;">-102</span>  4.49<span style="color: #949494;">e</span><span style="color: #BB0000;">-113</span>  8.08<span style="color: #949494;">e</span><span style="color: #BB0000;">-92</span>  1.13<span style="color: #949494;">e</span><span style="color: #BB0000;">-97</span>  2.96<span style="color: #949494;">e</span><span style="color: #BB0000;">-117</span></span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 2 more variables: OTH &lt;dbl&gt;, SUM &lt;dbl&gt;</span></span></span>
<span></span>
<span><span class="co"># Same thing</span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="fl">6</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>     <span class="fu"><a href="../reference/TRA.html">TRA</a></span><span class="op">(</span><span class="fu"><a href="../reference/fprod.html">fprod</a></span><span class="op">(</span><span class="va">.</span>, keep.group_vars <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, <span class="st">"/"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">head</span> <span class="co"># [same as TRA(.,fprod(., keep.group_vars = FALSE),"/")]</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 6 × 11</span></span></span>
<span><span class="co">#          AGR        MIN        MAN        PU        CON        WRT       TRA      FIRE        GOV</span></span>
<span><span class="co">#        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">4</span> <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>     <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">5</span>  1.29<span style="color: #949494;">e</span><span style="color: #BB0000;">-105</span>  2.81<span style="color: #949494;">e</span><span style="color: #BB0000;">-127</span>  1.40<span style="color: #949494;">e</span><span style="color: #BB0000;">-101</span>  4.44<span style="color: #949494;">e</span><span style="color: #BB0000;">-74</span>  4.19<span style="color: #949494;">e</span><span style="color: #BB0000;">-102</span>  3.97<span style="color: #949494;">e</span><span style="color: #BB0000;">-113</span>  6.91<span style="color: #949494;">e</span><span style="color: #BB0000;">-92</span>  1.01<span style="color: #949494;">e</span><span style="color: #BB0000;">-97</span>  2.51<span style="color: #949494;">e</span><span style="color: #BB0000;">-117</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">6</span>  1.24<span style="color: #949494;">e</span><span style="color: #BB0000;">-105</span>  2.00<span style="color: #949494;">e</span><span style="color: #BB0000;">-127</span>  1.94<span style="color: #949494;">e</span><span style="color: #BB0000;">-101</span>  5.75<span style="color: #949494;">e</span><span style="color: #BB0000;">-74</span>  8.55<span style="color: #949494;">e</span><span style="color: #BB0000;">-102</span>  4.49<span style="color: #949494;">e</span><span style="color: #BB0000;">-113</span>  8.08<span style="color: #949494;">e</span><span style="color: #BB0000;">-92</span>  1.13<span style="color: #949494;">e</span><span style="color: #BB0000;">-97</span>  2.96<span style="color: #949494;">e</span><span style="color: #BB0000;">-117</span></span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 2 more variables: OTH &lt;dbl&gt;, SUM &lt;dbl&gt;</span></span></span></code></pre></div>
<p><code>TRA.grouped_df</code> was designed such that it matches the
columns of the statistics (aggregated columns) to those of the original
data, and only transforms matching columns while returning the whole
data frame. Thus it is easily possible to only apply a transformation to
the first two sectors:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This only demeans Agriculture (AGR) and Mining (MIN)</span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/TRA.html">TRA</a></span><span class="op">(</span><span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">AGR</span>, <span class="va">MIN</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/fmean.html">fmean</a></span><span class="op">(</span>keep.group_vars <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, <span class="st">"-"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">head</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 6 × 16</span></span></span>
<span><span class="co">#   Country Regioncode Region Variable  Year   AGR    MIN    MAN     PU    CON   WRT   TRA  FIRE   GOV</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> BWA     SSA        Sub-s… VA        <span style="text-decoration: underline;">1</span>960   <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>  <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> BWA     SSA        Sub-s… VA        <span style="text-decoration: underline;">1</span>961   <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>  <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> BWA     SSA        Sub-s… VA        <span style="text-decoration: underline;">1</span>962   <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>  <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">4</span> BWA     SSA        Sub-s… VA        <span style="text-decoration: underline;">1</span>963   <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>  <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">5</span> BWA     SSA        Sub-s… VA        <span style="text-decoration: underline;">1</span>964 -<span style="color: #BB0000;">446.</span> -<span style="color: #BB0000; text-decoration: underline;">4</span><span style="color: #BB0000;">505.</span>  0.737  0.104  0.660  6.24  1.66  1.12  4.82</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">6</span> BWA     SSA        Sub-s… VA        <span style="text-decoration: underline;">1</span>965 -<span style="color: #BB0000;">446.</span> -<span style="color: #BB0000; text-decoration: underline;">4</span><span style="color: #BB0000;">506.</span>  1.02   0.135  1.35   7.06  1.94  1.25  5.70</span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 2 more variables: OTH &lt;dbl&gt;, SUM &lt;dbl&gt;</span></span></span></code></pre></div>
<p>Since <code>TRA</code> is already built into all <em>Fast Statistical
Functions</em> as an argument, it is best used in computations where
grouped statistics are computed using some other function.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Same as above, with one line of code using fmean.data.frame and ftransform...</span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/ftransform.html">ftransform</a></span><span class="op">(</span><span class="fu"><a href="../reference/fmean.html">fmean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>AGR <span class="op">=</span> <span class="va">AGR</span>, MIN <span class="op">=</span> <span class="va">MIN</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span>, TRA <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">head</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 6 × 16</span></span></span>
<span><span class="co">#   Country Regioncode Region Variable  Year   AGR    MIN    MAN     PU    CON   WRT   TRA  FIRE   GOV</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> BWA     SSA        Sub-s… VA        <span style="text-decoration: underline;">1</span>960   <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>  <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> BWA     SSA        Sub-s… VA        <span style="text-decoration: underline;">1</span>961   <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>  <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> BWA     SSA        Sub-s… VA        <span style="text-decoration: underline;">1</span>962   <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>  <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">4</span> BWA     SSA        Sub-s… VA        <span style="text-decoration: underline;">1</span>963   <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>  <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">5</span> BWA     SSA        Sub-s… VA        <span style="text-decoration: underline;">1</span>964 -<span style="color: #BB0000;">446.</span> -<span style="color: #BB0000; text-decoration: underline;">4</span><span style="color: #BB0000;">505.</span>  0.737  0.104  0.660  6.24  1.66  1.12  4.82</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">6</span> BWA     SSA        Sub-s… VA        <span style="text-decoration: underline;">1</span>965 -<span style="color: #BB0000;">446.</span> -<span style="color: #BB0000; text-decoration: underline;">4</span><span style="color: #BB0000;">506.</span>  1.02   0.135  1.35   7.06  1.94  1.25  5.70</span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 2 more variables: OTH &lt;dbl&gt;, SUM &lt;dbl&gt;</span></span></span></code></pre></div>
<!-- # Get grouped tibble -->
<!-- gGGDC <- GGDC10S %>% group_by(Variable, Country) -->
<!-- library(microbenchmark) -->
<!-- microbenchmark(TRA = gGGDC %>% TRA(summarise_at(., c("AGR","SUM"), sum, na.rm = TRUE), "replace_fill"), -->
<!--                mutate = gGGDC %>% mutate_at(c("AGR","SUM"), sum, na.rm = TRUE)) -->
<p>Another potential use of <code>TRA</code> is to do computations in
two- or more steps, for example if both aggregated and transformed data
are needed, or if computations are more complex and involve other
manipulations in-between the aggregating and sweeping part:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get grouped tibble</span></span>
<span><span class="va">gGGDC</span> <span class="op">&lt;-</span> <span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get aggregated data</span></span>
<span><span class="va">gsumGGDC</span> <span class="op">&lt;-</span> <span class="va">gGGDC</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="va">AGR</span><span class="op">:</span><span class="va">SUM</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">fsum</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">gsumGGDC</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 6 × 13</span></span></span>
<span><span class="co">#   Variable Country       AGR     MIN    MAN     PU    CON    WRT    TRA   FIRE     GOV    OTH    SUM</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> EMP      ARG        <span style="text-decoration: underline;">88</span>028.   <span style="text-decoration: underline;">3</span>230. 1.20<span style="color: #949494;">e</span>5  <span style="text-decoration: underline;">6</span>307. 4.60<span style="color: #949494;">e</span>4 1.23<span style="color: #949494;">e</span>5 4.02<span style="color: #949494;">e</span>4 3.89<span style="color: #949494;">e</span>4  1.27<span style="color: #949494;">e</span>5 6.15<span style="color: #949494;">e</span>4 6.54<span style="color: #949494;">e</span>5</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> EMP      BOL        <span style="text-decoration: underline;">58</span>817.   <span style="text-decoration: underline;">3</span>418. 1.43<span style="color: #949494;">e</span>4   326. 7.49<span style="color: #949494;">e</span>3 1.72<span style="color: #949494;">e</span>4 7.04<span style="color: #949494;">e</span>3 2.72<span style="color: #949494;">e</span>3 <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>  2.41<span style="color: #949494;">e</span>4 1.35<span style="color: #949494;">e</span>5</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> EMP      BRA      1<span style="text-decoration: underline;">065</span>864.  <span style="text-decoration: underline;">12</span>773. 4.33<span style="color: #949494;">e</span>5 <span style="text-decoration: underline;">22</span>604. 2.19<span style="color: #949494;">e</span>5 5.28<span style="color: #949494;">e</span>5 1.27<span style="color: #949494;">e</span>5 2.74<span style="color: #949494;">e</span>5  3.29<span style="color: #949494;">e</span>5 3.54<span style="color: #949494;">e</span>5 3.36<span style="color: #949494;">e</span>6</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">4</span> EMP      BWA         <span style="text-decoration: underline;">8</span>839.    493. 8.49<span style="color: #949494;">e</span>2   145. 1.19<span style="color: #949494;">e</span>3 1.71<span style="color: #949494;">e</span>3 3.93<span style="color: #949494;">e</span>2 7.21<span style="color: #949494;">e</span>2  2.87<span style="color: #949494;">e</span>3 1.30<span style="color: #949494;">e</span>3 1.85<span style="color: #949494;">e</span>4</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">5</span> EMP      CHL        <span style="text-decoration: underline;">44</span>220.   <span style="text-decoration: underline;">6</span>389. 3.94<span style="color: #949494;">e</span>4  <span style="text-decoration: underline;">1</span>850. 1.86<span style="color: #949494;">e</span>4 4.38<span style="color: #949494;">e</span>4 1.63<span style="color: #949494;">e</span>4 1.72<span style="color: #949494;">e</span>4 <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>  6.32<span style="color: #949494;">e</span>4 2.51<span style="color: #949494;">e</span>5</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">6</span> EMP      CHN     17<span style="text-decoration: underline;">264</span>654. <span style="text-decoration: underline;">422</span>972. 4.03<span style="color: #949494;">e</span>6 <span style="text-decoration: underline;">96</span>364. 1.25<span style="color: #949494;">e</span>6 1.73<span style="color: #949494;">e</span>6 8.36<span style="color: #949494;">e</span>5 2.96<span style="color: #949494;">e</span>5  1.36<span style="color: #949494;">e</span>6 1.86<span style="color: #949494;">e</span>6 2.91<span style="color: #949494;">e</span>7</span></span>
<span></span>
<span><span class="co"># Get transformed (scaled) data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/TRA.html">TRA</a></span><span class="op">(</span><span class="va">gGGDC</span>, <span class="va">gsumGGDC</span>, <span class="st">"/"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 6 × 16</span></span></span>
<span><span class="co">#   Country Regioncode Region     Variable  Year      AGR      MIN      MAN       PU      CON      WRT</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> BWA     SSA        Sub-sahar… VA        <span style="text-decoration: underline;">1</span>960 <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>   <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>   <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>   <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>   <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>   <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>  </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> BWA     SSA        Sub-sahar… VA        <span style="text-decoration: underline;">1</span>961 <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>   <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>   <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>   <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>   <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>   <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>  </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> BWA     SSA        Sub-sahar… VA        <span style="text-decoration: underline;">1</span>962 <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>   <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>   <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>   <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>   <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>   <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>  </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">4</span> BWA     SSA        Sub-sahar… VA        <span style="text-decoration: underline;">1</span>963 <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>   <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>   <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>   <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>   <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>   <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>  </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">5</span> BWA     SSA        Sub-sahar… VA        <span style="text-decoration: underline;">1</span>964  7.50<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span>  1.65<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>  1.66<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>  1.03<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>  1.57<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>  6.82<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">6</span> BWA     SSA        Sub-sahar… VA        <span style="text-decoration: underline;">1</span>965  7.24<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span>  1.18<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>  2.30<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>  1.33<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>  3.20<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>  7.72<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span></span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 5 more variables: TRA &lt;dbl&gt;, FIRE &lt;dbl&gt;, GOV &lt;dbl&gt;, OTH &lt;dbl&gt;, SUM &lt;dbl&gt;</span></span></span></code></pre></div>
<p>As discussed, whether using the argument to fast statistical
functions or <code>TRA</code> directly, these data transformations are
essentially a two-step process: Statistics are first computed and then
used to transform the original data.</p>
<!-- This process is already very efficient since all functions are written in C++, and programmatically separating the computation of statistics and data transformation tasks allows for unlimited combinations and drastically simplifies the code base of this package. -->
<!-- Nonetheless there are of course more memory efficient and faster ways to program such data transformations, which principally involve doing them column-by-column with a single C++ function.  -->
<p>Although both steps are efficiently done in C++, it would be even
more efficient to do them in a single step without materializing all the
statistics before transforming the data. Such slightly more efficient
functions are provided for the very commonly applied tasks of centering
and averaging data by groups (widely known as ‘between’-group and
‘within’-group transformations), and scaling and centering data by
groups (also known as ‘standardizing’ data).</p>
<!-- To ensure that this *collapse* lives up to the highest standards of performance for common uses, it also provides ... -->
</div>
<div class="section level3">
<h3 id="faster-centering-averaging-and-standardizing">2.4 Faster Centering, Averaging and Standardizing<a class="anchor" aria-label="anchor" href="#faster-centering-averaging-and-standardizing"></a>
</h3>
<!-- Between and Within Transformations and Standardization -->
<p>The functions <code>fbetween</code> and <code>fwithin</code> are
slightly more memory efficient implementations of <code>fmean</code>
invoked with different <code>TRA</code> options:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Same as ... %&gt;% fmean(TRA = "replace")</span></span>
<span>  <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="fl">6</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">fbetween</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 2 × 11</span></span></span>
<span><span class="co">#     AGR   MIN   MAN    PU   CON   WRT   TRA  FIRE   GOV   OTH    SUM</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> <span style="text-decoration: underline;">4</span>444.  34.9 <span style="text-decoration: underline;">1</span>614.  131.  997. <span style="text-decoration: underline;">1</span>307.  799.  320. <span style="text-decoration: underline;">2</span>958.    <span style="color: #BB0000;">NA</span> <span style="text-decoration: underline;">12</span>605.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> <span style="text-decoration: underline;">4</span>444.  34.9 <span style="text-decoration: underline;">1</span>614.  131.  997. <span style="text-decoration: underline;">1</span>307.  799.  320. <span style="text-decoration: underline;">2</span>958.    <span style="color: #BB0000;">NA</span> <span style="text-decoration: underline;">12</span>605.</span></span>
<span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Same as ... %&gt;% fmean(TRA = "replace_fill")</span></span>
<span>  <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="fl">6</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/fbetween_fwithin.html">fbetween</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 2 × 11</span></span></span>
<span><span class="co">#     AGR   MIN   MAN    PU   CON   WRT   TRA  FIRE   GOV   OTH    SUM</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> <span style="text-decoration: underline;">4</span>444.  34.9 <span style="text-decoration: underline;">1</span>614.  131.  997. <span style="text-decoration: underline;">1</span>307.  799.  320. <span style="text-decoration: underline;">2</span>958.    <span style="color: #BB0000;">NA</span> <span style="text-decoration: underline;">12</span>605.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> <span style="text-decoration: underline;">4</span>444.  34.9 <span style="text-decoration: underline;">1</span>614.  131.  997. <span style="text-decoration: underline;">1</span>307.  799.  320. <span style="text-decoration: underline;">2</span>958.    <span style="color: #BB0000;">NA</span> <span style="text-decoration: underline;">12</span>605.</span></span>
<span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Same as ... %&gt;% fmean(TRA = "-")</span></span>
<span>  <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="fl">6</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">fwithin</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 2 × 11</span></span></span>
<span><span class="co">#     AGR    MIN   MAN    PU   CON   WRT   TRA  FIRE   GOV   OTH   SUM</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span>  742.  -<span style="color: #BB0000;">7.35</span>  760.  187. <span style="text-decoration: underline;">1</span>798. <span style="text-decoration: underline;">1</span>713. <span style="text-decoration: underline;">1</span>249.  495. <span style="text-decoration: underline;">2</span>678.    <span style="color: #BB0000;">NA</span> <span style="text-decoration: underline;">9</span>614.</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span>  717. -<span style="color: #BB0000;">10.1</span>   734.  194. <span style="text-decoration: underline;">1</span>934. <span style="text-decoration: underline;">1</span>803. <span style="text-decoration: underline;">1</span>266.  512. <span style="text-decoration: underline;">2</span>778.    <span style="color: #BB0000;">NA</span> <span style="text-decoration: underline;">9</span>928.</span></span></code></pre></div>
<p>Apart from higher speed, <code>fwithin</code> has a <code>mean</code>
argument to assign an arbitrary mean to centered data, the default being
<code>mean = 0</code>. A very common choice for such an added mean is
just the overall mean of the data, which can be added in by invoking
<code>mean = "overall.mean"</code>:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="va">Country</span>, <span class="va">Variable</span>, <span class="va">AGR</span><span class="op">:</span><span class="va">SUM</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/fbetween_fwithin.html">fwithin</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="st">"overall.mean"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 3 × 13</span></span></span>
<span><span class="co">#   Country Variable      AGR      MIN      MAN     PU    CON    WRT    TRA   FIRE    GOV   OTH    SUM</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> EGY     EMP      2<span style="text-decoration: underline;">527</span>458. 1<span style="text-decoration: underline;">867</span>903. 5<span style="text-decoration: underline;">539</span>313. 3.36<span style="color: #949494;">e</span>5 1.80<span style="color: #949494;">e</span>6 3.39<span style="color: #949494;">e</span>6 1.47<span style="color: #949494;">e</span>6 1.66<span style="color: #949494;">e</span>6 1.71<span style="color: #949494;">e</span>6    <span style="color: #BB0000;">NA</span> 2.16<span style="color: #949494;">e</span>7</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> EGY     EMP      2<span style="text-decoration: underline;">527</span>439. 1<span style="text-decoration: underline;">867</span>902. 5<span style="text-decoration: underline;">539</span>251. 3.36<span style="color: #949494;">e</span>5 1.80<span style="color: #949494;">e</span>6 3.39<span style="color: #949494;">e</span>6 1.47<span style="color: #949494;">e</span>6 1.66<span style="color: #949494;">e</span>6 1.71<span style="color: #949494;">e</span>6    <span style="color: #BB0000;">NA</span> 2.16<span style="color: #949494;">e</span>7</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> EGY     EMP      2<span style="text-decoration: underline;">527</span>413. 1<span style="text-decoration: underline;">867</span>899. 5<span style="text-decoration: underline;">539</span>226. 3.36<span style="color: #949494;">e</span>5 1.80<span style="color: #949494;">e</span>6 3.39<span style="color: #949494;">e</span>6 1.47<span style="color: #949494;">e</span>6 1.66<span style="color: #949494;">e</span>6 1.72<span style="color: #949494;">e</span>6    <span style="color: #BB0000;">NA</span> 2.16<span style="color: #949494;">e</span>7</span></span></code></pre></div>
<!-- in particular, which regards the joint use of weights and the `mean = "overall.mean"` option: `... %>% fmean(w = SUM, TRA = "-+")` will not properly group-center the data on the overall weighted mean. Instead, it will group-center data on a frequency weighted average of the weighted group-means, thus not taking into account different aggregated weights attached to those weighted group-means themselves. The reason for this shortcoming is simply that `TRA` was not designed to take a separate weight vector as input. `fwithin(w = SUM, mean = "overall.mean")` does a better job and properly centers data on the weighted overall mean after subtracting out weighted group means: -->
<!-- ```{r} -->
<!-- GGDC10S %>% # This does not center data on a properly computed weighted overall mean -->
<!--   group_by(Variable, Country) %>% select_at(6:16) %>% fmean(SUM, TRA = "-+") -->
<!-- GGDC10S %>% # This does a proper job by both subtracting weighted group-means and adding a weighted overall mean -->
<!--   group_by(Variable, Country) %>% select_at(6:16) %>% fwithin(SUM, mean = "overall.mean") -->
<!-- ``` -->
<p>This can also be done using weights. The code below uses the
<code>SUM</code> column as weights, and then for each variable and each
group subtracts out the weighted mean, and then adds the overall
weighted column mean back to the centered columns. The <code>SUM</code>
column is just kept as it is and added after the grouping columns.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="va">Country</span>, <span class="va">Variable</span>, <span class="va">AGR</span><span class="op">:</span><span class="va">SUM</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/fbetween_fwithin.html">fwithin</a></span><span class="op">(</span><span class="va">SUM</span>, mean <span class="op">=</span> <span class="st">"overall.mean"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 3 × 13</span></span></span>
<span><span class="co">#   Country Variable    SUM        AGR      MIN    MAN     PU    CON    WRT    TRA   FIRE    GOV   OTH</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> EGY     EMP      <span style="text-decoration: underline;">22</span>020. 429<span style="text-decoration: underline;">066</span>006.   3.70<span style="color: #949494;">e</span>8 7.38<span style="color: #949494;">e</span>8 2.73<span style="color: #949494;">e</span>7 2.83<span style="color: #949494;">e</span>8 4.33<span style="color: #949494;">e</span>8 1.97<span style="color: #949494;">e</span>8 1.55<span style="color: #949494;">e</span>8 2.10<span style="color: #949494;">e</span>8    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> EGY     EMP      <span style="text-decoration: underline;">22</span>219. 429<span style="text-decoration: underline;">065</span>986.   3.70<span style="color: #949494;">e</span>8 7.38<span style="color: #949494;">e</span>8 2.73<span style="color: #949494;">e</span>7 2.83<span style="color: #949494;">e</span>8 4.33<span style="color: #949494;">e</span>8 1.97<span style="color: #949494;">e</span>8 1.55<span style="color: #949494;">e</span>8 2.10<span style="color: #949494;">e</span>8    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> EGY     EMP      <span style="text-decoration: underline;">22</span>533. 429<span style="text-decoration: underline;">065</span>961.   3.70<span style="color: #949494;">e</span>8 7.38<span style="color: #949494;">e</span>8 2.73<span style="color: #949494;">e</span>7 2.83<span style="color: #949494;">e</span>8 4.33<span style="color: #949494;">e</span>8 1.97<span style="color: #949494;">e</span>8 1.55<span style="color: #949494;">e</span>8 2.10<span style="color: #949494;">e</span>8    <span style="color: #BB0000;">NA</span></span></span></code></pre></div>
<p>Another argument to <code>fwithin</code> is the <code>theta</code>
parameter, allowing partial- or quasi-demeaning operations,
e.g. <code>fwithin(gdata, theta = theta)</code> is equal to
<code>gdata - theta * fbetween(gdata)</code>. This is particularly
useful to prepare data for variance components (also known as
‘random-effects’) estimation.</p>
<p>Apart from <code>fbetween</code> and <code>fwithin</code>, the
function <code>fscale</code> exists to efficiently scale and center
data, to avoid sequential calls such as
<code>... %&gt;% fsd(TRA = "/") %&gt;% fmean(TRA = "-")</code>.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This efficiently scales and centers (i.e. standardizes) the data</span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="va">Country</span>, <span class="va">Variable</span>, <span class="va">AGR</span><span class="op">:</span><span class="va">SUM</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">fscale</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 5,027 × 13</span></span></span>
<span><span class="co">#    Country Variable    AGR    MIN    MAN     PU    CON    WRT    TRA   FIRE    GOV    OTH    SUM</span></span>
<span><span class="co">#  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 1</span> BWA     VA       <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 2</span> BWA     VA       <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 3</span> BWA     VA       <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 4</span> BWA     VA       <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 5</span> BWA     VA       -<span style="color: #BB0000;">0.738</span> -<span style="color: #BB0000;">0.717</span> -<span style="color: #BB0000;">0.668</span> -<span style="color: #BB0000;">0.805</span> -<span style="color: #BB0000;">0.692</span> -<span style="color: #BB0000;">0.603</span> -<span style="color: #BB0000;">0.589</span> -<span style="color: #BB0000;">0.635</span> -<span style="color: #BB0000;">0.656</span> -<span style="color: #BB0000;">0.596</span> -<span style="color: #BB0000;">0.676</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 6</span> BWA     VA       -<span style="color: #BB0000;">0.739</span> -<span style="color: #BB0000;">0.717</span> -<span style="color: #BB0000;">0.668</span> -<span style="color: #BB0000;">0.805</span> -<span style="color: #BB0000;">0.692</span> -<span style="color: #BB0000;">0.603</span> -<span style="color: #BB0000;">0.589</span> -<span style="color: #BB0000;">0.635</span> -<span style="color: #BB0000;">0.656</span> -<span style="color: #BB0000;">0.596</span> -<span style="color: #BB0000;">0.676</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 7</span> BWA     VA       -<span style="color: #BB0000;">0.736</span> -<span style="color: #BB0000;">0.717</span> -<span style="color: #BB0000;">0.668</span> -<span style="color: #BB0000;">0.805</span> -<span style="color: #BB0000;">0.692</span> -<span style="color: #BB0000;">0.603</span> -<span style="color: #BB0000;">0.589</span> -<span style="color: #BB0000;">0.635</span> -<span style="color: #BB0000;">0.656</span> -<span style="color: #BB0000;">0.595</span> -<span style="color: #BB0000;">0.676</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 8</span> BWA     VA       -<span style="color: #BB0000;">0.734</span> -<span style="color: #BB0000;">0.717</span> -<span style="color: #BB0000;">0.668</span> -<span style="color: #BB0000;">0.805</span> -<span style="color: #BB0000;">0.692</span> -<span style="color: #BB0000;">0.604</span> -<span style="color: #BB0000;">0.589</span> -<span style="color: #BB0000;">0.635</span> -<span style="color: #BB0000;">0.655</span> -<span style="color: #BB0000;">0.595</span> -<span style="color: #BB0000;">0.676</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 9</span> BWA     VA       -<span style="color: #BB0000;">0.730</span> -<span style="color: #BB0000;">0.717</span> -<span style="color: #BB0000;">0.668</span> -<span style="color: #BB0000;">0.805</span> -<span style="color: #BB0000;">0.692</span> -<span style="color: #BB0000;">0.604</span> -<span style="color: #BB0000;">0.588</span> -<span style="color: #BB0000;">0.635</span> -<span style="color: #BB0000;">0.656</span> -<span style="color: #BB0000;">0.596</span> -<span style="color: #BB0000;">0.676</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">10</span> BWA     VA       -<span style="color: #BB0000;">0.729</span> -<span style="color: #BB0000;">0.716</span> -<span style="color: #BB0000;">0.667</span> -<span style="color: #BB0000;">0.803</span> -<span style="color: #BB0000;">0.690</span> -<span style="color: #BB0000;">0.603</span> -<span style="color: #BB0000;">0.588</span> -<span style="color: #BB0000;">0.635</span> -<span style="color: #BB0000;">0.656</span> -<span style="color: #BB0000;">0.596</span> -<span style="color: #BB0000;">0.675</span></span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 5,017 more rows</span></span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Grouped by:  Variable, Country  [85 | 59 (7.7) 4-65]</span></span></code></pre></div>
<p><code>fscale</code> also has additional <code>mean</code> and
<code>sd</code> arguments allowing the user to (group-) scale data to an
arbitrary mean and standard deviation. Setting <code>mean = FALSE</code>
just scales the data but preserves the means, and is thus different from
<code>fsd(..., TRA = "/")</code> which simply divides all values by the
standard deviation:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Saving grouped tibble</span></span>
<span><span class="va">gGGDC</span> <span class="op">&lt;-</span> <span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="va">Country</span>, <span class="va">Variable</span>, <span class="va">AGR</span><span class="op">:</span><span class="va">SUM</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Original means</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fmean.html">fmean</a></span><span class="op">(</span><span class="va">gGGDC</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 6 × 13</span></span></span>
<span><span class="co">#   Variable Country     AGR    MIN     MAN      PU     CON    WRT    TRA   FIRE     GOV    OTH    SUM</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> EMP      ARG       <span style="text-decoration: underline;">1</span>420.   52.1  <span style="text-decoration: underline;">1</span>932.   102.     742.  1.98<span style="color: #949494;">e</span>3 6.49<span style="color: #949494;">e</span>2  628.   <span style="text-decoration: underline;">2</span>043.  9.92<span style="color: #949494;">e</span>2 1.05<span style="color: #949494;">e</span>4</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> EMP      BOL        964.   56.0   235.     5.35   123.  2.82<span style="color: #949494;">e</span>2 1.15<span style="color: #949494;">e</span>2   44.6    <span style="color: #BB0000;">NA</span>   3.96<span style="color: #949494;">e</span>2 2.22<span style="color: #949494;">e</span>3</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> EMP      BRA      <span style="text-decoration: underline;">17</span>191.  206.   <span style="text-decoration: underline;">6</span>991.   365.    <span style="text-decoration: underline;">3</span>525.  8.51<span style="color: #949494;">e</span>3 2.05<span style="color: #949494;">e</span>3 <span style="text-decoration: underline;">4</span>414.   <span style="text-decoration: underline;">5</span>307.  5.71<span style="color: #949494;">e</span>3 5.43<span style="color: #949494;">e</span>4</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">4</span> EMP      BWA        188.   10.5    18.1    3.09    25.3 3.63<span style="color: #949494;">e</span>1 8.36<span style="color: #949494;">e</span>0   15.3    61.1 2.76<span style="color: #949494;">e</span>1 3.94<span style="color: #949494;">e</span>2</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">5</span> EMP      CHL        702.  101.    625.    29.4    296.  6.95<span style="color: #949494;">e</span>2 2.58<span style="color: #949494;">e</span>2  272.     <span style="color: #BB0000;">NA</span>   1.00<span style="color: #949494;">e</span>3 3.98<span style="color: #949494;">e</span>3</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">6</span> EMP      CHN     <span style="text-decoration: underline;">287</span>744. <span style="text-decoration: underline;">7</span>050.  <span style="text-decoration: underline;">67</span>144.  <span style="text-decoration: underline;">1</span>606.   <span style="text-decoration: underline;">20</span>852.  2.89<span style="color: #949494;">e</span>4 1.39<span style="color: #949494;">e</span>4 <span style="text-decoration: underline;">4</span>929.  <span style="text-decoration: underline;">22</span>669.  3.10<span style="color: #949494;">e</span>4 4.86<span style="color: #949494;">e</span>5</span></span>
<span></span>
<span><span class="co"># Mean Preserving Scaling</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fmean.html">fmean</a></span><span class="op">(</span><span class="fu"><a href="../reference/fscale.html">fscale</a></span><span class="op">(</span><span class="va">gGGDC</span>, mean <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 6 × 13</span></span></span>
<span><span class="co">#   Variable Country     AGR    MIN     MAN      PU     CON    WRT    TRA   FIRE     GOV    OTH    SUM</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> EMP      ARG       <span style="text-decoration: underline;">1</span>420.   52.1  <span style="text-decoration: underline;">1</span>932.   102.     742.  1.98<span style="color: #949494;">e</span>3 6.49<span style="color: #949494;">e</span>2  628.   <span style="text-decoration: underline;">2</span>043.  9.92<span style="color: #949494;">e</span>2 1.05<span style="color: #949494;">e</span>4</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> EMP      BOL        964.   56.0   235.     5.35   123.  2.82<span style="color: #949494;">e</span>2 1.15<span style="color: #949494;">e</span>2   44.6    <span style="color: #BB0000;">NA</span>   3.96<span style="color: #949494;">e</span>2 2.22<span style="color: #949494;">e</span>3</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> EMP      BRA      <span style="text-decoration: underline;">17</span>191.  206.   <span style="text-decoration: underline;">6</span>991.   365.    <span style="text-decoration: underline;">3</span>525.  8.51<span style="color: #949494;">e</span>3 2.05<span style="color: #949494;">e</span>3 <span style="text-decoration: underline;">4</span>414.   <span style="text-decoration: underline;">5</span>307.  5.71<span style="color: #949494;">e</span>3 5.43<span style="color: #949494;">e</span>4</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">4</span> EMP      BWA        188.   10.5    18.1    3.09    25.3 3.63<span style="color: #949494;">e</span>1 8.36<span style="color: #949494;">e</span>0   15.3    61.1 2.76<span style="color: #949494;">e</span>1 3.94<span style="color: #949494;">e</span>2</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">5</span> EMP      CHL        702.  101.    625.    29.4    296.  6.95<span style="color: #949494;">e</span>2 2.58<span style="color: #949494;">e</span>2  272.     <span style="color: #BB0000;">NA</span>   1.00<span style="color: #949494;">e</span>3 3.98<span style="color: #949494;">e</span>3</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">6</span> EMP      CHN     <span style="text-decoration: underline;">287</span>744. <span style="text-decoration: underline;">7</span>050.  <span style="text-decoration: underline;">67</span>144.  <span style="text-decoration: underline;">1</span>606.   <span style="text-decoration: underline;">20</span>852.  2.89<span style="color: #949494;">e</span>4 1.39<span style="color: #949494;">e</span>4 <span style="text-decoration: underline;">4</span>929.  <span style="text-decoration: underline;">22</span>669.  3.10<span style="color: #949494;">e</span>4 4.86<span style="color: #949494;">e</span>5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fvar_fsd.html">fsd</a></span><span class="op">(</span><span class="fu"><a href="../reference/fscale.html">fscale</a></span><span class="op">(</span><span class="va">gGGDC</span>, mean <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 6 × 13</span></span></span>
<span><span class="co">#   Variable Country   AGR   MIN   MAN    PU   CON   WRT   TRA  FIRE   GOV   OTH   SUM</span></span>
<span><span class="co">#   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">1</span> EMP      ARG      1.00  1.00  1.00  1.00  1.00  1.00  1.00  1.00  1.00  1.00  1.00</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">2</span> EMP      BOL      1.00  1.00  1.00  1.00  1.00  1.00  1.00  1.00 <span style="color: #BB0000;">NA</span>     1.00  1.00</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">3</span> EMP      BRA      1.00  1.00  1.00  1.00  1.00  1.00  1.00  1.00  1.00  1.00  1.00</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">4</span> EMP      BWA      1.00  1.00  1.00  1     1     1.00  1.00  1.00  1.00  1.00  1.00</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">5</span> EMP      CHL      1.00  1     1.00  1.00  1.00  1.00  1.00  1.00 <span style="color: #BB0000;">NA</span>     1.00  1.00</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">6</span> EMP      CHN      1.00  1.00  1.00  1.00  1.00  1.00  1.00  1.00  1.00  1.00  1.00</span></span></code></pre></div>
<p>One can also set <code>mean = "overall.mean"</code>, which
group-centers columns on the overall mean as illustrated with
<code>fwithin</code>. Another interesting option is setting
<code>sd = "within.sd"</code>. This group-scales data such that every
group has a standard deviation equal to the within-standard deviation of
the data:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Just using VA data for this example</span></span>
<span><span class="va">gGGDC</span> <span class="op">&lt;-</span> <span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/fsubset.html">fsubset</a></span><span class="op">(</span><span class="va">Variable</span> <span class="op">==</span> <span class="st">"VA"</span>, <span class="va">Country</span>, <span class="va">AGR</span><span class="op">:</span><span class="va">SUM</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>      <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Country</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This calculates the within- standard deviation for all columns</span></span>
<span><span class="fu"><a href="../reference/fvar_fsd.html">fsd</a></span><span class="op">(</span><span class="fu"><a href="../reference/select_replace_vars.html">num_vars</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">fwithin</a></span><span class="op">(</span><span class="va">gGGDC</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#       AGR       MIN       MAN        PU       CON       WRT       TRA      FIRE       GOV       OTH </span></span>
<span><span class="co">#  45046972  40122220  75608708   3062688  30811572  44125207  20676901  16030868  20358973  18780869 </span></span>
<span><span class="co">#       SUM </span></span>
<span><span class="co"># 306429102</span></span>
<span></span>
<span><span class="co"># This scales all groups to take on the within- standard deviation while preserving group means </span></span>
<span><span class="fu"><a href="../reference/fvar_fsd.html">fsd</a></span><span class="op">(</span><span class="fu"><a href="../reference/fscale.html">fscale</a></span><span class="op">(</span><span class="va">gGGDC</span>, mean <span class="op">=</span> <span class="cn">FALSE</span>, sd <span class="op">=</span> <span class="st">"within.sd"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 43 × 12</span></span></span>
<span><span class="co">#    Country       AGR       MIN       MAN       PU     CON    WRT    TRA   FIRE     GOV    OTH    SUM</span></span>
<span><span class="co">#    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 1</span> ARG     45<span style="text-decoration: underline;">046</span>972. 40<span style="text-decoration: underline;">122</span>220. 75<span style="text-decoration: underline;">608</span>708. 3<span style="text-decoration: underline;">062</span>688.  3.08<span style="color: #949494;">e</span>7 4.41<span style="color: #949494;">e</span>7 2.07<span style="color: #949494;">e</span>7 1.60<span style="color: #949494;">e</span>7  2.04<span style="color: #949494;">e</span>7 1.88<span style="color: #949494;">e</span>7 3.06<span style="color: #949494;">e</span>8</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 2</span> BOL     45<span style="text-decoration: underline;">046</span>972. 40<span style="text-decoration: underline;">122</span>220. 75<span style="text-decoration: underline;">608</span>708. 3<span style="text-decoration: underline;">062</span>688.  3.08<span style="color: #949494;">e</span>7 4.41<span style="color: #949494;">e</span>7 2.07<span style="color: #949494;">e</span>7 1.60<span style="color: #949494;">e</span>7 <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>  1.88<span style="color: #949494;">e</span>7 3.06<span style="color: #949494;">e</span>8</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 3</span> BRA     45<span style="text-decoration: underline;">046</span>972. 40<span style="text-decoration: underline;">122</span>220. 75<span style="text-decoration: underline;">608</span>708. 3<span style="text-decoration: underline;">062</span>688.  3.08<span style="color: #949494;">e</span>7 4.41<span style="color: #949494;">e</span>7 2.07<span style="color: #949494;">e</span>7 1.60<span style="color: #949494;">e</span>7  2.04<span style="color: #949494;">e</span>7 1.88<span style="color: #949494;">e</span>7 3.06<span style="color: #949494;">e</span>8</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 4</span> BWA     45<span style="text-decoration: underline;">046</span>972. 40<span style="text-decoration: underline;">122</span>220. 75<span style="text-decoration: underline;">608</span>708. 3<span style="text-decoration: underline;">062</span>688.  3.08<span style="color: #949494;">e</span>7 4.41<span style="color: #949494;">e</span>7 2.07<span style="color: #949494;">e</span>7 1.60<span style="color: #949494;">e</span>7  2.04<span style="color: #949494;">e</span>7 1.88<span style="color: #949494;">e</span>7 3.06<span style="color: #949494;">e</span>8</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 5</span> CHL     45<span style="text-decoration: underline;">046</span>972. 40<span style="text-decoration: underline;">122</span>220. 75<span style="text-decoration: underline;">608</span>708. 3<span style="text-decoration: underline;">062</span>688.  3.08<span style="color: #949494;">e</span>7 4.41<span style="color: #949494;">e</span>7 2.07<span style="color: #949494;">e</span>7 1.60<span style="color: #949494;">e</span>7 <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>  1.88<span style="color: #949494;">e</span>7 3.06<span style="color: #949494;">e</span>8</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 6</span> CHN     45<span style="text-decoration: underline;">046</span>972. 40<span style="text-decoration: underline;">122</span>220. 75<span style="text-decoration: underline;">608</span>708. 3<span style="text-decoration: underline;">062</span>688.  3.08<span style="color: #949494;">e</span>7 4.41<span style="color: #949494;">e</span>7 2.07<span style="color: #949494;">e</span>7 1.60<span style="color: #949494;">e</span>7  2.04<span style="color: #949494;">e</span>7 1.88<span style="color: #949494;">e</span>7 3.06<span style="color: #949494;">e</span>8</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 7</span> COL     45<span style="text-decoration: underline;">046</span>972. 40<span style="text-decoration: underline;">122</span>220. 75<span style="text-decoration: underline;">608</span>708. 3<span style="text-decoration: underline;">062</span>688.  3.08<span style="color: #949494;">e</span>7 4.41<span style="color: #949494;">e</span>7 2.07<span style="color: #949494;">e</span>7 1.60<span style="color: #949494;">e</span>7 <span style="color: #BB0000;">NA</span>   <span style="color: #949494;"> </span>  1.88<span style="color: #949494;">e</span>7 3.06<span style="color: #949494;">e</span>8</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 8</span> CRI     45<span style="text-decoration: underline;">046</span>972. 40<span style="text-decoration: underline;">122</span>220. 75<span style="text-decoration: underline;">608</span>708. 3<span style="text-decoration: underline;">062</span>688.  3.08<span style="color: #949494;">e</span>7 4.41<span style="color: #949494;">e</span>7 2.07<span style="color: #949494;">e</span>7 1.60<span style="color: #949494;">e</span>7  2.04<span style="color: #949494;">e</span>7 1.88<span style="color: #949494;">e</span>7 3.06<span style="color: #949494;">e</span>8</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 9</span> DEW     45<span style="text-decoration: underline;">046</span>972. 40<span style="text-decoration: underline;">122</span>220. 75<span style="text-decoration: underline;">608</span>708. 3<span style="text-decoration: underline;">062</span>688.  3.08<span style="color: #949494;">e</span>7 4.41<span style="color: #949494;">e</span>7 2.07<span style="color: #949494;">e</span>7 1.60<span style="color: #949494;">e</span>7  2.04<span style="color: #949494;">e</span>7 1.88<span style="color: #949494;">e</span>7 3.06<span style="color: #949494;">e</span>8</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">10</span> DNK     45<span style="text-decoration: underline;">046</span>972. 40<span style="text-decoration: underline;">122</span>220. 75<span style="text-decoration: underline;">608</span>708. 3<span style="text-decoration: underline;">062</span>688.  3.08<span style="color: #949494;">e</span>7 4.41<span style="color: #949494;">e</span>7 2.07<span style="color: #949494;">e</span>7 1.60<span style="color: #949494;">e</span>7  2.04<span style="color: #949494;">e</span>7 1.88<span style="color: #949494;">e</span>7 3.06<span style="color: #949494;">e</span>8</span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 33 more rows</span></span></span></code></pre></div>
<p>A grouped scaling operation with both
<code>mean = "overall.mean"</code> and <code>sd = "within.sd"</code>
thus efficiently achieves a harmonization of all groups in the first two
moments without changing the fundamental properties (in terms of level
and scale) of the data.</p>
</div>
<div class="section level3">
<h3 id="lags-leads-differences-and-growth-rates">2.5 Lags / Leads, Differences and Growth Rates<a class="anchor" aria-label="anchor" href="#lags-leads-differences-and-growth-rates"></a>
</h3>
<!-- It was suggested some time ago that leaving the best wine for the end is not the best strategy when giving a feast. Considering the marriage of *collapse* and *dplyr* the 3 functions for time-computations introduced in this section combine great flexibility with precision and computing power, and feature amongst the highlights of *collapse*. -->
<p>This section introduces 3 further powerful <em>collapse</em>
functions: <code>flag</code>, <code>fdiff</code> and
<code>fgrowth</code>. The first function, <code>flag</code>, efficiently
computes sequences of fully identified lags and leads on time series and
panel data. The following code computes 1 fully-identified panel-lag and
1 fully identified panel-lead of each variable in the data:</p>
<!-- In addition: None of these functions require the data to be sorted, they can carry out fast computations on completely unordered data as long as a time-variable is supplied that uniquely identifies the data. -->
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="op">-</span><span class="va">Region</span>, <span class="op">-</span><span class="va">Regioncode</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/flag.html">flag</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">1</span>, <span class="va">Year</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 5,027 × 36</span></span></span>
<span><span class="co">#    Country Variable  Year F1.AGR   AGR L1.AGR F1.MIN   MIN L1.MIN F1.MAN    MAN L1.MAN  F1.PU     PU</span></span>
<span><span class="co">#  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 1</span> BWA     VA        <span style="text-decoration: underline;">1</span>960   <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 2</span> BWA     VA        <span style="text-decoration: underline;">1</span>961   <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 3</span> BWA     VA        <span style="text-decoration: underline;">1</span>962   <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 4</span> BWA     VA        <span style="text-decoration: underline;">1</span>963   16.3  <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     3.49 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     0.737 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      0.104 <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 5</span> BWA     VA        <span style="text-decoration: underline;">1</span>964   15.7  16.3   <span style="color: #BB0000;">NA</span>     2.50  3.49  <span style="color: #BB0000;">NA</span>     1.02   0.737 <span style="color: #BB0000;">NA</span>      0.135  0.104</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 6</span> BWA     VA        <span style="text-decoration: underline;">1</span>965   17.7  15.7   16.3   1.97  2.50   3.49  0.804  1.02   0.737  0.203  0.135</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 7</span> BWA     VA        <span style="text-decoration: underline;">1</span>966   19.1  17.7   15.7   2.30  1.97   2.50  0.938  0.804  1.02   0.203  0.203</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 8</span> BWA     VA        <span style="text-decoration: underline;">1</span>967   21.1  19.1   17.7   1.84  2.30   1.97  0.750  0.938  0.804  0.203  0.203</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 9</span> BWA     VA        <span style="text-decoration: underline;">1</span>968   21.9  21.1   19.1   5.24  1.84   2.30  2.14   0.750  0.938  0.578  0.203</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">10</span> BWA     VA        <span style="text-decoration: underline;">1</span>969   23.1  21.9   21.1  10.2   5.24   1.84  4.15   2.14   0.750  1.12   0.578</span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 5,017 more rows</span></span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 22 more variables: L1.PU &lt;dbl&gt;, F1.CON &lt;dbl&gt;, CON &lt;dbl&gt;, L1.CON &lt;dbl&gt;, F1.WRT &lt;dbl&gt;, WRT &lt;dbl&gt;,</span></span></span>
<span><span class="co"># <span style="color: #949494;">#   L1.WRT &lt;dbl&gt;, F1.TRA &lt;dbl&gt;, TRA &lt;dbl&gt;, L1.TRA &lt;dbl&gt;, F1.FIRE &lt;dbl&gt;, FIRE &lt;dbl&gt;, L1.FIRE &lt;dbl&gt;,</span></span></span>
<span><span class="co"># <span style="color: #949494;">#   F1.GOV &lt;dbl&gt;, GOV &lt;dbl&gt;, L1.GOV &lt;dbl&gt;, F1.OTH &lt;dbl&gt;, OTH &lt;dbl&gt;, L1.OTH &lt;dbl&gt;, F1.SUM &lt;dbl&gt;,</span></span></span>
<span><span class="co"># <span style="color: #949494;">#   SUM &lt;dbl&gt;, L1.SUM &lt;dbl&gt;</span></span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Grouped by:  Variable, Country  [85 | 59 (7.7) 4-65]</span></span></code></pre></div>
<p>If the time-variable passed does not exactly identify the data
(i.e. because of repeated values in each group), all 3 functions will
issue appropriate error messages. <code>flag</code>, <code>fdiff</code>
and <code>fgrowth</code> support irregular time series and unbalanced
panels.
<!-- with different start and end periods and duration of coverage for each individual, but not irregular panels. A workaround for such panels exists with the function `seqid` which generates a new panel-id identifying consecutive time-sequences at the sub-individual level, see `?seqid`. --></p>
<p>It is also possible to omit the time-variable if one is certain that
the data is sorted:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span>,<span class="va">AGR</span><span class="op">:</span><span class="va">SUM</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">flag</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 5,027 × 13</span></span></span>
<span><span class="co">#    Variable Country   AGR   MIN    MAN     PU    CON   WRT   TRA  FIRE   GOV   OTH   SUM</span></span>
<span><span class="co">#  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 1</span> VA       BWA      <span style="color: #BB0000;">NA</span>   <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 2</span> VA       BWA      <span style="color: #BB0000;">NA</span>   <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 3</span> VA       BWA      <span style="color: #BB0000;">NA</span>   <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 4</span> VA       BWA      <span style="color: #BB0000;">NA</span>   <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 5</span> VA       BWA      <span style="color: #BB0000;">NA</span>   <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 6</span> VA       BWA      16.3  3.49  0.737  0.104  0.660  6.24  1.66  1.12  4.82  2.34  37.5</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 7</span> VA       BWA      15.7  2.50  1.02   0.135  1.35   7.06  1.94  1.25  5.70  2.68  39.3</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 8</span> VA       BWA      17.7  1.97  0.804  0.203  1.35   8.27  2.15  1.36  6.37  2.99  43.1</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 9</span> VA       BWA      19.1  2.30  0.938  0.203  0.897  4.31  1.72  1.54  7.04  3.31  41.4</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">10</span> VA       BWA      21.1  1.84  0.750  0.203  1.22   5.17  2.44  1.03  5.03  2.36  41.1</span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 5,017 more rows</span></span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Grouped by:  Variable, Country  [85 | 59 (7.7) 4-65]</span></span></code></pre></div>
<p><code>fdiff</code> computes sequences of lagged-leaded and iterated
differences as well as quasi-differences and log-differences on time
series and panel data. The code below computes the 1 and 10 year first
and second differences of each variable in the data:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="op">-</span><span class="va">Region</span>, <span class="op">-</span><span class="va">Regioncode</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/fdiff.html">fdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="va">Year</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 5,027 × 47</span></span></span>
<span><span class="co">#    Country Variable  Year D1.AGR D2.AGR L10D1.AGR L10D2.AGR D1.MIN D2.MIN L10D1.MIN L10D2.MIN D1.MAN</span></span>
<span><span class="co">#  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 1</span> BWA     VA        <span style="text-decoration: underline;">1</span>960 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>            <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>            <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 2</span> BWA     VA        <span style="text-decoration: underline;">1</span>961 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>            <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>            <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 3</span> BWA     VA        <span style="text-decoration: underline;">1</span>962 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>            <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>            <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 4</span> BWA     VA        <span style="text-decoration: underline;">1</span>963 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>            <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>            <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 5</span> BWA     VA        <span style="text-decoration: underline;">1</span>964 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>            <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>            <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 6</span> BWA     VA        <span style="text-decoration: underline;">1</span>965 -<span style="color: #BB0000;">0.575</span> <span style="color: #BB0000;">NA</span>            <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span> -<span style="color: #BB0000;">0.998</span> <span style="color: #BB0000;">NA</span>            <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>  0.282</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 7</span> BWA     VA        <span style="text-decoration: underline;">1</span>966  1.95   2.53         <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span> -<span style="color: #BB0000;">0.525</span>  0.473        <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span> -<span style="color: #BB0000;">0.214</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 8</span> BWA     VA        <span style="text-decoration: underline;">1</span>967  1.47  -<span style="color: #BB0000;">0.488</span>        <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>  0.328  0.854        <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>  0.134</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 9</span> BWA     VA        <span style="text-decoration: underline;">1</span>968  1.95   0.488        <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span> -<span style="color: #BB0000;">0.460</span> -<span style="color: #BB0000;">0.788</span>        <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span> -<span style="color: #BB0000;">0.188</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">10</span> BWA     VA        <span style="text-decoration: underline;">1</span>969  0.763 -<span style="color: #BB0000;">1.19</span>         <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>  3.41   3.87         <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>  1.39 </span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 5,017 more rows</span></span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 35 more variables: D2.MAN &lt;dbl&gt;, L10D1.MAN &lt;dbl&gt;, L10D2.MAN &lt;dbl&gt;, D1.PU &lt;dbl&gt;, D2.PU &lt;dbl&gt;,</span></span></span>
<span><span class="co"># <span style="color: #949494;">#   L10D1.PU &lt;dbl&gt;, L10D2.PU &lt;dbl&gt;, D1.CON &lt;dbl&gt;, D2.CON &lt;dbl&gt;, L10D1.CON &lt;dbl&gt;, L10D2.CON &lt;dbl&gt;,</span></span></span>
<span><span class="co"># <span style="color: #949494;">#   D1.WRT &lt;dbl&gt;, D2.WRT &lt;dbl&gt;, L10D1.WRT &lt;dbl&gt;, L10D2.WRT &lt;dbl&gt;, D1.TRA &lt;dbl&gt;, D2.TRA &lt;dbl&gt;,</span></span></span>
<span><span class="co"># <span style="color: #949494;">#   L10D1.TRA &lt;dbl&gt;, L10D2.TRA &lt;dbl&gt;, D1.FIRE &lt;dbl&gt;, D2.FIRE &lt;dbl&gt;, L10D1.FIRE &lt;dbl&gt;,</span></span></span>
<span><span class="co"># <span style="color: #949494;">#   L10D2.FIRE &lt;dbl&gt;, D1.GOV &lt;dbl&gt;, D2.GOV &lt;dbl&gt;, L10D1.GOV &lt;dbl&gt;, L10D2.GOV &lt;dbl&gt;, D1.OTH &lt;dbl&gt;,</span></span></span>
<span><span class="co"># <span style="color: #949494;">#   D2.OTH &lt;dbl&gt;, L10D1.OTH &lt;dbl&gt;, L10D2.OTH &lt;dbl&gt;, D1.SUM &lt;dbl&gt;, D2.SUM &lt;dbl&gt;, L10D1.SUM &lt;dbl&gt;, …</span></span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Grouped by:  Variable, Country  [85 | 59 (7.7) 4-65]</span></span></code></pre></div>
<p>Log-differences of the form <span class="math inline">\(log(x_t) -
log(x_{t-s})\)</span> are also easily computed.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="op">-</span><span class="va">Region</span>, <span class="op">-</span><span class="va">Regioncode</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/fdiff.html">fdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fl">1</span>, <span class="va">Year</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 5,027 × 25</span></span></span>
<span><span class="co">#    Country Variable  Year Dlog1.AGR L10Dlog1.AGR Dlog1.MIN L10Dlog1.MIN Dlog1.MAN L10Dlog1.MAN</span></span>
<span><span class="co">#  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 1</span> BWA     VA        <span style="text-decoration: underline;">1</span>960   <span style="color: #BB0000;">NA</span>                <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 2</span> BWA     VA        <span style="text-decoration: underline;">1</span>961   <span style="color: #BB0000;">NA</span>                <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 3</span> BWA     VA        <span style="text-decoration: underline;">1</span>962   <span style="color: #BB0000;">NA</span>                <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 4</span> BWA     VA        <span style="text-decoration: underline;">1</span>963   <span style="color: #BB0000;">NA</span>                <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 5</span> BWA     VA        <span style="text-decoration: underline;">1</span>964   <span style="color: #BB0000;">NA</span>                <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 6</span> BWA     VA        <span style="text-decoration: underline;">1</span>965   -<span style="color: #BB0000;">0.035</span><span style="color: #BB0000; text-decoration: underline;">9</span>           <span style="color: #BB0000;">NA</span>    -<span style="color: #BB0000;">0.336</span>           <span style="color: #BB0000;">NA</span>     0.324           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 7</span> BWA     VA        <span style="text-decoration: underline;">1</span>966    0.117            <span style="color: #BB0000;">NA</span>    -<span style="color: #BB0000;">0.236</span>           <span style="color: #BB0000;">NA</span>    -<span style="color: #BB0000;">0.236</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 8</span> BWA     VA        <span style="text-decoration: underline;">1</span>967    0.079<span style="text-decoration: underline;">6</span>           <span style="color: #BB0000;">NA</span>     0.154           <span style="color: #BB0000;">NA</span>     0.154           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 9</span> BWA     VA        <span style="text-decoration: underline;">1</span>968    0.097<span style="text-decoration: underline;">2</span>           <span style="color: #BB0000;">NA</span>    -<span style="color: #BB0000;">0.223</span>           <span style="color: #BB0000;">NA</span>    -<span style="color: #BB0000;">0.223</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">10</span> BWA     VA        <span style="text-decoration: underline;">1</span>969    0.035<span style="text-decoration: underline;">5</span>           <span style="color: #BB0000;">NA</span>     1.05            <span style="color: #BB0000;">NA</span>     1.05            <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 5,017 more rows</span></span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 16 more variables: Dlog1.PU &lt;dbl&gt;, L10Dlog1.PU &lt;dbl&gt;, Dlog1.CON &lt;dbl&gt;, L10Dlog1.CON &lt;dbl&gt;,</span></span></span>
<span><span class="co"># <span style="color: #949494;">#   Dlog1.WRT &lt;dbl&gt;, L10Dlog1.WRT &lt;dbl&gt;, Dlog1.TRA &lt;dbl&gt;, L10Dlog1.TRA &lt;dbl&gt;, Dlog1.FIRE &lt;dbl&gt;,</span></span></span>
<span><span class="co"># <span style="color: #949494;">#   L10Dlog1.FIRE &lt;dbl&gt;, Dlog1.GOV &lt;dbl&gt;, L10Dlog1.GOV &lt;dbl&gt;, Dlog1.OTH &lt;dbl&gt;, L10Dlog1.OTH &lt;dbl&gt;,</span></span></span>
<span><span class="co"># <span style="color: #949494;">#   Dlog1.SUM &lt;dbl&gt;, L10Dlog1.SUM &lt;dbl&gt;</span></span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Grouped by:  Variable, Country  [85 | 59 (7.7) 4-65]</span></span></code></pre></div>
<p>Finally, it is also possible to compute quasi-differences and
quasi-log-differences of the form <span class="math inline">\(x_t - \rho
x_{t-s}\)</span> or <span class="math inline">\(log(x_t) - \rho
log(x_{t-s})\)</span>:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="op">-</span><span class="va">Region</span>, <span class="op">-</span><span class="va">Regioncode</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/fdiff.html">fdiff</a></span><span class="op">(</span>t <span class="op">=</span> <span class="va">Year</span>, rho <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 5,027 × 14</span></span></span>
<span><span class="co">#    Country Variable  Year    AGR    MIN    MAN      PU     CON    WRT    TRA   FIRE    GOV    OTH</span></span>
<span><span class="co">#  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 1</span> BWA     VA        <span style="text-decoration: underline;">1</span>960 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 2</span> BWA     VA        <span style="text-decoration: underline;">1</span>961 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 3</span> BWA     VA        <span style="text-decoration: underline;">1</span>962 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 4</span> BWA     VA        <span style="text-decoration: underline;">1</span>963 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 5</span> BWA     VA        <span style="text-decoration: underline;">1</span>964 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 6</span> BWA     VA        <span style="text-decoration: underline;">1</span>965  0.241 -<span style="color: #BB0000;">0.824</span>  0.318  0.035<span style="text-decoration: underline;">9</span>  0.719   1.13   0.363  0.184  1.11   0.454</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 7</span> BWA     VA        <span style="text-decoration: underline;">1</span>966  2.74  -<span style="color: #BB0000;">0.401</span> -<span style="color: #BB0000;">0.163</span>  0.074<span style="text-decoration: underline;">3</span>  0.067<span style="text-decoration: underline;">3</span>  1.56   0.312  0.174  0.955  0.449</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 8</span> BWA     VA        <span style="text-decoration: underline;">1</span>967  2.35   0.427  0.174  0.010<span style="text-decoration: underline;">1</span> -<span style="color: #BB0000;">0.381</span>  -<span style="color: #BB0000;">3.55</span>  -<span style="color: #BB0000;">0.323</span>  0.246  0.988  0.465</span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 9</span> BWA     VA        <span style="text-decoration: underline;">1</span>968  2.91  -<span style="color: #BB0000;">0.345</span> -<span style="color: #BB0000;">0.141</span>  0.010<span style="text-decoration: underline;">1</span>  0.365   1.08   0.804 -<span style="color: #BB0000;">0.427</span> -<span style="color: #BB0000;">1.66</span>  -<span style="color: #BB0000;">0.780</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">10</span> BWA     VA        <span style="text-decoration: underline;">1</span>969  1.82   3.50   1.43   0.385   2.32    0.841  0.397  0.252  0.818  0.385</span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 5,017 more rows</span></span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 1 more variable: SUM &lt;dbl&gt;</span></span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Grouped by:  Variable, Country  [85 | 59 (7.7) 4-65]</span></span></code></pre></div>
<p>The quasi-differencing feature was added to <code>fdiff</code> to
facilitate the preparation of time series and panel data for
least-squares estimations suffering from serial correlation following
Cochrane &amp; Orcutt (1949).</p>
<!-- and `fgrowth` computes lagged-leaded and iterated growth-rates obtained via the exact computation method or through log-differencing.  -->
<p>Finally, <code>fgrowth</code> computes growth rates in the same way.
By default exact growth rates are computed in percentage terms using
<span class="math inline">\((x_t-x_{t-s}) / x_{t-s} \times 100\)</span>
(the default argument is <code>scale = 100</code>). The user can also
request growth rates obtained by log-differencing using <span class="math inline">\(log(x_t/ x_{t-s}) \times 100\)</span>.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Exact growth rates, computed as: (x/lag(x) - 1) * 100</span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="op">-</span><span class="va">Region</span>, <span class="op">-</span><span class="va">Regioncode</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/fgrowth.html">fgrowth</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fl">1</span>, <span class="va">Year</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 5,027 × 25</span></span></span>
<span><span class="co">#    Country Variable  Year G1.AGR L10G1.AGR G1.MIN L10G1.MIN G1.MAN L10G1.MAN G1.PU L10G1.PU G1.CON</span></span>
<span><span class="co">#  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 1</span> BWA     VA        <span style="text-decoration: underline;">1</span>960  <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>   <span style="color: #BB0000;">NA</span>          <span style="color: #BB0000;">NA</span>   <span style="color: #BB0000;">NA</span>          <span style="color: #BB0000;">NA</span>  <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>   <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 2</span> BWA     VA        <span style="text-decoration: underline;">1</span>961  <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>   <span style="color: #BB0000;">NA</span>          <span style="color: #BB0000;">NA</span>   <span style="color: #BB0000;">NA</span>          <span style="color: #BB0000;">NA</span>  <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>   <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 3</span> BWA     VA        <span style="text-decoration: underline;">1</span>962  <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>   <span style="color: #BB0000;">NA</span>          <span style="color: #BB0000;">NA</span>   <span style="color: #BB0000;">NA</span>          <span style="color: #BB0000;">NA</span>  <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>   <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 4</span> BWA     VA        <span style="text-decoration: underline;">1</span>963  <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>   <span style="color: #BB0000;">NA</span>          <span style="color: #BB0000;">NA</span>   <span style="color: #BB0000;">NA</span>          <span style="color: #BB0000;">NA</span>  <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>   <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 5</span> BWA     VA        <span style="text-decoration: underline;">1</span>964  <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>   <span style="color: #BB0000;">NA</span>          <span style="color: #BB0000;">NA</span>   <span style="color: #BB0000;">NA</span>          <span style="color: #BB0000;">NA</span>  <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>   <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 6</span> BWA     VA        <span style="text-decoration: underline;">1</span>965  -<span style="color: #BB0000;">3.52</span>        <span style="color: #BB0000;">NA</span>  -<span style="color: #BB0000;">28.6</span>        <span style="color: #BB0000;">NA</span>   38.2        <span style="color: #BB0000;">NA</span>  29.4       <span style="color: #BB0000;">NA</span>  104. </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 7</span> BWA     VA        <span style="text-decoration: underline;">1</span>966  12.4         <span style="color: #BB0000;">NA</span>  -<span style="color: #BB0000;">21.1</span>        <span style="color: #BB0000;">NA</span>  -<span style="color: #BB0000;">21.1</span>        <span style="color: #BB0000;">NA</span>  50         <span style="color: #BB0000;">NA</span>    0  </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 8</span> BWA     VA        <span style="text-decoration: underline;">1</span>967   8.29        <span style="color: #BB0000;">NA</span>   16.7        <span style="color: #BB0000;">NA</span>   16.7        <span style="color: #BB0000;">NA</span>   0         <span style="color: #BB0000;">NA</span>  -<span style="color: #BB0000;">33.3</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 9</span> BWA     VA        <span style="text-decoration: underline;">1</span>968  10.2         <span style="color: #BB0000;">NA</span>  -<span style="color: #BB0000;">20</span>          <span style="color: #BB0000;">NA</span>  -<span style="color: #BB0000;">20</span>          <span style="color: #BB0000;">NA</span>   0         <span style="color: #BB0000;">NA</span>   35.7</span></span>
<span><span class="co"># <span style="color: #BCBCBC;">10</span> BWA     VA        <span style="text-decoration: underline;">1</span>969   3.61        <span style="color: #BB0000;">NA</span>  185.         <span style="color: #BB0000;">NA</span>  185.         <span style="color: #BB0000;">NA</span> 185.        <span style="color: #BB0000;">NA</span>  185. </span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 5,017 more rows</span></span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 13 more variables: L10G1.CON &lt;dbl&gt;, G1.WRT &lt;dbl&gt;, L10G1.WRT &lt;dbl&gt;, G1.TRA &lt;dbl&gt;,</span></span></span>
<span><span class="co"># <span style="color: #949494;">#   L10G1.TRA &lt;dbl&gt;, G1.FIRE &lt;dbl&gt;, L10G1.FIRE &lt;dbl&gt;, G1.GOV &lt;dbl&gt;, L10G1.GOV &lt;dbl&gt;, G1.OTH &lt;dbl&gt;,</span></span></span>
<span><span class="co"># <span style="color: #949494;">#   L10G1.OTH &lt;dbl&gt;, G1.SUM &lt;dbl&gt;, L10G1.SUM &lt;dbl&gt;</span></span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Grouped by:  Variable, Country  [85 | 59 (7.7) 4-65]</span></span>
<span></span>
<span><span class="co"># Log-difference growth rates, computed as: log(x / lag(x)) * 100</span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="op">-</span><span class="va">Region</span>, <span class="op">-</span><span class="va">Regioncode</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/fgrowth.html">fgrowth</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fl">1</span>, <span class="va">Year</span>, logdiff <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 5,027 × 25</span></span></span>
<span><span class="co">#    Country Variable  Year Dlog1.AGR L10Dlog1.AGR Dlog1.MIN L10Dlog1.MIN Dlog1.MAN L10Dlog1.MAN</span></span>
<span><span class="co">#  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 1</span> BWA     VA        <span style="text-decoration: underline;">1</span>960     <span style="color: #BB0000;">NA</span>              <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>             <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>             <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 2</span> BWA     VA        <span style="text-decoration: underline;">1</span>961     <span style="color: #BB0000;">NA</span>              <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>             <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>             <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 3</span> BWA     VA        <span style="text-decoration: underline;">1</span>962     <span style="color: #BB0000;">NA</span>              <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>             <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>             <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 4</span> BWA     VA        <span style="text-decoration: underline;">1</span>963     <span style="color: #BB0000;">NA</span>              <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>             <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>             <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 5</span> BWA     VA        <span style="text-decoration: underline;">1</span>964     <span style="color: #BB0000;">NA</span>              <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>             <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>             <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 6</span> BWA     VA        <span style="text-decoration: underline;">1</span>965     -<span style="color: #BB0000;">3.59</span>           <span style="color: #BB0000;">NA</span>     -<span style="color: #BB0000;">33.6</span>           <span style="color: #BB0000;">NA</span>      32.4           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 7</span> BWA     VA        <span style="text-decoration: underline;">1</span>966     11.7            <span style="color: #BB0000;">NA</span>     -<span style="color: #BB0000;">23.6</span>           <span style="color: #BB0000;">NA</span>     -<span style="color: #BB0000;">23.6</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 8</span> BWA     VA        <span style="text-decoration: underline;">1</span>967      7.96           <span style="color: #BB0000;">NA</span>      15.4           <span style="color: #BB0000;">NA</span>      15.4           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 9</span> BWA     VA        <span style="text-decoration: underline;">1</span>968      9.72           <span style="color: #BB0000;">NA</span>     -<span style="color: #BB0000;">22.3</span>           <span style="color: #BB0000;">NA</span>     -<span style="color: #BB0000;">22.3</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">10</span> BWA     VA        <span style="text-decoration: underline;">1</span>969      3.55           <span style="color: #BB0000;">NA</span>     105.            <span style="color: #BB0000;">NA</span>     105.            <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 5,017 more rows</span></span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 16 more variables: Dlog1.PU &lt;dbl&gt;, L10Dlog1.PU &lt;dbl&gt;, Dlog1.CON &lt;dbl&gt;, L10Dlog1.CON &lt;dbl&gt;,</span></span></span>
<span><span class="co"># <span style="color: #949494;">#   Dlog1.WRT &lt;dbl&gt;, L10Dlog1.WRT &lt;dbl&gt;, Dlog1.TRA &lt;dbl&gt;, L10Dlog1.TRA &lt;dbl&gt;, Dlog1.FIRE &lt;dbl&gt;,</span></span></span>
<span><span class="co"># <span style="color: #949494;">#   L10Dlog1.FIRE &lt;dbl&gt;, Dlog1.GOV &lt;dbl&gt;, L10Dlog1.GOV &lt;dbl&gt;, Dlog1.OTH &lt;dbl&gt;, L10Dlog1.OTH &lt;dbl&gt;,</span></span></span>
<span><span class="co"># <span style="color: #949494;">#   Dlog1.SUM &lt;dbl&gt;, L10Dlog1.SUM &lt;dbl&gt;</span></span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Grouped by:  Variable, Country  [85 | 59 (7.7) 4-65]</span></span></code></pre></div>
<p><code>fdiff</code> and <code>fgrowth</code> can also perform leaded
(forward) differences and growth rates
(i.e. <code>... %&gt;% fgrowth(-c(1, 10), 1:2, Year)</code> would
compute one and 10-year leaded first and second differences). Again it
is possible to perform sequential operations:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This computes the 1 and 10-year growth rates, for the current period and lagged by one period</span></span>
<span><span class="va">GGDC10S</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="op">-</span><span class="va">Region</span>, <span class="op">-</span><span class="va">Regioncode</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/fgrowth.html">fgrowth</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fl">1</span>, <span class="va">Year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/flag.html">flag</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="va">Year</span><span class="op">)</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 5,027 × 47</span></span></span>
<span><span class="co">#    Country Variable  Year G1.AGR L1.G1.AGR L10G1.AGR L1.L10G1.AGR G1.MIN L1.G1.MIN L10G1.MIN</span></span>
<span><span class="co">#  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 1</span> BWA     VA        <span style="text-decoration: underline;">1</span>960  <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>   <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>          <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 2</span> BWA     VA        <span style="text-decoration: underline;">1</span>961  <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>   <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>          <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 3</span> BWA     VA        <span style="text-decoration: underline;">1</span>962  <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>   <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>          <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 4</span> BWA     VA        <span style="text-decoration: underline;">1</span>963  <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>   <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>          <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 5</span> BWA     VA        <span style="text-decoration: underline;">1</span>964  <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>   <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>          <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 6</span> BWA     VA        <span style="text-decoration: underline;">1</span>965  -<span style="color: #BB0000;">3.52</span>     <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>  -<span style="color: #BB0000;">28.6</span>      <span style="color: #BB0000;">NA</span>          <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 7</span> BWA     VA        <span style="text-decoration: underline;">1</span>966  12.4      -<span style="color: #BB0000;">3.52</span>        <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>  -<span style="color: #BB0000;">21.1</span>     -<span style="color: #BB0000;">28.6</span>        <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 8</span> BWA     VA        <span style="text-decoration: underline;">1</span>967   8.29     12.4         <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>   16.7     -<span style="color: #BB0000;">21.1</span>        <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 9</span> BWA     VA        <span style="text-decoration: underline;">1</span>968  10.2       8.29        <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>  -<span style="color: #BB0000;">20</span>        16.7        <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co"># <span style="color: #BCBCBC;">10</span> BWA     VA        <span style="text-decoration: underline;">1</span>969   3.61     10.2         <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>  185.      -<span style="color: #BB0000;">20</span>          <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 5,017 more rows</span></span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 37 more variables: L1.L10G1.MIN &lt;dbl&gt;, G1.MAN &lt;dbl&gt;, L1.G1.MAN &lt;dbl&gt;, L10G1.MAN &lt;dbl&gt;,</span></span></span>
<span><span class="co"># <span style="color: #949494;">#   L1.L10G1.MAN &lt;dbl&gt;, G1.PU &lt;dbl&gt;, L1.G1.PU &lt;dbl&gt;, L10G1.PU &lt;dbl&gt;, L1.L10G1.PU &lt;dbl&gt;,</span></span></span>
<span><span class="co"># <span style="color: #949494;">#   G1.CON &lt;dbl&gt;, L1.G1.CON &lt;dbl&gt;, L10G1.CON &lt;dbl&gt;, L1.L10G1.CON &lt;dbl&gt;, G1.WRT &lt;dbl&gt;,</span></span></span>
<span><span class="co"># <span style="color: #949494;">#   L1.G1.WRT &lt;dbl&gt;, L10G1.WRT &lt;dbl&gt;, L1.L10G1.WRT &lt;dbl&gt;, G1.TRA &lt;dbl&gt;, L1.G1.TRA &lt;dbl&gt;,</span></span></span>
<span><span class="co"># <span style="color: #949494;">#   L10G1.TRA &lt;dbl&gt;, L1.L10G1.TRA &lt;dbl&gt;, G1.FIRE &lt;dbl&gt;, L1.G1.FIRE &lt;dbl&gt;, L10G1.FIRE &lt;dbl&gt;,</span></span></span>
<span><span class="co"># <span style="color: #949494;">#   L1.L10G1.FIRE &lt;dbl&gt;, G1.GOV &lt;dbl&gt;, L1.G1.GOV &lt;dbl&gt;, L10G1.GOV &lt;dbl&gt;, L1.L10G1.GOV &lt;dbl&gt;, …</span></span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Grouped by:  Variable, Country  [85 | 59 (7.7) 4-65]</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="benchmarks">3. Benchmarks<a class="anchor" aria-label="anchor" href="#benchmarks"></a>
</h2>
<p>This section seeks to demonstrate that the functionality introduced
in the preceding 2 sections indeed produces code that evaluates
substantially faster than native <em>dplyr</em>.</p>
<p>To do this properly, the different components of a typical piped call
(selecting / subsetting, ordering, grouping, and performing some
computation) are benchmarked separately on 2 different data sizes.</p>
<p>All benchmarks are run on a Windows 8.1 laptop with a 2x 2.2 GHZ
Intel i5 processor, 8GB DDR3 RAM and a Samsung 850 EVO SSD hard
drive.</p>
<div class="section level3">
<h3 id="data">3.1 Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h3>
<p>Benchmarks are run on the original <code>GGDC10S</code> data used
throughout this vignette and a larger dataset with approx. 1 million
observations, obtained by replicating and row-binding
<code>GGDC10S</code> 200 times while maintaining unique groups.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This shows the groups in GGDC10S</span></span>
<span><span class="fu"><a href="../reference/GRP.html">GRP</a></span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="op">~</span> <span class="va">Variable</span> <span class="op">+</span> <span class="va">Country</span><span class="op">)</span></span>
<span><span class="co"># collapse grouping object of length 5027 with 85 ordered groups</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Call: GRP.default(X = GGDC10S, by = ~Variable + Country), X is unsorted</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Distribution of group sizes: </span></span>
<span><span class="co">#    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#    4.00   53.00   62.00   59.14   63.00   65.00 </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Groups with sizes: </span></span>
<span><span class="co"># EMP.ARG EMP.BOL EMP.BRA EMP.BWA EMP.CHL EMP.CHN </span></span>
<span><span class="co">#      62      61      62      52      63      62 </span></span>
<span><span class="co">#   ---</span></span>
<span><span class="co"># VA.TWN VA.TZA VA.USA VA.VEN VA.ZAF VA.ZMB </span></span>
<span><span class="co">#     63     52     65     63     52     52</span></span>
<span></span>
<span><span class="co"># This replicates the data 200 times </span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="fl">200</span>, <span class="va">GGDC10S</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span>
<span><span class="co"># This function adds a number i to the country and variable columns of each dataset</span></span>
<span><span class="va">uniquify</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">i</span><span class="op">)</span> <span class="fu"><a href="../reference/ftransform.html">ftransform</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span>, <span class="va">paste0</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Making datasets unique and row-binding them</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unlist2d.html">unlist2d</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Map</a></span><span class="op">(</span><span class="va">uniquify</span>, <span class="va">data</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">200</span><span class="op">)</span><span class="op">)</span>, idcols <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/efficient-programming.html">fdim</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co"># [1] 1005400      16</span></span>
<span></span>
<span><span class="co"># This shows the groups in the replicated data</span></span>
<span><span class="fu"><a href="../reference/GRP.html">GRP</a></span><span class="op">(</span><span class="va">data</span>, <span class="op">~</span> <span class="va">Variable</span> <span class="op">+</span> <span class="va">Country</span><span class="op">)</span></span>
<span><span class="co"># collapse grouping object of length 1005400 with 17000 ordered groups</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Call: GRP.default(X = data, by = ~Variable + Country), X is unsorted</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Distribution of group sizes: </span></span>
<span><span class="co">#    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#    4.00   53.00   62.00   59.14   63.00   65.00 </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Groups with sizes: </span></span>
<span><span class="co"># EMP1.ARG1 EMP1.BOL1 EMP1.BRA1 EMP1.BWA1 EMP1.CHL1 EMP1.CHN1 </span></span>
<span><span class="co">#        62        61        62        52        63        62 </span></span>
<span><span class="co">#   ---</span></span>
<span><span class="co"># VA99.TWN99 VA99.TZA99 VA99.USA99 VA99.VEN99 VA99.ZAF99 VA99.ZMB99 </span></span>
<span><span class="co">#         63         52         65         63         52         52</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#            used  (Mb) gc trigger  (Mb) limit (Mb) max used  (Mb)</span></span>
<span><span class="co"># Ncells  1243174  66.4    2327114 124.3         NA  2327114 124.3</span></span>
<span><span class="co"># Vcells 18414122 140.5   27668405 211.1      16384 21587856 164.8</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="selecting-subsetting-ordering-and-grouping">3.1 Selecting, Subsetting, Ordering and Grouping<a class="anchor" aria-label="anchor" href="#selecting-subsetting-ordering-and-grouping"></a>
</h3>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Selecting columns</span></span>
<span><span class="co"># Small</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="va">Country</span>, <span class="va">Variable</span>, <span class="va">AGR</span><span class="op">:</span><span class="va">SUM</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="va">Country</span>, <span class="va">Variable</span>, <span class="va">AGR</span><span class="op">:</span><span class="va">SUM</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Unit: microseconds</span></span>
<span><span class="co">#      expr      min       lq       mean    median       uq      max neval</span></span>
<span><span class="co">#     dplyr 3489.488 3621.926 3921.45418 3790.8285 4046.102 7889.775   100</span></span>
<span><span class="co">#  collapse   10.220   12.714   20.70493   16.6315   28.505   51.400   100</span></span>
<span></span>
<span><span class="co"># Large</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">Country</span>, <span class="va">Variable</span>, <span class="va">AGR</span><span class="op">:</span><span class="va">SUM</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">Country</span>, <span class="va">Variable</span>, <span class="va">AGR</span><span class="op">:</span><span class="va">SUM</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Unit: microseconds</span></span>
<span><span class="co">#      expr      min       lq       mean    median       uq       max neval</span></span>
<span><span class="co">#     dplyr 3430.147 3519.537 4355.90560 3615.6435 3755.689 24484.974   100</span></span>
<span><span class="co">#  collapse   10.275   12.482   19.41635   15.3005   25.408    41.783   100</span></span>
<span></span>
<span><span class="co">## Subsetting columns </span></span>
<span><span class="co"># Small</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="va">Variable</span> <span class="op">==</span> <span class="st">"VA"</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/fsubset.html">fsubset</a></span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="va">Variable</span> <span class="op">==</span> <span class="st">"VA"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Unit: microseconds</span></span>
<span><span class="co">#      expr      min      lq      mean   median        uq      max neval</span></span>
<span><span class="co">#     dplyr 1356.294 1573.20 1622.6789 1609.260 1663.6395 1973.148   100</span></span>
<span><span class="co">#  collapse  110.069  251.06  249.7036  262.408  274.2565  331.969   100</span></span>
<span></span>
<span><span class="co"># Large</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">Variable</span> <span class="op">==</span> <span class="st">"VA"</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/fsubset.html">fsubset</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">Variable</span> <span class="op">==</span> <span class="st">"VA"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#      expr       min        lq     mean    median       uq      max neval</span></span>
<span><span class="co">#     dplyr 10.545093 16.003232 17.05909 16.440964 16.75533 65.54238   100</span></span>
<span><span class="co">#  collapse  6.337589  7.983163  9.53547  8.117383  8.31383 32.10814   100</span></span>
<span></span>
<span><span class="co">## Ordering rows</span></span>
<span><span class="co"># Small</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">Country</span><span class="op">)</span>, <span class="va">Variable</span>, <span class="va">Year</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/roworder.html">roworder</a></span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="op">-</span><span class="va">Country</span>, <span class="va">Variable</span>, <span class="va">Year</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Unit: microseconds</span></span>
<span><span class="co">#      expr      min       lq      mean   median       uq        max neval</span></span>
<span><span class="co">#     dplyr 6285.986 6912.030 8900.5720 7162.905 7432.332 142485.814   100</span></span>
<span><span class="co">#  collapse  670.985  720.275  769.6222  758.429  790.512   1202.588   100</span></span>
<span></span>
<span><span class="co"># Large</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">Country</span><span class="op">)</span>, <span class="va">Variable</span>, <span class="va">Year</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/roworder.html">roworder</a></span><span class="op">(</span><span class="va">data</span>, <span class="op">-</span><span class="va">Country</span>, <span class="va">Variable</span>, <span class="va">Year</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#      expr      min       lq     mean   median       uq      max neval</span></span>
<span><span class="co">#     dplyr 199.0398 199.0398 205.0088 205.0088 210.9778 210.9778     2</span></span>
<span><span class="co">#  collapse 157.4205 157.4205 159.7776 159.7776 162.1347 162.1347     2</span></span>
<span></span>
<span></span>
<span><span class="co">## Grouping </span></span>
<span><span class="co"># Small</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="va">Country</span>, <span class="va">Variable</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="va">Country</span>, <span class="va">Variable</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Unit: microseconds</span></span>
<span><span class="co">#      expr      min       lq      mean   median       uq       max neval</span></span>
<span><span class="co">#     dplyr 3502.997 3741.552 4309.1548 3906.761 4325.826 19373.328   100</span></span>
<span><span class="co">#  collapse  306.483  320.900  391.2006  364.586  388.754  1620.548   100</span></span>
<span></span>
<span><span class="co"># Large</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">Country</span>, <span class="va">Variable</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">Country</span>, <span class="va">Variable</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#      expr      min       lq     mean   median       uq       max neval</span></span>
<span><span class="co">#     dplyr 77.97566 78.48921 85.39169 79.27614 81.17757 118.92567    10</span></span>
<span><span class="co">#  collapse 59.68204 60.32196 61.87591 61.28217 62.30614  67.57554    10</span></span>
<span></span>
<span><span class="co">## Computing a new column </span></span>
<span><span class="co"># Small</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">GGDC10S</span>, NEW <span class="op">=</span> <span class="va">AGR</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/ftransform.html">ftransform</a></span><span class="op">(</span><span class="va">GGDC10S</span>, NEW <span class="op">=</span> <span class="va">AGR</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Unit: microseconds</span></span>
<span><span class="co">#      expr      min       lq      mean   median       uq      max neval</span></span>
<span><span class="co">#     dplyr 1285.894 1349.755 1494.2015 1387.659 1541.066 3132.612   100</span></span>
<span><span class="co">#  collapse   65.134   68.349   81.8449   78.341   92.438  176.427   100</span></span>
<span></span>
<span><span class="co"># Large</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">data</span>, NEW <span class="op">=</span> <span class="va">AGR</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/ftransform.html">ftransform</a></span><span class="op">(</span><span class="va">data</span>, NEW <span class="op">=</span> <span class="va">AGR</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#      expr      min       lq     mean   median       uq      max neval</span></span>
<span><span class="co">#     dplyr 2.893903 3.483154 5.949544 5.635884 5.860514 29.26906   100</span></span>
<span><span class="co">#  collapse 1.346054 1.772760 3.561971 4.030751 4.164459 23.18243   100</span></span>
<span></span>
<span><span class="co">## All combined with pipes </span></span>
<span><span class="co"># Small</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="va">Variable</span> <span class="op">==</span> <span class="st">"VA"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Country</span>, <span class="va">Year</span>, <span class="va">AGR</span><span class="op">:</span><span class="va">SUM</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">Country</span><span class="op">)</span>, <span class="va">Year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>NEW <span class="op">=</span> <span class="va">AGR</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Country</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/fsubset.html">fsubset</a></span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="va">Variable</span> <span class="op">==</span> <span class="st">"VA"</span>, <span class="va">Country</span>, <span class="va">Year</span>, <span class="va">AGR</span><span class="op">:</span><span class="va">SUM</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                       <span class="fu"><a href="../reference/roworder.html">roworder</a></span><span class="op">(</span><span class="op">-</span><span class="va">Country</span>, <span class="va">Year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                       <span class="fu"><a href="../reference/ftransform.html">ftransform</a></span><span class="op">(</span>NEW <span class="op">=</span> <span class="va">AGR</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                       <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Country</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Unit: microseconds</span></span>
<span><span class="co">#      expr       min         lq       mean     median        uq       max neval</span></span>
<span><span class="co">#     dplyr 13071.387 14389.5160 15838.2114 14915.6930 15556.240 36927.739   100</span></span>
<span><span class="co">#  collapse   364.259   402.8485   508.0254   490.5015   533.461  1299.997   100</span></span>
<span></span>
<span><span class="co"># Large</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">Variable</span> <span class="op">==</span> <span class="st">"VA"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Country</span>, <span class="va">Year</span>, <span class="va">AGR</span><span class="op">:</span><span class="va">SUM</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">Country</span><span class="op">)</span>, <span class="va">Year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>NEW <span class="op">=</span> <span class="va">AGR</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Country</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/fsubset.html">fsubset</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">Variable</span> <span class="op">==</span> <span class="st">"VA"</span>, <span class="va">Country</span>, <span class="va">Year</span>, <span class="va">AGR</span><span class="op">:</span><span class="va">SUM</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                       <span class="fu"><a href="../reference/roworder.html">roworder</a></span><span class="op">(</span><span class="op">-</span><span class="va">Country</span>, <span class="va">Year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                       <span class="fu"><a href="../reference/ftransform.html">ftransform</a></span><span class="op">(</span>NEW <span class="op">=</span> <span class="va">AGR</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                       <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Country</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#      expr      min        lq      mean    median        uq       max neval</span></span>
<span><span class="co">#     dplyr 28.93666 29.554415 32.977858 29.804298 30.797230 50.075130    10</span></span>
<span><span class="co">#  collapse  8.35628  8.386666  8.521272  8.461759  8.491551  9.095365    10</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#            used  (Mb) gc trigger  (Mb) limit (Mb) max used  (Mb)</span></span>
<span><span class="co"># Ncells  1249049  66.8    2327114 124.3         NA  2327114 124.3</span></span>
<span><span class="co"># Vcells 18432049 140.7   56645518 432.2      16384 65356848 498.7</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="aggregation">3.1 Aggregation<a class="anchor" aria-label="anchor" href="#aggregation"></a>
</h3>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Grouping the data</span></span>
<span><span class="va">cgGGDC10S</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="op">-</span><span class="va">Region</span>, <span class="op">-</span><span class="va">Regioncode</span><span class="op">)</span></span>
<span><span class="va">gGGDC10S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="op">-</span><span class="va">Region</span>, <span class="op">-</span><span class="va">Regioncode</span><span class="op">)</span></span>
<span><span class="va">cgdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="op">-</span><span class="va">Region</span>, <span class="op">-</span><span class="va">Regioncode</span><span class="op">)</span></span>
<span><span class="va">gdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">Variable</span>, <span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="op">-</span><span class="va">Region</span>, <span class="op">-</span><span class="va">Regioncode</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">GGDC10S</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#            used  (Mb) gc trigger  (Mb) limit (Mb) max used  (Mb)</span></span>
<span><span class="co"># Ncells  1266027  67.7    2327114 124.3         NA  2327114 124.3</span></span>
<span><span class="co"># Vcells 18050810 137.8   56645518 432.2      16384 65356848 498.7</span></span>
<span></span>
<span><span class="co">## Conversion of Grouping object: This time would be required extra in all hybrid calls </span></span>
<span><span class="co">## i.e. when calling collapse functions on data grouped with dplyr::group_by</span></span>
<span><span class="co"># Small</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/GRP.html">GRP</a></span><span class="op">(</span><span class="va">gGGDC10S</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Unit: microseconds</span></span>
<span><span class="co">#           expr    min      lq     mean median      uq     max neval</span></span>
<span><span class="co">#  GRP(gGGDC10S) 30.907 31.5885 33.33999 31.894 32.2815 138.711   100</span></span>
<span></span>
<span><span class="co"># Large</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/GRP.html">GRP</a></span><span class="op">(</span><span class="va">gdata</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#        expr      min       lq     mean   median       uq      max neval</span></span>
<span><span class="co">#  GRP(gdata) 1.217799 2.864908 3.598289 2.962506 3.066216 54.68288   100</span></span>
<span></span>
<span></span>
<span><span class="co">## Sum </span></span>
<span><span class="co"># Small</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html" class="external-link">summarise_all</a></span><span class="op">(</span><span class="va">gGGDC10S</span>, <span class="va">sum</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/fsum.html">fsum</a></span><span class="op">(</span><span class="va">cgGGDC10S</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Unit: microseconds</span></span>
<span><span class="co">#      expr       min        lq       mean    median        uq      max neval</span></span>
<span><span class="co">#     dplyr 13033.942 14151.341 16920.9501 14801.111 16312.319 57057.20   100</span></span>
<span><span class="co">#  collapse   225.046   242.611   277.0517   269.405   283.555   932.73   100</span></span>
<span></span>
<span><span class="co"># Large</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html" class="external-link">summarise_all</a></span><span class="op">(</span><span class="va">gdata</span>, <span class="va">sum</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/fsum.html">fsum</a></span><span class="op">(</span><span class="va">cgdata</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#      expr        min         lq       mean     median         uq       max neval</span></span>
<span><span class="co">#     dplyr 1051.00696 1160.41047 1240.97960 1225.59529 1289.48393 1458.7252    10</span></span>
<span><span class="co">#  collapse   36.77166   37.10408   39.28687   37.36837   38.83307   54.0068    10</span></span>
<span></span>
<span><span class="co">## Mean</span></span>
<span><span class="co"># Small</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html" class="external-link">summarise_all</a></span><span class="op">(</span><span class="va">gGGDC10S</span>, <span class="va">mean.default</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/fmean.html">fmean</a></span><span class="op">(</span><span class="va">cgGGDC10S</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Unit: microseconds</span></span>
<span><span class="co">#      expr       min       lq       mean    median         uq      max neval</span></span>
<span><span class="co">#     dplyr 18219.980 18951.79 24351.9623 19862.054 22661.0000 71083.06   100</span></span>
<span><span class="co">#  collapse   191.647   210.09   655.9897   234.565   253.9305 29215.17   100</span></span>
<span></span>
<span><span class="co"># Large</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html" class="external-link">summarise_all</a></span><span class="op">(</span><span class="va">gdata</span>, <span class="va">mean.default</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/fmean.html">fmean</a></span><span class="op">(</span><span class="va">cgdata</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#      expr        min         lq       mean     median         uq       max neval</span></span>
<span><span class="co">#     dplyr 2609.94027 2788.95462 2922.11488 2900.61127 3008.47574 3388.9440    10</span></span>
<span><span class="co">#  collapse   28.58095   28.98742   35.10517   29.21946   29.63693   60.1694    10</span></span>
<span></span>
<span><span class="co">## Median</span></span>
<span><span class="co"># Small</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html" class="external-link">summarise_all</a></span><span class="op">(</span><span class="va">gGGDC10S</span>, <span class="va">median</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/fnth_fmedian.html">fmedian</a></span><span class="op">(</span><span class="va">cgGGDC10S</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Unit: microseconds</span></span>
<span><span class="co">#      expr       min         lq       mean    median        uq        max neval</span></span>
<span><span class="co">#     dplyr 62224.317 65144.5440 71071.3413 66979.834 74692.284 121432.835   100</span></span>
<span><span class="co">#  collapse   257.783   273.0575   319.1502   323.604   346.867    753.752   100</span></span>
<span></span>
<span><span class="co"># Large</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html" class="external-link">summarise_all</a></span><span class="op">(</span><span class="va">gdata</span>, <span class="va">median</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/fnth_fmedian.html">fmedian</a></span><span class="op">(</span><span class="va">cgdata</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#      expr         min          lq        mean      median          uq         max neval</span></span>
<span><span class="co">#     dplyr 12439.11146 12439.11146 12491.73470 12491.73470 12544.35794 12544.35794     2</span></span>
<span><span class="co">#  collapse    34.18171    34.18171    38.22922    38.22922    42.27674    42.27674     2</span></span>
<span></span>
<span><span class="co">## Standard Deviation</span></span>
<span><span class="co"># Small</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html" class="external-link">summarise_all</a></span><span class="op">(</span><span class="va">gGGDC10S</span>, <span class="va">sd</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/fvar_fsd.html">fsd</a></span><span class="op">(</span><span class="va">cgGGDC10S</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Unit: microseconds</span></span>
<span><span class="co">#      expr       min         lq       mean    median         uq       max neval</span></span>
<span><span class="co">#     dplyr 31281.100 32847.3795 35497.4035 33404.466 35834.9565 60607.592   100</span></span>
<span><span class="co">#  collapse   330.989   345.7875   377.9596   380.162   391.7625   595.704   100</span></span>
<span></span>
<span><span class="co"># Large</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html" class="external-link">summarise_all</a></span><span class="op">(</span><span class="va">gdata</span>, <span class="va">sd</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/fvar_fsd.html">fsd</a></span><span class="op">(</span><span class="va">cgdata</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#      expr        min         lq       mean     median         uq        max neval</span></span>
<span><span class="co">#     dplyr 5402.32798 5402.32798 5433.49542 5433.49542 5464.66286 5464.66286     2</span></span>
<span><span class="co">#  collapse   62.35387   62.35387   63.17848   63.17848   64.00309   64.00309     2</span></span>
<span></span>
<span><span class="co">## Maximum</span></span>
<span><span class="co"># Small</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html" class="external-link">summarise_all</a></span><span class="op">(</span><span class="va">gGGDC10S</span>, <span class="va">max</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/fmin_fmax.html">fmax</a></span><span class="op">(</span><span class="va">cgGGDC10S</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Unit: microseconds</span></span>
<span><span class="co">#      expr        min          lq        mean      median         uq        max neval</span></span>
<span><span class="co">#     dplyr 176345.744 183201.4080 188546.9957 186081.1040 190930.933 309029.021   100</span></span>
<span><span class="co">#  collapse    124.397    135.0225    161.9521    160.2905    178.597    468.706   100</span></span>
<span></span>
<span><span class="co"># Large</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html" class="external-link">summarise_all</a></span><span class="op">(</span><span class="va">gdata</span>, <span class="va">max</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/fmin_fmax.html">fmax</a></span><span class="op">(</span><span class="va">cgdata</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#      expr        min         lq       mean     median         uq       max neval</span></span>
<span><span class="co">#     dplyr 1591.34896 1696.68018 1809.22776 1810.17779 1886.72714 2102.9881    10</span></span>
<span><span class="co">#  collapse   14.79236   15.13991   15.46265   15.48342   15.70449   16.0907    10</span></span>
<span></span>
<span><span class="co">## First Value</span></span>
<span><span class="co"># Small</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html" class="external-link">summarise_all</a></span><span class="op">(</span><span class="va">gGGDC10S</span>, <span class="va">first</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/ffirst_flast.html">ffirst</a></span><span class="op">(</span><span class="va">cgGGDC10S</span>, na.rm <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Unit: microseconds</span></span>
<span><span class="co">#      expr       min        lq        mean    median        uq       max neval</span></span>
<span><span class="co">#     dplyr 38470.366 40146.984 42216.74138 41405.526 43129.993 50523.558   100</span></span>
<span><span class="co">#  collapse    51.124    57.902    82.59861    96.516    98.867   145.644   100</span></span>
<span></span>
<span><span class="co"># Large</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html" class="external-link">summarise_all</a></span><span class="op">(</span><span class="va">gdata</span>, <span class="va">first</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/ffirst_flast.html">ffirst</a></span><span class="op">(</span><span class="va">cgdata</span>, na.rm <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#      expr         min          lq        mean      median          uq         max neval</span></span>
<span><span class="co">#     dplyr 6961.063440 7214.715193 7357.368719 7410.315644 7491.019063 7550.737431    10</span></span>
<span><span class="co">#  collapse    2.510998    3.161265    3.546645    3.275513    3.477635    6.119615    10</span></span>
<span></span>
<span><span class="co">## Number of Distinct Values</span></span>
<span><span class="co"># Small</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html" class="external-link">summarise_all</a></span><span class="op">(</span><span class="va">gGGDC10S</span>, <span class="va">n_distinct</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/fndistinct.html">fndistinct</a></span><span class="op">(</span><span class="va">cgGGDC10S</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Unit: microseconds</span></span>
<span><span class="co">#      expr       min        lq       mean    median         uq       max neval</span></span>
<span><span class="co">#     dplyr 47907.026 50326.818 55918.2762 53105.307 57408.7185 88681.980   100</span></span>
<span><span class="co">#  collapse   382.959   410.762   443.1653   438.563   457.7175   791.374   100</span></span>
<span></span>
<span><span class="co"># Large</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html" class="external-link">summarise_all</a></span><span class="op">(</span><span class="va">gdata</span>, <span class="va">n_distinct</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/fndistinct.html">fndistinct</a></span><span class="op">(</span><span class="va">cgdata</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#      expr        min         lq       mean     median         uq        max neval</span></span>
<span><span class="co">#     dplyr 8789.46222 8949.43686 9141.94294 9200.78296 9318.72016 9451.31249     5</span></span>
<span><span class="co">#  collapse   68.00007   69.51117   72.09068   70.13749   73.16455   79.64011     5</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#            used  (Mb) gc trigger  (Mb) limit (Mb) max used  (Mb)</span></span>
<span><span class="co"># Ncells  2064077 110.3    4673748 249.7         NA  4673748 249.7</span></span>
<span><span class="co"># Vcells 19369068 147.8   56645518 432.2      16384 65356848 498.7</span></span></code></pre></div>
<!-- The benchmarks show that at this data size efficient primitives like `base::sum` or `base::max` can still deliver very decent performance with `summarize`. Less optimized base functions like `mean`, `median` and `sd` however take multiple seconds to compute, and here `collapse` fast functions really prove to be very useful complements to the *dplyr* system. -->
<!-- Weighted statistics are also performed extremely fast by *collapse* functions. I would not know how to compute weighted statistics by groups in *dplyr*, as it would require the weighting variable to be split as well, which seems impossible in native *dplyr*. -->
<!-- A further highlight of *collapse* is the extremely fast statistical mode function, which can also compute a weighted mode. Fast categorical aggregation has been an issue in R, and defining a mode function from base R and applying it to 17000 groups will probably let it run at least a minute. `fmode` reduces this time to half a second. -->
<!-- Thus in terms of data aggregation *collapse* fast functions are able to speed up *dplyr* to a level that makes it attractive again to R users working on medium-sized or larger data, and everyone programming with *dplyr*. I however strongly recommend *collapse* itself for easy and speedy programming as it does not rely on non-standard evaluation and has less R-overhead than *dplyr*. -->
<!-- In all of this the grouping system of *dplyr* remains the central bottleneck. For example grouping 10 million observations in 1 million groups takes around 10 second with `group_by`, whereas `GRP` takes around 1.5 seconds, and this difference grows exponentially as data get larger. Rewriting `group_by` using `GRP` / `radixorderv` and then writing a simple C++ conversion program for the grouping object could be a quick remedy for this issue, but that is at the discretion of Hadley Wickham and coauthors. -->
<!-- (If you need that speed program with *collapse* or use *data.table* with GeForce optimized functions). -->
<p>Below are some additional benchmarks for weighted aggregations and
aggregations using the statistical mode, which cannot easily or
efficiently be performed with <em>dplyr</em>.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Weighted Mean</span></span>
<span><span class="co"># Small</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/fmean.html">fmean</a></span><span class="op">(</span><span class="va">cgGGDC10S</span>, <span class="va">SUM</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co"># Unit: microseconds</span></span>
<span><span class="co">#                   expr    min       lq     mean   median      uq     max neval</span></span>
<span><span class="co">#  fmean(cgGGDC10S, SUM) 233.57 234.7725 239.1367 236.0865 238.146 351.873   100</span></span>
<span></span>
<span><span class="co"># Large </span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/fmean.html">fmean</a></span><span class="op">(</span><span class="va">cgdata</span>, <span class="va">SUM</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> </span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#                expr      min       lq     mean   median       uq     max neval</span></span>
<span><span class="co">#  fmean(cgdata, SUM) 33.34954 33.41851 33.94263 33.54076 34.46969 35.4433    10</span></span>
<span></span>
<span><span class="co">## Weighted Standard-Deviation</span></span>
<span><span class="co"># Small</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/fvar_fsd.html">fsd</a></span><span class="op">(</span><span class="va">cgGGDC10S</span>, <span class="va">SUM</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co"># Unit: microseconds</span></span>
<span><span class="co">#                 expr     min       lq     mean  median     uq     max neval</span></span>
<span><span class="co">#  fsd(cgGGDC10S, SUM) 354.674 358.4795 373.6078 362.436 369.36 498.337   100</span></span>
<span></span>
<span><span class="co"># Large </span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/fvar_fsd.html">fsd</a></span><span class="op">(</span><span class="va">cgdata</span>, <span class="va">SUM</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> </span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#              expr      min       lq     mean   median       uq      max neval</span></span>
<span><span class="co">#  fsd(cgdata, SUM) 63.42646 64.21176 65.15056 64.64021 66.52745 67.92801    10</span></span>
<span></span>
<span><span class="co">## Statistical Mode</span></span>
<span><span class="co"># Small</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/fmode.html">fmode</a></span><span class="op">(</span><span class="va">cgGGDC10S</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co"># Unit: microseconds</span></span>
<span><span class="co">#              expr     min       lq     mean  median      uq    max neval</span></span>
<span><span class="co">#  fmode(cgGGDC10S) 581.261 585.9695 620.8994 605.961 629.251 842.78   100</span></span>
<span></span>
<span><span class="co"># Large </span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/fmode.html">fmode</a></span><span class="op">(</span><span class="va">cgdata</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> </span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#           expr      min       lq     mean   median       uq      max neval</span></span>
<span><span class="co">#  fmode(cgdata) 105.9943 107.4276 108.8921 108.2589 109.5904 114.8025    10</span></span>
<span></span>
<span><span class="co">## Weighted Statistical Mode</span></span>
<span><span class="co"># Small</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/fmode.html">fmode</a></span><span class="op">(</span><span class="va">cgGGDC10S</span>, <span class="va">SUM</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co"># Unit: microseconds</span></span>
<span><span class="co">#                   expr     min      lq     mean  median      uq     max neval</span></span>
<span><span class="co">#  fmode(cgGGDC10S, SUM) 682.149 690.246 734.2629 700.762 769.857 970.851   100</span></span>
<span></span>
<span><span class="co"># Large </span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/fmode.html">fmode</a></span><span class="op">(</span><span class="va">cgdata</span>, <span class="va">SUM</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> </span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#                expr      min       lq     mean   median       uq     max neval</span></span>
<span><span class="co">#  fmode(cgdata, SUM) 122.8627 123.6322 126.2189 126.5988 129.0409 129.332    10</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#            used  (Mb) gc trigger  (Mb) limit (Mb) max used  (Mb)</span></span>
<span><span class="co"># Ncells  2063531 110.3    4673748 249.7         NA  4673748 249.7</span></span>
<span><span class="co"># Vcells 19365688 147.8   58018632 442.7      16384 68289991 521.1</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="transformation">3.2 Transformation<a class="anchor" aria-label="anchor" href="#transformation"></a>
</h3>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## Replacing with group sum</span></span>
<span><span class="co"># Small</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_all</a></span><span class="op">(</span><span class="va">gGGDC10S</span>, <span class="va">sum</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/fsum.html">fsum</a></span><span class="op">(</span><span class="va">cgGGDC10S</span>, TRA <span class="op">=</span> <span class="st">"replace_fill"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Unit: microseconds</span></span>
<span><span class="co">#      expr       min        lq       mean     median       uq       max neval</span></span>
<span><span class="co">#     dplyr 27426.495 28613.550 30789.0838 29683.4950 30802.22 53090.876   100</span></span>
<span><span class="co">#  collapse   417.501   522.569   555.8625   558.3015   576.82   671.308   100</span></span>
<span></span>
<span><span class="co"># Large</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_all</a></span><span class="op">(</span><span class="va">gdata</span>, <span class="va">sum</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/fsum.html">fsum</a></span><span class="op">(</span><span class="va">cgdata</span>, TRA <span class="op">=</span> <span class="st">"replace_fill"</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#      expr        min         lq      mean    median        uq       max neval</span></span>
<span><span class="co">#     dplyr 1369.28166 1696.18824 1711.5093 1733.7599 1766.4020 1849.1325    10</span></span>
<span><span class="co">#  collapse   81.42708   84.79044  131.7076   94.8447  101.4687  474.9394    10</span></span>
<span></span>
<span><span class="co">## Dividing by group sum</span></span>
<span><span class="co"># Small</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_all</a></span><span class="op">(</span><span class="va">gGGDC10S</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/fsum.html">fsum</a></span><span class="op">(</span><span class="va">cgGGDC10S</span>, TRA <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Unit: microseconds</span></span>
<span><span class="co">#      expr      min        lq       mean   median        uq       max neval</span></span>
<span><span class="co">#     dplyr 27862.66 30077.622 32726.3397 30898.21 32848.700 56347.550   100</span></span>
<span><span class="co">#  collapse   680.32   721.192   777.0225   758.04   821.487  1025.242   100</span></span>
<span></span>
<span><span class="co"># Large</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_all</a></span><span class="op">(</span><span class="va">gdata</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/fsum.html">fsum</a></span><span class="op">(</span><span class="va">cgdata</span>, TRA <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#      expr       min        lq      mean    median        uq       max neval</span></span>
<span><span class="co">#     dplyr 1795.8878 2104.5133 2161.7033 2248.4097 2285.8522 2361.1147    10</span></span>
<span><span class="co">#  collapse  117.9019  125.8552  163.4611  127.9584  130.5126  464.1452    10</span></span>
<span></span>
<span><span class="co">## Centering</span></span>
<span><span class="co"># Small</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_all</a></span><span class="op">(</span><span class="va">gGGDC10S</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean.default</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/fbetween_fwithin.html">fwithin</a></span><span class="op">(</span><span class="va">cgGGDC10S</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Unit: microseconds</span></span>
<span><span class="co">#      expr       min        lq       mean     median         uq      max neval</span></span>
<span><span class="co">#     dplyr 32478.228 35124.278 39228.1971 36796.7135 38266.8050 81634.80   100</span></span>
<span><span class="co">#  collapse   494.805   524.192   573.1317   573.0425   596.6725   832.72   100</span></span>
<span></span>
<span><span class="co"># Large</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_all</a></span><span class="op">(</span><span class="va">gdata</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean.default</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/fbetween_fwithin.html">fwithin</a></span><span class="op">(</span><span class="va">cgdata</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#      expr        min         lq      mean   median        uq       max neval</span></span>
<span><span class="co">#     dplyr 3181.32650 3627.74739 3654.6155 3731.135 3831.0607 3944.2836    10</span></span>
<span><span class="co">#  collapse   90.47569   90.93589  181.1855  110.989  184.8398  702.1718    10</span></span>
<span></span>
<span><span class="co">## Centering and Scaling (Standardizing)</span></span>
<span><span class="co"># Small</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_all</a></span><span class="op">(</span><span class="va">gGGDC10S</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">(</span><span class="va">x</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean.default</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/fscale.html">fscale</a></span><span class="op">(</span><span class="va">cgGGDC10S</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Unit: microseconds</span></span>
<span><span class="co">#      expr       min         lq       mean     median        uq       max neval</span></span>
<span><span class="co">#     dplyr 55303.394 59301.7305 64929.6792 61944.8400 65176.246 106028.17   100</span></span>
<span><span class="co">#  collapse   423.724   640.0285   679.1872   681.7245   704.644    986.67   100</span></span>
<span></span>
<span><span class="co"># Large</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_all</a></span><span class="op">(</span><span class="va">gdata</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">(</span><span class="va">x</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean.default</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               collapse <span class="op">=</span> <span class="fu"><a href="../reference/fscale.html">fscale</a></span><span class="op">(</span><span class="va">cgdata</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#      expr       min        lq      mean    median        uq       max neval</span></span>
<span><span class="co">#     dplyr 8632.9568 8632.9568 8926.8485 8926.8485 9220.7402 9220.7402     2</span></span>
<span><span class="co">#  collapse  118.9444  118.9444  128.0866  128.0866  137.2288  137.2288     2</span></span>
<span></span>
<span><span class="co">## Lag</span></span>
<span><span class="co"># Small</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr_unordered <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">gGGDC10S</span>, <span class="fu"><a href="../reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu">dplyr</span><span class="fu">::</span><span class="va"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">)</span><span class="op">)</span>,</span>
<span>               collapse_unordered <span class="op">=</span> <span class="fu"><a href="../reference/flag.html">flag</a></span><span class="op">(</span><span class="va">cgGGDC10S</span><span class="op">)</span>,</span>
<span>               dplyr_ordered <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">gGGDC10S</span>, <span class="fu"><a href="../reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">x</span>, order_by <span class="op">=</span> <span class="va">Year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               collapse_ordered <span class="op">=</span> <span class="fu"><a href="../reference/flag.html">flag</a></span><span class="op">(</span><span class="va">cgGGDC10S</span>, t <span class="op">=</span> <span class="va">Year</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Unit: microseconds</span></span>
<span><span class="co">#                expr       min          lq        mean      median          uq        max neval</span></span>
<span><span class="co">#     dplyr_unordered 57668.205  61589.7830  67370.8294  63826.4725  66504.9645 155495.628   100</span></span>
<span><span class="co">#  collapse_unordered   182.895    390.9940    432.2146    427.8245    476.3455    665.955   100</span></span>
<span><span class="co">#       dplyr_ordered 98327.632 106673.1050 112403.3025 110783.0370 114574.8265 137359.632   100</span></span>
<span><span class="co">#    collapse_ordered   285.684    431.1505    469.0872    451.4445    498.7330    907.025   100</span></span>
<span></span>
<span><span class="co"># Large</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr_unordered <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">gdata</span>, <span class="fu"><a href="../reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu">dplyr</span><span class="fu">::</span><span class="va"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">)</span><span class="op">)</span>,</span>
<span>               collapse_unordered <span class="op">=</span> <span class="fu"><a href="../reference/flag.html">flag</a></span><span class="op">(</span><span class="va">cgdata</span><span class="op">)</span>,</span>
<span>               dplyr_ordered <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">gdata</span>, <span class="fu"><a href="../reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">x</span>, order_by <span class="op">=</span> <span class="va">Year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               collapse_ordered <span class="op">=</span> <span class="fu"><a href="../reference/flag.html">flag</a></span><span class="op">(</span><span class="va">cgdata</span>, t <span class="op">=</span> <span class="va">Year</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#                expr         min          lq        mean      median          uq         max neval</span></span>
<span><span class="co">#     dplyr_unordered 11788.04867 11788.04867 11954.34324 11954.34324 12120.63780 12120.63780     2</span></span>
<span><span class="co">#  collapse_unordered    62.37295    62.37295    62.61711    62.61711    62.86126    62.86126     2</span></span>
<span><span class="co">#       dplyr_ordered 20721.85652 20721.85652 21391.50874 21391.50874 22061.16096 22061.16096     2</span></span>
<span><span class="co">#    collapse_ordered    72.91673    72.91673    78.64386    78.64386    84.37099    84.37099     2</span></span>
<span></span>
<span><span class="co">## First-Difference (unordered)</span></span>
<span><span class="co"># Small</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr_unordered <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_all</a></span><span class="op">(</span><span class="va">gGGDC10S</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               collapse_unordered <span class="op">=</span> <span class="fu"><a href="../reference/fdiff.html">fdiff</a></span><span class="op">(</span><span class="va">cgGGDC10S</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Unit: microseconds</span></span>
<span><span class="co">#                expr       min        lq       mean    median         uq       max neval</span></span>
<span><span class="co">#     dplyr_unordered 76718.508 77795.767 80772.3419 78653.187 79601.3540 109469.06   100</span></span>
<span><span class="co">#  collapse_unordered   276.253   418.537   460.7524   458.152   491.7215   1121.19   100</span></span>
<span></span>
<span><span class="co"># Large</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>dplyr_unordered <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_all</a></span><span class="op">(</span><span class="va">gdata</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               collapse_unordered <span class="op">=</span> <span class="fu"><a href="../reference/fdiff.html">fdiff</a></span><span class="op">(</span><span class="va">cgdata</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#                expr         min          lq        mean      median          uq         max neval</span></span>
<span><span class="co">#     dplyr_unordered 12356.19573 12356.19573 12702.65275 12702.65275 13049.10976 13049.10976     2</span></span>
<span><span class="co">#  collapse_unordered    66.23811    66.23811    67.92178    67.92178    69.60545    69.60545     2</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#            used  (Mb) gc trigger  (Mb) limit (Mb) max used  (Mb)</span></span>
<span><span class="co"># Ncells  2070902 110.6    5648497 301.7         NA  5648497 301.7</span></span>
<span><span class="co"># Vcells 19383123 147.9   66978264 511.1      16384 83720678 638.8</span></span></code></pre></div>
<p>Below again some benchmarks for transformations not easily of
efficiently performed with <em>dplyr</em>, such as centering on the
overall mean, mean-preserving scaling, weighted scaling and centering,
sequences of lags / leads, (iterated) panel-differences and growth
rates.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Centering on overall mean</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">fwithin</a></span><span class="op">(</span><span class="va">cgdata</span>, mean <span class="op">=</span> <span class="st">"overall.mean"</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#                                    expr      min       lq     mean   median       uq    max neval</span></span>
<span><span class="co">#  fwithin(cgdata, mean = "overall.mean") 64.45669 78.97896 90.14167 87.19192 101.3341 118.94    10</span></span>
<span></span>
<span><span class="co"># Weighted Centering</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">fwithin</a></span><span class="op">(</span><span class="va">cgdata</span>, <span class="va">SUM</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#                  expr      min       lq     mean  median       uq      max neval</span></span>
<span><span class="co">#  fwithin(cgdata, SUM) 53.18106 83.19289 85.37856 86.9525 88.26107 102.3837    10</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/fbetween_fwithin.html">fwithin</a></span><span class="op">(</span><span class="va">cgdata</span>, <span class="va">SUM</span>, mean <span class="op">=</span> <span class="st">"overall.mean"</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#                                         expr      min       lq     mean   median       uq      max</span></span>
<span><span class="co">#  fwithin(cgdata, SUM, mean = "overall.mean") 67.69949 83.41879 85.99108 85.38855 86.84905 102.8098</span></span>
<span><span class="co">#  neval</span></span>
<span><span class="co">#     10</span></span>
<span></span>
<span><span class="co"># Weighted Scaling and Standardizing</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/fvar_fsd.html">fsd</a></span><span class="op">(</span><span class="va">cgdata</span>, <span class="va">SUM</span>, TRA <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#                         expr      min       lq     mean   median       uq      max neval</span></span>
<span><span class="co">#  fsd(cgdata, SUM, TRA = "/") 119.9496 135.8335 142.2232 137.5957 138.7076 173.5807    10</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/fscale.html">fscale</a></span><span class="op">(</span><span class="va">cgdata</span>, <span class="va">SUM</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#                 expr     min       lq    mean   median       uq      max neval</span></span>
<span><span class="co">#  fscale(cgdata, SUM) 75.4563 93.66858 103.283 108.4097 109.3828 117.3637    10</span></span>
<span></span>
<span><span class="co"># Sequence of lags and leads</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/flag.html">flag</a></span><span class="op">(</span><span class="va">cgdata</span>, <span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#                expr      min       lq     mean   median       uq      max neval</span></span>
<span><span class="co">#  flag(cgdata, -1:1) 82.11261 131.4312 230.3366 284.0841 288.0878 288.6183    10</span></span>
<span></span>
<span><span class="co"># Iterated difference</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/fdiff.html">fdiff</a></span><span class="op">(</span><span class="va">cgdata</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#                 expr      min       lq     mean  median       uq      max neval</span></span>
<span><span class="co">#  fdiff(cgdata, 1, 2) 48.55849 49.75097 76.17047 78.1978 85.91034 110.2697    10</span></span>
<span></span>
<span><span class="co"># Growth Rate</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="../reference/fgrowth.html">fgrowth</a></span><span class="op">(</span><span class="va">cgdata</span>,<span class="fl">1</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Unit: milliseconds</span></span>
<span><span class="co">#                expr      min       lq     mean   median       uq      max neval</span></span>
<span><span class="co">#  fgrowth(cgdata, 1) 49.68257 50.36062 76.10994 78.79219 87.55391 108.7424    10</span></span></code></pre></div>
<!-- Again the benchmarks show stunning performance gains using *collapse* functions. -->
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Timmer, M. P., de Vries, G. J., &amp; de Vries, K. (2015). “Patterns
of Structural Change in Developing Countries.” . In J. Weiss, &amp; M.
Tribe (Eds.), <em>Routledge Handbook of Industry and Development.</em>
(pp. 65-83). Routledge.</p>
<p>Cochrane, D. &amp; Orcutt, G. H. (1949). “Application of Least
Squares Regression to Relationships Containing Auto-Correlated Error
Terms”. <em>Journal of the American Statistical Association.</em> 44
(245): 32–61.</p>
<p>Prais, S. J. &amp; Winsten, C. B. (1954). “Trend Estimators and
Serial Correlation”. <em>Cowles Commission Discussion Paper
No. 383.</em> Chicago.</p>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Sebastian Krantz.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
