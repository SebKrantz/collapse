<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fast and Easy Data Reshaping — pivot • collapse</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Fast and Easy Data Reshaping — pivot"><meta name="description" content="pivot() is collapse's data reshaping command. It combines longer-, wider-, and recast-pivoting functionality in a single parsimonious API. Notably, it can also accommodate variable labels."><meta property="og:description" content="pivot() is collapse's data reshaping command. It combines longer-, wider-, and recast-pivoting functionality in a single parsimonious API. Notably, it can also accommodate variable labels."><meta property="og:image" content="https://sebkrantz.github.io/collapse/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">collapse</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.1.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Documentation</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://sebkrantz.github.io/Rblog/">Blog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://bsky.app/profile/rcollapse.bsky.social" aria-label="BlueSky"><span class="fa fa-bluesky"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://twitter.com/collapse_R" aria-label="Twitter"><span class="fa fa-twitter"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/SebKrantz/collapse" aria-label="GitHub"><span class="fa fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Fast and Easy Data Reshaping</h1>

      <div class="d-none name"><code>pivot.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>pivot()</code> is <em>collapse</em>'s data reshaping command. It combines longer-, wider-, and recast-pivoting functionality in a single parsimonious API. Notably, it can also accommodate variable labels.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">pivot</span><span class="op">(</span><span class="va">data</span>,               <span class="co"># Summary of Documentation:</span></span>
<span>      ids <span class="op">=</span> <span class="cn">NULL</span>,         <span class="co"># identifier cols to preserve</span></span>
<span>      values <span class="op">=</span> <span class="cn">NULL</span>,      <span class="co"># cols containing the data</span></span>
<span>      names <span class="op">=</span> <span class="cn">NULL</span>,       <span class="co"># name(s) of new col(s) | col(s) containing names</span></span>
<span>      labels <span class="op">=</span> <span class="cn">NULL</span>,      <span class="co"># name of new labels col | col(s) containing labels</span></span>
<span>      how <span class="op">=</span> <span class="st">"longer"</span>,     <span class="co"># method: "longer"/"l", "wider"/"w" or "recast"/"r"</span></span>
<span>      na.rm <span class="op">=</span> <span class="cn">FALSE</span>,      <span class="co"># remove rows missing 'values' in reshaped data</span></span>
<span>      factor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"names"</span>, <span class="st">"labels"</span><span class="op">)</span>, <span class="co"># create new id col(s) as factor variable(s)?</span></span>
<span>      check.dups <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># detect duplicate 'ids'+'names' combinations</span></span>
<span></span>
<span>      <span class="co"># Only apply if how = "wider" or "recast"</span></span>
<span>      FUN <span class="op">=</span> <span class="st">"last"</span>,       <span class="co"># aggregation function (internal or external)</span></span>
<span>      FUN.args <span class="op">=</span> <span class="cn">NULL</span>,    <span class="co"># list of arguments passed to aggregation function</span></span>
<span>      nthreads <span class="op">=</span> <span class="va">.op</span><span class="op">[[</span><span class="st">"nthreads"</span><span class="op">]</span><span class="op">]</span>, <span class="co"># minor gains as grouping remains serial</span></span>
<span>      fill <span class="op">=</span> <span class="cn">NULL</span>,        <span class="co"># value to insert for unbalanced data (default NA/NULL)</span></span>
<span>      drop <span class="op">=</span> <span class="cn">TRUE</span>,        <span class="co"># drop unused levels (=columns) if 'names' is factor</span></span>
<span>      sort <span class="op">=</span> <span class="cn">FALSE</span>,       <span class="co"># "ids": sort 'ids' and/or "names": alphabetic casting</span></span>
<span></span>
<span>      <span class="co"># Only applies if how = "wider" with multiple long columns ('values')</span></span>
<span>      transpose <span class="op">=</span> <span class="cn">FALSE</span>   <span class="co"># "columns": applies t_list() before flattening, and/or</span></span>
<span><span class="op">)</span>                         <span class="co"># "names": sets names nami_colj. default: colj_nami</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <p></p>
<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>data frame-like object (list of equal-length columns).</p></dd>

  <dt id="arg-ids">ids<a class="anchor" aria-label="anchor" href="#arg-ids"></a></dt>
<dd><p>identifier columns to keep. Specified using column names, indices, a logical vector or an identifier function e.g. <code><a href="small-helpers.html">is_categorical</a></code>.</p></dd>

  <dt id="arg-values">values<a class="anchor" aria-label="anchor" href="#arg-values"></a></dt>
<dd><p>columns containing the data to be reshaped. Specified like <code>ids</code>.</p></dd>

  <dt id="arg-names">names<a class="anchor" aria-label="anchor" href="#arg-names"></a></dt>
<dd><p>names of columns to generate, or retrieve variable names from:</p><table class="table table"><tr><td><code> how </code></td><td></td><td><em> Description </em></td></tr><tr><td><code>"longer"</code></td><td></td><td>list of names for the variable and value column in the long format, respectively. If <code>NULL</code>, <code>list("variable", "value")</code> will be chosen. Alternatively, a named list length 1 or 2 can be provided using "variable"/"value" as keys e.g. <code>list(value = "data_col")</code>.</td></tr><tr><td><code> "wider"</code></td><td></td><td>column(s) containing names of the new variables. Specified using a vector of column names, indices, a logical vector or selector function e.g. <code>is.character</code>. Multiple columns will be combined using <code><a href="qF.html">finteraction</a></code> with <code>"_"</code> as separator.</td></tr><tr><td><code> "recast"</code></td><td></td><td>(named) list with the following elements: [[1]]/[["from"]] - column(s) containing names of the new variables, specified as in <code>"wider"</code>; [[2]]/[["to"]] - name of the variable to generate containing old column names. If <code>NULL</code>, <code>list("variable", "variable")</code> will be chosen.</td></tr></table></dd>

  <dt id="arg-labels">labels<a class="anchor" aria-label="anchor" href="#arg-labels"></a></dt>
<dd><p>names of columns to generate, or retrieve variable labels from:</p><table class="table table"><tr><td><code> how </code></td><td></td><td><em> Description </em></td></tr><tr><td><code>"longer"</code></td><td></td><td>A string specifying the name of the column to store labels - retrieved from the data using <code>vlabels(values)</code>. <code>TRUE</code> will create a column named <code>"label"</code>. Alternatively, a (named) list with two elements: [[1]]/[["name"]] - the name of the labels column; [[2]]/[["new"]] - a (named) character vector of new labels for the 'variable', 'label' and 'value' columns in the long-format frame. See Examples.</td></tr><tr><td><code> "wider"</code></td><td></td><td>column(s) containing labels of the new variables. Specified using a vector of column names, indices, a logical vector or selector function e.g. <code>is.character</code>. Multiple columns will be combined using <code><a href="qF.html">finteraction</a></code> with <code>" - "</code> as separator.</td></tr><tr><td><code> "recast"</code></td><td></td><td>(named) list with the following elements: [[1]]/[["from"]] - column(s) containing labels for the new variables, specified as in <code>"wider"</code>; [[2]]/[["to"]] - name of the variable to generate containing old labels; [[3]]/[["new"]] - a (named) character vector of new labels for the generated 'variable' and 'label' columns. If [[1]]/[["from"]] is not supplied, this can also include labels for new variables. Omitting one of the elements via a named list or setting it to <code>NULL</code> in a list of 3 will omit the corresponding operation i.e. either not saving existing labels or not assigning new ones.</td></tr></table></dd>

  <dt id="arg-how">how<a class="anchor" aria-label="anchor" href="#arg-how"></a></dt>
<dd><p>character. The pivoting method: one of <code>"longer"</code>, <code>"wider"</code> or <code>"recast"</code>. These can be abbreviated by the first letter i.e. <code>"l"/"w"/"r"</code>.</p></dd>

  <dt id="arg-na-rm">na.rm<a class="anchor" aria-label="anchor" href="#arg-na-rm"></a></dt>
<dd><p>logical. <code>TRUE</code> will remove missing values such that in the reshaped data there is no row missing all data columns - selected through 'values'. For wide/recast pivots using internal <code>FUN</code>'s <code>"first"/"last"/"count"</code>, this also toggles skipping of missing values.</p></dd>

  <dt id="arg-factor">factor<a class="anchor" aria-label="anchor" href="#arg-factor"></a></dt>
<dd><p>character. Whether to generate new 'names' and/or 'labels' columns as factor variables. This is generally recommended as factors are more memory efficient than character vectors and also faster in subsequent filtering and grouping. Internally, this argument is evaluated as <code>factor &lt;- c("names", "labels") %in% factor</code>, so passing anything other than <code>"names"</code> and/or <code>"labels"</code> will disable it.</p></dd>

  <dt id="arg-check-dups">check.dups<a class="anchor" aria-label="anchor" href="#arg-check-dups"></a></dt>
<dd><p>logical. <code>TRUE</code> checks for duplicate 'ids'+'names' combinations, and, if 'labels' are specified, also for duplicate 'names'+'labels' combinations. The default <code>FALSE</code> implies that the algorithm just runs through the data, leading effectively to the <code>FUN</code> option to be executed (default last value). See Details.</p></dd>

  <dt id="arg-fun">FUN<a class="anchor" aria-label="anchor" href="#arg-fun"></a></dt>
<dd><p>function to aggregate values. At present, only a single function is allowed. <a href="fast-statistical-functions.html">Fast Statistical Functions</a> receive vectorized execution. For maximum efficiency, a small set of internal functions is provided: <code>"first"</code>, <code>"last"</code>, <code>"count"</code>, <code>"sum"</code>, <code>"mean"</code>, <code>"min"</code>, or <code>"max"</code>. In options <code>"first"/"last"/"count"</code> setting <code>na.rm = TRUE</code> skips missing values. In options <code>"sum"/"mean"/"min"/"max"</code> missing values are always skipped (see Details why). The <code>fill</code> argument is ignored in <code>"count"/"sum"/"mean"/"min"/"max"</code> (<code>"count"/"sum"</code> force <code>fill = 0</code> else <code>NA</code> is used).</p></dd>

<dt id="arg-fun-args">FUN.args<a class="anchor" aria-label="anchor" href="#arg-fun-args"></a></dt>
<dd><p>(optional) list of arguments passed to <code>FUN</code> (if using an external function). Data-length arguments such as weight vectors are supported.</p></dd>

<dt id="arg-nthreads">nthreads<a class="anchor" aria-label="anchor" href="#arg-nthreads"></a></dt>
<dd><p>integer. if <code>how = "wider"|"recast"</code>: number of threads to use with OpenMP (default <code>get_collapse("nthreads")</code>, initialized to 1). Only the distribution of values to columns with <code>how = "wider"|"recast"</code> is multithreaded here. Since grouping id columns on a long data frame is expensive and serial, the gains are minor. With <code>how = "long"</code>, multithreading does not make much sense as the most expensive operation is allocating the long results vectors. The rest is a couple of <code>memset()</code>'s in C to copy the values.</p></dd>

  <dt id="arg-fill">fill<a class="anchor" aria-label="anchor" href="#arg-fill"></a></dt>
<dd><p>if <code>how = "wider"|"recast"</code>: value to insert for 'ids'-'names' combinations not present in the long format. <code>NULL</code> uses <code>NA</code> for atomic vectors and <code>NULL</code> for lists.</p></dd>

  <dt id="arg-drop">drop<a class="anchor" aria-label="anchor" href="#arg-drop"></a></dt>
<dd><p>logical. if <code>how = "wider"|"recast"</code> and 'names' is a single factor variable: <code>TRUE</code> will check for and drop unused levels in that factor, avoiding the generation of empty columns.</p></dd>

<dt id="arg-sort">sort<a class="anchor" aria-label="anchor" href="#arg-sort"></a></dt>
<dd><p>if <code>how = "wider"|"recast"</code>: specifying <code>"ids"</code> applies ordered grouping on the id-columns, returning data sorted by ids. Specifying <code>"names"</code> sorts the names before casting (unless 'names' is a factor), yielding columns cast in alphabetic order. Both options can be passed as a character vector, or, alternatively, <code>TRUE</code> can be used to enable both.</p></dd>

<dt id="arg-transpose">transpose<a class="anchor" aria-label="anchor" href="#arg-transpose"></a></dt>
<dd><p>if <code>how = "wider"|"recast"</code> and multiple columns are selected through 'values': specifying <code>"columns"</code> applies <code><a href="t_list.html">t_list</a></code> to the result before flattening, resulting in a different column order. Specifying <code>"names"</code> generates names of the form nami_colj, instead of colj_nami. Both options can be passed as a character vector, or, alternatively, <code>TRUE</code> can be used to enable both.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Pivot wider essentially works as follows: compute <code>g_rows = group(ids)</code> and also <code>g_cols = group(names)</code> (using <code><a href="group.html">group</a></code> if <code>sort = FALSE</code>). <code>g_rows</code> gives the row-numbers of the wider data frame and <code>g_cols</code> the column numbers.</p>
<p>Then, a C function generates a wide data frame and runs through each long column ('values'), assigning each value to the corresponding row and column in the wide frame. In this process <code>FUN</code> is always applied. The default, <code>"last"</code>, does nothing at all, i.e., if there are duplicates, some values are overwritten. <code>"first"</code> works similarly just that the C-loop is executed the other way around. The other hard-coded options count, sum, average, or compare observations on the fly. Missing values are internally skipped for statistical functions as there is no way to distinguish an incoming <code>NA</code> from an initial <code>NA</code> - apart from counting occurrences using an internal structure of the same size as the result data frame which is costly and thus not implemented.</p>
<p>When passing an R-function to <code>FUN</code>, the data is grouped using <code>g_full = group(g_rows, g_cols)</code>, aggregated by groups, and expanded again to full length using <code><a href="TRA.html">TRA</a></code> before entering the reshaping algorithm. Thus, this is significantly more expensive than the optimized internal functions. With <a href="fast-statistical-functions.html">Fast Statistical Functions</a> the aggregation is vectorized across groups, other functions are applied using <code><a href="BY.html">BY</a></code> - by far the slowest option.</p>
<p>If <code>check.dups = TRUE</code>, a check of the form  <code>fnunique(list(g_rows, g_cols)) &lt; fnrow(data)</code> is run, and an informative warning is issued if duplicates are found.</p>
<p>Recast pivoting works similarly. In long pivots <code>FUN</code> is ignored and the check simply amounts to <code>fnunique(ids) &lt; fnrow(data)</code>. <!-- % Making this check optional ensures greater performance, but also requires the user to exercise discretion i.e. know your data or invoke the check. --></p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A reshaped data frame with the same class and attributes (except for 'names'/'row-names') as the input frame.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>Leaving either 'ids' or 'values' empty will assign all other columns (except for <code>"variable"</code> if <code>how = "wider"|"recast"</code>) to the non-specified argument. It is also possible to leave both empty, e.g. for complete melting if <code>how = "wider"</code> or data transposition if <code>how = "recast"</code> (similar to <code><a href="https://rdatatable.gitlab.io/data.table/reference/transpose.html" class="external-link">data.table::transpose</a></code> but supporting multiple names columns and variable labels). See Examples.</p>
<p><code>pivot</code> currently does not support concurrently melting/pivoting longer to multiple columns. See <code><a href="https://rdatatable.gitlab.io/data.table/reference/melt.data.table.html" class="external-link">data.table::melt</a></code> or <code>pivot_longer</code> from <em>tidyr</em> or <em>tidytable</em> for an efficient alternative with this feature. It is also possible to achieve this with just a little bit of programming. An example is provided below. <!-- % Currently I don't see a 'complete' (like \code{pivot_longer}) way of including this feature in the API, and in general I don't see this as a very well-defined operation. But I am open to suggestions. --></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="collap.html">collap</a></code>, <code><a href="efficient-programming.html">vec</a></code>, <code><a href="rowbind.html">rowbind</a></code>, <code><a href="unlist2d.html">unlist2d</a></code>, <a href="fast-data-manipulation.html">Data Frame Manipulation</a>, <a href="collapse-documentation.html">Collapse Overview</a></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># -------------------------------- PIVOT LONGER ---------------------------------</span></span></span>
<span class="r-in"><span><span class="co"># Simple Melting (Reshaping Long)</span></span></span>
<span class="r-in"><span><span class="fu">pivot</span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   variable value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1      mpg  21.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2      mpg  21.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3      mpg  22.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4      mpg  21.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5      mpg  18.7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6      mpg  18.1</span>
<span class="r-in"><span><span class="fu">pivot</span><span class="op">(</span><span class="va">iris</span>, <span class="st">"Species"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Species     variable value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  setosa Sepal.Length   5.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  setosa Sepal.Length   4.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  setosa Sepal.Length   4.7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  setosa Sepal.Length   4.6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  setosa Sepal.Length   5.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  setosa Sepal.Length   5.4</span>
<span class="r-in"><span><span class="fu">pivot</span><span class="op">(</span><span class="va">iris</span>, values <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Same thing</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Species     variable value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  setosa Sepal.Length   5.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  setosa Sepal.Length   4.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  setosa Sepal.Length   4.7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  setosa Sepal.Length   4.6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  setosa Sepal.Length   5.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  setosa Sepal.Length   5.4</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Using collapse's datasets</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">wlddev</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       country iso3c       date year decade     region     income  OECD PCGDP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Afghanistan   AFG 1961-01-01 1960   1960 South Asia Low income FALSE    NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Afghanistan   AFG 1962-01-01 1961   1960 South Asia Low income FALSE    NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Afghanistan   AFG 1963-01-01 1962   1960 South Asia Low income FALSE    NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Afghanistan   AFG 1964-01-01 1963   1960 South Asia Low income FALSE    NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Afghanistan   AFG 1965-01-01 1964   1960 South Asia Low income FALSE    NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   LIFEEX GINI       ODA     POP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 32.446   NA 116769997 8996973</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 32.962   NA 232080002 9169410</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 33.471   NA 112839996 9351441</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 33.971   NA 237720001 9543205</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 34.463   NA 295920013 9744781</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 1 rows ]</span>
<span class="r-in"><span><span class="fu">pivot</span><span class="op">(</span><span class="va">wlddev</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">8</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       country iso3c       date year decade     region     income  OECD variable</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Afghanistan   AFG 2003-01-01 2002   2000 South Asia Low income FALSE    PCGDP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Afghanistan   AFG 2004-01-01 2003   2000 South Asia Low income FALSE    PCGDP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Afghanistan   AFG 2005-01-01 2004   2000 South Asia Low income FALSE    PCGDP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Afghanistan   AFG 2006-01-01 2005   2000 South Asia Low income FALSE    PCGDP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Afghanistan   AFG 2007-01-01 2006   2000 South Asia Low income FALSE    PCGDP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 Afghanistan   AFG 2008-01-01 2007   2000 South Asia Low income FALSE    PCGDP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 330.3036</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 343.0809</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 333.2167</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 357.2347</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 365.2845</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 405.5490</span>
<span class="r-in"><span><span class="fu">pivot</span><span class="op">(</span><span class="va">wlddev</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iso3c"</span>, <span class="st">"year"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PCGDP"</span>, <span class="st">"LIFEEX"</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   iso3c year variable    value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   AFG 2002    PCGDP 330.3036</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   AFG 2003    PCGDP 343.0809</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   AFG 2004    PCGDP 333.2167</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   AFG 2005    PCGDP 357.2347</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   AFG 2006    PCGDP 365.2845</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6   AFG 2007    PCGDP 405.5490</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">GGDC10S</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Country Regioncode             Region Variable Year AGR MIN MAN PU CON WRT</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     BWA        SSA Sub-saharan Africa       VA 1960  NA  NA  NA NA  NA  NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     BWA        SSA Sub-saharan Africa       VA 1961  NA  NA  NA NA  NA  NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     BWA        SSA Sub-saharan Africa       VA 1962  NA  NA  NA NA  NA  NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4     BWA        SSA Sub-saharan Africa       VA 1963  NA  NA  NA NA  NA  NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   TRA FIRE GOV OTH SUM</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  NA   NA  NA  NA  NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  NA   NA  NA  NA  NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  NA   NA  NA  NA  NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  NA   NA  NA  NA  NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 2 rows ]</span>
<span class="r-in"><span><span class="fu">pivot</span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Sectorcode"</span>, <span class="st">"Value"</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Country Regioncode             Region Variable Year Sectorcode    Value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     BWA        SSA Sub-saharan Africa       VA 1964        AGR 16.30154</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     BWA        SSA Sub-saharan Africa       VA 1965        AGR 15.72700</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     BWA        SSA Sub-saharan Africa       VA 1966        AGR 17.68066</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4     BWA        SSA Sub-saharan Africa       VA 1967        AGR 19.14591</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5     BWA        SSA Sub-saharan Africa       VA 1968        AGR 21.09957</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6     BWA        SSA Sub-saharan Africa       VA 1969        AGR 21.86221</span>
<span class="r-in"><span><span class="co"># Can also set by name: variable and/or value. Note that 'value' here remains lowercase</span></span></span>
<span class="r-in"><span><span class="fu">pivot</span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>variable <span class="op">=</span> <span class="st">"Sectorcode"</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Country Regioncode             Region Variable Year Sectorcode    value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     BWA        SSA Sub-saharan Africa       VA 1964        AGR 16.30154</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     BWA        SSA Sub-saharan Africa       VA 1965        AGR 15.72700</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     BWA        SSA Sub-saharan Africa       VA 1966        AGR 17.68066</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4     BWA        SSA Sub-saharan Africa       VA 1967        AGR 19.14591</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5     BWA        SSA Sub-saharan Africa       VA 1968        AGR 21.09957</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6     BWA        SSA Sub-saharan Africa       VA 1969        AGR 21.86221</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Melting including saving labels</span></span></span>
<span class="r-in"><span><span class="fu">pivot</span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, labels <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Country Regioncode             Region Variable Year variable        label</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     BWA        SSA Sub-saharan Africa       VA 1964      AGR Agriculture </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     BWA        SSA Sub-saharan Africa       VA 1965      AGR Agriculture </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     BWA        SSA Sub-saharan Africa       VA 1966      AGR Agriculture </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4     BWA        SSA Sub-saharan Africa       VA 1967      AGR Agriculture </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5     BWA        SSA Sub-saharan Africa       VA 1968      AGR Agriculture </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6     BWA        SSA Sub-saharan Africa       VA 1969      AGR Agriculture </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 16.30154</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 15.72700</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 17.68066</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 19.14591</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 21.09957</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 21.86221</span>
<span class="r-in"><span><span class="fu">pivot</span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, labels <span class="op">=</span> <span class="st">"description"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Country Regioncode             Region Variable Year variable  description</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     BWA        SSA Sub-saharan Africa       VA 1964      AGR Agriculture </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     BWA        SSA Sub-saharan Africa       VA 1965      AGR Agriculture </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     BWA        SSA Sub-saharan Africa       VA 1966      AGR Agriculture </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4     BWA        SSA Sub-saharan Africa       VA 1967      AGR Agriculture </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5     BWA        SSA Sub-saharan Africa       VA 1968      AGR Agriculture </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6     BWA        SSA Sub-saharan Africa       VA 1969      AGR Agriculture </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 16.30154</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 15.72700</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 17.68066</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 19.14591</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 21.09957</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 21.86221</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Also assigning new labels</span></span></span>
<span class="r-in"><span><span class="fu">pivot</span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"description"</span>,</span></span>
<span class="r-in"><span>            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sector Code"</span>, <span class="st">"Sector Description"</span>, <span class="st">"Value"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="small-helpers.html">namlab</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Variable              Label</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     Country            Country</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  Regioncode        Region code</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3      Region             Region</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4    Variable           Variable</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5        Year               Year</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6    variable        Sector Code</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7 description Sector Description</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8       value              Value</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Can leave out value column by providing named vector of labels</span></span></span>
<span class="r-in"><span><span class="fu">pivot</span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"description"</span>,</span></span>
<span class="r-in"><span>          <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>variable <span class="op">=</span> <span class="st">"Sector Code"</span>, description <span class="op">=</span> <span class="st">"Sector Description"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="small-helpers.html">namlab</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Variable              Label</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     Country            Country</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  Regioncode        Region code</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3      Region             Region</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4    Variable           Variable</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5        Year               Year</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6    variable        Sector Code</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7 description Sector Description</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8       value               &lt;NA&gt;</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now here is a nice example that is explicit and respects the dataset naming conventions</span></span></span>
<span class="r-in"><span><span class="fu">pivot</span><span class="op">(</span><span class="va">GGDC10S</span>, ids <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>      names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>variable <span class="op">=</span> <span class="st">"Sectorcode"</span>,</span></span>
<span class="r-in"><span>                   value <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>      labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Sector"</span>,</span></span>
<span class="r-in"><span>                    new <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Sectorcode <span class="op">=</span> <span class="st">"GGDC10S Sector Code"</span>,</span></span>
<span class="r-in"><span>                            Sector <span class="op">=</span> <span class="st">"Long Sector Description"</span>,</span></span>
<span class="r-in"><span>                            Value <span class="op">=</span> <span class="st">"Employment or Value Added"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="small-helpers.html">namlab</a></span><span class="op">(</span>N <span class="op">=</span> <span class="cn">TRUE</span>, Nd <span class="op">=</span> <span class="cn">TRUE</span>, class <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Variable     Class     N Ndist                     Label</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    Country character 46942    43                   Country</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Regioncode character 46942     6               Region code</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     Region character 46942     6                    Region</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   Variable character 46942     2                  Variable</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5       Year   numeric 46942    67                      Year</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 Sectorcode    factor 46942    11       GGDC10S Sector Code</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7     Sector    factor 46942    11   Long Sector Description</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8      Value   numeric 46942 46478 Employment or Value Added</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Note that pivot() currently does not support melting to multiple columns</span></span></span>
<span class="r-in"><span><span class="co"># But you can tackle the issue with a bit of programming:</span></span></span>
<span class="r-in"><span><span class="va">wide</span> <span class="op">&lt;-</span> <span class="fu">pivot</span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Country"</span>, <span class="st">"Year"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AGR"</span>, <span class="st">"MAN"</span>, <span class="st">"SUM"</span><span class="op">)</span>, <span class="st">"Variable"</span>,</span></span>
<span class="r-in"><span>              how <span class="op">=</span> <span class="st">"wider"</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">wide</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Country Year   AGR_VA  AGR_EMP    MAN_VA  MAN_EMP   SUM_VA  SUM_EMP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     BWA 1964 16.30154 152.1179 0.7365696 2.420000 37.48229 173.8829</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     BWA 1965 15.72700 153.2971 1.0181992 2.330406 39.34710 178.7637</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     BWA 1966 17.68066 153.8867 0.8038415 1.281642 43.14677 179.7183</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4     BWA 1967 19.14591 155.0659 0.9378151 1.041623 41.39519 178.9181</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5     BWA 1968 21.09957 156.2451 0.7502521 1.069332 41.14259 181.9292</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6     BWA 1969 21.86221 157.4243 2.1396077 2.124402 51.22160 188.0569</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">wide</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="op">{</span><span class="fu"><a href="https://sebkrantz.github.io/collapse/reference/select_replace_vars.html">av</a></span><span class="op">(</span><span class="fu">pivot</span><span class="op">(</span><span class="va">.</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"_VA"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="fu">pivot</span><span class="op">(</span><span class="fu"><a href="https://sebkrantz.github.io/collapse/reference/select_replace_vars.html">gvr</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_EMP"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">}</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Country Year variable    value variable    value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     BWA 1964   AGR_VA 16.30154  AGR_EMP 152.1179</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     BWA 1965   AGR_VA 15.72700  AGR_EMP 153.2971</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     BWA 1966   AGR_VA 17.68066  AGR_EMP 153.8867</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4     BWA 1967   AGR_VA 19.14591  AGR_EMP 155.0659</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5     BWA 1968   AGR_VA 21.09957  AGR_EMP 156.2451</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6     BWA 1969   AGR_VA 21.86221  AGR_EMP 157.4243</span>
<span class="r-in"><span><span class="va">wide</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="op">{</span><span class="fu"><a href="https://sebkrantz.github.io/collapse/reference/select_replace_vars.html">av</a></span><span class="op">(</span><span class="fu"><a href="https://sebkrantz.github.io/collapse/reference/select_replace_vars.html">av</a></span><span class="op">(</span><span class="fu"><a href="https://sebkrantz.github.io/collapse/reference/select_replace_vars.html">gv</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="small-helpers.html">rm_stub</a></span><span class="op">(</span><span class="fu"><a href="https://sebkrantz.github.io/collapse/reference/select_replace_vars.html">gvr</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_VA"</span><span class="op">)</span>, <span class="st">"_VA"</span>, pre <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>                   <span class="fu">pivot</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Sectorcode"</span>, <span class="st">"VA"</span><span class="op">)</span>, labels <span class="op">=</span> <span class="st">"Sector"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             EMP <span class="op">=</span> <span class="fu"><a href="efficient-programming.html">vec</a></span><span class="op">(</span><span class="fu"><a href="https://sebkrantz.github.io/collapse/reference/select_replace_vars.html">gvr</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_EMP"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">}</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Country Year Sectorcode       Sector       VA      EMP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     BWA 1964        AGR Agriculture  16.30154 152.1179</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     BWA 1965        AGR Agriculture  15.72700 153.2971</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     BWA 1966        AGR Agriculture  17.68066 153.8867</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4     BWA 1967        AGR Agriculture  19.14591 155.0659</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5     BWA 1968        AGR Agriculture  21.09957 156.2451</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6     BWA 1969        AGR Agriculture  21.86221 157.4243</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">wide</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># -------------------------------- PIVOT WIDER ---------------------------------</span></span></span>
<span class="r-in"><span><span class="va">iris_long</span> <span class="op">&lt;-</span> <span class="fu">pivot</span><span class="op">(</span><span class="va">iris</span>, <span class="st">"Species"</span><span class="op">)</span> <span class="co"># Getting a long frame</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">iris_long</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Species     variable value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  setosa Sepal.Length   5.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  setosa Sepal.Length   4.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  setosa Sepal.Length   4.7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  setosa Sepal.Length   4.6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  setosa Sepal.Length   5.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  setosa Sepal.Length   5.4</span>
<span class="r-in"><span><span class="co"># If 'names'/'values' not supplied, searches for 'variable' and 'value' columns</span></span></span>
<span class="r-in"><span><span class="fu">pivot</span><span class="op">(</span><span class="va">iris_long</span>, how <span class="op">=</span> <span class="st">"wider"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Species Sepal.Length Sepal.Width Petal.Length Petal.Width</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     setosa          5.0         3.3          1.4         0.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 versicolor          5.7         2.8          4.1         1.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  virginica          5.9         3.0          5.1         1.8</span>
<span class="r-in"><span><span class="co"># But here the records are not identified by 'Species': thus aggregation with last value:</span></span></span>
<span class="r-in"><span><span class="fu">pivot</span><span class="op">(</span><span class="va">iris_long</span>, how <span class="op">=</span> <span class="st">"wider"</span>, check <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># issues a warning</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>duplicates detected: there are 12 unique combinations of id- and name-columns, but the data has 600 rows. This means you have on average 50 duplicates per id-name-combination. If how = 'wider', pivot() will take the last of those duplicates in first-appearance-order. Consider aggregating your data e.g. using collap() before applying pivot().</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Species Sepal.Length Sepal.Width Petal.Length Petal.Width</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     setosa          5.0         3.3          1.4         0.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 versicolor          5.7         2.8          4.1         1.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  virginica          5.9         3.0          5.1         1.8</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">iris_long</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># This works better, these two are inverse operations</span></span></span>
<span class="r-in"><span><span class="va">wlddev</span> <span class="op">|&gt;</span> <span class="fu">pivot</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">pivot</span><span class="op">(</span>how <span class="op">=</span> <span class="st">"w"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       country iso3c       date year decade     region     income  OECD PCGDP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Afghanistan   AFG 1961-01-01 1960   1960 South Asia Low income FALSE    NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Afghanistan   AFG 1962-01-01 1961   1960 South Asia Low income FALSE    NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Afghanistan   AFG 1963-01-01 1962   1960 South Asia Low income FALSE    NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Afghanistan   AFG 1964-01-01 1963   1960 South Asia Low income FALSE    NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Afghanistan   AFG 1965-01-01 1964   1960 South Asia Low income FALSE    NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   LIFEEX GINI       ODA     POP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 32.446   NA 116769997 8996973</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 32.962   NA 232080002 9169410</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 33.471   NA 112839996 9351441</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 33.971   NA 237720001 9543205</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 34.463   NA 295920013 9744781</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 1 rows ]</span>
<span class="r-in"><span><span class="co"># ...but not perfect, we loose labels</span></span></span>
<span class="r-in"><span><span class="fu"><a href="small-helpers.html">namlab</a></span><span class="op">(</span><span class="va">wlddev</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Variable</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   country</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     iso3c</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3      date</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4      year</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5    decade</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6    region</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7    income</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8      OECD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9     PCGDP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10   LIFEEX</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11     GINI</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12      ODA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13      POP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                                                                Label</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                                                                       Country Name</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                                                                       Country Code</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                                                         Date Recorded (Fictitious)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4                                                                               Year</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5                                                                             Decade</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6                                                                             Region</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7                                                                       Income Level</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8                                                            Is OECD Member Country?</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9                                                 GDP per capita (constant 2010 US$)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10                                           Life expectancy at birth, total (years)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11                                                  Gini index (World Bank estimate)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12 Net official development assistance and official aid received (constant 2018 US$)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13                                                                 Population, total</span>
<span class="r-in"><span><span class="va">wlddev</span> <span class="op">|&gt;</span> <span class="fu">pivot</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">pivot</span><span class="op">(</span>how <span class="op">=</span> <span class="st">"w"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="small-helpers.html">namlab</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Variable                      Label</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   country               Country Name</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     iso3c               Country Code</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3      date Date Recorded (Fictitious)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4      year                       Year</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5    decade                     Decade</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6    region                     Region</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7    income               Income Level</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8      OECD    Is OECD Member Country?</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9     PCGDP                       &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10   LIFEEX                       &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11     GINI                       &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12      ODA                       &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13      POP                       &lt;NA&gt;</span>
<span class="r-in"><span><span class="co"># But pivot() supports labels: these are perfect inverse operations</span></span></span>
<span class="r-in"><span><span class="va">wlddev</span> <span class="op">|&gt;</span> <span class="fu">pivot</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span>, labels <span class="op">=</span> <span class="st">"label"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>max <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># Notice the "label" column</span></span></span>
<span class="r-in"><span>  <span class="fu">pivot</span><span class="op">(</span>how <span class="op">=</span> <span class="st">"w"</span>, labels <span class="op">=</span> <span class="st">"label"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="small-helpers.html">namlab</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       country iso3c       date year decade     region     income  OECD variable</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Afghanistan   AFG 1961-01-01 1960   1960 South Asia Low income FALSE    PCGDP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Afghanistan   AFG 1962-01-01 1961   1960 South Asia Low income FALSE    PCGDP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Afghanistan   AFG 1963-01-01 1962   1960 South Asia Low income FALSE    PCGDP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Afghanistan   AFG 1964-01-01 1963   1960 South Asia Low income FALSE    PCGDP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                label value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 GDP per capita (constant 2010 US$)    NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 GDP per capita (constant 2010 US$)    NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 GDP per capita (constant 2010 US$)    NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 GDP per capita (constant 2010 US$)    NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 65876 rows ]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Variable</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   country</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     iso3c</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3      date</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4      year</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5    decade</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6    region</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7    income</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8      OECD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9     PCGDP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10   LIFEEX</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11     GINI</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12      ODA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13      POP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                                                                Label</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                                                                       Country Name</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                                                                       Country Code</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                                                         Date Recorded (Fictitious)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4                                                                               Year</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5                                                                             Decade</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6                                                                             Region</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7                                                                       Income Level</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8                                                            Is OECD Member Country?</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9                                                 GDP per capita (constant 2010 US$)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10                                           Life expectancy at birth, total (years)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11                                                  Gini index (World Bank estimate)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12 Net official development assistance and official aid received (constant 2018 US$)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13                                                                 Population, total</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># If the data does not have 'variable'/'value' cols: need to specify 'names'/'values'</span></span></span>
<span class="r-in"><span><span class="co"># Using a single column:</span></span></span>
<span class="r-in"><span><span class="fu">pivot</span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Country"</span>, <span class="st">"Year"</span><span class="op">)</span>, <span class="st">"SUM"</span>, <span class="st">"Variable"</span>, how <span class="op">=</span> <span class="st">"w"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Country Year       VA      EMP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     BWA 1960       NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     BWA 1961       NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     BWA 1962       NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4     BWA 1963       NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5     BWA 1964 37.48229 173.8829</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6     BWA 1965 39.34710 178.7637</span>
<span class="r-in"><span><span class="va">SUM_wide</span> <span class="op">&lt;-</span> <span class="fu">pivot</span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Country"</span>, <span class="st">"Year"</span><span class="op">)</span>, <span class="st">"SUM"</span>, <span class="st">"Variable"</span>, how <span class="op">=</span> <span class="st">"w"</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">SUM_wide</span><span class="op">)</span> <span class="co"># na.rm = TRUE here removes all new rows completely missing data</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Country Year       VA      EMP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     BWA 1964 37.48229 173.8829</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     BWA 1965 39.34710 178.7637</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     BWA 1966 43.14677 179.7183</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4     BWA 1967 41.39519 178.9181</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5     BWA 1968 41.14259 181.9292</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6     BWA 1969 51.22160 188.0569</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">SUM_wide</span><span class="op">)</span> <span class="co"># But there may still be NA's, notice the NA in the final row</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Country Year        VA      EMP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2341     EGY 2008  844222.3 21039.90</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2342     EGY 2009  978684.0 21863.86</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2343     EGY 2010 1133629.1 22019.88</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2344     EGY 2011 1290896.1 22219.39</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2345     EGY 2012 1487175.1 22532.56</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2346     EGY 2013 1650962.8       NA</span>
<span class="r-in"><span><span class="co"># We could use fill to set another value</span></span></span>
<span class="r-in"><span><span class="fu">pivot</span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Country"</span>, <span class="st">"Year"</span><span class="op">)</span>, <span class="st">"SUM"</span>, <span class="st">"Variable"</span>, how <span class="op">=</span> <span class="st">"w"</span>,</span></span>
<span class="r-in"><span>      na.rm <span class="op">=</span> <span class="cn">TRUE</span>, fill <span class="op">=</span> <span class="op">-</span><span class="fl">9999</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Country Year        VA      EMP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2341     EGY 2008  844222.3 21039.90</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2342     EGY 2009  978684.0 21863.86</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2343     EGY 2010 1133629.1 22019.88</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2344     EGY 2011 1290896.1 22219.39</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2345     EGY 2012 1487175.1 22532.56</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2346     EGY 2013 1650962.8 -9999.00</span>
<span class="r-in"><span><span class="co"># This will keep the label of "SUM", unless we supply a column with new labels</span></span></span>
<span class="r-in"><span><span class="fu"><a href="small-helpers.html">namlab</a></span><span class="op">(</span><span class="va">SUM_wide</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Variable                   Label</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  Country                 Country</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     Year                    Year</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3       VA Summation of sector GDP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4      EMP Summation of sector GDP</span>
<span class="r-in"><span><span class="co"># Such a column is not available here, but we could use "Variable" twice</span></span></span>
<span class="r-in"><span><span class="fu">pivot</span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Country"</span>, <span class="st">"Year"</span><span class="op">)</span>, <span class="st">"SUM"</span>, <span class="st">"Variable"</span>, <span class="st">"Variable"</span>, how <span class="op">=</span> <span class="st">"w"</span>,</span></span>
<span class="r-in"><span>      na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="small-helpers.html">namlab</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Variable   Label</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  Country Country</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     Year    Year</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3       VA      VA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4      EMP     EMP</span>
<span class="r-in"><span><span class="co"># Alternatively, can of course relabel ex-post</span></span></span>
<span class="r-in"><span><span class="va">SUM_wide</span> <span class="op">|&gt;</span> <span class="fu"><a href="frename.html">relabel</a></span><span class="op">(</span>VA <span class="op">=</span> <span class="st">"Value Added"</span>, EMP <span class="op">=</span> <span class="st">"Employment"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="small-helpers.html">namlab</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Variable       Label</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  Country     Country</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     Year        Year</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3       VA Value Added</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4      EMP  Employment</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">SUM_wide</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Multiple-column pivots</span></span></span>
<span class="r-in"><span><span class="fu">pivot</span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Country"</span>, <span class="st">"Year"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AGR"</span>, <span class="st">"MAN"</span>, <span class="st">"SUM"</span><span class="op">)</span>, <span class="st">"Variable"</span>, how <span class="op">=</span> <span class="st">"w"</span>,</span></span>
<span class="r-in"><span>      na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Country Year   AGR_VA  AGR_EMP    MAN_VA  MAN_EMP   SUM_VA  SUM_EMP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     BWA 1964 16.30154 152.1179 0.7365696 2.420000 37.48229 173.8829</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     BWA 1965 15.72700 153.2971 1.0181992 2.330406 39.34710 178.7637</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     BWA 1966 17.68066 153.8867 0.8038415 1.281642 43.14677 179.7183</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4     BWA 1967 19.14591 155.0659 0.9378151 1.041623 41.39519 178.9181</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5     BWA 1968 21.09957 156.2451 0.7502521 1.069332 41.14259 181.9292</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6     BWA 1969 21.86221 157.4243 2.1396077 2.124402 51.22160 188.0569</span>
<span class="r-in"><span><span class="co"># Here we may prefer a transposed column order</span></span></span>
<span class="r-in"><span><span class="fu">pivot</span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Country"</span>, <span class="st">"Year"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AGR"</span>, <span class="st">"MAN"</span>, <span class="st">"SUM"</span><span class="op">)</span>, <span class="st">"Variable"</span>, how <span class="op">=</span> <span class="st">"w"</span>,</span></span>
<span class="r-in"><span>      na.rm <span class="op">=</span> <span class="cn">TRUE</span>, transpose <span class="op">=</span> <span class="st">"columns"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Country Year   AGR_VA    MAN_VA   SUM_VA  AGR_EMP  MAN_EMP  SUM_EMP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     BWA 1964 16.30154 0.7365696 37.48229 152.1179 2.420000 173.8829</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     BWA 1965 15.72700 1.0181992 39.34710 153.2971 2.330406 178.7637</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     BWA 1966 17.68066 0.8038415 43.14677 153.8867 1.281642 179.7183</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4     BWA 1967 19.14591 0.9378151 41.39519 155.0659 1.041623 178.9181</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5     BWA 1968 21.09957 0.7502521 41.14259 156.2451 1.069332 181.9292</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6     BWA 1969 21.86221 2.1396077 51.22160 157.4243 2.124402 188.0569</span>
<span class="r-in"><span><span class="co"># Can also flip the order of names (independently of columns)</span></span></span>
<span class="r-in"><span><span class="fu">pivot</span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Country"</span>, <span class="st">"Year"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AGR"</span>, <span class="st">"MAN"</span>, <span class="st">"SUM"</span><span class="op">)</span>, <span class="st">"Variable"</span>, how <span class="op">=</span> <span class="st">"w"</span>,</span></span>
<span class="r-in"><span>      na.rm <span class="op">=</span> <span class="cn">TRUE</span>, transpose <span class="op">=</span> <span class="st">"names"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Country Year   VA_AGR  EMP_AGR    VA_MAN  EMP_MAN   VA_SUM  EMP_SUM</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     BWA 1964 16.30154 152.1179 0.7365696 2.420000 37.48229 173.8829</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     BWA 1965 15.72700 153.2971 1.0181992 2.330406 39.34710 178.7637</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     BWA 1966 17.68066 153.8867 0.8038415 1.281642 43.14677 179.7183</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4     BWA 1967 19.14591 155.0659 0.9378151 1.041623 41.39519 178.9181</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5     BWA 1968 21.09957 156.2451 0.7502521 1.069332 41.14259 181.9292</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6     BWA 1969 21.86221 157.4243 2.1396077 2.124402 51.22160 188.0569</span>
<span class="r-in"><span><span class="co"># Can also enable both (complete transposition)</span></span></span>
<span class="r-in"><span><span class="fu">pivot</span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Country"</span>, <span class="st">"Year"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AGR"</span>, <span class="st">"MAN"</span>, <span class="st">"SUM"</span><span class="op">)</span>, <span class="st">"Variable"</span>, how <span class="op">=</span> <span class="st">"w"</span>,</span></span>
<span class="r-in"><span>      na.rm <span class="op">=</span> <span class="cn">TRUE</span>, transpose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># or tranpose = c("columns", "names")</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Country Year   VA_AGR    VA_MAN   VA_SUM  EMP_AGR  EMP_MAN  EMP_SUM</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     BWA 1964 16.30154 0.7365696 37.48229 152.1179 2.420000 173.8829</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     BWA 1965 15.72700 1.0181992 39.34710 153.2971 2.330406 178.7637</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     BWA 1966 17.68066 0.8038415 43.14677 153.8867 1.281642 179.7183</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4     BWA 1967 19.14591 0.9378151 41.39519 155.0659 1.041623 178.9181</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5     BWA 1968 21.09957 0.7502521 41.14259 156.2451 1.069332 181.9292</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6     BWA 1969 21.86221 2.1396077 51.22160 157.4243 2.124402 188.0569</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Finally, here is a nice, simple way to reshape the entire dataset.</span></span></span>
<span class="r-in"><span><span class="fu">pivot</span><span class="op">(</span><span class="va">GGDC10S</span>, values <span class="op">=</span> <span class="fl">6</span><span class="op">:</span><span class="fl">16</span>, names <span class="op">=</span> <span class="st">"Variable"</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, how <span class="op">=</span> <span class="st">"w"</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="small-helpers.html">namlab</a></span><span class="op">(</span>N <span class="op">=</span> <span class="cn">TRUE</span>, Nd <span class="op">=</span> <span class="cn">TRUE</span>, class <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Variable     Class    N Ndist         Label</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     Country character 2346    43       Country</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  Regioncode character 2346     6   Region code</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3      Region character 2346     6        Region</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4        Year   numeric 2346    67          Year</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5      AGR_VA   numeric 2139  2135  Agriculture </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6     AGR_EMP   numeric 2225  2219  Agriculture </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7      MIN_VA   numeric 2139  2072        Mining</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8     MIN_EMP   numeric 2216  2153        Mining</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9      MAN_VA   numeric 2139  2139 Manufacturing</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10    MAN_EMP   numeric 2216  2214 Manufacturing</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11      PU_VA   numeric 2139  2097     Utilities</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12     PU_EMP   numeric 2215  2141     Utilities</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13     CON_VA   numeric 2139  2130  Construction</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14    CON_EMP   numeric 2216  2209  Construction</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 12 rows ]</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># -------------------------------- PIVOT RECAST ---------------------------------</span></span></span>
<span class="r-in"><span><span class="co"># Look at the data again</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">GGDC10S</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Country Regioncode             Region Variable Year AGR MIN MAN PU CON WRT</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     BWA        SSA Sub-saharan Africa       VA 1960  NA  NA  NA NA  NA  NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     BWA        SSA Sub-saharan Africa       VA 1961  NA  NA  NA NA  NA  NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     BWA        SSA Sub-saharan Africa       VA 1962  NA  NA  NA NA  NA  NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4     BWA        SSA Sub-saharan Africa       VA 1963  NA  NA  NA NA  NA  NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   TRA FIRE GOV OTH SUM</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  NA   NA  NA  NA  NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  NA   NA  NA  NA  NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  NA   NA  NA  NA  NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  NA   NA  NA  NA  NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 2 rows ]</span>
<span class="r-in"><span><span class="co"># Let's stack the sectors and instead create variable columns</span></span></span>
<span class="r-in"><span><span class="fu">pivot</span><span class="op">(</span><span class="va">GGDC10S</span>, <span class="fu"><a href="small-helpers.html">.c</a></span><span class="op">(</span><span class="va">Country</span>, <span class="va">Regioncode</span>, <span class="va">Region</span>, <span class="va">Year</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>      names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Variable"</span>, <span class="st">"Sectorcode"</span><span class="op">)</span>, how <span class="op">=</span> <span class="st">"r"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Country Regioncode             Region Year Sectorcode       VA      EMP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     BWA        SSA Sub-saharan Africa 1960        AGR       NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     BWA        SSA Sub-saharan Africa 1961        AGR       NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     BWA        SSA Sub-saharan Africa 1962        AGR       NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4     BWA        SSA Sub-saharan Africa 1963        AGR       NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5     BWA        SSA Sub-saharan Africa 1964        AGR 16.30154 152.1179</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6     BWA        SSA Sub-saharan Africa 1965        AGR 15.72700 153.2971</span>
<span class="r-in"><span><span class="co"># Same thing (a bit easier)</span></span></span>
<span class="r-in"><span><span class="fu">pivot</span><span class="op">(</span><span class="va">GGDC10S</span>, values <span class="op">=</span> <span class="fl">6</span><span class="op">:</span><span class="fl">16</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Variable"</span>, <span class="st">"Sectorcode"</span><span class="op">)</span>, how <span class="op">=</span> <span class="st">"r"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Country Regioncode             Region Year Sectorcode       VA      EMP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     BWA        SSA Sub-saharan Africa 1960        AGR       NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     BWA        SSA Sub-saharan Africa 1961        AGR       NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     BWA        SSA Sub-saharan Africa 1962        AGR       NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4     BWA        SSA Sub-saharan Africa 1963        AGR       NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5     BWA        SSA Sub-saharan Africa 1964        AGR 16.30154 152.1179</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6     BWA        SSA Sub-saharan Africa 1965        AGR 15.72700 153.2971</span>
<span class="r-in"><span><span class="co"># Removing missing values</span></span></span>
<span class="r-in"><span><span class="fu">pivot</span><span class="op">(</span><span class="va">GGDC10S</span>, values <span class="op">=</span> <span class="fl">6</span><span class="op">:</span><span class="fl">16</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Variable"</span>, <span class="st">"Sectorcode"</span><span class="op">)</span>, how <span class="op">=</span> <span class="st">"r"</span>,</span></span>
<span class="r-in"><span>      na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Country Regioncode             Region Year Sectorcode       VA      EMP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     BWA        SSA Sub-saharan Africa 1960        AGR       NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     BWA        SSA Sub-saharan Africa 1961        AGR       NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     BWA        SSA Sub-saharan Africa 1962        AGR       NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4     BWA        SSA Sub-saharan Africa 1963        AGR       NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5     BWA        SSA Sub-saharan Africa 1964        AGR 16.30154 152.1179</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6     BWA        SSA Sub-saharan Africa 1965        AGR 15.72700 153.2971</span>
<span class="r-in"><span><span class="co"># Saving Labels</span></span></span>
<span class="r-in"><span><span class="fu">pivot</span><span class="op">(</span><span class="va">GGDC10S</span>, values <span class="op">=</span> <span class="fl">6</span><span class="op">:</span><span class="fl">16</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Variable"</span>, <span class="st">"Sectorcode"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>      labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>to <span class="op">=</span> <span class="st">"Sector"</span><span class="op">)</span>, how <span class="op">=</span> <span class="st">"r"</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Country Regioncode             Region Year Sectorcode       Sector       VA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     BWA        SSA Sub-saharan Africa 1960        AGR Agriculture        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     BWA        SSA Sub-saharan Africa 1961        AGR Agriculture        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     BWA        SSA Sub-saharan Africa 1962        AGR Agriculture        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4     BWA        SSA Sub-saharan Africa 1963        AGR Agriculture        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5     BWA        SSA Sub-saharan Africa 1964        AGR Agriculture  16.30154</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6     BWA        SSA Sub-saharan Africa 1965        AGR Agriculture  15.72700</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        EMP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 152.1179</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 153.2971</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Supplying new labels for generated columns: as complete as it gets</span></span></span>
<span class="r-in"><span><span class="fu">pivot</span><span class="op">(</span><span class="va">GGDC10S</span>, values <span class="op">=</span> <span class="fl">6</span><span class="op">:</span><span class="fl">16</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Variable"</span>, <span class="st">"Sectorcode"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>      labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>to <span class="op">=</span> <span class="st">"Sector"</span>,</span></span>
<span class="r-in"><span>                    new <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Sectorcode <span class="op">=</span> <span class="st">"GGDC10S Sector Code"</span>,</span></span>
<span class="r-in"><span>                            Sector <span class="op">=</span> <span class="st">"Long Sector Description"</span>,</span></span>
<span class="r-in"><span>                            VA <span class="op">=</span> <span class="st">"Value Added"</span>,</span></span>
<span class="r-in"><span>                            EMP <span class="op">=</span> <span class="st">"Employment"</span><span class="op">)</span><span class="op">)</span>, how <span class="op">=</span> <span class="st">"r"</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="small-helpers.html">namlab</a></span><span class="op">(</span>N <span class="op">=</span> <span class="cn">TRUE</span>, Nd <span class="op">=</span> <span class="cn">TRUE</span>, class <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Variable     Class     N Ndist                   Label</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    Country character 27852    43                 Country</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Regioncode character 27852     6             Region code</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     Region character 27852     6                  Region</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4       Year   numeric 27852    67                    Year</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Sectorcode    factor 27852    11     GGDC10S Sector Code</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6     Sector    factor 27852    11 Long Sector Description</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7         VA   numeric 23092 22915             Value Added</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8        EMP   numeric 23850 23610              Employment</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now another (slightly unconventional) use case here is data transposition</span></span></span>
<span class="r-in"><span><span class="co"># Let's get the data for Botswana</span></span></span>
<span class="r-in"><span><span class="va">BWA</span> <span class="op">&lt;-</span> <span class="va">GGDC10S</span> <span class="op">|&gt;</span> <span class="fu"><a href="fsubset.html">fsubset</a></span><span class="op">(</span><span class="va">Country</span> <span class="op">==</span> <span class="st">"BWA"</span>, <span class="va">Variable</span>, <span class="va">Year</span>, <span class="va">AGR</span><span class="op">:</span><span class="va">SUM</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">BWA</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Variable Year      AGR      MIN       MAN        PU       CON      WRT</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1       VA 1960       NA       NA        NA        NA        NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2       VA 1961       NA       NA        NA        NA        NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3       VA 1962       NA       NA        NA        NA        NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4       VA 1963       NA       NA        NA        NA        NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5       VA 1964 16.30154 3.494075 0.7365696 0.1043936 0.6600454 6.243732</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        TRA     FIRE      GOV      OTH      SUM</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1       NA       NA       NA       NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2       NA       NA       NA       NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3       NA       NA       NA       NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4       NA       NA       NA       NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 1.658928 1.119194 4.822485 2.341328 37.48229</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 1 rows ]</span>
<span class="r-in"><span><span class="co"># By supplying no ids or values, we are simply requesting a transpose operation</span></span></span>
<span class="r-in"><span><span class="fu">pivot</span><span class="op">(</span><span class="va">BWA</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Variable"</span>, <span class="st">"Year"</span><span class="op">)</span>, to <span class="op">=</span> <span class="st">"Sectorcode"</span><span class="op">)</span>, how <span class="op">=</span> <span class="st">"r"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Sectorcode VA_1960 VA_1961 VA_1962 VA_1963 VA_1964 VA_1965 VA_1966 VA_1967</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      VA_1968 VA_1969 VA_1970 VA_1971 VA_1972 VA_1973 VA_1974 VA_1975 VA_1976</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      VA_1977 VA_1978 VA_1979 VA_1980 VA_1981 VA_1982 VA_1983 VA_1984 VA_1985</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      VA_1986 VA_1987 VA_1988 VA_1989 VA_1990 VA_1991 VA_1992 VA_1993 VA_1994</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      VA_1995 VA_1996 VA_1997 VA_1998 VA_1999 VA_2000 VA_2001 VA_2002 VA_2003</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      VA_2004 VA_2005 VA_2006 VA_2007 VA_2008 VA_2009 VA_2010 VA_2011 EMP_1960</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      EMP_1961 EMP_1962 EMP_1963 EMP_1964 EMP_1965 EMP_1966 EMP_1967 EMP_1968</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      EMP_1969 EMP_1970 EMP_1971 EMP_1972 EMP_1973 EMP_1974 EMP_1975 EMP_1976</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 35 columns ]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 11 rows ]</span>
<span class="r-in"><span><span class="co"># Same with labels</span></span></span>
<span class="r-in"><span><span class="fu">pivot</span><span class="op">(</span><span class="va">BWA</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Variable"</span>, <span class="st">"Year"</span><span class="op">)</span>, to <span class="op">=</span> <span class="st">"Sectorcode"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>      labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>to <span class="op">=</span> <span class="st">"Sector"</span><span class="op">)</span>, how <span class="op">=</span> <span class="st">"r"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Sectorcode Sector VA_1960 VA_1961 VA_1962 VA_1963 VA_1964 VA_1965 VA_1966</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      VA_1967 VA_1968 VA_1969 VA_1970 VA_1971 VA_1972 VA_1973 VA_1974 VA_1975</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      VA_1976 VA_1977 VA_1978 VA_1979 VA_1980 VA_1981 VA_1982 VA_1983 VA_1984</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      VA_1985 VA_1986 VA_1987 VA_1988 VA_1989 VA_1990 VA_1991 VA_1992 VA_1993</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      VA_1994 VA_1995 VA_1996 VA_1997 VA_1998 VA_1999 VA_2000 VA_2001 VA_2002</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      VA_2003 VA_2004 VA_2005 VA_2006 VA_2007 VA_2008 VA_2009 VA_2010 VA_2011</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      EMP_1960 EMP_1961 EMP_1962 EMP_1963 EMP_1964 EMP_1965 EMP_1966 EMP_1967</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      EMP_1968 EMP_1969 EMP_1970 EMP_1971 EMP_1972 EMP_1973 EMP_1974 EMP_1975</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 36 columns ]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 11 rows ]</span>
<span class="r-in"><span><span class="co"># For simple cases, data.table::transpose() will be more efficient, but with multiple</span></span></span>
<span class="r-in"><span><span class="co"># columns to generate names and/or variable labels to be saved/assigned, pivot() is handy</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">BWA</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sebastian Krantz.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer></div>





  </body></html>

