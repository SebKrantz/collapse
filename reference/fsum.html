<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fast (Grouped, Weighted) Sum for Matrix-Like Objects — fsum • collapse</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Fast (Grouped, Weighted) Sum for Matrix-Like Objects — fsum"><meta name="description" content="fsum is a generic function that computes the (column-wise) sum of all values in x, (optionally) grouped by g and/or weighted by w (e.g. to calculate survey totals). The TRA argument can further be used to transform x using its (grouped, weighted) sum."><meta property="og:description" content="fsum is a generic function that computes the (column-wise) sum of all values in x, (optionally) grouped by g and/or weighted by w (e.g. to calculate survey totals). The TRA argument can further be used to transform x using its (grouped, weighted) sum."><meta property="og:image" content="https://sebkrantz.github.io/collapse/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">collapse</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.0.17</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Documentation</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://sebkrantz.github.io/Rblog/">Blog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://twitter.com/collapse_R" aria-label="Twitter"><span class="fa fa-twitter"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/SebKrantz/collapse" aria-label="GitHub"><span class="fa fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Fast (Grouped, Weighted) Sum for Matrix-Like Objects</h1>

      <div class="d-none name"><code>fsum.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>fsum</code> is a generic function that computes the (column-wise) sum of all values in <code>x</code>, (optionally) grouped by <code>g</code> and/or weighted by <code>w</code> (e.g. to calculate survey totals). The <code><a href="TRA.html">TRA</a></code> argument can further be used to transform <code>x</code> using its (grouped, weighted) sum.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fsum</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Default S3 method</span></span>
<span><span class="fu">fsum</span><span class="op">(</span><span class="va">x</span>, g <span class="op">=</span> <span class="cn">NULL</span>, w <span class="op">=</span> <span class="cn">NULL</span>, TRA <span class="op">=</span> <span class="cn">NULL</span>, na.rm <span class="op">=</span> <span class="va">.op</span><span class="op">[[</span><span class="st">"na.rm"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>     use.g.names <span class="op">=</span> <span class="cn">TRUE</span>, fill <span class="op">=</span> <span class="cn">FALSE</span>, nthreads <span class="op">=</span> <span class="va">.op</span><span class="op">[[</span><span class="st">"nthreads"</span><span class="op">]</span><span class="op">]</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'matrix'</span></span>
<span><span class="fu">fsum</span><span class="op">(</span><span class="va">x</span>, g <span class="op">=</span> <span class="cn">NULL</span>, w <span class="op">=</span> <span class="cn">NULL</span>, TRA <span class="op">=</span> <span class="cn">NULL</span>, na.rm <span class="op">=</span> <span class="va">.op</span><span class="op">[[</span><span class="st">"na.rm"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>     use.g.names <span class="op">=</span> <span class="cn">TRUE</span>, drop <span class="op">=</span> <span class="cn">TRUE</span>, fill <span class="op">=</span> <span class="cn">FALSE</span>, nthreads <span class="op">=</span> <span class="va">.op</span><span class="op">[[</span><span class="st">"nthreads"</span><span class="op">]</span><span class="op">]</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'data.frame'</span></span>
<span><span class="fu">fsum</span><span class="op">(</span><span class="va">x</span>, g <span class="op">=</span> <span class="cn">NULL</span>, w <span class="op">=</span> <span class="cn">NULL</span>, TRA <span class="op">=</span> <span class="cn">NULL</span>, na.rm <span class="op">=</span> <span class="va">.op</span><span class="op">[[</span><span class="st">"na.rm"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>     use.g.names <span class="op">=</span> <span class="cn">TRUE</span>, drop <span class="op">=</span> <span class="cn">TRUE</span>, fill <span class="op">=</span> <span class="cn">FALSE</span>, nthreads <span class="op">=</span> <span class="va">.op</span><span class="op">[[</span><span class="st">"nthreads"</span><span class="op">]</span><span class="op">]</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'grouped_df'</span></span>
<span><span class="fu">fsum</span><span class="op">(</span><span class="va">x</span>, w <span class="op">=</span> <span class="cn">NULL</span>, TRA <span class="op">=</span> <span class="cn">NULL</span>, na.rm <span class="op">=</span> <span class="va">.op</span><span class="op">[[</span><span class="st">"na.rm"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>     use.g.names <span class="op">=</span> <span class="cn">FALSE</span>, keep.group_vars <span class="op">=</span> <span class="cn">TRUE</span>, keep.w <span class="op">=</span> <span class="cn">TRUE</span>, stub <span class="op">=</span> <span class="va">.op</span><span class="op">[[</span><span class="st">"stub"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>     fill <span class="op">=</span> <span class="cn">FALSE</span>, nthreads <span class="op">=</span> <span class="va">.op</span><span class="op">[[</span><span class="st">"nthreads"</span><span class="op">]</span><span class="op">]</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>a numeric vector, matrix, data frame or grouped data frame (class 'grouped_df').</p></dd>


<dt id="arg-g">g<a class="anchor" aria-label="anchor" href="#arg-g"></a></dt>
<dd><p>a factor, <code>GRP</code> object, atomic vector (internally converted to factor) or a list of vectors / factors (internally converted to a <code>GRP</code> object) used to group <code>x</code>.</p></dd>


<dt id="arg-w">w<a class="anchor" aria-label="anchor" href="#arg-w"></a></dt>
<dd><p>a numeric vector of (non-negative) weights, may contain missing values.</p></dd>


<dt id="arg-tra">TRA<a class="anchor" aria-label="anchor" href="#arg-tra"></a></dt>
<dd><p>an integer or quoted operator indicating the transformation to perform:
0 - "na"     |     1 - "fill"     |     2 - "replace"     |     3 - "-"     |     4 - "-+"     |     5 - "/"     |     6 - "%"     |     7 - "+"     |     8 - "*"     |     9 - "%%"     |     10 - "-%%". See <code><a href="TRA.html">TRA</a></code>.</p></dd>


<dt id="arg-na-rm">na.rm<a class="anchor" aria-label="anchor" href="#arg-na-rm"></a></dt>
<dd><p>logical. Skip missing values in <code>x</code>. Defaults to <code>TRUE</code> and implemented at very little computational cost. If <code>na.rm = FALSE</code> a <code>NA</code> is returned when encountered.</p></dd>


<dt id="arg-use-g-names">use.g.names<a class="anchor" aria-label="anchor" href="#arg-use-g-names"></a></dt>
<dd><p>logical. Make group-names and add to the result as names (default method) or row-names (matrix and data frame methods). No row-names are generated for <em>data.table</em>'s.</p></dd>


<dt id="arg-fill">fill<a class="anchor" aria-label="anchor" href="#arg-fill"></a></dt>
<dd><p>logical. Initialize result with <code>0</code> instead of <code>NA</code> when <code>na.rm = TRUE</code> e.g. <code>fsum(NA, fill = TRUE)</code> returns <code>0</code> instead of <code>NA</code>.</p></dd>


<dt id="arg-nthreads">nthreads<a class="anchor" aria-label="anchor" href="#arg-nthreads"></a></dt>
<dd><p>integer. The number of threads to utilize. See Details.</p></dd>


<dt id="arg-drop">drop<a class="anchor" aria-label="anchor" href="#arg-drop"></a></dt>
<dd><p><em>matrix and data.frame method:</em> Logical. <code>TRUE</code> drops dimensions and returns an atomic vector if <code>g = NULL</code> and <code>TRA = NULL</code>.</p></dd>


<dt id="arg-keep-group-vars">keep.group_vars<a class="anchor" aria-label="anchor" href="#arg-keep-group-vars"></a></dt>
<dd><p><em>grouped_df method:</em> Logical. <code>FALSE</code> removes grouping variables after computation.</p></dd>


<dt id="arg-keep-w">keep.w<a class="anchor" aria-label="anchor" href="#arg-keep-w"></a></dt>
<dd><p><em>grouped_df method:</em> Logical. Retain summed weighting variable after computation (if contained in <code>grouped_df</code>).</p></dd>


<dt id="arg-stub">stub<a class="anchor" aria-label="anchor" href="#arg-stub"></a></dt>
<dd><p>character. If <code>keep.w = TRUE</code> and <code>stub = TRUE</code> (default), the summed weights column is prefixed by <code>"sum."</code>. Users can specify a different prefix through this argument, or set it to <code>FALSE</code> to avoid prefixing.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>arguments to be passed to or from other methods. If <code>TRA</code> is used, passing <code>set = TRUE</code> will transform data by reference and return the result invisibly.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>



<p>The weighted sum (e.g. survey total) is computed as <code>sum(x * w)</code>, but in one pass and about twice as efficient. If <code>na.rm = TRUE</code>, missing values will be removed from both <code>x</code> and <code>w</code> i.e. utilizing only <code>x[complete.cases(x,w)]</code> and <code>w[complete.cases(x,w)]</code>.</p>
<p>This all seamlessly generalizes to grouped computations, which are performed in a single pass (without splitting the data) and are therefore extremely fast. See Benchmark and Examples below.</p>
<p>When applied to data frames with groups or <code>drop = FALSE</code>, <code>fsum</code> preserves all column attributes. The attributes of the data frame itself are also preserved.</p>
<p>Since v1.6.0 <code>fsum</code> explicitly supports integers. Integers are summed using the long long type in C which is bounded at +-9,223,372,036,854,775,807 (so ~4.3 billion times greater than the minimum/maximum R integer bounded at +-2,147,483,647). If the value of the sum is outside +-2,147,483,647, a double containing the result is returned, otherwise an integer is returned. With groups, an integer results vector is initialized, and an integer overflow error is provided if the sum in any group is outside +-2,147,483,647. Data needs to be coerced to double beforehand in such cases.</p>
<p>Multithreading, added in v1.8.0, applies at the column-level unless <code>g = NULL</code> and <code>nthreads &gt; NCOL(x)</code>. Parallelism over groups is not available because sums are computed simultaneously within each group. <code>nthreads = 1L</code> uses a serial version of the code, not parallel code running on one thread. This serial code is always used with less than 100,000 obs (<code>length(x) &lt; 100000</code> for vectors and matrices), because parallel execution itself has some overhead.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The (<code>w</code> weighted) sum of <code>x</code>, grouped by <code>g</code>, or (if <code><a href="TRA.html">TRA</a></code> is used) <code>x</code> transformed by its (grouped, weighted) sum.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See Also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <p><code><a href="fprod.html">fprod</a></code>, <code><a href="fmean.html">fmean</a></code>, <a href="fast-statistical-functions.html">Fast Statistical Functions</a>, <a href="collapse-documentation.html">Collapse Overview</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## default vector method</span></span></span>
<span class="r-in"><span><span class="va">mpg</span> <span class="op">&lt;-</span> <span class="va">mtcars</span><span class="op">$</span><span class="va">mpg</span></span></span>
<span class="r-in"><span><span class="fu">fsum</span><span class="op">(</span><span class="va">mpg</span><span class="op">)</span>                         <span class="co"># Simple sum</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 642.9</span>
<span class="r-in"><span><span class="fu">fsum</span><span class="op">(</span><span class="va">mpg</span>, w <span class="op">=</span> <span class="va">mtcars</span><span class="op">$</span><span class="va">hp</span><span class="op">)</span>          <span class="co"># Weighted sum (total): Weighted by hp</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 84362.7</span>
<span class="r-in"><span><span class="fu">fsum</span><span class="op">(</span><span class="va">mpg</span>, TRA <span class="op">=</span> <span class="st">"%"</span><span class="op">)</span>              <span class="co"># Simple transformation: obtain percentages of mpg</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 3.266449 3.266449 3.546430 3.328667 2.908695 2.815368 2.224296 3.795303</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [9] 3.546430 2.986468 2.768704 2.550941 2.690932 2.364287 1.617670 1.617670</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [17] 2.286514 5.039664 4.728574 5.272982 3.344221 2.410950 2.364287 2.068751</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [25] 2.986468 4.246384 4.044175 4.728574 2.457614 3.064240 2.333178 3.328667</span>
<span class="r-in"><span><span class="fu">fsum</span><span class="op">(</span><span class="va">mpg</span>, <span class="va">mtcars</span><span class="op">$</span><span class="va">cyl</span><span class="op">)</span>             <span class="co"># Grouped sum</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     4     6     8 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 293.3 138.2 211.4 </span>
<span class="r-in"><span><span class="fu">fsum</span><span class="op">(</span><span class="va">mpg</span>, <span class="va">mtcars</span><span class="op">$</span><span class="va">cyl</span>, <span class="va">mtcars</span><span class="op">$</span><span class="va">hp</span><span class="op">)</span>  <span class="co"># Weighted grouped sum (total)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       4       6       8 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23743.0 16873.0 43746.7 </span>
<span class="r-in"><span><span class="fu">fsum</span><span class="op">(</span><span class="va">mpg</span>, <span class="va">mtcars</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">8</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>       <span class="co"># More groups..</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4.0.1 4.1.0 4.1.1 6.0.1 6.1.0 8.0.0 8.0.1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  26.0  68.7 198.6  61.7  76.5 180.6  30.8 </span>
<span class="r-in"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="GRP.html">GRP</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="op">~</span> <span class="va">cyl</span> <span class="op">+</span> <span class="va">vs</span> <span class="op">+</span> <span class="va">am</span><span class="op">)</span> <span class="co"># Precomputing groups gives more speed !</span></span></span>
<span class="r-in"><span><span class="fu">fsum</span><span class="op">(</span><span class="va">mpg</span>, <span class="va">g</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4.0.1 4.1.0 4.1.1 6.0.1 6.1.0 8.0.0 8.0.1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  26.0  68.7 198.6  61.7  76.5 180.6  30.8 </span>
<span class="r-in"><span><span class="fu"><a href="fmean.html">fmean</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="va">g</span><span class="op">)</span> <span class="op">==</span> <span class="fu">fsum</span><span class="op">(</span><span class="va">mpg</span>, <span class="va">g</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="fnobs.html">fnobs</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="va">g</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4.0.1 4.1.0 4.1.1 6.0.1 6.1.0 8.0.0 8.0.1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE </span>
<span class="r-in"><span><span class="fu">fsum</span><span class="op">(</span><span class="va">mpg</span>, <span class="va">g</span>, TRA <span class="op">=</span> <span class="st">"%"</span><span class="op">)</span>           <span class="co"># Percentages by group</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]  34.035656  34.035656  11.480363  27.973856  10.354374  23.660131</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7]   7.918051  35.516739  33.187773  25.098039  23.267974   9.080842</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [13]   9.579181   8.416390   5.758583   5.758583   8.139535  16.314199</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [19]  15.307150  17.069486  31.295488   8.582503   8.416390   7.364341</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [25]  10.631229  13.746224 100.000000  15.307150  51.298701  31.928687</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [31]  48.701299  10.775428</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## data.frame method</span></span></span>
<span class="r-in"><span><span class="fu">fsum</span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      mpg      cyl     disp       hp     drat       wt     qsec       vs </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  642.900  198.000 7383.100 4694.000  115.090  102.952  571.160   14.000 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       am     gear     carb </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   13.000  118.000   90.000 </span>
<span class="r-in"><span><span class="fu">fsum</span><span class="op">(</span><span class="va">mtcars</span>, TRA <span class="op">=</span> <span class="st">"%"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                        mpg      cyl     disp       hp     drat       wt</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4         3.266449 3.030303 2.167111 2.343417 3.388652 2.544875</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4 Wag     3.266449 3.030303 2.167111 2.343417 3.388652 2.792564</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Datsun 710        3.546430 2.020202 1.462800 1.981253 3.345208 2.253477</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet 4 Drive    3.328667 3.030303 3.494467 2.343417 2.676166 3.122815</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet Sportabout 2.908695 4.040404 4.876001 3.728164 2.736988 3.341363</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Valiant           2.815368 3.030303 3.047500 2.236898 2.398123 3.360789</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       qsec       vs       am     gear     carb</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4         2.881854 0.000000 7.692308 3.389831 4.444444</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4 Wag     2.979901 0.000000 7.692308 3.389831 4.444444</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Datsun 710        3.258281 7.142857 7.692308 3.389831 1.111111</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet 4 Drive    3.403600 7.142857 0.000000 2.542373 1.111111</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet Sportabout 2.979901 0.000000 0.000000 2.542373 2.222222</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Valiant           3.540164 7.142857 0.000000 2.542373 1.111111</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 26 rows ]</span>
<span class="r-in"><span><span class="fu">fsum</span><span class="op">(</span><span class="va">mtcars</span>, <span class="va">g</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         mpg cyl   disp   hp  drat     wt   qsec vs am gear carb</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4.0.1  26.0   4  120.3   91  4.43  2.140  16.70  0  1    5    2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4.1.0  68.7  12  407.6  254 11.31  8.805  62.91  3  0   11    5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4.1.1 198.6  28  628.6  564 29.04 14.198 130.90  7  7   29   10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6.0.1  61.7  18  465.0  395 11.42  8.265  48.98  0  3   13   14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6.1.0  76.5  24  818.2  461 13.68 13.555  76.86  4  0   14   10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8.0.0 180.6  96 4291.4 2330 37.45 49.249 205.71  0  0   36   37</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 1 rows ]</span>
<span class="r-in"><span><span class="fu">fsum</span><span class="op">(</span><span class="va">mtcars</span>, <span class="va">g</span>, TRA <span class="op">=</span> <span class="st">"%"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                        mpg       cyl      disp       hp      drat        wt</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4         34.03566 33.333333 34.408602 27.84810 34.150613 31.699940</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4 Wag     34.03566 33.333333 34.408602 27.84810 34.150613 34.785239</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Datsun 710        11.48036 14.285714 17.181037 16.48936 13.257576 16.340330</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet 4 Drive    27.97386 25.000000 31.532633 23.86117 22.514620 23.718185</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet Sportabout 10.35437  8.333333  8.388871  7.51073  8.411215  6.984913</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Valiant           23.66013 25.000000 27.499389 22.77657 20.175439 25.525636</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                        qsec       vs       am      gear      carb</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4         33.605553      NaN 33.33333 30.769231 28.571429</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4 Wag     34.748877      NaN 33.33333 30.769231 28.571429</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Datsun 710        14.216960 14.28571 14.28571 13.793103 10.000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet 4 Drive    25.292740 25.00000      NaN 21.428571 10.000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet Sportabout  8.273783      NaN      NaN  8.333333  5.405405</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Valiant           26.307572 25.00000      NaN 21.428571 10.000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 26 rows ]</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## matrix method</span></span></span>
<span class="r-in"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="quick-conversion.html">qM</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">fsum</span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      mpg      cyl     disp       hp     drat       wt     qsec       vs </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  642.900  198.000 7383.100 4694.000  115.090  102.952  571.160   14.000 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       am     gear     carb </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   13.000  118.000   90.000 </span>
<span class="r-in"><span><span class="fu">fsum</span><span class="op">(</span><span class="va">m</span>, TRA <span class="op">=</span> <span class="st">"%"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                          mpg      cyl      disp       hp     drat       wt</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4           3.266449 3.030303 2.1671114 2.343417 3.388652 2.544875</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4 Wag       3.266449 3.030303 2.1671114 2.343417 3.388652 2.792564</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Datsun 710          3.546430 2.020202 1.4628002 1.981253 3.345208 2.253477</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet 4 Drive      3.328667 3.030303 3.4944671 2.343417 2.676166 3.122815</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet Sportabout   2.908695 4.040404 4.8760006 3.728164 2.736988 3.341363</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Valiant             2.815368 3.030303 3.0475004 2.236898 2.398123 3.360789</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                         qsec       vs       am     gear     carb</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4           2.881854 0.000000 7.692308 3.389831 4.444444</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4 Wag       2.979901 0.000000 7.692308 3.389831 4.444444</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Datsun 710          3.258281 7.142857 7.692308 3.389831 1.111111</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet 4 Drive      3.403600 7.142857 0.000000 2.542373 1.111111</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet Sportabout   2.979901 0.000000 0.000000 2.542373 2.222222</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Valiant             3.540164 7.142857 0.000000 2.542373 1.111111</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached getOption("max.print") -- omitted 26 rows ]</span>
<span class="r-in"><span><span class="fu">fsum</span><span class="op">(</span><span class="va">m</span>, <span class="va">g</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         mpg cyl   disp   hp  drat     wt   qsec vs am gear carb</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4.0.1  26.0   4  120.3   91  4.43  2.140  16.70  0  1    5    2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4.1.0  68.7  12  407.6  254 11.31  8.805  62.91  3  0   11    5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4.1.1 198.6  28  628.6  564 29.04 14.198 130.90  7  7   29   10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6.0.1  61.7  18  465.0  395 11.42  8.265  48.98  0  3   13   14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6.1.0  76.5  24  818.2  461 13.68 13.555  76.86  4  0   14   10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8.0.0 180.6  96 4291.4 2330 37.45 49.249 205.71  0  0   36   37</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached getOption("max.print") -- omitted 1 row ]</span>
<span class="r-in"><span><span class="fu">fsum</span><span class="op">(</span><span class="va">m</span>, <span class="va">g</span>, TRA <span class="op">=</span> <span class="st">"%"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                            mpg        cyl       disp         hp       drat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4            34.035656  33.333333  34.408602  27.848101  34.150613</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4 Wag        34.035656  33.333333  34.408602  27.848101  34.150613</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Datsun 710           11.480363  14.285714  17.181037  16.489362  13.257576</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet 4 Drive       27.973856  25.000000  31.532633  23.861171  22.514620</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet Sportabout    10.354374   8.333333   8.388871   7.510730   8.411215</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Valiant              23.660131  25.000000  27.499389  22.776573  20.175439</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                             wt       qsec       vs        am       gear</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4            31.699940  33.605553      NaN  33.33333  30.769231</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4 Wag        34.785239  34.748877      NaN  33.33333  30.769231</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Datsun 710           16.340330  14.216960 14.28571  14.28571  13.793103</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet 4 Drive       23.718185  25.292740 25.00000       NaN  21.428571</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet Sportabout     6.984913   8.273783      NaN       NaN   8.333333</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Valiant              25.525636  26.307572 25.00000       NaN  21.428571</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                           carb</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4            28.571429</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4 Wag        28.571429</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Datsun 710           10.000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet 4 Drive       10.000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet Sportabout     5.405405</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Valiant              10.000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached getOption("max.print") -- omitted 26 rows ]</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## method for grouped data frames - created with dplyr::group_by or fgroup_by</span></span></span>
<span class="r-in"><span><span class="va">mtcars</span> <span class="op">|&gt;</span> <span class="fu"><a href="GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">cyl</span>,<span class="va">vs</span>,<span class="va">am</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">fsum</span><span class="op">(</span><span class="va">hp</span><span class="op">)</span>  <span class="co"># Weighted grouped sum (total)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   cyl vs am sum.hp     mpg     disp    drat       wt     qsec gear carb</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   4  0  1     91  2366.0  10947.3  403.13  194.740  1519.70  455  182</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   4  1  0    254  5764.3  34121.1  960.08  736.135  5356.47  919  411</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   4  1  1    564 15612.7  52945.4 2301.27 1165.914 10456.79 2369  838</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   6  0  1    395  8067.5  60575.0 1491.50 1089.200  6395.30 1755 1930</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   6  1  0    461  8805.5  93234.6 1592.92 1563.190  8837.10 1629 1199</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6   8  0  0   2330 34550.5 846042.0 7323.40 9689.735 39807.80 6990 7480</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 1 rows ]</span>
<span class="r-in"><span><span class="va">mtcars</span> <span class="op">|&gt;</span> <span class="fu"><a href="GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">cyl</span>,<span class="va">vs</span>,<span class="va">am</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">fsum</span><span class="op">(</span>TRA <span class="op">=</span> <span class="st">"%"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   cyl vs am      mpg      disp       hp      drat        wt</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4           6  0  1 34.03566 34.408602 27.84810 34.150613 31.699940</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4 Wag       6  0  1 34.03566 34.408602 27.84810 34.150613 34.785239</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Datsun 710          4  1  1 11.48036 17.181037 16.48936 13.257576 16.340330</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet 4 Drive      6  1  0 27.97386 31.532633 23.86117 22.514620 23.718185</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet Sportabout   8  0  0 10.35437  8.388871  7.51073  8.411215  6.984913</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Valiant             6  1  0 23.66013 27.499389 22.77657 20.175439 25.525636</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                        qsec      gear      carb</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4         33.605553 30.769231 28.571429</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mazda RX4 Wag     34.748877 30.769231 28.571429</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Datsun 710        14.216960 13.793103 10.000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet 4 Drive    25.292740 21.428571 10.000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hornet Sportabout  8.273783  8.333333  5.405405</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Valiant           26.307572 21.428571 10.000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 26 rows ]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Grouped by:  cyl, vs, am  [7 | 5 (3.8) 1-12] </span>
<span class="r-in"><span><span class="va">mtcars</span> <span class="op">|&gt;</span> <span class="fu"><a href="GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">cyl</span>,<span class="va">vs</span>,<span class="va">am</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="select_replace_vars.html">fselect</a></span><span class="op">(</span><span class="va">mpg</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">fsum</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   cyl vs am   mpg</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   4  0  1  26.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   4  1  0  68.7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   4  1  1 198.6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   6  0  1  61.7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   6  1  0  76.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6   8  0  0 180.6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7   8  0  1  30.8</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> </span></span>
<span class="r-in"><span><span class="co">## This compares fsum with data.table and base::rowsum</span></span></span>
<span class="r-in"><span><span class="co"># Starting with small data</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘data.table’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:dplyr’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     between, first, last</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following object is masked from ‘package:collapse’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     fdroplevels</span>
<span class="r-in"><span><span class="va">opts</span> <span class="op">&lt;-</span> <span class="fu"><a href="collapse-options.html">set_collapse</a></span><span class="op">(</span>nthreads <span class="op">=</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/openmp-utils.html" class="external-link">getDTthreads</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mtcDT</span> <span class="op">&lt;-</span> <span class="fu"><a href="quick-conversion.html">qDT</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="qF.html">qF</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">cyl</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/joshuaulrich/microbenchmark/" class="external-link">microbenchmark</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="va">mtcDT</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">sum</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">f</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>               <span class="fu"><a href="https://rdrr.io/r/base/rowsum.html" class="external-link">rowsum</a></span><span class="op">(</span><span class="va">mtcDT</span>, <span class="va">f</span>, reorder <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>               <span class="fu">fsum</span><span class="op">(</span><span class="va">mtcDT</span>, <span class="va">f</span>, na.rm <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, unit <span class="op">=</span> <span class="st">"relative"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unit: relative</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                               expr       min        lq      mean    median</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  mtcDT[, lapply(.SD, sum), by = f] 77.414141 70.292793 65.994832 65.065844</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  rowsum(mtcDT, f, reorder = FALSE)  3.848485  3.711712  3.646652  3.617284</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      fsum(mtcDT, f, na.rm = FALSE)  1.000000  1.000000  1.000000  1.000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         uq        max neval</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  58.538182 195.029340   100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   3.516364   6.713936   100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1.000000   1.000000   100</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now larger data</span></span></span>
<span class="r-in"><span><span class="va">tdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="quick-conversion.html">qDT</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1e5</span><span class="op">)</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="co"># 100 columns with 100.000 obs</span></span></span>
<span class="r-in"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="qF.html">qF</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="fl">1e4</span>, <span class="fl">1e5</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>                        <span class="co"># A factor with 10.000 groups</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="va">tdata</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">sum</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">f</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>               <span class="fu"><a href="https://rdrr.io/r/base/rowsum.html" class="external-link">rowsum</a></span><span class="op">(</span><span class="va">tdata</span>, <span class="va">f</span>, reorder <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>               <span class="fu">fsum</span><span class="op">(</span><span class="va">tdata</span>, <span class="va">f</span>, na.rm <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, unit <span class="op">=</span> <span class="st">"relative"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unit: relative</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                               expr      min       lq     mean   median       uq</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  tdata[, lapply(.SD, sum), by = f] 3.253451 3.169481 2.465019 3.178842 2.816867</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  rowsum(tdata, f, reorder = FALSE) 2.662385 2.622163 2.165780 2.614740 2.318166</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      fsum(tdata, f, na.rm = FALSE) 1.000000 1.000000 1.000000 1.000000 1.000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        max neval</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0.3435441   100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1.1798617   100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1.0000000   100</span>
<span class="r-in"><span><span class="co"># Reset options</span></span></span>
<span class="r-in"><span><span class="fu"><a href="collapse-options.html">set_collapse</a></span><span class="op">(</span><span class="va">opts</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sebastian Krantz.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.9000.</p>
</div>

    </footer></div>





  </body></html>

