<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Fast matching of elements/rows in x to elements/rows in table.
This is a much faster replacement for match that works
  with atomic vectors and data frames / lists of equal-length vectors. It is the workhorse function of join."><title>Fast Matching — fmatch • collapse</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Fast Matching — fmatch"><meta property="og:description" content="Fast matching of elements/rows in x to elements/rows in table.
This is a much faster replacement for match that works
  with atomic vectors and data frames / lists of equal-length vectors. It is the workhorse function of join."><meta property="og:image" content="https://sebkrantz.github.io/collapse/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">collapse</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.0.10</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Documentation</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/index.html">Vignettes</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://sebkrantz.github.io/Rblog/">Blog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://twitter.com/collapse_R" aria-label="Twitter">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/SebKrantz/collapse" aria-label="GitHub">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Fast Matching</h1>
      
      <div class="d-none name"><code>fmatch.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Fast matching of elements/rows in <code>x</code> to elements/rows in <code>table</code>.</p>
<p>This is a much faster replacement for <code><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></code> that works
  with atomic vectors and data frames / lists of equal-length vectors. It is the workhorse function of <code><a href="join.html">join</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fmatch</span><span class="op">(</span><span class="va">x</span>, <span class="va">table</span>, nomatch <span class="op">=</span> <span class="cn">NA_integer_</span>,</span>
<span>       count <span class="op">=</span> <span class="cn">FALSE</span>, overid <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check match: throws an informative error for non-matched elements</span></span>
<span><span class="co"># Default message reflects frequent internal use to check data frame columns</span></span>
<span><span class="fu">ckmatch</span><span class="op">(</span><span class="va">x</span>, <span class="va">table</span>, e <span class="op">=</span> <span class="st">"Unknown columns:"</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Infix operators based on fmatch():</span></span>
<span><span class="va">x</span> <span class="op">%!in%</span> <span class="va">table</span>   <span class="co"># Opposite of %in%</span></span>
<span><span class="va">x</span> <span class="op">%iin%</span> <span class="va">table</span>   <span class="co"># = which(x %in% table), but more efficient</span></span>
<span><span class="va">x</span> <span class="op">%!iin%</span> <span class="va">table</span>  <span class="co"># = which(x %!in% table), but more efficient</span></span>
<span><span class="co"># Use set_collapse(mask = "%in%") to replace %in% with</span></span>
<span><span class="co"># a much faster version based on fmatch()</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>x</dt>
<dd><p>a vector, list or data frame whose elements are matched against <code>table</code>. If a list/data frame, matches are found by comparing rows, unlike <code><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></code> which compares columns.</p></dd>

  <dt>table</dt>
<dd><p>a vector, list or data frame to match against.</p></dd>

  <dt>nomatch</dt>
<dd><p>integer. Value to be returned in the case when no match is found. Default is <code>NA_integer_</code>.</p></dd>

  <dt>count</dt>
<dd><p>logical. Counts number of (unique) matches and attaches 4 attributes:</p><ul><li><p><code>"N.nomatch"</code>: The number of elements in <code>x</code> not matched <code>= sum(result == nomatch)</code>.</p></li>
<li><p><code>"N.groups"</code>: The size of the table <code> = NROW(table)</code>.</p></li>
<li><p><code>"N.distinct"</code>: The number of unique matches <code> = fndistinct(result[result != nomatch])</code>.</p></li>
<li><p><code>"class"</code>: The <code><a href="qF.html">"qG"</a></code> class: needed for optimized computations on the results object (e.g. <code>funique(result)</code>, which is needed for a full join).</p></li>
</ul><p><em>Note</em> that computing these attributes requires an extra pass through the matching vector. Also note that these attributes contain no general information about whether either <code>x</code> or <code>table</code> are unique, except for two special cases when N.groups = N.distinct (table is unique) or length(result) = N.distinct (x is unique). Otherwise use <code><a href="funique.html">any_duplicated</a></code> to check x/table.</p></dd>

  <dt>overid</dt>
<dd><p>integer. If <code>x/table</code> are lists/data frames, <code>fmatch</code> compares the rows incrementally, starting with the first two columns, and matching further columns as necessary (see Details). Overidentification corresponds to the case when a subset of the columns uniquely identify the data. In this case this argument controls the behavior:</p><ul><li><p><code>0</code>: Early termination: stop matching additional columns. Most efficient.</p></li>
<li><p><code>1</code>: Continue matching columns and issue a warning that the data is overidentified.</p></li>
<li><p><code>2</code>: Continue matching columns without warning.</p></li>
</ul><p></p></dd>

<dt>e</dt>
<dd><p>the error message thrown by <code>ckmatch</code> for non-matched elements. The message is followed by the comma-separated non-matched elements.</p></dd>

<dt>...</dt>
<dd><p>further arguments to <code>fmatch</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>Integer vector containing the positions of first matches of <code>x</code> in <code>table</code>. <code>nomatch</code> is returned for elements of <code>x</code> that have no match in <code>table</code>. If <code>count = TRUE</code>, the result has additional attributes and a class <code><a href="qF.html">"qG"</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>With data frames / lists, <code>fmatch</code> compares the rows but moves through the data on a column-by-column basis (like a vectorized hash join algorithm). With two or more columns, the first two columns are hashed simultaneously for speed. Further columns can be added to this match. It is likely that the first 2, 3, 4 etc. columns of a data frame fully identify the data. After each column <code>fmatch()</code> internally checks whether the <code>table</code> rows that are still eligible for matching (eliminating <code>nomatch</code> rows from earlier columns) are unique. If this is the case and <code>overid = 0</code>, <code>fmatch()</code> terminates early without considering further columns. This is efficient but may give undesirable/wrong results if considering further columns would turn some additional elements of the result vector into <code>nomatch</code> values.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="join.html">join</a></code>, <code><a href="funique.html">funique</a></code>, <code><a href="group.html">group</a></code>, <a href="fast-grouping-ordering.html">Fast Grouping and Ordering</a>, <a href="collapse-documentation.html">Collapse Overview</a></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"a"</span>, <span class="st">"e"</span>, <span class="st">"f"</span>, <span class="st">"ff"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">fmatch</span><span class="op">(</span><span class="va">x</span>, <span class="va">letters</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  2  3  1  5  6 NA</span>
<span class="r-in"><span><span class="fu">fmatch</span><span class="op">(</span><span class="va">x</span>, <span class="va">letters</span>, nomatch <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2 3 1 5 6 0</span>
<span class="r-in"><span><span class="fu">fmatch</span><span class="op">(</span><span class="va">x</span>, <span class="va">letters</span>, count <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  2  3  1  5  6 NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"N.nomatch")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"N.groups")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 26</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"N.distinct")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "qG"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Table 1</span></span></span>
<span class="r-in"><span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  id1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  id2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"b"</span>, <span class="st">"c"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"John"</span>, <span class="st">"Bob"</span>, <span class="st">"Jane"</span>, <span class="st">"Carl"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   id1 id2 name</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   1   a John</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   1   b  Bob</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   2   b Jane</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   3   c Carl</span>
<span class="r-in"><span><span class="co"># Table 2</span></span></span>
<span class="r-in"><span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  id1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  id2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"e"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"John"</span>, <span class="st">"Janne"</span>, <span class="st">"Carl"</span>, <span class="st">"Lynne"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   id1 id2  name</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   1   a  John</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   2   b Janne</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   3   c  Carl</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   3   e Lynne</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># This gives an overidentification warning: columns 1:2 identify the data</span></span></span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="fu">fmatch</span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># This just runs through without warning</span></span></span>
<span class="r-in"><span><span class="fu">fmatch</span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span>, overid <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  1 NA NA  3</span>
<span class="r-in"><span><span class="co"># This terminates computation after first 2 columns</span></span></span>
<span class="r-in"><span><span class="fu">fmatch</span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span>, overid <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  1 NA  2  3</span>
<span class="r-in"><span><span class="fu">fmatch</span><span class="op">(</span><span class="va">df1</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, <span class="va">df2</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>  <span class="co"># Same thing!</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  1 NA  2  3</span>
<span class="r-in"><span><span class="co"># -&gt; note that here we get an additional match based on the unique ids,</span></span></span>
<span class="r-in"><span><span class="co"># which we didn't get before because "Jane" != "Janne"</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Sebastian Krantz.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

    </footer></div>

  

  

  </body></html>

